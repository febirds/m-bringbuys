var wysihtml5={version:"0.5.2",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46};wysihtml5.polyfills=function(e,t){String.prototype.trim||!function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),function(){var i="addEventListener",n="removeEventListener";t[i]||(e.Element.prototype[i]=e[i]=t[i]=function(t,i,n){return(n=this).attachEvent("on"+t,function(t){var t=t||e.event;t.target=t.target||t.srcElement,t.preventDefault=t.preventDefault||function(){t.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){t.cancelBubble=!0},t.which=t.button?2===t.button?3:4===t.button?2:t.button:t.keyCode,i.call(n,t)})},e.Element.prototype[n]=e[n]=t[n]=function(e,t){return this.detachEvent("on"+e,t)})}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(e.Element.prototype,"textContent").get&&!function(){var t=Object.getOwnPropertyDescriptor(e.Element.prototype,"innerText");Object.defineProperty(e.Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})}(),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var i=this.length,n=-1,o=t>>>0;~(i-o);n=this[--i]===e?i:n);return n}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o}),function(e){e.matches=e.matches||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,i=(t.document||t.ownerDocument).querySelectorAll(e),n=0;i[n]&&i[n]!==t;)++n;return i[n]?!0:!1},e.closest=e.closest||function(e){for(var t=this;t&&!t.matches(e);)t=t.parentElement;return t}}(Element.prototype),"document"in e&&("classList"in t.createElement("_")?"DOMTokenList"in e&&!function(){"use strict";var i=t.createElement("_");if(i.classList.add("c1","c2"),!i.classList.contains("c2")){var n=function(t){var i=e.DOMTokenList.prototype[t];e.DOMTokenList.prototype[t]=function(e){var t,n=arguments.length;for(t=0;n>t;t++)e=arguments[t],i.call(this,e)}};n("add"),n("remove")}if(i.classList.toggle("c3",!1),i.classList.contains("c3")){var o=e.DOMTokenList.prototype.toggle;e.DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:o.call(this,e)}}i=null}():!function(e){"use strict";if("Element"in e){var t="classList",i="prototype",n=e.Element[i],o=Object,a=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[i].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},d=function(e){for(var t=a.call(e.getAttribute("class")||""),i=t?t.split(/\s+/):[],n=0,o=i.length;o>n;n++)this.push(i[n]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=d[i]=[],h=function(){return new d(this)};if(s[i]=Error[i],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==l(this,e)},c.add=function(){var e,t=arguments,i=0,n=t.length,o=!1;do e=t[i]+"",-1===l(this,e)&&(this.push(e),o=!0);while(++i<n);o&&this._updateClassName()},c.remove=function(){var e,t,i=arguments,n=0,o=i.length,a=!1;do for(e=i[n]+"",t=l(this,e);-1!==t;)this.splice(t,1),a=!0,t=l(this,e);while(++n<o);a&&this._updateClassName()},c.toggle=function(e,t){e+="";var i=this.contains(e),n=i?t!==!0&&"remove":t!==!1&&"add";return n&&this[n](e),t===!0||t===!1?t:!i},c.toString=function(){return this.join(" ")},o.defineProperty){var u={get:h,enumerable:!0,configurable:!0};try{o.defineProperty(n,t,u)}catch(m){-2146823252===m.number&&(u.enumerable=!1,o.defineProperty(n,t,u))}}else o[i].__defineGetter__&&n.__defineGetter__(t,h)}}(e));var i=function(){if("createRange"in document&&"getSelection"in window){var e,t,i=document.createElement("div"),n=document.createTextNode("a"),o=document.createTextNode("a"),a=document.createTextNode("a"),r=document.createRange();return i.setAttribute("contenteditable","true"),i.appendChild(n),i.appendChild(o),i.appendChild(a),document.body.appendChild(i),r.setStart(o,1),r.setEnd(o,1),e=window.getSelection(),e.removeAllRanges(),e.addRange(r),i.normalize(),e=window.getSelection(),t=1!==i.childNodes.length||e.anchorNode!==i.firstChild||2!==e.anchorOffset,i.parentNode.removeChild(i),e.removeAllRanges(),t}},n=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t.push(e):t=t.concat(n(e));return t},o=function(){Node.prototype.normalize;var e=function(){var e=n(this),t=this.ownerDocument.defaultView.getSelection(),i=t.anchorNode,o=t.anchorOffset,a=i&&1===i.nodeType&&i.childNodes.length>0?i.childNodes[o]:void 0,r=t.focusNode,s=t.focusOffset,l=r&&1===r.nodeType&&s>0?r.childNodes[s-1]:void 0,d=this.ownerDocument.createRange(),c=e.shift(),h=c?e.shift():null;for(l&&3===l.nodeType&&(r=l,s=l.nodeValue.length,l=void 0),a&&3===a.nodeType&&(i=a,o=0,a=void 0),(i===r&&o>s||i!==r&&i.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_PRECEDING&&!(i.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_CONTAINS))&&(r=[i,i=r][0],s=[o,o=s][0]);c&&h;)h.previousSibling&&h.previousSibling===c?(i===h&&(i=c,o=c.nodeValue.length+o),r===h&&(r=c,s=c.nodeValue.length+s),c.nodeValue=c.nodeValue+h.nodeValue,h.parentNode.removeChild(h),h=e.shift()):(c=h,h=e.shift());l&&(s=Array.prototype.indexOf.call(l.parentNode.childNodes,l)+1),a&&(o=Array.prototype.indexOf.call(a.parentNode.childNodes,a)),i&&i.parentNode&&r&&r.parentNode&&(d.setStart(i,o),d.setEnd(r,s),t.removeAllRanges(),t.addRange(d))};Node.prototype.normalize=e},a=function(){window.removeEventListener("load",a),"Node"in window&&"normalize"in Node.prototype&&i()&&o()};"complete"!==t.readyState?window.addEventListener("load",a):a()},wysihtml5.polyfills(window,document),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var i=typeof e[t];return i==w||!(i!=v||!e[t])||"unknown"==i}function t(e,t){return!(typeof e[t]!=v||!e[t])}function i(e,t){return typeof e[t]!=C}function n(e){return function(t,i){for(var n=i.length;n--;)if(!e(t,i[n]))return!1;return!0}}function o(e){return e&&T(e,k)&&_(e,S)}function a(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function r(t){typeof console!=C&&e(console,"log")&&console.log(t)}function s(e,t){R&&t?alert(e):r(e)}function l(e){I.initialized=!0,I.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,I.config.alertOnFail)}function d(e){s("Rangy warning: "+e,I.config.alertOnWarn)}function c(e){return e.message||e.description||String(e)}function h(){if(R&&!I.initialized){var t,i=!1,n=!1;e(document,"createRange")&&(t=document.createRange(),T(t,x)&&_(t,E)&&(i=!0));var s=a(document);if(!s||"body"!=s.nodeName.toLowerCase())return l("No body element found"),void 0;if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(n=!0)),!i&&!n)return l("Neither Range nor TextRange are available"),void 0;I.initialized=!0,I.features={implementsDomRange:i,implementsTextRange:n};var d,h;for(var u in L)(d=L[u])instanceof g&&d.init(d,I);for(var m=0,p=D.length;p>m;++m)try{D[m](I)}catch(f){h="Rangy init listener threw an exception. Continuing. Detail: "+c(f),r(h)}}}function u(e,t,i){i&&(e+=" in module "+i.name),I.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function m(e,t,i,n){e[t]=function(){return u(t,i,n),e[i].apply(e,O.toArray(arguments))}}function p(e){e=e||window,h();for(var t=0,i=B.length;i>t;++t)B[t](e)}function g(e,t,i){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=i}function f(e,t,i){var n=new g(e,t,function(t){if(!t.initialized){t.initialized=!0;try{i(I,t),t.supported=!0}catch(n){var o="Module '"+e+"' failed to load: "+c(n);r(o),n.stack&&r(n.stack)}}});return L[e]=n,n}function y(){}function b(){}var v="object",w="function",C="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],k=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=n(e),N=n(t),_=n(i),A=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var i=0,n=e.length;n>i;++i)t(e[i],i)},L={},R=typeof window!=C&&typeof document!=C,O={isHostMethod:e,isHostObject:t,isHostProperty:i,areHostMethods:T,areHostObjects:N,areHostProperties:_,isTextRange:o,getBody:a,forEach:A},I={version:"1.3.0",initialized:!1,isBrowser:R,supported:!0,util:O,features:{},modules:L,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==C?!0:rangyAutoInitialize}};I.fail=l,I.warn=d;var P;({}).hasOwnProperty?(O.extend=P=function(e,t,i){var n,o;for(var a in t)t.hasOwnProperty(a)&&(n=e[a],o=t[a],i&&null!==n&&"object"==typeof n&&null!==o&&"object"==typeof o&&P(n,o,!0),e[a]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},O.createOptions=function(e,t){var i={};return P(i,t),e&&P(i,e),i}):l("hasOwnProperty not supported"),R||l("Rangy can only run in a browser"),function(){var e;if(R){var t=document.createElement("div");t.appendChild(document.createElement("span"));var i=[].slice;try{1==i.call(t.childNodes,0)[0].nodeType&&(e=function(e){return i.call(e,0)})}catch(n){}}e||(e=function(e){for(var t=[],i=0,n=e.length;n>i;++i)t[i]=e[i];return t}),O.toArray=e}();var M;R&&(e(document,"addEventListener")?M=function(e,t,i){e.addEventListener(t,i,!1)}:e(document,"attachEvent")?M=function(e,t,i){e.attachEvent("on"+t,i)}:l("Document does not have required addEventListener or attachEvent method"),O.addListener=M);var D=[];O.deprecationNotice=u,O.createAliasForDeprecatedMethod=m,I.init=h,I.addInitListener=function(e){I.initialized?e(I):D.push(e)};var B=[];I.addShimListener=function(e){B.push(e)},R&&(I.shim=I.createMissingNativeApi=p,m(I,"createMissingNativeApi","shim")),g.prototype={init:function(){for(var e,t,i=this.dependencies||[],n=0,o=i.length;o>n;++n){if(t=i[n],e=L[t],!(e&&e instanceof g))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){I.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){I.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},I.createModule=function(e){var t,i;2==arguments.length?(t=arguments[1],i=[]):(t=arguments[2],i=arguments[1]);var n=f(e,i,t);I.initialized&&I.supported&&n.init()},I.createCoreModule=function(e,t,i){f(e,t,i)},I.RangePrototype=y,I.rangePrototype=new y,I.selectionPrototype=new b,I.createCoreModule("DomUtil",[],function(e,t){function i(e){var t;return typeof e.namespaceURI==R||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function a(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function r(e,t){var i,n=[];for(i=e;i;i=i.parentNode)n.push(i);for(i=t;i;i=i.parentNode)if(D(n,i))return i;return null}function s(e,t,i){for(var n=i?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t){return s(e,t,!0)}function d(e,t,i){for(var n,o=i?e:e.parentNode;o;){if(n=o.parentNode,n===t)return o;o=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function h(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function u(e,t){var i=t.nextSibling,n=t.parentNode;return i?n.insertBefore(e,i):n.appendChild(e),e}function m(e,t,i){var n=e.cloneNode(!1);if(n.deleteData(0,t),e.deleteData(t,e.length-t),u(n,e),i)for(var a,r=0;a=i[r++];)a.node==e&&a.offset>t?(a.node=n,a.offset-=t):a.node==e.parentNode&&a.offset>o(e)&&++a.offset;return n}function p(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=R)return e.ownerDocument;if(typeof e.document!=R)return e.document;if(e.parentNode)return p(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var i=p(e);if(typeof i.defaultView!=R)return i.defaultView;if(typeof i.parentWindow!=R)return i.parentWindow;throw t.createError("Cannot get a window object for node")}function f(e){if(typeof e.contentDocument!=R)return e.contentDocument;if(typeof e.contentWindow!=R)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function y(e){if(typeof e.contentWindow!=R)return e.contentWindow;if(typeof e.contentDocument!=R)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function b(e){return e&&O.isHostMethod(e,"setTimeout")&&O.isHostObject(e,"document")}function v(e,t,i){var n;if(e?O.isHostProperty(e,"nodeType")?n=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?f(e):p(e):b(e)&&(n=e.document):n=document,!n)throw t.createError(i+"(): Parameter must be a Window object or DOM node");return n}function w(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,i,n,a){var s,l,c,h,u;if(e==n)return i===a?0:a>i?-1:1;if(s=d(n,e,!0))return i<=o(s)?-1:1;if(s=d(e,n,!0))return o(s)<a?-1:1;if(l=r(e,n),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(c=e===l?l:d(e,l,!0),h=n===l?l:d(n,l,!0),c===h)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(u=l.firstChild;u;){if(u===c)return-1;if(u===h)return 1;u=u.nextSibling}}function E(e){var t;try{return t=e.parentNode,!1}catch(i){return!0}}function x(e){if(!e)return"[No node]";if(B&&E(e))return"[Broken node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,i=p(e).createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i}function k(e,t,i){var n=I(e),o=e.createElement("div");o.contentEditable=""+!!i,t&&(o.innerHTML=t);var a=n.firstChild;return a?n.insertBefore(o,a):n.appendChild(o),o}function T(e){return e.parentNode.removeChild(e)}function N(e){this.root=e,this._next=e}function _(e){return new N(e)}function A(e,t){this.node=e,this.offset=t}function L(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var R="undefined",O=e.util,I=O.getBody;O.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),O.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var P=document.createElement("div");O.areHostMethods(P,["insertBefore","appendChild","cloneNode"]||!O.areHostObjects(P,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),O.isHostProperty(P,"innerHTML")||t.fail("Element is missing innerHTML property");var M=document.createTextNode("test");O.areHostMethods(M,["splitText","deleteData","insertData","appendData","cloneNode"]||!O.areHostObjects(P,["previousSibling","nextSibling","childNodes","parentNode"])||!O.areHostProperties(M,["data"]))||t.fail("Incomplete Text Node implementation");var D=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1},B=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var i=t.firstChild;t.innerHTML="<br />",B=E(i),e.features.crashyTextNodes=B}();var z;typeof window.getComputedStyle!=R?z=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=R?z=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),N.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,i=this._current=this._next;if(this._current)if(e=i.firstChild)this._next=e;else{for(t=null;i!==this.root&&!(t=i.nextSibling);)i=i.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},L.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},L.prototype.toString=function(){return this.message},e.dom={arrayContains:D,isHtmlNamespace:i,parentElement:n,getNodeIndex:o,getNodeLength:a,getCommonAncestor:r,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:d,isCharacterDataNode:c,isTextOrCommentNode:h,insertAfter:u,splitDataNode:m,getDocument:p,getWindow:g,getIframeWindow:y,getIframeDocument:f,getBody:I,isWindow:b,getContentDocument:v,getRootContainer:w,comparePoints:C,isBrokenNode:E,inspectNode:x,getComputedStyleProperty:z,createTestElement:k,removeNode:T,fragmentFromNodeChildren:S,createIterator:_,DomPosition:A},e.DOMException=L}),I.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(H(e,t.startContainer)||H(e,t.endContainer))}function i(e){return e.document||j(e.startContainer)}function n(e){return G(e.startContainer)}function o(e){return new D(e.parentNode,$(e))}function a(e){return new D(e.parentNode,$(e)+1)}function r(e,t,i){var n=11==e.nodeType?e.firstChild:e;return z(t)?i==t.length?P.insertAfter(e,t):t.parentNode.insertBefore(e,0==i?t:F(t,i)):i>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[i]),n}function s(e,t,n){if(S(e),S(t),i(t)!=i(e))throw new B("WRONG_DOCUMENT_ERR");var o=q(e.startContainer,e.startOffset,t.endContainer,t.endOffset),a=q(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=o&&a>=0:0>o&&a>0}function l(e){for(var t,n,o,a=i(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(o=e.getSubtreeIterator(),n.appendChild(l(o)),o.detach()),10==n.nodeType)throw new B("HIERARCHY_REQUEST_ERR");a.appendChild(n)}return a}function d(e,t,i){var n,o;i=i||{stop:!1};for(var a,r;a=e.next();)if(e.isPartiallySelectedSubtree()){if(t(a)===!1)return i.stop=!0,void 0;if(r=e.getSubtreeIterator(),d(r,t,i),r.detach(),i.stop)return}else for(n=P.createIterator(a);o=n.next();)if(t(o)===!1)return i.stop=!0,void 0}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach()):e.remove()}function h(e){for(var t,n,o=i(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(h(n)),n.detach()):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function u(e,t,i){var n,o=!(!t||!t.length),a=!!i;o&&(n=new RegExp("^("+t.join("|")+")$"));var r=[];return d(new p(e,!1),function(t){if(!(o&&!n.test(t.nodeType)||a&&!i(t))){var s=e.startContainer;if(t!=s||!z(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&z(l)&&0==e.endOffset||r.push(t)}}}),r}function m(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+P.inspectNode(e.startContainer)+":"+e.startOffset+", "+P.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var i=e.commonAncestorContainer;this.sc===this.ec&&z(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==i||z(this.sc)?V(this.sc,i,!0):this.sc.childNodes[this.so],this._last=this.ec!==i||z(this.ec)?V(this.ec,i,!0):this.ec.childNodes[this.eo-1])}}function g(e){return function(t,i){for(var n,o=i?t:t.parentNode;o;){if(n=o.nodeType,W(e,n))return o;o=o.parentNode}return null}}function f(e,t){if(nt(e,t))throw new B("INVALID_NODE_TYPE_ERR")}function y(e,t){if(!W(t,e.nodeType))throw new B("INVALID_NODE_TYPE_ERR")}function b(e,t){if(0>t||t>(z(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function v(e,t){if(tt(e,!0)!==tt(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function w(e){if(it(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function C(e,t){if(!e)throw new B(t)}function E(e,t){return t<=(z(e)?e.length:e.childNodes.length)}function x(e){return!!e.startContainer&&!!e.endContainer&&!(K&&(P.isBrokenNode(e.startContainer)||P.isBrokenNode(e.endContainer)))&&G(e.startContainer)==G(e.endContainer)&&E(e.startContainer,e.startOffset)&&E(e.endContainer,e.endOffset)}function S(e){if(!x(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function k(e,t){S(e);var i=e.startContainer,n=e.startOffset,o=e.endContainer,a=e.endOffset,r=i===o;z(o)&&a>0&&a<o.length&&F(o,a,t),z(i)&&n>0&&n<i.length&&(i=F(i,n,t),r?(a-=n,o=i):o==i.parentNode&&a>=$(i)&&a++,n=0),e.setStartAndEnd(i,n,o,a)}function T(e){S(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function N(e){e.START_TO_START=dt,e.START_TO_END=ct,e.END_TO_END=ht,e.END_TO_START=ut,e.NODE_BEFORE=mt,e.NODE_AFTER=pt,e.NODE_BEFORE_AND_AFTER=gt,e.NODE_INSIDE=ft}function _(e){N(e),N(e.prototype)}function A(e,t){return function(){S(this);var i,n,o=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,l=new p(this,!0);o!==s&&(i=V(o,s,!0),n=a(i),o=n.node,r=n.offset),d(l,w),l.reset();var c=e(l);return l.detach(),t(this,o,r,o,r),c}}function L(i,n){function r(e,t){return function(i){y(i,X),y(G(i),J);var n=(e?o:a)(i);(t?s:l)(this,n.node,n.offset)}}function s(e,t,i){var o=e.endContainer,a=e.endOffset;(t!==e.startContainer||i!==e.startOffset)&&((G(t)!=G(o)||1==q(t,i,o,a))&&(o=t,a=i),n(e,t,i,o,a))}function l(e,t,i){var o=e.startContainer,a=e.startOffset;(t!==e.endContainer||i!==e.endOffset)&&((G(t)!=G(o)||-1==q(t,i,o,a))&&(o=t,a=i),n(e,o,a,t,i))}var d=function(){};d.prototype=e.rangePrototype,i.prototype=new d,M.extend(i.prototype,{setStart:function(e,t){f(e,!0),b(e,t),s(this,e,t)},setEnd:function(e,t){f(e,!0),b(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],i=e[1],o=t,a=i;switch(e.length){case 3:a=e[2];break;case 4:o=e[2],a=e[3]}n(this,t,i,o,a)},setBoundary:function(e,t,i){this["set"+(i?"Start":"End")](e,t)},setStartBefore:r(!0,!0),setStartAfter:r(!1,!0),setEndBefore:r(!0,!1),setEndAfter:r(!1,!1),collapse:function(e){S(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){f(e,!0),n(this,e,0,e,U(e))},selectNode:function(e){f(e,!1),y(e,X);var t=o(e),i=a(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:A(h,n),deleteContents:A(c,n),canSurroundContents:function(){S(this),w(this.startContainer),w(this.endContainer);var e=new p(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},splitBoundaries:function(){k(this)},splitBoundariesPreservingPositions:function(e){k(this,e)},normalizeBoundaries:function(){S(this);var e,t=this.startContainer,i=this.startOffset,o=this.endContainer,a=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,a=e.length,e.appendData(t.data),Y(t))},s=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var r=e.length;if(i=n.length,e.insertData(0,n.data),Y(n),t==o)a+=i,o=t;else if(o==e.parentNode){var s=$(e);a==s?(o=e,a=r):a>s&&a--}}},l=!0;if(z(o))a==o.length?r(o):0==a&&(e=o.previousSibling,e&&e.nodeType==o.nodeType&&(a=e.length,t==o&&(l=!1),e.appendData(o.data),Y(o),o=e));else{if(a>0){var d=o.childNodes[a-1];d&&z(d)&&r(d)}l=!this.collapsed}if(l){if(z(t))0==i?s(t):i==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(o==e&&(o=t,a+=t.length),t.appendData(e.data),Y(e)));else if(i<t.childNodes.length){var c=t.childNodes[i];c&&z(c)&&s(c)}}else t=o,i=a;n(this,t,i,o,a)},collapseToPoint:function(e,t){f(e,!0),b(e,t),this.setStartAndEnd(e,t)}}),_(i)}function R(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:P.getCommonAncestor(e.startContainer,e.endContainer)}function O(e,t,i,n,o){e.startContainer=t,e.startOffset=i,e.endContainer=n,e.endOffset=o,e.document=P.getDocument(t),R(e)}function I(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,R(this)}var P=e.dom,M=e.util,D=P.DomPosition,B=e.DOMException,z=P.isCharacterDataNode,$=P.getNodeIndex,H=P.isOrIsAncestorOf,j=P.getDocument,q=P.comparePoints,F=P.splitDataNode,V=P.getClosestAncestorIn,U=P.getNodeLength,W=P.arrayContains,G=P.getRootContainer,K=e.features.crashyTextNodes,Y=P.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,z(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,i=this._current;!z(i)||i!==this.sc&&i!==this.ec?i.parentNode&&Y(i):(e=i===this.sc?this.so:0,t=i===this.ec?this.eo:i.length,e!=t&&i.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new I(i(this.range));var t=this._current,n=t,o=0,a=t,r=U(t);H(t,this.sc)&&(n=this.sc,o=this.so),H(t,this.ec)&&(a=this.ec,r=this.eo),O(e,n,o,a,r)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var X=[1,3,4,5,7,8,10],J=[2,9,11],Z=[5,6,10,12],Q=[1,3,4,5,7,8,10,11],et=[1,3,4,5,7,8],tt=g([9,11]),it=g(Z),nt=g([6,10,12]),ot=document.createElement("style"),at=!1;try{ot.innerHTML="<b>x</b>",at=3==ot.firstChild.nodeType}catch(rt){}e.features.htmlParsingConforms=at;var st=at?function(e){var t=this.startContainer,i=j(t);if(!t)throw new B("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:z(t)&&(n=P.parentElement(t)),n=null===n||"HTML"==n.nodeName&&P.isHtmlNamespace(j(n).documentElement)&&P.isHtmlNamespace(n)?i.createElement("body"):n.cloneNode(!1),n.innerHTML=e,P.fragmentFromNodeChildren(n)}:function(e){var t=i(this),n=t.createElement("body");return n.innerHTML=e,P.fragmentFromNodeChildren(n)},lt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],dt=0,ct=1,ht=2,ut=3,mt=0,pt=1,gt=2,ft=3;M.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){S(this),v(this.startContainer,t.startContainer);var i,n,o,a,r=e==ut||e==dt?"start":"end",s=e==ct||e==dt?"start":"end";return i=this[r+"Container"],n=this[r+"Offset"],o=t[s+"Container"],a=t[s+"Offset"],q(i,n,o,a)},insertNode:function(e){if(S(this),y(e,Q),w(this.startContainer),H(e,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");var t=r(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){S(this);var e,t;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&z(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=i(this).createDocumentFragment(),t.appendChild(e),t;var n=new p(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){S(this),w(this.startContainer),w(this.endContainer);var e=new p(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},surroundContents:function(e){if(y(e,et),!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);r(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){S(this);for(var e,t=new I(i(this)),n=lt.length;n--;)e=lt[n],t[e]=this[e];return t},toString:function(){S(this);var e=this.startContainer;if(e===this.endContainer&&z(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],i=new p(this,!0);return d(i,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),i.detach(),t.join("")},compareNode:function(e){S(this);var t=e.parentNode,i=$(e);if(!t)throw new B("NOT_FOUND_ERR");var n=this.comparePoint(t,i),o=this.comparePoint(t,i+1);return 0>n?o>0?gt:mt:o>0?pt:ft},comparePoint:function(e,t){return S(this),C(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),q(e,t,this.startContainer,this.startOffset)<0?-1:q(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:st,toHtml:function(){return T(this)},intersectsNode:function(e,t){if(S(this),G(e)!=n(this))return!1;var i=e.parentNode,o=$(e);if(!i)return!0;var a=q(i,o,this.endContainer,this.endOffset),r=q(i,o+1,this.startContainer,this.startOffset);return t?0>=a&&r>=0:0>a&&r>0},isPointInRange:function(e,t){return S(this),C(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),q(e,t,this.startContainer,this.startOffset)>=0&&q(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=q(this.startContainer,this.startOffset,e.startContainer,e.startOffset),i=q(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return-1==t&&n.setStart(e.startContainer,e.startOffset),1==i&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==q(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==q(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new B("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ft},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,U(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();return t.setEnd(n,n.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return S(this),u(this,e,t)},getDocument:function(){return i(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=i(this),o=e.createRange(n);t=t||P.getBody(n),o.selectNodeContents(t);var a=this.intersection(o),r=0,s=0;return a&&(o.setEnd(a.startContainer,a.startOffset),r=o.toString().length,s=r+a.toString().length),{start:r,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,i=0;this.setStart(t,0),this.collapse(!0);for(var n,o,a,r,s=[t],l=!1,d=!1;!d&&(n=s.pop());)if(3==n.nodeType)o=i+n.length,!l&&e.start>=i&&e.start<=o&&(this.setStart(n,e.start-i),l=!0),l&&e.end>=i&&e.end<=o&&(this.setEnd(n,e.end-i),d=!0),i=o;
else for(r=n.childNodes,a=r.length;a--;)s.push(r[a])},getName:function(){return"DomRange"},equals:function(e){return I.rangesEqual(this,e)},isValid:function(){return x(this)},inspect:function(){return m(this)},detach:function(){}}),L(I,O),M.extend(I,{rangeProperties:lt,RangeIterator:p,copyComparisonConstants:_,createPrototypeRange:L,inspect:m,toHtml:T,getRangeDocument:i,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=I}),I.createCoreModule("WrappedRange",["DomRange"],function(e,t){var i,n,o=e.dom,a=e.util,r=o.DomPosition,s=e.DomRange,l=o.getBody,d=o.getContentDocument,c=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function n(e){for(var t,i=u.length;i--;)t=u[i],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function r(e,t,i,n,o){var a=e.startContainer!==t||e.startOffset!=i,r=e.endContainer!==n||e.endOffset!=o,s=!e.equals(e.nativeRange);(a||r||s)&&(e.setEnd(n,o),e.setStart(t,i))}var c,h,u=s.rangeProperties;i=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,n(this)},s.createPrototypeRange(i,r),c=i.prototype,c.selectNode=function(e){this.nativeRange.selectNode(e),n(this)},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(e){this.nativeRange.surroundContents(e),n(this)},c.collapse=function(e){this.nativeRange.collapse(e),n(this)},c.cloneRange=function(){return new i(this.nativeRange.cloneRange())},c.refresh=function(){n(this)},c.toString=function(){return this.nativeRange.toString()};var m=document.createTextNode("test");l(document).appendChild(m);var p=document.createRange();p.setStart(m,0),p.setEnd(m,0);try{p.setStart(m,1),c.setStart=function(e,t){this.nativeRange.setStart(e,t),n(this)},c.setEnd=function(e,t){this.nativeRange.setEnd(e,t),n(this)},h=function(e){return function(t){this.nativeRange[e](t),n(this)}}}catch(g){c.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(i){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}n(this)},c.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(i){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}n(this)},h=function(e,t){return function(i){try{this.nativeRange[e](i)}catch(o){this.nativeRange[t](i),this.nativeRange[e](i)}n(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore"),c.setStartAfter=h("setStartAfter","setEndAfter"),c.setEndBefore=h("setEndBefore","setStartBefore"),c.setEndAfter=h("setEndAfter","setStartAfter"),c.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},p.selectNodeContents(m),p.setEnd(m,3);var f=document.createRange();f.selectNodeContents(m),f.setEnd(m,4),f.setStart(m,2),c.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,f)&&1==p.compareBoundaryPoints(p.END_TO_START,f)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var b=y.firstChild,v=l(document);v.appendChild(y),p.setStart(b,1),p.setEnd(b,2),p.deleteContents(),"13"==b.data&&(c.deleteContents=function(){this.nativeRange.deleteContents(),n(this)},c.extractContents=function(){var e=this.nativeRange.extractContents();return n(this),e}),v.removeChild(y),v=null,a.isHostMethod(p,"createContextualFragment")&&(c.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(m),c.getName=function(){return"WrappedRange"},e.WrappedRange=i,e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var h=function(e){var t=e.parentElement(),i=e.duplicate();i.collapse(!0);var n=i.parentElement();i=e.duplicate(),i.collapse(!1);var a=i.parentElement(),r=n==a?n:o.getCommonAncestor(n,a);return r==t?r:o.getCommonAncestor(t,r)},u=function(e){return 0==e.compareEndPoints("StartToEnd",e)},m=function(e,t,i,n,a){var s=e.duplicate();s.collapse(i);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var d=new r(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var h=o.getDocument(l).createElement("span");h.parentNode&&o.removeNode(h);for(var u,m,p,g,f,y=i?"StartToStart":"StartToEnd",b=a&&a.containerElement==l?a.nodeIndex:0,v=l.childNodes.length,w=v,C=w;;){if(C==v?l.appendChild(h):l.insertBefore(h,l.childNodes[C]),s.moveToElementText(h),u=s.compareEndPoints(y,e),0==u||b==w)break;if(-1==u){if(w==b+1)break;b=C}else w=w==b+1?b:C;C=Math.floor((b+w)/2),l.removeChild(h)}if(f=h.nextSibling,-1==u&&f&&c(f)){s.setEndPoint(i?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(f.data)){var x=s.duplicate(),S=x.text.replace(/\r\n/g,"\r").length;for(E=x.moveStart("character",S);-1==(u=x.compareEndPoints("StartToEnd",x));)E++,x.moveStart("character",1)}else E=s.text.length;g=new r(f,E)}else m=(n||!i)&&h.previousSibling,p=(n||i)&&h.nextSibling,g=p&&c(p)?new r(p,0):m&&c(m)?new r(m,m.data.length):new r(l,o.getNodeIndex(h));return o.removeNode(h),{boundaryPosition:g,nodeInfo:{nodeIndex:C,containerElement:l}}},p=function(e,t){var i,n,a,r,s=e.offset,d=o.getDocument(e.node),h=l(d).createTextRange(),u=c(e.node);return u?(i=e.node,n=i.parentNode):(r=e.node.childNodes,i=s<r.length?r[s]:null,n=e.node),a=d.createElement("span"),a.innerHTML="&#feff;",i?n.insertBefore(a,i):n.appendChild(a),h.moveToElementText(a),h.collapse(!t),n.removeChild(a),u&&h[t?"moveStart":"moveEnd"]("character",s),h};n=function(e){this.textRange=e,this.refresh()},n.prototype=new s(document),n.prototype.refresh=function(){var e,t,i,n=h(this.textRange);u(this.textRange)?t=e=m(this.textRange,n,!0,!0).boundaryPosition:(i=m(this.textRange,n,!0,!1),e=i.boundaryPosition,t=m(this.textRange,n,!1,!1,i.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},n.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(n);var g=function(e){if(e.collapsed)return p(new r(e.startContainer,e.startOffset),!0);var t=p(new r(e.startContainer,e.startOffset),!0),i=p(new r(e.endContainer,e.endOffset),!1),n=l(s.getRangeDocument(e)).createTextRange();return n.setEndPoint("StartToStart",t),n.setEndPoint("EndToEnd",i),n};if(n.rangeToTextRange=g,n.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=n,!e.features.implementsDomRange||e.config.preferTextRange){var f=function(e){return e("return this;")()}(Function);"undefined"==typeof f.Range&&(f.Range=n),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=n}}e.createRange=function(i){return i=d(i,t,"createRange"),new e.WrappedRange(e.createNativeRange(i))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},a.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),a.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var i=t.document;"undefined"==typeof i.createRange&&(i.createRange=function(){return e.createRange(i)}),i=t=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function i(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function n(e,i){if(e){if(_.isWindow(e))return e;if(e instanceof y)return e.win;var n=_.getContentDocument(e,t,i);return _.getWindow(n)}return window}function o(e){return n(e,"getWinSelection").getSelection()}function a(e){return n(e,"getDocSelection").document.selection}function r(e){var t=!1;return e.anchorNode&&(t=1==_.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,i){var n=i?"end":"start",o=i?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function d(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function c(t){var i;return t instanceof R?(i=e.createNativeRange(t.getDocument()),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset)):t instanceof O?i=t.nativeRange:M.implementsDomRange&&t instanceof _.getWindow(t.startContainer).Range&&(i=t),i}function h(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,i=e.length;i>t;++t)if(!_.isAncestorOf(e[0],e[t]))return!1;return!0}function u(e){var i=e.getNodes();if(!h(i))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return i[0]}function m(e){return!!e&&"undefined"!=typeof e.text}function p(e,t){var i=new O(t);e._ranges=[i],s(e,i,!1),e.rangeCount=1,e.isCollapsed=i.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)d(t);else{var i=t.docSelection.createRange();if(m(i))p(t,i);else{t.rangeCount=i.length;for(var n,o=B(i.item(0)),a=0;a<t.rangeCount;++a)n=e.createRange(o),n.selectNode(i.item(a)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function f(e,i){for(var n=e.docSelection.createRange(),o=u(i),a=B(n.item(0)),r=z(a).createControlRange(),s=0,l=n.length;l>s;++s)r.add(n.item(s));try{r.add(o)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),g(e)}function y(e,t,i){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function b(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function v(e,t){for(var i,n,o=tt.length;o--;)if(i=tt[o],n=i.selection,"deleteAll"==t)b(n);else if(i.win==e)return"delete"==t?(tt.splice(o,1),!0):n;return"deleteAll"==t&&(tt.length=0),null}function w(e,i){for(var n,o=B(i[0].startContainer),a=z(o).createControlRange(),r=0,s=i.length;s>r;++r){n=u(i[r]);try{a.add(n)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a.select(),g(e)}function C(e,t){if(e.win.document!=B(t))throw new I("WRONG_DOCUMENT_ERR")}function E(t){return function(i,n){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](i,n)):(o=e.createRange(this.win.document),o.setStartAndEnd(i,n)),this.setSingleRange(o,this.isBackward())}}function x(e){var t=[],i=new P(e.anchorNode,e.anchorOffset),n=new P(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var a=0,r=e.rangeCount;r>a;++a)t[a]=R.inspect(e.getRangeAt(a));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,k,T="boolean",N="number",_=e.dom,A=e.util,L=A.isHostMethod,R=e.DomRange,O=e.WrappedRange,I=e.DOMException,P=_.DomPosition,M=e.features,D="Control",B=_.getDocument,z=_.getBody,$=R.rangesEqual,H=L(window,"getSelection"),j=A.isHostObject(document,"selection");M.implementsWinGetSelection=H,M.implementsDocSelection=j;var q=j&&(!H||e.config.preferTextRange);if(q)S=a,e.isSelectionValid=function(e){var t=n(e,"isSelectionValid").document,i=t.selection;return"None"!=i.type||B(i.createRange().parentElement())==t};else{if(!H)return t.fail("Neither document.selection or window.getSelection() detected."),!1;S=o,e.isSelectionValid=function(){return!0}}e.getNativeSelection=S;var F=S();if(!F)return t.fail("Native selection was null (possibly issue 138?)"),!1;var V=e.createNativeRange(document),U=z(document),W=A.areHostProperties(F,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=W;var G=L(F,"extend");M.selectionHasExtend=G;var K=typeof F.rangeCount==N;M.selectionHasRangeCount=K;var Y=!1,X=!0,J=G?function(t,i){var n=R.getRangeDocument(i),o=e.createRange(n);o.collapseToPoint(i.endContainer,i.endOffset),t.addRange(c(o)),t.extend(i.startContainer,i.startOffset)}:null;A.areHostMethods(F,["addRange","getRangeAt","removeAllRanges"])&&typeof F.rangeCount==N&&M.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var i=t.rangeCount,n=i>1,o=[],a=r(t),s=0;i>s;++s)o[s]=t.getRangeAt(s);var l=_.createTestElement(document,"",!1),d=l.appendChild(document.createTextNode("   ")),c=document.createRange();if(c.setStart(d,1),c.collapse(!0),t.removeAllRanges(),t.addRange(c),X=1==t.rangeCount,t.removeAllRanges(),!n){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)Y=!1;else{var u=c.cloneRange();c.setStart(d,0),u.setEnd(d,3),u.setStart(d,2),t.addRange(c),t.addRange(u),Y=2==t.rangeCount}}for(_.removeNode(l),t.removeAllRanges(),s=0;i>s;++s)0==s&&a?J?J(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),M.selectionSupportsMultipleRanges=Y,M.collapsedNonEditableSelectionsSupported=X;var Z,Q=!1;U&&L(U,"createControlRange")&&(Z=U.createControlRange(),A.areHostProperties(Z,["item","add"])&&(Q=!0)),M.implementsControlRange=Q,k=W?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var et;L(F,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}:W&&(et=function(t){var i=B(t.anchorNode),n=e.createRange(i);return n.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),n}),y.prototype=e.selectionPrototype;var tt=[],it=function(e){if(e&&e instanceof y)return e.refresh(),e;e=n(e,"getNativeSelection");var t=v(e),i=S(e),o=j?a(e):null;return t?(t.nativeSelection=i,t.docSelection=o,t.refresh()):(t=new y(i,o,e),tt.push({win:e,selection:t})),t};e.getSelection=it,A.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var nt=y.prototype;if(!q&&W&&A.areHostMethods(F,["removeAllRanges","addRange"])){nt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),d(this)};var ot=function(e,t){J(e.nativeSelection,t),e.refresh()};nt.addRange=K?function(t,n){if(Q&&j&&this.docSelection.type==D)f(this,t);else if(i(n)&&G)ot(this,t);else{var o;Y?o=this.rangeCount:(this.removeAllRanges(),o=0);var a=c(t).cloneRange();try{this.nativeSelection.addRange(a)}catch(r){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var l=et(this.nativeSelection,this.rangeCount-1);l&&!$(l,t)&&(t=new O(l))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=k(this)}else this.refresh()}}:function(e,t){i(t)&&G?ot(this,e):(this.nativeSelection.addRange(c(e)),this.refresh())},nt.setRanges=function(e){if(Q&&j&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,i=e.length;i>t;++t)this.addRange(e[t])}}}else{if(!(L(F,"empty")&&L(V,"select")&&Q&&q))return t.fail("No means of selecting a Range or TextRange was found"),!1;nt.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=B(this.anchorNode);else if(this.docSelection.type==D){var t=this.docSelection.createRange();t.length&&(e=B(t.item(0)))}if(e){var i=z(e).createTextRange();i.select(),this.docSelection.empty()}}}catch(n){}d(this)},nt.addRange=function(t){this.docSelection.type==D?f(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},nt.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}nt.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var at;if(q)at=function(t){var i;e.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=z(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==D?g(t):m(i)?p(t,i):d(t)};else if(L(F,"getRangeAt")&&typeof F.rangeCount==N)at=function(t){if(Q&&j&&t.docSelection.type==D)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,n=t.rangeCount;n>i;++i)t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i));s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=k(t)}else d(t)};else{if(!W||typeof F.isCollapsed!=T||typeof V.collapsed!=T||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;at=function(e){var t,i=e.nativeSelection;i.anchorNode?(t=et(i,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=k(e)):d(e)}}nt.refresh=function(e){var t=e?this._ranges.slice(0):null,i=this.anchorNode,n=this.anchorOffset;if(at(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=i||this.anchorOffset!=n)return!0;for(;o--;)if(!$(t[o],this._ranges[o]))return!0;return!1}};var rt=function(e,t){var i=e.getAllRanges();e.removeAllRanges();for(var n=0,o=i.length;o>n;++n)$(t,i[n])||e.addRange(i[n]);e.rangeCount||d(e)};nt.removeRange=Q&&j?function(e){if(this.docSelection.type==D){for(var t,i=this.docSelection.createRange(),n=u(e),o=B(i.item(0)),a=z(o).createControlRange(),r=!1,s=0,l=i.length;l>s;++s)t=i.item(s),t!==n||r?a.add(i.item(s)):r=!0;a.select(),g(this)}else rt(this,e)}:function(e){rt(this,e)};var st;!q&&W&&M.implementsDomRange?(st=r,nt.isBackward=function(){return st(this)}):st=nt.isBackward=function(){return!1},nt.isBackwards=nt.isBackward,nt.toString=function(){for(var e=[],t=0,i=this.rangeCount;i>t;++t)e[t]=""+this._ranges[t];return e.join("")},nt.collapse=function(t,i){C(this,t);var n=e.createRange(t);n.collapseToPoint(t,i),this.setSingleRange(n),this.isCollapsed=!0},nt.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},nt.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},nt.selectAllChildren=function(t){C(this,t);var i=e.createRange(t);i.selectNodeContents(t),this.setSingleRange(i)},nt.deleteFromDocument=function(){if(Q&&j&&this.docSelection.type==D){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),_.removeNode(e);this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();if(i.length){this.removeAllRanges();for(var n=0,o=i.length;o>n;++n)i[n].deleteContents();this.addRange(i[o-1])}}},nt.eachRange=function(e,t){for(var i=0,n=this._ranges.length;n>i;++i)if(e(this.getRangeAt(i)))return t},nt.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},nt.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},nt.callMethodOnEachRange=function(e,t){var i=[];return this.eachRange(function(n){i.push(n[e].apply(n,t||[]))}),i},nt.setStart=E(!0),nt.setEnd=E(!1),e.rangePrototype.select=function(e){it(this.getDocument()).setSingleRange(this,e)},nt.changeEachRange=function(e){var t=[],i=this.isBackward();this.eachRange(function(i){e(i),t.push(i)}),this.removeAllRanges(),i&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},nt.containsNode=function(e,t){return this.eachRange(function(i){return i.containsNode(e,t)},!0)||!1},nt.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},nt.moveToBookmark=function(t){for(var i,n,o=[],a=0;i=t.rangeBookmarks[a++];)n=e.createRange(this.win),n.moveToBookmark(i),o.push(n);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},nt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},nt.restoreRanges=function(e){this.removeAllRanges();for(var t,i=0;t=e.ranges[i];++i)this.addRange(t,e.backward&&0==i)},nt.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(R.toHtml(t))}),e.join("")},M.implementsTextRange&&(nt.getNativeTextRange=function(){var i;if(i=this.docSelection){var n=i.createRange();if(m(n))return n;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),nt.getName=function(){return"WrappedSelection"},nt.inspect=function(){return x(this)},nt.detach=function(){v(this.win,"delete"),b(this)},y.detachAll=function(){v(null,"deleteAll")},y.inspect=x,y.isDirectionBackward=i,e.Selection=y,e.selectionPrototype=nt,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return it(e)}),e=null})});var z=!1,$=function(){z||(z=!0,!I.initialized&&I.config.autoInitialize&&h())};return R&&("complete"==document.readyState?$():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",$,!1),M(window,"load",$))),I},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("TextRange",["WrappedSelection"],function(e,t){function i(e,t){function i(e,t,i){s.push({start:e,end:t,isWord:i})}for(var n,o,a,r=e.join(""),s=[],l=0;n=t.wordRegex.exec(r);){if(o=n.index,a=o+n[0].length,o>l&&i(l,o,!1),t.includeTrailingSpace)for(;Z.test(e[a]);)++a;i(o,a,!0),l=a}return l<e.length&&i(l,e.length,!1),s}function n(e,t){for(var i=e.slice(t.start,t.end),n={isWord:t.isWord,chars:i,toString:function(){return i.join("")}},o=0,a=i.length;a>o;++o)i[o].token=n;return n}function o(e,t,i){for(var o,a=i(e,t),r=[],s=0;o=a[s++];)r.push(n(e,o));return r}function a(e){var t=e||"",i="string"==typeof t?t.split(""):t;return i.sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),i.join("").replace(/(.)\1+/g,"$1")}function r(e){var t,i;return e?(t=e.language||Q,i={},W(i,lt[t]||lt[Q]),W(i,e),i):lt[Q]}function s(e,t){var i=G(e,t);return t.hasOwnProperty("wordOptions")&&(i.wordOptions=r(i.wordOptions)),t.hasOwnProperty("characterOptions")&&(i.characterOptions=G(i.characterOptions,rt)),i}function l(e,t){var i=mt(e,"display",t),n=e.tagName.toLowerCase();return"block"==i&&at&&pt.hasOwnProperty(n)?pt[n]:i}function d(e){for(var t=p(e),i=0,n=t.length;n>i;++i)if(1==t[i].nodeType&&"none"==l(t[i]))return!0;return!1}function c(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==mt(t,"visibility")}function h(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(l(e))||9==e.nodeType||11==e.nodeType)}function u(e){return V.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function m(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function p(e){return m(e).concat([e])}function g(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}function f(e,t){return!t&&e.hasChildNodes()?e.firstChild:g(e)}function y(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var i=e.parentNode;return i&&1==i.nodeType?i:null}function b(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var i=e.parentNode;if(!i||1!=i.nodeType)return!1;var n=mt(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(n)||/^[\t\r ]+$/.test(t)&&"pre-line"==n}function v(e){if(""===e.data)return!0;if(!b(e))return!1;var t=e.parentNode;return t?d(e)?!0:!1:!0}function w(e){var t=e.nodeType;return 7==t||8==t||d(e)||/^(script|style)$/i.test(e.nodeName)||c(e)||v(e)}function C(e,t){var i=e.nodeType;return 7==i||8==i||1==i&&"none"==l(e,t)}function E(){this.store={}}function x(e,t,i){return function(n){var o=this.cache;if(o.hasOwnProperty(e))return gt++,o[e];ft++;var a=t.call(this,i?this[i]:this,n);return o[e]=a,a}}function S(e,t){this.node=e,this.session=t,this.cache=new E,this.positions=new E}function k(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new E}function T(){return"[Position("+V.inspectNode(this.node)+":"+this.offset+")]"}function N(){return A(),At=new Lt}function _(){return At||N()}function A(){At&&At.detach(),At=null}function L(e,i,n,o){function a(){var e=null;return i?(e=s,l||(s=s.previousVisible(),l=!s||n&&s.equals(n))):l||(e=s=s.nextVisible(),l=!s||n&&s.equals(n)),l&&(s=null),e}n&&(i?w(n.node)&&(n=e.previousVisible()):w(n.node)&&(n=n.nextVisible()));var r,s=e,l=!1,d=!1;return{next:function(){if(d)return d=!1,r;for(var e,t;e=a();)if(t=e.getCharacter(o))return r=e,e;return null},rewind:function(){if(!r)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");d=!0},dispose:function(){e=n=null}}}function R(e,t,i){function n(e){for(var t,i,n=[],o=e?a:r,s=!1,l=!1;t=o.next();){if(i=t.character,J.test(i))l&&(l=!1,s=!0);else{if(s){o.rewind();break}l=!0}n.push(t)}return n}var a=L(e,!1,null,t),r=L(e,!0,null,t),s=i.tokenizer,l=n(!0),d=n(!1).reverse(),c=o(d.concat(l),i,s),h=l.length?c.slice(Rt(c,l[0].token)):[],u=d.length?c.slice(0,Rt(c,d.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==h.length&&!(e=h[0]).isWord&&(t=n(!0)).length>0;)h=o(e.chars.concat(t),i,s);return h.shift()},previousStartToken:function(){for(var e,t;1==u.length&&!(e=u[0]).isWord&&(t=n(!1)).length>0;)u=o(t.reverse().concat(e.chars),i,s);return u.pop()},dispose:function(){a.dispose(),r.dispose(),h=u=null}}}function O(e,t,i,n,o){var a,r,s,l,d=0,c=e,h=Math.abs(i);if(0!==i){var u=0>i;switch(t){case q:for(r=L(e,u,null,n);(a=r.next())&&h>d;)++d,c=a;s=a,r.dispose();break;case F:for(var m=R(e,n,o),p=u?m.previousStartToken:m.nextEndToken;(l=p())&&h>d;)l.isWord&&(++d,c=u?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}u?(c=c.previousVisible(),d=-d):c&&c.isLeadingSpace&&!c.isTrailingSpace&&(t==F&&(r=L(e,!1,null,n),s=r.next(),r.dispose()),s&&(c=s.previousVisible()))}return{position:c,unitsMoved:d}}function I(e,t,i,n){var o=e.getRangeBoundaryPosition(t,!0),a=e.getRangeBoundaryPosition(t,!1),r=n?a:o,s=n?o:a;return L(r,!!n,s,i)}function P(e,t,i){for(var n,o=[],a=I(e,t,i);n=a.next();)o.push(n);return a.dispose(),o}function M(t,i,n){var o=e.createRange(t.node);return o.setStartAndEnd(t.node,t.offset,i.node,i.offset),!o.expand("word",{wordOptions:n})}function D(e,t,i,n,o){function a(e,t){var i=g[e].previousVisible(),n=g[t-1],a=!o.wholeWordsOnly||M(i,n,o.wordOptions);return{startPos:i,endPos:n,valid:a}}for(var r,s,l,d,c,h,u=et(o.direction),m=L(e,u,e.session.getRangeBoundaryPosition(n,u),o.characterOptions),p="",g=[],f=null;r=m.next();)if(s=r.character,i||o.caseSensitive||(s=s.toLowerCase()),u?(g.unshift(r),p=s+p):(g.push(r),p+=s),i){if(c=t.exec(p))if(l=c.index,d=l+c[0].length,h){if(!u&&d<p.length||u&&l>0){f=a(l,d);break}}else h=!0}else if(-1!=(l=p.indexOf(t))){f=a(l,l+t.length);break}return h&&(f=a(l,d)),m.dispose(),f}function B(e){return function(){var t=!!At,i=_(),n=[i].concat(U.toArray(arguments)),o=e.apply(this,n);return t||A(),o}}function z(e,t){return B(function(i,n,o,a){typeof o==j&&(o=n,n=q),a=s(a,ct);var r=e;t&&(r=o>=0,this.collapse(!r));var l=O(i.getRangeBoundaryPosition(this,r),n,o,a.characterOptions,a.wordOptions),d=l.position;return this[r?"setStart":"setEnd"](d.node,d.offset),l.unitsMoved})}function $(e){return B(function(t,i){i=G(i,rt);for(var n,o=I(t,this,i,!e),a=0;(n=o.next())&&J.test(n.character);)++a;o.dispose();var r=a>0;return r&&this[e?"moveStart":"moveEnd"]("character",e?a:-a,{characterOptions:i}),r})}function H(e){return B(function(t,i){var n=!1;return this.changeEachRange(function(t){n=t[e](i)||n}),n})}var j="undefined",q="character",F="word",V=e.dom,U=e.util,W=U.extend,G=U.createOptions,K=V.getBody,Y=/^[ \t\f\r\n]+$/,X=/^[ \t\f\r]+$/,J=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,Z=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,Q="en",et=e.Selection.isDirectionBackward,tt=!1,it=!1,nt=!1,ot=!0;!function(){var t=V.createTestElement(document,"<p>1 </p><p></p>",!0),i=t.firstChild,n=e.getSelection();n.collapse(i.lastChild,2),n.setStart(i.firstChild,0),tt=1==(""+n).length,t.innerHTML="1 <br />",n.collapse(t,2),n.setStart(t.firstChild,0),it=1==(""+n).length,t.innerHTML="1 <p>1</p>",n.collapse(t,2),n.setStart(t.firstChild,0),nt=1==(""+n).length,V.removeNode(t),n.removeAllRanges()}();var at,rt={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},st={includeBlockContentTrailingSpace:!ot,includeSpaceBeforeBr:!it,includeSpaceBeforeBlock:!nt,includePreLineTrailingSpace:!0},lt={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:i}},dt={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},ct={wordOptions:null,characterOptions:null},ht={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ut={wordOptions:null,characterOptions:null,direction:"forward"},mt=V.getComputedStyleProperty;!function(){var e=document.createElement("table"),t=K(document);t.appendChild(e),at="block"==mt(e,"display"),t.removeChild(e)}();var pt={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};E.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var gt=0,ft=0,yt={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new k(this,e))},toString:function(){return"[NodeWrapper("+V.inspectNode(this.node)+")]"}};S.prototype=yt;var bt="EMPTY",vt="NON_SPACE",wt="UNCOLLAPSIBLE_SPACE",Ct="COLLAPSIBLE_SPACE",Et="TRAILING_SPACE_BEFORE_BLOCK",xt="TRAILING_SPACE_IN_BLOCK",St="TRAILING_SPACE_BEFORE_BR",kt="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Tt="TRAILING_LINE_BREAK_AFTER_BR",Nt="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";W(yt,{isCharacterDataNode:x("isCharacterDataNode",V.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",V.getNodeIndex,"node"),getLength:x("nodeLength",V.getNodeLength,"node"),containsPositions:x("containsPositions",u,"node"),isWhitespace:x("isWhitespace",b,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",v,"node"),getComputedDisplay:x("computedDisplay",l,"node"),isCollapsed:x("collapsed",w,"node"),isIgnored:x("ignored",C,"node"),next:x("nextPos",f,"node"),previous:x("previous",y,"node"),getTextNodeInfo:x("textNodeInfo",function(e){var t=null,i=!1,n=mt(e.parentNode,"whiteSpace"),o="pre-line"==n;return o?(t=X,i=!0):("normal"==n||"nowrap"==n)&&(t=Y,i=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:i,preLine:o}},"node"),hasInnerText:x("hasInnerText",function(e,t){for(var i=this.session,n=i.getPosition(e.parentNode,this.getNodeIndex()+1),o=i.getPosition(e,0),a=t?n:o,r=t?o:n;a!==r;){if(a.prepopulateChar(),a.isDefinitelyNonEmpty())return!0;a=t?a.previousVisible():a.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),i=0,n=t.length;n>i;++i)if(!w(t[i]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!C(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var _t={character:"",characterType:bt,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,i=e.offset,n="",o=bt,a=!1;if(i>0)if(3==t.nodeType){var r=t.data,s=r.charAt(i-1),l=e.nodeWrapper.getTextNodeInfo(),d=l.spaceRegex;l.collapseSpaces?d.test(s)?i>1&&d.test(r.charAt(i-2))||(l.preLine&&"\n"===r.charAt(i)?(n=" ",o=kt):(n=" ",o=Ct)):(n=s,o=vt,a=!0):(n=s,o=wt,a=!0)}else{var c=t.childNodes[i-1];if(c&&1==c.nodeType&&!w(c)&&("br"==c.tagName.toLowerCase()?(n="\n",e.isBr=!0,o=Ct,a=!1):e.checkForTrailingSpace=!0),!n){var h=t.childNodes[i];
    h&&1==h.nodeType&&!w(h)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=n,e.characterType=o,e.isCharInvariant=a}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==vt||e==wt},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=Ct),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=Ct),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t,i=this;i=i.previousVisible();)if(t=i.getCharacter(e),""!==t)return i;return null},getCharacter:function(e){function t(){return m||(c=p.getPrecedingUncollapsedPosition(e),m=!0),c}this.resolveLeadingAndTrailingSpaces();var i,n=this.character,o=a(e.ignoreCharacters),r=""!==n&&o.indexOf(n)>-1;if(this.isCharInvariant)return i=r?"":n;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,o].join("_"),l=this.cache.get(s);if(null!==l)return l;var d,c,h="",u=this.characterType==Ct,m=!1,p=this;return u&&(this.type==Nt?h="\n":" "==n&&(!t()||c.isTrailingSpace||"\n"==c.character||" "==c.character&&c.characterType==Ct)||("\n"==n&&this.isLeadingSpace?t()&&"\n"!=c.character&&(h="\n"):(d=this.nextUncollapsed(),d&&(d.isBr?this.type=St:d.isTrailingSpace&&"\n"==d.character?this.type=xt:d.isLeadingSpace&&"\n"==d.character&&(this.type=Et),"\n"==d.character?(this.type!=St||e.includeSpaceBeforeBr)&&(this.type!=Et||e.includeSpaceBeforeBlock)&&(this.type==xt&&d.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=kt||d.type!=vt||e.includePreLineTrailingSpace)&&("\n"==n?d.isTrailingSpace?this.isTrailingSpace||this.isBr&&(d.type=Tt,t()&&c.isLeadingSpace&&!c.isTrailingSpace&&"\n"==c.character?d.character="":d.type=Nt):h="\n":" "==n&&(h=" "))):h=n)))),o.indexOf(h)>-1&&(h=""),this.cache.set(s,h),h},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:T,toString:function(){return this.character}};k.prototype=_t,W(_t,{next:x("nextPos",function(e){var t=e.nodeWrapper,i=e.node,n=e.offset,o=t.session;if(!i)return null;var a,r,s;return n==t.getLength()?(a=i.parentNode,r=a?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(a=i,r=n+1):(s=i.childNodes[n],o.getNodeWrapper(s).containsPositions()?(a=s,r=0):(a=i,r=n+1)),a?o.getPosition(a,r):null}),previous:x("previous",function(e){var t,i,n,o=e.nodeWrapper,a=e.node,r=e.offset,s=o.session;return 0==r?(t=a.parentNode,i=t?o.getNodeIndex():0):o.isCharacterDataNode()?(t=a,i=r-1):(n=a.childNodes[r-1],s.getNodeWrapper(n).containsPositions()?(t=n,i=V.getNodeLength(n)):(t=a,i=r-1)),t?s.getPosition(t,i):null}),nextVisible:x("nextVisible",function(e){var t=e.next();if(!t)return null;var i=t.nodeWrapper,n=t.node,o=t;return i.isCollapsed()&&(o=i.session.getPosition(n.parentNode,i.getNodeIndex()+1)),o}),nextUncollapsed:x("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:x("previousVisible",function(e){var t=e.previous();if(!t)return null;var i=t.nodeWrapper,n=t.node,o=t;return i.isCollapsed()&&(o=i.session.getPosition(n.parentNode,i.getNodeIndex())),o})});var At=null,Lt=function(){function e(e){var t=new E;return{get:function(i){var n=t.get(i[e]);if(n)for(var o,a=0;o=n[a++];)if(o.node===i)return o;return null},set:function(i){var n=i.node[e],o=t.get(n)||t.set(n,[]);o.push(i)}}}function t(){this.initCaches()}var i=U.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=i?function(){var e=new E;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var i=t.get(e);return i||(i=new S(e,this),t.set(i)),i},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var i=t?"start":"end";return this.getPosition(e[i+"Container"],e[i+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();W(V,{nextNode:f,previousNode:y});var Rt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var i=0,n=e.length;n>i;++i)if(e[i]===t)return i;return-1};W(e.rangePrototype,{moveStart:z(!0,!1),moveEnd:z(!1,!1),move:z(!0,!0),trimStart:$(!0),trimEnd:$(!1),trim:B(function(e,t){var i=this.trimStart(t),n=this.trimEnd(t);return i||n}),expand:B(function(e,t,i){var n=!1;i=s(i,ht);var o=i.characterOptions;if(t||(t=q),t==F){var a,r,l=i.wordOptions,d=e.getRangeBoundaryPosition(this,!0),c=e.getRangeBoundaryPosition(this,!1),h=R(d,o,l),u=h.nextEndToken(),m=u.chars[0].previousVisible();if(this.collapsed)a=u;else{var p=R(c,o,l);a=p.previousStartToken()}return r=a.chars[a.chars.length-1],m.equals(d)||(this.setStart(m.node,m.offset),n=!0),r&&!r.equals(c)&&(this.setEnd(r.node,r.offset),n=!0),i.trim&&(i.trimStart&&(n=this.trimStart(o)||n),i.trimEnd&&(n=this.trimEnd(o)||n)),n}return this.moveEnd(q,1,i)}),text:B(function(e,t){return this.collapsed?"":P(e,this,G(t,rt)).join("")}),selectCharacters:B(function(e,t,i,n,o){var a={characterOptions:o};t||(t=K(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",i,a),this.collapse(!0),this.moveEnd("character",n-i,a)}),toCharacterRange:B(function(e,t,i){t||(t=K(this.getDocument()));var n,o,a=t.parentNode,r=V.getNodeIndex(t),s=-1==V.comparePoints(this.startContainer,this.endContainer,a,r),l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,a,r),n=-l.text(i).length):(l.setStartAndEnd(a,r,this.startContainer,this.startOffset),n=l.text(i).length),o=n+this.text(i).length,{start:n,end:o}}),findText:B(function(t,i,n){n=s(n,dt),n.wholeWordsOnly&&(n.wordOptions.includeTrailingSpace=!1);var o=et(n.direction),a=n.withinRange;a||(a=e.createRange(),a.selectNodeContents(this.getDocument()));var r=i,l=!1;"string"==typeof r?n.caseSensitive||(r=r.toLowerCase()):l=!0;var d=t.getRangeBoundaryPosition(this,!o),c=a.comparePoint(d.node,d.offset);-1===c?d=t.getRangeBoundaryPosition(a,!0):1===c&&(d=t.getRangeBoundaryPosition(a,!1));for(var h,u=d,m=!1;;)if(h=D(u,r,l,a,n)){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;u=o?h.startPos:h.endPos}else{if(!n.wrap||m)return!1;a=a.cloneRange(),u=t.getRangeBoundaryPosition(a,!o),a.setBoundary(d.node,d.offset,o),m=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),i=t.lastChild;this.insertNode(t),this.collapseAfter(i)}}}),W(e.selectionPrototype,{expand:B(function(e,t,i){this.changeEachRange(function(e){e.expand(t,i)})}),move:B(function(e,t,i,n){var o=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var a=this.getRangeAt(0);n||(n={}),n.characterOptions=G(n.characterOptions,st),o=a.move(t,i,n),this.setSingleRange(a)}return o}),trimStart:H("trimStart"),trimEnd:H("trimEnd"),trim:H("trim"),selectCharacters:B(function(t,i,n,o,a,r){var s=e.createRange(i);s.selectCharacters(i,n,o,r),this.setSingleRange(s,a)}),saveCharacterRanges:B(function(e,t,i){for(var n=this.getAllRanges(),o=n.length,a=[],r=1==o&&this.isBackward(),s=0,l=n.length;l>s;++s)a[s]={characterRange:n[s].toCharacterRange(t,i),backward:r,characterOptions:i};return a}),restoreCharacterRanges:B(function(t,i,n){this.removeAllRanges();for(var o,a,r,s=0,l=n.length;l>s;++s)a=n[s],r=a.characterRange,o=e.createRange(i),o.selectCharacters(i,r.start,r.end,a.characterOptions),this.addRange(o,a.backward)}),text:B(function(e,t){for(var i=[],n=0,o=this.rangeCount;o>n;++n)i[n]=this.getRangeAt(n).text(t);return i.join("")})}),e.innerText=function(t,i){var n=e.createRange(t);n.selectNodeContents(t);var o=n.text(i);return o},e.createWordIterator=function(e,t,i){var n=_();i=s(i,ut);var o=n.getPosition(e,t),a=R(o,i.characterOptions,i.wordOptions),r=et(i.direction);return{next:function(){return r?a.previousStartToken():a.nextEndToken()},dispose:function(){a.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=_();e(t),A()},e.noMutation.createEntryPointFunction=B,e.textRange={isBlockNode:h,isCollapsedWhitespaceNode:v,createPosition:B(function(e,t,i){return e.getPosition(t,i)})}}),e},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function i(e,t){return(t||document).getElementById(e)}function n(e,t){var i,n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=p.getDocument(e.startContainer),a=e.cloneRange();return a.collapse(t),i=o.createElement("span"),i.id=n,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(o.createTextNode(y)),a.insertNode(i),i}function o(e,n,o,a){var r=i(o,e);r?(n[a?"setStartBefore":"setEndBefore"](r),g(r)):t.warn("Marker element has been removed. Cannot restore selection.")}function a(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function r(t,i){var o,a,r=e.DomRange.getRangeDocument(t),s=t.toString(),l=f(i);return t.collapsed?(a=n(t,!1),{document:r,markerId:a.id,collapsed:!0}):(a=n(t,!1),o=n(t,!0),{document:r,startMarkerId:o.id,endMarkerId:a.id,collapsed:!1,backward:l,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}})}function s(n,a){var r=n.document;"undefined"==typeof a&&(a=!0);var s=e.createRange(r);if(n.collapsed){var l=i(n.markerId,r);if(l){l.style.display="inline";var d=l.previousSibling;d&&3==d.nodeType?(g(l),s.collapseToPoint(d,d.length)):(s.collapseBefore(l),g(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(r,s,n.startMarkerId,!0),o(r,s,n.endMarkerId,!1);return a&&s.normalizeBoundaries(),s}function l(t,n){var o,s,l=[],d=f(n);t=t.slice(0),t.sort(a);for(var c=0,h=t.length;h>c;++c)l[c]=r(t[c],d);for(c=h-1;c>=0;--c)o=t[c],s=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(i(l[c].markerId,s)):(o.setEndBefore(i(l[c].endMarkerId,s)),o.setStartAfter(i(l[c].startMarkerId,s)));return l}function d(i){if(!e.isSelectionValid(i))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var n=e.getSelection(i),o=n.getAllRanges(),a=1==o.length&&n.isBackward(),r=l(o,a);return a?n.setSingleRange(o[0],a):n.setRanges(o),{win:i,rangeInfos:r,restored:!1}}function c(e){for(var t=[],i=e.length,n=i-1;n>=0;n--)t[n]=s(e[n],!0);return t}function h(t,i){if(!t.restored){var n=t.rangeInfos,o=e.getSelection(t.win),a=c(n),r=n.length;1==r&&i&&e.features.selectionHasExtend&&n[0].backward?(o.removeAllRanges(),o.addRange(a[0],!0)):o.setRanges(a),t.restored=!0}}function u(e,t){var n=i(t,e);n&&g(n)}function m(e){for(var t,i=e.rangeInfos,n=0,o=i.length;o>n;++n)t=i[n],t.collapsed?u(e.doc,t.markerId):(u(e.doc,t.startMarkerId),u(e.doc,t.endMarkerId))}var p=e.dom,g=p.removeNode,f=e.Selection.isDirectionBackward,y="﻿";e.util.extend(e,{saveRange:r,restoreRange:s,saveRanges:l,restoreRanges:c,saveSelection:d,restoreSelection:h,removeMarkerElement:u,removeMarkers:m})}),e},this);var Base=function(){};Base.extend=function(e,t){var i=Base.prototype.extend;Base._prototyping=!0;var n=new this;i.call(n,e),n.base=function(){},delete Base._prototyping;var o=n.constructor,a=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==a)this._constructing=!0,o.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],n)};return a.ancestor=this,a.extend=this.extend,a.forEach=this.forEach,a.implement=this.implement,a.prototype=n,a.toString=this.toString,a.valueOf=function(e){return"object"==e?a:o.valueOf()},i.call(a,t),"function"==typeof a.init&&a.init(),a},Base.prototype={extend:function(e,t){if(arguments.length>1){var i=this[e];if(i&&"function"==typeof t&&(!i.valueOf||i.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var n=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=i;var t=n.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:n},t.toString=Base.toString}this[e]=t}else if(e){var o=Base.prototype.extend;Base._prototyping||"function"==typeof this||(o=this.extend||o);for(var a={toSource:null},r=["constructor","toString","valueOf"],s=Base._prototyping?0:1;l=r[s++];)e[l]!=a[l]&&o.call(this,l,e[l]);for(var l in e)a[l]||o.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,i){for(var n in e)void 0===this.prototype[n]&&t.call(i,e[n],n,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}function i(e,t){var i,n=-1;return"Microsoft Internet Explorer"==navigator.appName?i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(navigator.userAgent.indexOf("Trident")>-1?i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(i=/Edge\/(\d+)./i)),i&&null!=i.exec(navigator.userAgent)&&(n=parseFloat(RegExp.$1)),-1===n?!1:e?t?"<"===t?n>e:">"===t?e>n:"<="===t?n>=e:">="===t?e>=n:void 0:e===n:!0}var n=navigator.userAgent,o=document.createElement("div"),a=-1!==n.indexOf("Gecko")&&-1===n.indexOf("KHTML"),r=-1!==n.indexOf("AppleWebKit/"),s=-1!==n.indexOf("Chrome/"),l=-1!==n.indexOf("Opera/");return{USER_AGENT:n,supported:function(){var i=this.USER_AGENT.toLowerCase(),n="contentEditable"in o,a=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,r=document.querySelector&&document.querySelectorAll,s=this.isIos()&&e(i)<5||this.isAndroid()&&t(i)<4||-1!==i.indexOf("opera mobi")||-1!==i.indexOf("hpwos/");return n&&a&&r&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return i()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return i(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in o},insertsLineBreaksOnReturn:function(){return a},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in o||function(){return o.setAttribute("on"+e,"return;"),"function"==typeof o["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!l},supportsHTML5Tags:function(e){var t=e.createElement("div"),i="<article>foo</article>";return t.innerHTML=i,t.innerHTML.toLowerCase()===i},supportsCommand:function(){var e={formatBlock:i(10,"<="),insertUnorderedList:i(9,">=")||i(12,"<="),insertOrderedList:i(9,">=")||i(12,"<=")},t={insertHTML:a};return function(i,n){var o=e[n];if(!o){try{return i.queryCommandSupported(n)}catch(a){}try{return i.queryCommandEnabled(n)}catch(r){return!!t[n]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return i()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return a||l||r},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return a||i()||l},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var e,t,i=o.cloneNode(!1);return i.innerHTML="<p><div></div>",t=i.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return l},supportsSpeechApiOn:function(e){var t=n.match(/Chrome\/(\d+)/)||[void 0,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return i(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return i(12,">")},hasProblemsSettingCaretAfterImg:function(){return i()},hasUndoInContextMenu:function(){return a||s||l},hasInsertNodeIssue:function(){return l},hasIframeFocusIssue:function(){return i()},createsNestedInvalidMarkupAfterPaste:function(){return r},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!i()},fixStyleKey:function(e){return"cssFloat"===e?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":e}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var i=t.length;i--;)if(-1!==wysihtml5.lang.array(e).indexOf(t[i]))return!0;return!1}return-1!==wysihtml5.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var i=[],n=0,o=e.length;o>n;n++)t.contains(e[n])||i.push(e[n]);return i},get:function(){for(var t=0,i=e.length,n=[];i>t;t++)n.push(e[t]);return n},map:function(t,i){if(Array.prototype.map)return e.map(t,i);for(var n=e.length>>>0,o=new Array(n),a=0;n>a;a++)o[a]=t.call(i,e[a],a,e);return o},unique:function(){for(var t=[],i=e.length,n=0;i>n;)wysihtml5.lang.array(t).contains(e[n])||t.push(e[n]),n++;return t}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var i,n,o=0;if(e){for(i=this.events[e]||[],n=[];o<i.length;o++)i[o]!==t&&t&&n.push(i[o]);this.events[e]=n}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var i=this.events[e]||[],n=0;n<i.length;n++)i[n].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t,i){for(var n in t)i&&wysihtml5.lang.object(t[n]).isPlainObject()&&("undefined"==typeof e[n]||wysihtml5.lang.object(e[n]).isPlainObject())?"undefined"==typeof e[n]?e[n]=wysihtml5.lang.object(t[n]).clone(!0):wysihtml5.lang.object(e[n]).merge(wysihtml5.lang.object(t[n]).clone(!0)):e[n]=wysihtml5.lang.object(t[n]).isPlainObject()?wysihtml5.lang.object(t[n]).clone(!0):t[n];return this},difference:function(t){var i={};for(var n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)||(i[n]=e[n]));for(var o in t)t.hasOwnProperty(o)&&(e.hasOwnProperty(o)&&e[o]===t[o]||(i[0]=e[0]));return i},get:function(){return e},clone:function(t){var i,n={};if(null===e||!wysihtml5.lang.object(e).isPlainObject())return e;for(i in e)e.hasOwnProperty(i)&&(n[i]=t?wysihtml5.lang.object(e[i]).clone(t):e[i]);return n},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function(){return e&&"[object Object]"===Object.prototype.toString.call(e)&&!("Node"in window?e instanceof Node:e instanceof Element||e instanceof Text)},isEmpty:function(){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}},function(){var e=/^\s+/,t=/\s+$/,i=/[&<>\t"]/g,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(o){return o=String(o),{trim:function(){return o.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)o=this.replace("#{"+t+"}").by(e[t]);return o},replace:function(e){return{by:function(t){return o.split(e).join(t)}}},escapeHTML:function(e,t){var a=o.replace(i,function(e){return n[e]});return e&&(a=a.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(a=a.replace(/  /gi,"&nbsp; ")),a}}}}(),function(e){function t(e,t){return a(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),r(e,t))}function i(e){return e.replace(l,function(e,t){var i=(t.match(d)||[])[1]||"",n=h[i];t=t.replace(d,""),t.split(n).length>t.split(i).length&&(t+=i,i="");var o=t,a=t;return t.length>c&&(a=a.substr(0,c)+"..."),"www."===o.substr(0,4)&&(o="http://"+o),'<a href="'+o+'">'+a+"</a>"+i})}function n(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function o(t){var o=t.parentNode,a=e.lang.string(t.data).escapeHTML(),r=n(o.ownerDocument);for(r.innerHTML="<span></span>"+i(a),r.removeChild(r.firstChild);r.firstChild;)o.insertBefore(r.firstChild,t);o.removeChild(t)}function a(t,i){for(var n;t.parentNode;){if(t=t.parentNode,n=t.nodeName,t.className&&e.lang.array(t.className.split(" ")).contains(i))return!0;if(s.contains(n))return!0;if("body"===n)return!1}return!1}function r(t,i){if(!(s.contains(t.nodeName)||t.className&&e.lang.array(t.className.split(" ")).contains(i))){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return o(t),void 0;for(var n=e.lang.array(t.childNodes).get(),a=n.length,d=0;a>d;d++)r(n[d],i);return t}}var s=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,d=/([^\w\/\-](,?))$/i,c=100,h={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,i){var n=e.classList;return n?n.add(i):(t.hasClass(e,i)||(e.className+=" "+i),void 0)},t.removeClass=function(e,t){var i=e.classList;return i?i.remove(t):(e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "),void 0)},t.hasClass=function(e,t){var i=e.classList;if(i)return i.contains(t);var n=e.className;return n.length>0&&(n==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(n))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){if(t.nodeType!==wysihtml5.ELEMENT_NODE){if(t.parentNode===e)return!0;t=t.parentNode}return e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var i=e.createElement("li");return t.appendChild(i),i}function t(e,t){return e.createElement(t)}function i(i,n,o){if("UL"===i.nodeName||"OL"===i.nodeName||"MENU"===i.nodeName)return i;var a,r,s,l,d,c,h,u,m,p=i.ownerDocument,g=t(p,n),f=i.querySelectorAll("br"),y=f.length;for(m=0;y>m;m++)for(l=f[m];(d=l.parentNode)&&d!==i&&d.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(d)){d.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}for(a=wysihtml5.lang.array(i.childNodes).get(),r=a.length,m=0;r>m;m++)u=u||e(p,g),s=a[m],c="block"===wysihtml5.dom.getStyle("display").from(s),h="BR"===s.nodeName,!c||o&&wysihtml5.dom.hasClass(s,o)?h?u=u.firstChild?null:u:u.appendChild(s):(u=u.firstChild?e(p,g):u,u.appendChild(s),u=null);return 0===a.length&&e(p,g),i.parentNode.replaceChild(g,i),g}return i}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(i){for(var n,o=0,a=e.length;a>o;o++)n=e[o],"undefined"!=typeof t[n]&&""!==t[n]&&(i[n]=t[n]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(t){return n(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},n=function(i){for(var n=0,o=t.length;o>n;n++)if("border-box"===e.getStyle(t[n]).from(i))return t[n]};e.copyStyles=function(n){return{from:function(o){i(o)&&(n=wysihtml5.lang.array(n).without(t));for(var a,r="",s=n.length,l=0;s>l;l++)a=n[l],r+=a+":"+e.getStyle(a).from(o)+";";return{to:function(t){return e.setStyles(r).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(e,t,i,n){var o=function(i){for(var o=i.target,a=3===o.nodeType?o.parentNode:o,r=e.querySelectorAll(t),s=0,l=r.length;l>s;s++)r[s].contains(a)&&n.call(r[s],i)};return e.addEventListener(i,o,!1),{stop:function(){e.removeEventListener(i,o,!1)}}}}(wysihtml5),function(e){function t(e,t){for(var i=[e],n=e;t&&n&&n!==t||!t&&n;)i.unshift(n),n=n.parentNode;return i}function i(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")}e.dom.domNode=function(n){var o=[e.ELEMENT_NODE,e.TEXT_NODE];return{is:{emptyTextNode:function(t){var i=t?/^\s*$/g:/^[\r\n]*$/g;return n.nodeType===e.TEXT_NODE&&i.test(n.data)},visible:function(){var t=!/^\s*$/g.test(e.dom.getTextContent(n));return t||1===n.nodeType&&n.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(t=!0),t}},prev:function(t){var a=n.previousSibling,r=t&&t.nodeTypes?t.nodeTypes:o;return a?i(a)||!e.lang.array(r).contains(a.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(a).is.emptyTextNode(!0)?e.dom.domNode(a).prev(t):a:null},next:function(t){var a=n.nextSibling,r=t&&t.nodeTypes?t.nodeTypes:o;return a?i(a)||!e.lang.array(r).contains(a.nodeType)||t&&t.ignoreBlankTexts&&e.dom.domNode(a).is.emptyTextNode(!0)?e.dom.domNode(a).next(t):a:null},commonAncestor:function(e,i){var o=t(n,i),a=t(e,i);if(o[0]!=a[0])return null;for(var r=0;r<o.length;r++)if(o[r]!=a[r])return o[r-1];return null},lastLeafNode:function(t){var i;if(1!==n.nodeType)return n;if(i=n.lastChild,!i)return n;if(t&&t.leafClasses)for(var o=t.leafClasses.length;o--;)if(e.dom.hasClass(n,t.leafClasses[o]))return n;return e.dom.domNode(i).lastLeafNode(t)},escapeParent:function(t,i){var o,a,r,s=n;if(!e.dom.contains(t,n))throw new Error("Child is not a descendant of node.");do{for(o=s.parentNode,a=o.cloneNode(!1);o.lastChild&&o.lastChild!==s;)a.insertBefore(o.lastChild,a.firstChild);if(o!==t&&(r=o.cloneNode(!1),r.appendChild(s),s=r),o.parentNode.insertBefore(s,o.nextSibling),""!==a.innerHTML)if(/^\s+$/.test(a.innerHTML))for(;a.lastChild;)o.parentNode.insertBefore(a.lastChild,s.nextSibling);else o.parentNode.insertBefore(a,s.nextSibling);if(""===o.innerHTML)o.parentNode.removeChild(o);else if(/^\s+$/.test(o.innerHTML)){for(;o.firstChild;)o.parentNode.insertBefore(o.firstChild,o);o.parentNode.removeChild(o)}}while(o&&o!==t);i&&s&&(s.parentNode.insertBefore(i,s),i.appendChild(s))},test:function(t){var i;if(!t)return!1;if(1!==n.nodeType)return!1;if(t.query&&!n.matches(t.query))return!1;if(t.nodeName&&n.nodeName.toLowerCase()!==t.nodeName.toLowerCase())return!1;if(t.className&&!n.classList.contains(t.className))return!1;if(t.classRegExp){var o=(n.className||"").match(t.classRegExp)||[];if(0===o.length)return!1}if(t.styleProperty&&t.styleProperty.length>0)for(var a=!1,r=Array.isArray(t.styleProperty)?t.styleProperty:[t.styleProperty],s=0,l=r.length;l>s;s++){if(i=e.browser.fixStyleKey(r[s]),n.style[i]){if(!t.styleValue){a=!0;break}if(t.styleValue instanceof RegExp){if(n.style[i].trim().match(t.styleValue).length>0){a=!0;break}}else if(Array.isArray(t.styleValue)){if(t.styleValue.indexOf(n.style[i].trim())){a=!0;break}}else if(t.styleValue===n.style[i].trim().replace(/, /g,",")){a=!0;break}}if(!a)return!1}if(t.attribute){var d=e.dom.getAttributes(n),c=[],h=!1;Array.isArray(t.attribute)?c=t.attribute:c[t.attribute]=t.attributeValue;for(var u in c)if(c.hasOwnProperty(u))if("undefined"==typeof c[u]){if("undefined"!=typeof d[u]){h=!0;break}}else if(d[u]===c[u]){h=!0;break}if(!h)return!1}return!0}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var i=t.createElement("div");i.style.display="none",t.body.appendChild(i);try{i.innerHTML=e}catch(n){}return t.body.removeChild(i),i},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,n=i.length;n>t;t++)e.createElement(i[t]);e._wysihtml5_supportsHTML5Tags=!0}},i=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(i,n){n=n||document;var o;return"object"==typeof i&&i.nodeType?(o=n.createElement("div"),o.appendChild(i)):wysihtml5.browser.supportsHTML5Tags(n)?(o=n.createElement("div"),o.innerHTML=i):(t(n),o=e(i,n)),o}}(),wysihtml5.dom.getParentElement=function(){return function(e,t,i,n){for(i=i||50;i--&&e&&"BODY"!==e.nodeName&&(!n||e!==n);){if(wysihtml5.dom.domNode(e).test(t))return e;e=e.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(i,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},i=/\-[a-z]/g;return function(i){return{from:function(n){if(n.nodeType===wysihtml5.ELEMENT_NODE){var o=n.ownerDocument,a=t[i]||e(i),r=n.style,s=n.currentStyle,l=r[a];if(l)return l;if(s)try{return s[a]}catch(d){}var c,h,u=o.defaultView||o.parentWindow,m=("height"===i||"width"===i)&&"TEXTAREA"===n.nodeName;return u.getComputedStyle?(m&&(c=r.overflow,r.overflow="hidden"),h=u.getComputedStyle(n,null).getPropertyValue(i),m&&(r.overflow=c||""),h):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(e,t){var i=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||i.push(e):i=i.concat(wysihtml5.dom.getTextNodes(e,t));return i},wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=i++)}var t={},i=1;return function(i,n){var o=e(i)+":"+n,a=t[o];return a||(a=t[o]=i.getElementsByTagName(n)),a.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var i={},n=1;e.dom.hasElementWithClassName=function(n,o){if(!e.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+o);var a=t(n)+":"+o,r=i[a];return r||(r=i[a]=n.getElementsByClassName(o)),r.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var i=t.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(t.createTextNode(e));var n=t.querySelector("head link");if(n)return n.parentNode.insertBefore(i,n),void 0;var o=t.querySelector("head");o&&o.appendChild(i)}}},function(e){e.dom.lineBreaks=function(t){function i(e){return"BR"===e.nodeName}function n(t){return i(t)?!0:"block"===e.dom.getStyle("display").from(t)?!0:!1}return{add:function(){var i=t.ownerDocument,o=e.dom.domNode(t).next({ignoreBlankTexts:!0}),a=e.dom.domNode(t).prev({ignoreBlankTexts:!0});o&&!n(o)&&e.dom.insert(i.createElement("br")).after(t),a&&!n(a)&&e.dom.insert(i.createElement("br")).before(t)},remove:function(){var n=e.dom.domNode(t).next({ignoreBlankTexts:!0}),o=e.dom.domNode(t).prev({ignoreBlankTexts:!0});n&&i(n)&&n.parentNode.removeChild(n),o&&i(o)&&o.parentNode.removeChild(o)}}}}(wysihtml5),wysihtml5.dom.observe=function(e,t,i){t="string"==typeof t?[t]:t;for(var n,o,a=0,r=t.length;r>a;a++)o=t[a],e.addEventListener?e.addEventListener(o,i,!1):(n=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},i.call(e,t)},e.attachEvent("on"+o,n));return{stop:function(){for(var o,a=0,r=t.length;r>a;a++)o=t[a],e.removeEventListener?e.removeEventListener(o,i,!1):e.detachEvent("on"+o,n)}}},wysihtml5.dom.parse=function(e,t){function i(e,t){wysihtml5.lang.object(v).merge(b).merge(t.rules).get();var i,a,r,s=t.context||e.ownerDocument||document,l=s.createDocumentFragment(),d="string"==typeof e,c=!1;for(t.clearInternals===!0&&(c=!0),i=d?wysihtml5.dom.getAsDom(e,s):e,v.selectors&&o(i,v.selectors);i.firstChild;)r=i.firstChild,a=n(r,t.cleanUp,c,t.uneditableClass),a&&l.appendChild(a),r!==a&&i.removeChild(r);if(t.unjoinNbsps)for(var h=wysihtml5.dom.getTextNodes(l),u=h.length;u--;)h[u].nodeValue=h[u].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return i.innerHTML="",i.appendChild(l),d?wysihtml5.quirks.getCorrectInnerHTML(i):i}function n(e,t,i,o){var a,r,s,l,d=e.nodeType,c=e.childNodes,h=c.length,u=g[d],m=0;
    if(o&&1===d&&wysihtml5.dom.hasClass(e,o))return e;if(r=u&&u(e,i),!r){if(r===!1){for(a=e.ownerDocument.createDocumentFragment(),m=h;m--;)c[m]&&(s=n(c[m],t,i,o),s&&(c[m]===s&&m--,a.insertBefore(s,a.firstChild)));return l=wysihtml5.dom.getStyle("display").from(e),""===l&&(l=wysihtml5.lang.array(w).contains(e.tagName)?"block":""),wysihtml5.lang.array(["block","flex","table"]).contains(l)&&a.appendChild(e.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||a.appendChild(e.ownerDocument.createTextNode(" "))),a.normalize&&a.normalize(),a}return null}for(m=0;h>m;m++)c[m]&&(s=n(c[m],t,i,o),s&&(c[m]===s&&m--,r.appendChild(s)));if(t&&r.nodeName.toLowerCase()===f&&(!r.childNodes.length||/^\s*$/gi.test(r.innerHTML)&&(i||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!r.attributes.length)){for(a=r.ownerDocument.createDocumentFragment();r.firstChild;)a.appendChild(r.firstChild);return a.normalize&&a.normalize(),a}return r.normalize&&r.normalize(),r}function o(e,t){var i,n,o;for(i in t)if(t.hasOwnProperty(i)){wysihtml5.lang.object(t[i]).isFunction()?n=t[i]:"string"==typeof t[i]&&k[t[i]]&&(n=k[t[i]]),o=e.querySelectorAll(i);for(var a=o.length;a--;)n(o[a])}}function a(e,t){var i,n,o,a=v.tags,s=e.nodeName.toLowerCase(),d=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(d&&"HTML"!=d&&(s=d+":"+s),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(s="div")),s in a){if(i=a[s],!i||i.remove)return null;if(i.unwrap)return!1;i="string"==typeof i?{rename_tag:i}:i}else{if(!e.firstChild)return null;i={rename_tag:f}}if(i.one_of_type&&!r(e,v,i.one_of_type,t)){if(!i.remove_action)return null;if("unwrap"===i.remove_action)return!1;if("rename"!==i.remove_action)return null;o=i.remove_action_rename_to||f}return n=e.ownerDocument.createElement(o||i.rename_tag||s),u(e,n,i,t),l(e,n,i),e=null,n.normalize&&n.normalize(),n}function r(e,t,i,n){var o,a;if("SPAN"===e.nodeName&&!n&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(a in i)if(i.hasOwnProperty(a)&&t.type_definitions&&t.type_definitions[a]&&(o=t.type_definitions[a],s(e,o)))return!0;return!1}function s(e,t){var i,n,o,a,r,s=e.getAttribute("class"),l=e.getAttribute("style");if(t.methods)for(var d in t.methods)if(t.methods.hasOwnProperty(d)&&S[d]&&S[d](e))return!0;if(s&&t.classes){s=s.replace(/^\s+/g,"").replace(/\s+$/g,"").split(y),i=s.length;for(var c=0;i>c;c++)if(t.classes[s[c]])return!0}if(l&&t.styles){l=l.split(";");for(n in t.styles)if(t.styles.hasOwnProperty(n))for(var h=l.length;h--;)if(r=l[h].split(":"),r[0].replace(/\s/g,"").toLowerCase()===n&&(t.styles[n]===!0||1===t.styles[n]||wysihtml5.lang.array(t.styles[n]).contains(r[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(o in t.attrs)if(t.attrs.hasOwnProperty(o)&&(a=wysihtml5.dom.getAttribute(e,o),"string"==typeof a&&a.search(t.attrs[o])>-1))return!0;return!1}function l(e,t,i){var n,o;if(i&&i.keep_styles)for(n in i.keep_styles)if(i.keep_styles.hasOwnProperty(n)){if(o="float"===n?e.style.styleFloat||e.style.cssFloat:e.style[n],i.keep_styles[n]instanceof RegExp&&!i.keep_styles[n].test(o))continue;"float"===n?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=o:e.style[n]&&(t.style[n]=o)}}function d(e,t){var i=[];for(var n in t)t.hasOwnProperty(n)&&0===n.indexOf(e)&&i.push(n);return i}function c(e,t,i,n){var o,a=wysihtml5.lang.object(i).isFunction()?i:C[i];return a&&(o=a(t,n),"string"==typeof o)?o:!1}function h(e,t){var i,n,o,a=wysihtml5.lang.object(v.attributes||{}).clone(),r=wysihtml5.lang.object(a).merge(wysihtml5.lang.object(t||{}).clone()).get(),s={},l=wysihtml5.dom.getAttributes(e);for(i in r)if(/\*$/.test(i)){o=d(i.slice(0,-1),l);for(var h=0,u=o.length;u>h;h++)n=c(o[h],l[o[h]],r[i],e.nodeName),n!==!1&&(s[o[h]]=n)}else n=c(i,l[i],r[i],e.nodeName),n!==!1&&(s[i]=n);return s}function u(e,t,i,n){var o,a,r,s,l,d={},c=i.set_class,u=i.add_class,m=i.add_style,p=i.set_attributes,g=v.classes,f=0,b=[],w=[],C=[],S=[];if(p&&(d=wysihtml5.lang.object(p).clone()),d=wysihtml5.lang.object(d).merge(h(e,i.check_attributes)).get(),c&&b.push(c),u)for(s in u)l=x[u[s]],l&&(r=l(wysihtml5.dom.getAttribute(e,s)),"string"==typeof r&&b.push(r));if(m)for(s in m)l=E[m[s]],l&&(newStyle=l(wysihtml5.dom.getAttribute(e,s)),"string"==typeof newStyle&&w.push(newStyle));if("string"==typeof g&&"any"===g)if(e.getAttribute("class"))if(v.classes_blacklist){for(S=e.getAttribute("class"),S&&(b=b.concat(S.split(y))),o=b.length;o>f;f++)a=b[f],v.classes_blacklist[a]||C.push(a);C.length&&(d["class"]=wysihtml5.lang.array(C).unique().join(" "))}else d["class"]=e.getAttribute("class");else b&&b.length>0&&(d["class"]=wysihtml5.lang.array(b).unique().join(" "));else{for(n||(g["_wysihtml5-temp-placeholder"]=1,g._rangySelectionBoundary=1,g["wysiwyg-tmp-selected-cell"]=1),S=e.getAttribute("class"),S&&(b=b.concat(S.split(y))),o=b.length;o>f;f++)a=b[f],g[a]&&C.push(a);C.length&&(d["class"]=wysihtml5.lang.array(C).unique().join(" "))}d["class"]&&n&&(d["class"]=d["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(d["class"])&&delete d["class"]),w.length&&(d.style=wysihtml5.lang.array(w).unique().join(" "));for(s in d)try{t.setAttribute(s,d[s])}catch(k){}d.src&&("undefined"!=typeof d.width&&t.setAttribute("width",d.width),"undefined"!=typeof d.height&&t.setAttribute("height",d.height))}function m(e){var t=e.nextSibling;if(!t||t.nodeType!==wysihtml5.TEXT_NODE){var i=e.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"");return e.ownerDocument.createTextNode(i)}t.data=e.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")+t.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")}function p(e){return v.comments?e.ownerDocument.createComment(e.nodeValue):void 0}var g={1:a,3:m,8:p},f="span",y=/\s+/,b={tags:{},classes:{}},v={},w=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],C={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t,i){return t?t.replace(e,""):"IMG"===i?"":null}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),dimension:function(){var e=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(t){return t=(t||"").replace(e,"$1$2$3"),t||null}}(),any:function(){return function(e){return e?e:null}}()},E={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[String(t).toLowerCase()]}}()},x={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()},S={has_visible_contet:function(){var e,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(i){if(e=(i.innerText||i.textContent).replace(/\s/g,""),e&&e.length>0)return!0;for(var n=t.length;n--;)if(i.querySelector(t[n]))return!0;return i.offsetWidth&&i.offsetWidth>0&&i.offsetHeight&&i.offsetHeight>0?!0:!1}}()},k={unwrap:function(e){wysihtml5.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return i(e,t)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,i=wysihtml5.lang.array(e.childNodes).get(),n=i.length,o=0;n>o;o++)t=i[o],t.nodeType===wysihtml5.TEXT_NODE&&/^[\n\r]*$/.test(t.data)&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var i,n=e.ownerDocument.createElement(t);i=e.firstChild;)n.appendChild(i);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode&&e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return e.parentNode.removeChild(e),void 0;for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function i(e){return"BR"===e.nodeName}function n(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function o(e,o){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var a,r,s,l,d,c,h,u=e.ownerDocument,m=u.createDocumentFragment(),p=wysihtml5.dom.domNode(e).prev({ignoreBlankTexts:!0}),g=wysihtml5.dom.domNode(e).next({ignoreBlankTexts:!0}),f=e.lastElementChild||e.lastChild;if(o)for(!p||t(p)||i(p)||n(m);c=e.firstElementChild||e.firstChild;){for(r=c.lastChild,h=c===f;a=c.firstChild;)s=a===r,l=(!h||g&&!t(g))&&s&&!t(a)&&!i(a),m.appendChild(a),l&&n(m);c.parentNode.removeChild(c)}else for(;c=e.firstElementChild||e.firstChild;){if(c.querySelector&&c.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;a=c.firstChild;)m.appendChild(a);else{for(d=u.createElement("p");a=c.firstChild;)d.appendChild(a);m.appendChild(d)}c.parentNode.removeChild(c)}e.parentNode.replaceChild(m,e)}}e.resolveList=o}(wysihtml5.dom),function(e){var t=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],n=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],o=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(i).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var i=this,n=t.createElement("iframe");return n.className=this.config.className,e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(n),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(n.src="javascript:'<html></html>'"),n.onload=function(){n.onreadystatechange=n.onload=null,i._onLoadIframe(n)},n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&(n.onreadystatechange=n.onload=null,i._onLoadIframe(n))},n},_onLoadIframe:function(a){if(e.dom.contains(t.documentElement,a)){var r=this,s=a.contentWindow,l=a.contentWindow.document,d=t.characterSet||t.charset||"utf-8",c=this._getHtml({charset:d,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(c),l.close(),this.getWindow=function(){return a.contentWindow},this.getDocument=function(){return a.contentWindow.document},s.onerror=function(e,t,i){throw new Error("wysihtml5.Sandbox: "+e,t,i)},!e.browser.supportsSandboxedIframes()){var h,u;for(h=0,u=i.length;u>h;h++)this._unset(s,i[h]);for(h=0,u=n.length;u>h;h++)this._unset(s,n[h],e.EMPTY_FUNCTION);for(h=0,u=o.length;u>h;h++)this._unset(l,o[h]);this._unset(l,"cookie","",!0)}e.polyfills&&e.polyfills(s,l),this.loaded=!0,setTimeout(function(){r.callback(r)},0)}},_getHtml:function(t){var i,n=t.stylesheets,o="",a=0;if(n="string"==typeof n?[n]:n)for(i=n.length;i>a;a++)o+='<link rel="stylesheet" href="'+n[a]+'">';return t.stylesheets=o,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,i,n,o){try{t[i]=n}catch(a){}try{t.__defineGetter__(i,function(){return n})}catch(a){}if(o)try{t.__defineSetter__(i,function(){})}catch(a){}if(!e.browser.crashesWhenDefineProperty(i))try{var r={get:function(){return n}};o&&(r.set=function(){}),Object.defineProperty(t,i,r)}catch(a){}}})}(wysihtml5),function(e){var t=document;e.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(t,i,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(i).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.element=n?this._bindElement(n):this._createElement()},destroy:function(){},_createElement:function(){var e=t.createElement("div");return e.className=this.config.className,this._loadElement(e),e},_bindElement:function(e){return e.className=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var i=this;if(!t){var n=this._getHtml();e.innerHTML=n}this.loaded=!0,setTimeout(function(){i.callback(i)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var n in t)i.setAttribute(e[n]||n,t[n])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var i=t.style;if("string"==typeof e)return i.cssText+=";"+e,void 0;for(var n in e)"float"===n?(i.cssFloat=e[n],i.styleFloat=e[n]):i[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,i,n,o){var a=o||"wysihtml5-placeholder",r=function(){var t=i.element.offsetWidth>0&&i.element.offsetHeight>0;i.hasPlaceholderSet()&&(i.clear(),i.element.focus(),t&&setTimeout(function(){var e=i.selection.getSelection();e.focusNode&&e.anchorNode||i.selection.selectNode(i.element.firstChild||i.element)},0)),i.placeholderSet=!1,e.removeClass(i.element,a)},s=function(){i.isEmpty()&&!i.placeholderSet&&(i.placeholderSet=!0,i.setValue(n,!1),e.addClass(i.element,a))};t.on("set_placeholder",s).on("unset_placeholder",r).on("focus:composer",r).on("paste:composer",r).on("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(e,t){var i=!wysihtml5.browser.supportsGetAttributeCorrectly();t=t.toLowerCase();var n=e.nodeName;if("IMG"==n&&"src"==t&&wysihtml5.dom.isLoadedImage(e)===!0)return e.src;if(i&&"outerHTML"in e){var o=e.outerHTML.toLowerCase(),a=-1!=o.indexOf(" "+t+"=");return a?e.getAttribute(t):null}return e.getAttribute(t)},wysihtml5.dom.getAttributes=function(e){var t,i=!wysihtml5.browser.supportsGetAttributeCorrectly(),n=e.nodeName,o=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==n&&"src"==e.attributes[t].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?o.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&i?1!==e.attributes[t].value&&(o[e.attributes[t].name]=e.attributes[t].value):o[e.attributes[t].name]=e.attributes[t].value);return o},wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){function t(e,t){for(var i,n=[],o=0,a=e.length;a>o;o++)if(i=e[o].querySelectorAll(t))for(var r=i.length;r--;n.unshift(i[r]));return n}function i(e){e.parentNode.removeChild(e)}function n(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function o(e,t){for(var i=e.nextSibling;1!=i.nodeType;)if(i=i.nextSibling,!t||t==i.tagName.toLowerCase())return i;return null}var a=e.dom,r=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},s=function(e,t){e?(this.cell=e,this.table=a.getParentElement(e,{query:"table"})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};s.prototype={addSpannedCellToMap:function(e,t,i,n,o,a){for(var s=[],l=i+(a?parseInt(a,10)-1:0),d=n+(o?parseInt(o,10)-1:0),c=i;l>=c;c++){"undefined"==typeof t[c]&&(t[c]=[]);for(var h=n;d>=h;h++)t[c][h]=new r(e),t[c][h].isColspan=o&&parseInt(o,10)>1,t[c][h].isRowspan=a&&parseInt(a,10)>1,t[c][h].firstCol=h==n,t[c][h].lastCol=h==d,t[c][h].firstRow=c==i,t[c][h].lastRow=c==l,t[c][h].isReal=h==n&&c==i,t[c][h].spanCollection=s,s.push(t[c][h])}},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,i=e.spanCollection.length;i>t;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,i,n,o,s,l,d,c=[],h=this.getTableRows();for(e=0;e<h.length;e++)for(t=h[e],i=this.getRowCells(t),s=0,"undefined"==typeof c[e]&&(c[e]=[]),n=0;n<i.length;n++){for(o=i[n];"undefined"!=typeof c[e][s];)s++;l=a.getAttribute(o,"colspan"),d=a.getAttribute(o,"rowspan"),l||d?(this.addSpannedCellToMap(o,c,e,s,l,d),s+=l?parseInt(l,10):1):(c[e][s]=new r(o),s++)}return this.map=c,c},getRowCells:function(i){var n=this.table.querySelectorAll("table"),o=n?t(n,"th, td"):[],a=i.querySelectorAll("th, td"),r=o.length>0?e.lang.array(a).without(o):a;return r},getTableRows:function(){var i=this.table.querySelectorAll("table"),n=i?t(i,"tr"):[],o=this.table.querySelectorAll("tr"),a=n.length>0?e.lang.array(o).without(n):o;return a},getMapIndex:function(e){for(var t=this.map.length,i=this.map&&this.map[0]?this.map[0].length:0,n=0;t>n;n++)for(var o=0;i>o;o++)if(this.map[n][o].el===e)return{row:n,col:o};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var i=this.idx_start;this.idx_start=this.idx_end,this.idx_end=i}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}if(null!=this.idx_start&&null!=this.idx_end)for(var o=this.idx_start.row,a=this.idx_end.row;a>=o;o++)for(var r=this.idx_start.col,s=this.idx_end.col;s>=r;r++)t.push(this.map[o][r].el);return t},orderSelectionEnds:function(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var i=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=i}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,i){for(var n,o=this.table.ownerDocument,a=o.createDocumentFragment(),r=0;t>r;r++){if(n=o.createElement(e),i)for(var s in i)i.hasOwnProperty(s)&&n.setAttribute(s,i[s]);n.appendChild(document.createTextNode(" ")),a.appendChild(n)}return a},correctColIndexForUnreals:function(e,t){for(var i=this.map[t],n=-1,o=0;e>o;o++)i[o].isReal&&n++;return n},getLastNewCellOnRow:function(e,t){for(var i,n,o=this.getRowCells(e),a=0,r=o.length;r>a;a++)if(i=o[a],n=this.getMapIndex(i),n===!1||"undefined"!=typeof t&&n.row!=t)return i;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return e&&0!=e.length?!1:(i(this.table),!0)},splitRowToCells:function(e){if(e.isColspan){var t=parseInt(a.getAttribute(e.el,"colspan")||1,10),i=e.el.tagName.toLowerCase();if(t>1){var o=this.createCells(i,t-1);n(e.el,o)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,t){var i=null,n=null;t=t||this.idx;for(var o=0,r=this.map[t.row].length;r>o;o++)if(n=this.map[t.row][o],n.isReal&&(i=a.getParentElement(n.el,{query:"tr"})))return i;return null===i&&e&&(i=a.getParentElement(this.map[t.row][t.col].el,{query:"tr"})||null),i},injectRowAt:function(e,t,i,o,r){var s=this.getRealRowEl(!1,{row:e,col:t}),l=this.createCells(o,i);if(s){var d=this.correctColIndexForUnreals(t,e);d>=0?n(this.getRowCells(s)[d],l):s.insertBefore(l,s.firstChild)}else{var c=this.table.ownerDocument.createElement("tr");c.appendChild(l),n(a.getParentElement(r.el,{query:"tr"}),c)}},canMerge:function(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var i=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=i}for(var n=this.idx_start.row,o=this.idx_end.row;o>=n;n++)for(var a=this.idx_start.col,r=this.idx_end.col;r>=a;a++)if(this.map[n][a].isColspan||this.map[n][a].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var i=parseInt(a.getAttribute(e.el,t),10)-1;i>=1?e.el.setAttribute(t,i):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,n,o,r,s,l;if(this.setTableMap(),this.map){for(n=0,o=this.map.length;o>n;n++){for(e=this.map[n],l=!0,r=0,s=e.length;s>r;r++)if(t=e[r],!(a.getAttribute(t.el,"rowspan")&&parseInt(a.getAttribute(t.el,"rowspan"),10)>1&&t.firstRow!==!0)){l=!1;break}if(l)for(r=0;s>r;r++)this.decreaseCellSpan(e[r],"rowspan")}var d=this.getTableRows();for(n=0,o=d.length;o>n;n++)e=d[n],0==e.childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&i(e)}},fillMissingCells:function(){var e=0,t=0,i=null;if(this.setTableMap(),this.map){e=this.map.length;for(var o=0;e>o;o++)this.map[o].length>t&&(t=this.map[o].length);for(var a=0;e>a;a++)for(var s=0;t>s;s++)this.map[a]&&!this.map[a][s]&&s>0&&(this.map[a][s]=new r(this.createCells("td",1)),i=this.map[a][s-1],i&&i.el&&i.el.parent&&n(this.map[a][s-1].el,this.map[a][s].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],t=a.getAttribute(e.el,"colspan")?parseInt(a.getAttribute(e.el,"colspan"),10):1,i=e.el.tagName.toLowerCase();if(e.isRowspan){var n=parseInt(a.getAttribute(e.el,"rowspan"),10);if(n>1)for(var o=1,r=n-1;r>=o;o++)this.injectRowAt(this.idx.row+o,this.idx.col,t,i,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,n=this.idx_end.col-this.idx_start.col+1,o=this.idx_start.row,a=this.idx_end.row;a>=o;o++)for(var r=this.idx_start.col,s=this.idx_end.col;s>=r;r++)o==this.idx_start.row&&r==this.idx_start.col?(t>1&&this.map[o][r].el.setAttribute("rowspan",t),n>1&&this.map[o][r].el.setAttribute("colspan",n)):(/^\s*<br\/?>\s*$/.test(this.map[o][r].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[o][r].el.innerHTML),i(this.map[o][r].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var t=this.getMapIndex(e.el),i=t.row+1,o={row:i,col:t.col};if(i<this.map.length){var r=this.getRealRowEl(!1,o);if(null!==r){var s=this.correctColIndexForUnreals(o.col,o.row);if(s>=0)n(this.getRowCells(r)[s],e.el);else{var l=this.getLastNewCellOnRow(r,i);null!==l?n(l,e.el):r.insertBefore(e.el,r.firstChild)}parseInt(a.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(a.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):i(e.el):parseInt(a.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(a.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],i=0,n=t.length;n>i;i++)t[i].isReal&&e.push(t[i].el);return e},getColumnElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=0,i=this.map.length;i>t;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=a.getParentElement(this.cell,{query:"tr"});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],n=0,o=t.length;o>n;n++)t[n].modified||(this.setCellAsModified(t[n]),this.removeRowCell(t[n]));i(e)}},removeColCell:function(e){e.isColspan?parseInt(a.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(a.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&i(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&a.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(a.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var i=this.map[this.idx.row],o=t.createElement("tr"),r=0,s=i.length;s>r;r++)i[r].modified||(this.setCellAsModified(i[r]),this.addRowCell(i[r],o,e));switch(e){case"below":n(this.getRealRowEl(!0),o);break;case"above":var l=a.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});l&&l.parentNode.insertBefore(o,l)}}},addRowCell:function(e,t,i){var n=e.isColspan?{colspan:a.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=i&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(a.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,n)):"above"!=i&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,n)):c.isRowspan&&e.el.attr("rowspan",parseInt(a.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&(("below"==e||"above"==e)&&this.addRow(e),("before"==e||"after"==e)&&this.addColumn(e))},addColCell:function(e,t,i){var o,r=e.el.tagName.toLowerCase();switch(i){case"before":o=!e.isColspan||e.firstCol;break;case"after":o=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(o){switch(i){case"before":e.el.parentNode.insertBefore(this.createCells(r,1),e.el);break;case"after":n(e.el,this.createCells(r,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,i)}else e.el.setAttribute("colspan",parseInt(a.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,i;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&a.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(a.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var n=0,o=this.map.length;o>n;n++)t=this.map[n],t[this.idx.col]&&(i=t[this.idx.col],i.modified||(this.setCellAsModified(i),this.addColCell(i,n,e)))},handleCellAddWithRowspan:function(e,t,i){for(var r,s,l,d=parseInt(a.getAttribute(this.cell,"rowspan"),10)-1,c=a.getParentElement(e.el,{query:"tr"}),h=e.el.tagName.toLowerCase(),u=this.table.ownerDocument,m=0;d>m;m++)if(r=this.correctColIndexForUnreals(this.idx.col,t+m),c=o(c,"tr"))if(r>0)switch(i){case"before":s=this.getRowCells(c),r>0&&this.map[t+m][this.idx.col].el!=s[r]&&r==s.length-1?n(s[r],this.createCells(h,1)):s[r].parentNode.insertBefore(this.createCells(h,1),s[r]);break;case"after":n(this.getRowCells(c)[r],this.createCells(h,1))}else c.insertBefore(this.createCells(h,1),c.firstChild);else l=u.createElement("tr"),l.appendChild(this.createCells(h,1)),this.table.appendChild(l)}},a.table={getCellsBetween:function(e,t){var i=new s(e);return i.getMapElsTo(t)},addCells:function(e,t){var i=new s(e);i.add(t)},removeCells:function(e,t){var i=new s(e);i.remove(t)},mergeCellsBetween:function(e,t){var i=new s(e);i.merge(t)},unmergeCell:function(e){var t=new s(e);t.unmerge()},orderSelectionEnds:function(e,t){var i=new s(e);return i.orderSelectionEnds(t)},indexOf:function(e){var t=new s(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var i=new s(null,e);return i.getElementAtIndex(t)},findRowByCell:function(e){var t=new s(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new s(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var i=new s(e);return i.canMerge(t)}}}(wysihtml5),wysihtml5.dom.query=function(e,t){var i,n=[];e.nodeType&&(e=[e]);for(var o=0,a=e.length;a>o;o++)if(i=e[o].querySelectorAll(t))for(var r=i.length;r--;n.unshift(i[r]));return n},wysihtml5.dom.compareDocumentPosition=function(){var e=document.documentElement;return e.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var i,n;if(i=9===e.nodeType?e:e.ownerDocument,n=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(i!==n)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml5.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml5.lang.array(t.childNodes).indexOf(e))return 10;for(var o=e,a=[],r=null;o;){if(o==t)return 10;a.push(o),o=o.parentNode}for(o=t,r=null;o;){if(o==e)return 20;var s=wysihtml5.lang.array(a).indexOf(o);if(-1!==s){var l=a[s],d=wysihtml5.lang.array(l.childNodes).indexOf(a[s-1]),c=wysihtml5.lang.array(l.childNodes).indexOf(r);return d>c?2:4}r=o,o=o.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(e){var t=[];if(e.parentNode){for(;e.lastChild;)t.unshift(e.lastChild),wysihtml5.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}return t},wysihtml5.dom.getPastedHtml=function(e){var t;return wysihtml5.browser.supportsModernPaste()&&e.clipboardData&&(wysihtml5.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml5.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml5.dom.getPastedHtmlWithDiv=function(e,t){var i=e.selection.getBookmark(),n=e.element.ownerDocument,o=n.createElement("DIV"),a=e.getScrollPos();n.body.appendChild(o),o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.style.position="absolute",o.style.top=a.y+"px",o.style.left=a.x+"px",o.setAttribute("contenteditable","true"),o.focus(),setTimeout(function(){var n;e.selection.setBookmark(i),n=o.innerHTML,n&&/^<br\/?>$/i.test(n.trim())&&(n=!1),t(n),o.parentNode.removeChild(o)},0)},wysihtml5.dom.removeInvisibleSpaces=function(e){for(var t=wysihtml5.dom.getTextNodes(e),i=t.length;i--;)t[i].nodeValue=t[i].nodeValue.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")},wysihtml5.quirks.cleanPastedHTML=function(){var e=function(e){var t=wysihtml5.lang.string(e).trim(),i=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");
    return new RegExp("^((?!^"+i+"$).)*$","i")},t=function(t,i){var n,o,a=wysihtml5.lang.object(t).clone(!0);for(n in a.tags)if(a.tags.hasOwnProperty(n)&&a.tags[n].keep_styles)for(o in a.tags[n].keep_styles)a.tags[n].keep_styles.hasOwnProperty(o)&&i[o]&&(a.tags[n].keep_styles[o]=e(i[o]));return a},i=function(e,t){var i;if(!e)return null;for(var n=0,o=e.length;o>n;n++)if(e[n].condition||(i=e[n].set),e[n].condition&&e[n].condition.test(t))return e[n].set;return i};return function(e,n){var o,a={color:wysihtml5.dom.getStyle("color").from(n.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(n.referenceNode)},r=t(i(n.rules,e)||{},a);return o=wysihtml5.dom.parse(e,{rules:r,cleanUp:!0,context:n.referenceNode.ownerDocument,uneditableClass:n.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(i){var n=i.innerHTML;if(-1===n.indexOf(t))return n;var o,a,r,s,l=i.querySelectorAll("[href*='~'], [src*='~']");for(s=0,r=l.length;r>s;s++)o=l[s].href||l[s].src,a=e.lang.string(o).replace("~").by(t),n=e.lang.string(n).replace(a).by(o);return n}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(i){e.dom.addClass(i,t),e.dom.removeClass(i,t);try{var n=i.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(o){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(e,t){function i(){return e.addEventListener("mousedown",m),h}function n(i){h.start=i,h.end=i,h.cells=[i],h.table=c.getParentElement(h.start,{query:"table"},!1,e),h.table&&(o(),c.addClass(i,u),e.addEventListener("mousemove",r),e.addEventListener("mouseup",s),t.fire("tableselectstart").fire("tableselectstart:composer"))}function o(){if(e){var t=e.querySelectorAll("."+u);if(t.length>0)for(var i=0;i<t.length;i++)c.removeClass(t[i],u)}}function a(e){for(var t=0;t<e.length;t++)c.addClass(e[t],u)}function r(i){var n,r=null,s=c.getParentElement(i.target,{query:"td, th"},!1,e);s&&h.table&&h.start&&(r=c.getParentElement(s,{query:"table"},!1,e),r&&r===h.table&&(o(),n=h.end,h.end=s,h.cells=c.table.getCellsBetween(h.start,s),h.cells.length>1&&t.composer.selection.deselect(),a(h.cells),h.end!==n&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function s(){e.removeEventListener("mousemove",r),e.removeEventListener("mouseup",s),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){l()},0)}function l(){e.ownerDocument.addEventListener("click",p)}function d(i,n){h.start=i,h.end=n,h.table=c.getParentElement(h.start,{query:"table"},!1,e),selectedCells=c.table.getCellsBetween(h.start,h.end),a(selectedCells),l(),t.fire("tableselect").fire("tableselect:composer")}var c=wysihtml5.dom,h={table:null,start:null,end:null,cells:null,select:d},u="wysiwyg-tmp-selected-cell",m=function(t){var i=wysihtml5.dom.getParentElement(t.target,{query:"td, th"},!1,e);i&&n(i)},p=function(i){e.ownerDocument.removeEventListener("click",p),c.getParentElement(i.target,{query:"table"},!1,e)!=h.table&&(o(),h.table=null,h.start=null,h.end=null,t.fire("tableunselect").fire("tableunselect:composer"))};return i()},function(e){function t(e){var t,i;for(t in n)if(n.hasOwnProperty(t)&&(i=n[t],i.regex.test(e)))return i}function i(e){var i=t(e);return i?i.name:void 0}var n={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},o=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={getColorParseMethod:t,getColorFormat:i,parseColor:function(i,a){var r,s,l,d,c,h=i;if(a){if(r=o(a),!(s=i.match(r)))return!1;s=s.pop().split(":")[1],h=e.lang.string(s).trim()}return(l=t(h))?(d=h.match(l.regex))?(c=l.radix||10,l===n.hex3?(d.shift(),d.push(1),e.lang.array(d).map(function(e,t){return 3>t?parseInt(e,c)*c+parseInt(e,c):parseFloat(e)})):(d.shift(),d[3]||d.push(1),e.lang.array(d).map(function(e,t){return 3>t?parseInt(e,c):parseFloat(e)}))):!1:!1},unparseColor:function(e,t){var i=16;return"hex"===t?(e[0].toString(i)+e[1].toString(i)+e[2].toString(i)).toUpperCase():"hash"===t?"#"+(e[0].toString(i)+e[1].toString(i)+e[2].toString(i)).toUpperCase():"rgb"===t?"rgb("+e[0]+","+e[1]+","+e[2]+")":"rgba"===t?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"csv"===t?e[0]+","+e[1]+","+e[2]+","+e[3]:e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var i=t.match(o("font-size"));return i?e.lang.string(i[i.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function i(e,t){for(var i=0;t!==e;)if(i++,t=t.parentNode,!t)throw new Error("not a descendant of ancestor!");return i}function n(t){var i=document.createElement("span"),n=function(){t.removeEventListener("mouseup",n),t.removeEventListener("keydown",n),t.removeEventListener("touchstart",n),t.removeEventListener("focus",n),t.removeEventListener("blur",n),t.removeEventListener("paste",o),t.removeEventListener("drop",o),t.removeEventListener("beforepaste",o),i&&i.parentNode&&i.parentNode.removeChild(i)},o=function(){i&&i.parentNode&&setTimeout(n,0)};return i.appendChild(document.createTextNode(e.INVISIBLE_SPACE)),i.className="_wysihtml5-temp-caret-fix",i.style.display="block",i.style.minWidth="1px",i.style.height="0px",t.addEventListener("mouseup",n),t.addEventListener("keydown",n),t.addEventListener("touchstart",n),t.addEventListener("focus",n),t.addEventListener("blur",n),t.addEventListener("paste",o),t.addEventListener("drop",o),t.addEventListener("beforepaste",o),i}function o(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,n=i(t,e.startContainer),o=i(t,e.endContainer);!e.canSurroundContents();)n>o?(e.setStartBefore(e.startContainer),n=i(t,e.startContainer)):(e.setEndAfter(e.endContainer),o=i(t,e.endContainer))}var a=e.dom;e.Selection=Base.extend({constructor:function(e,t,i){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=t,this.unselectableClass=i||!1},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},createTemporaryCaretSpaceAfter:function(t){var i=this.doc.createElement("span"),n=this.doc.createTextNode(e.INVISIBLE_SPACE),o=function(){var t;this.contain.removeEventListener("mouseup",o),this.contain.removeEventListener("keydown",r),this.contain.removeEventListener("touchstart",o),this.contain.removeEventListener("focus",o),this.contain.removeEventListener("blur",o),this.contain.removeEventListener("paste",a),this.contain.removeEventListener("drop",a),this.contain.removeEventListener("beforepaste",a),i&&i.parentNode&&(i.innerHTML=i.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(i.innerHTML)?(t=i.lastChild,e.dom.unwrap(i),this.setAfter(t)):i.parentNode.removeChild(i))}.bind(this),a=function(){i&&i.parentNode&&setTimeout(o,0)},r=function(e){8===e.which||91===e.which||17===e.which||86===e.which&&(e.ctrlKey||e.metaKey)||o()};return i.className="_wysihtml5-temp-caret-fix",i.style.position="absolute",i.style.display="block",i.style.minWidth="1px",i.style.zIndex="99999",i.appendChild(n),t.parentNode.insertBefore(i,t.nextSibling),this.setBefore(n),this.contain.addEventListener("mouseup",o),this.contain.addEventListener("keydown",r),this.contain.addEventListener("touchstart",o),this.contain.addEventListener("focus",o),this.contain.addEventListener("blur",o),this.contain.addEventListener("paste",a),this.contain.addEventListener("drop",a),this.contain.addEventListener("beforepaste",a),i},setAfter:function(t,i,n){var o,a=this.win,r=rangy.createRange(this.doc),s=function(){var n=t.parentNode,r=n?n.childNodes[n.childNodes.length-1]:null;if(!o||r===t&&1===t.nodeType&&"block"===a.getComputedStyle(t).display)if(i){var s=this.doc.createTextNode(e.INVISIBLE_SPACE);t.parentNode.insertBefore(s,t.nextSibling),this.selectNode(s),setTimeout(function(){s&&s.parentNode&&s.parentNode.removeChild(s)},0)}else this.createTemporaryCaretSpaceAfter(t)}.bind(this);if(r.setStartAfter(t),r.setEndAfter(t),document.activeElement&&document.activeElement===this.composer.element)o=this.setSelection(r),s(),n&&n(o);else{var l=this.composer.getScrollPos();this.composer.element.focus(),this.composer.setScrollPos(l),setTimeout(function(){o=this.setSelection(r),s(),n&&n(o)}.bind(this),0)}},selectNode:function(t,i){var n=rangy.createRange(this.doc),o=t.nodeType===e.ELEMENT_NODE,r="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,s=o?t.innerHTML:t.data,l=""===s||s===e.INVISIBLE_SPACE,d=a.getStyle("display").from(t),c="block"===d||"list-item"===d;if(l&&o&&r&&!i)try{t.innerHTML=e.INVISIBLE_SPACE}catch(h){}r?n.selectNodeContents(t):n.selectNode(t),r&&l&&o?n.collapse(c):r&&l&&(n.setStartAfter(t),n.setEndAfter(t)),this.setSelection(n)},getSelectedNode:function(e){var t,i;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(i=this.doc.selection.createRange(),i&&i.length)?i.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(i=this.getRange(this.doc),i?i.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var e=this.getRange();o(e),this.setSelection(e)},getSelectedOwnNodes:function(){for(var e=this.getOwnRanges(),t=[],i=0,n=e.length;n>i;i++)t.push(e[i].commonAncestorContainer||this.doc.body);return t},findNodesInSelection:function(t){for(var i,n=this.getOwnRanges(),o=[],a=0,r=n.length;r>a;a++)i=n[a].getNodes([1],function(i){return e.lang.array(t).contains(i.nodeName)}),o=o.concat(i);return o},filterElements:function(e){for(var t,i=this.getOwnRanges(),n=[],o=0,a=i.length;a>o;o++)t=i[o].getNodes([1],function(t){return e(t,i[o])}),n=n.concat(t);return n},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),i=0,n=e.length;n>i;i++)if(t.containsNode(e[i]))return!0;return!1},deleteContents:function(){var e=this.getRange();this.deleteRangeContents(e),this.setSelection(e)},deleteRangeContents:function(t){var i,n,o,a;if(this.unselectableClass){(i=e.dom.getParentElement(t.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setStartBefore(i),(n=e.dom.getParentElement(t.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setEndAfter(n),o=t.getNodes([1],function(t){return e.dom.hasClass(t,this.unselectableClass)}.bind(this));for(var r=o.length;r--;)try{a=new CustomEvent("wysihtml5:uneditable:delete"),o[r].dispatchEvent(a)}catch(s){}}t.deleteContents()},getPreviousNode:function(t,i){var n;if(!t){var o=this.getSelection();t=o.anchorNode}if(t===this.contain)return!1;var a,r=t.previousSibling;return r===this.contain?!1:(r&&3!==r.nodeType&&1!==r.nodeType?r=this.getPreviousNode(r,i):r&&3===r.nodeType&&/^\s*$/.test(r.textContent)?r=this.getPreviousNode(r,i):i&&r&&1===r.nodeType?(n=e.dom.getStyle("display").from(r),e.lang.array(["BR","HR","IMG"]).contains(r.nodeName)||e.lang.array(["block","inline-block","flex","list-item","table"]).contains(n)||!/^[\s]*$/.test(r.innerHTML)||(r=this.getPreviousNode(r,i))):r||t===this.contain||(a=t.parentNode,a!==this.contain&&(r=this.getPreviousNode(a,i))),r!==this.contain?r:!1)},getSelectionParentsByTag:function(){for(var t,i=this.getSelectedOwnNodes(),n=[],o=0,a=i.length;a>o;o++)t=i[o].nodeName&&"LI"===i[o].nodeName?i[o]:e.dom.getParentElement(i[o],{query:"li"},!1,this.contain),t&&n.push(t);return n.length?n:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,i=e.startOffset,n=rangy.createRange(this.doc);return n.selectNodeContents(t),n.setStart(t,i),n}},caretIsLastInSelection:function(){var e=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),t=e.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),i=this.getSelection(),n=this.getRange(),o=n.startContainer;return o?o.nodeType===e.TEXT_NODE?this.isCollapsed()&&o.nodeType===e.TEXT_NODE&&/^\s*$/.test(o.data.substr(0,n.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===i.anchorNode||t.endContainer===i.anchorNode)&&t.startOffset===i.anchorOffset):void 0},caretIsInTheBeginnig:function(t){var i=this.getSelection(),n=i.anchorNode,o=i.anchorOffset;return t&&n?0===o&&(n.nodeName&&n.nodeName===t.toUpperCase()||e.dom.getParentElement(n.parentNode,{query:t},1)):n?0===o&&!this.getPreviousNode(n,!0):void 0},getBeforeSelection:function(t){var i,n,o=this.getSelection(),a=o.isBackwards()?o.focusNode:o.anchorNode,r=o.isBackwards()?o.focusOffset:o.anchorOffset,s=this.createRange();if(n=e.dom.getParentElement(a,{query:"._wysihtml5-temp-caret-fix"},1),n&&(a=n.parentNode,r=Array.prototype.indexOf.call(a.childNodes,n)),a){if(r>0)return 3===a.nodeType?(s.setStart(a,0),s.setEnd(a,r),{type:"text",range:s,offset:r,node:a}):(s.setStartBefore(a.childNodes[0]),i=a.childNodes[r-1],s.setEndAfter(i),{type:"element",range:s,offset:r,node:i});if(s.setStartAndEnd(a,0),t){var l=this.getPreviousNode(a,!0),d=null;if(l&&(d=1===l.nodeType&&e.dom.hasClass(l,this.unselectableClass)?l:e.dom.domNode(l).lastLeafNode()),d)return{type:"leafnode",range:s,offset:r,node:d}}return{type:"none",range:s,offset:r,node:a}}return null},executeAndRestoreRangy:function(e){var t=rangy.saveSelection(this.win);if(t)try{e()}catch(i){setTimeout(function(){throw i},0)}else e();rangy.restoreSelection(t)},executeAndRestore:function(t,i){var n,o,r,s,l,d,c,h,u=this.doc.body,m=i&&u.scrollTop,p=i&&u.scrollLeft,g="_wysihtml5-temp-placeholder",f='<span class="'+g+'">'+e.INVISIBLE_SPACE+"</span>",y=this.getRange(!0);if(!y)return t(u,u),void 0;y.collapsed||(c=y.cloneRange(),d=c.createContextualFragment(f),c.collapse(!1),c.insertNode(d),c.detach()),l=y.createContextualFragment(f),y.insertNode(l),d&&(n=this.contain.querySelectorAll("."+g),y.setStartBefore(n[0]),y.setEndAfter(n[n.length-1])),this.setSelection(y);try{t(y.startContainer,y.endContainer)}catch(b){setTimeout(function(){throw b},0)}if(n=this.contain.querySelectorAll("."+g),n&&n.length){h=rangy.createRange(this.doc),r=n[0].nextSibling,n.length>1&&(s=n[n.length-1].previousSibling),s&&r?(h.setStartBefore(r),h.setEndAfter(s)):(o=this.doc.createTextNode(e.INVISIBLE_SPACE),a.insert(o).after(n[0]),h.setStartBefore(o),h.setEndAfter(o)),this.setSelection(h);for(var v=n.length;v--;)n[v].parentNode.removeChild(n[v])}else this.contain.focus();i&&(u.scrollTop=m,u.scrollLeft=p);try{n.parentNode.removeChild(n)}catch(w){}},set:function(e,t){var i=rangy.createRange(this.doc);i.setStart(e,t||0),this.setSelection(i)},insertHTML:function(e){var t,i,n=this.getRange(),o=this.doc.createElement("DIV"),a=this.doc.createDocumentFragment();if(n){for(n.deleteContents(),o.innerHTML=e,t=o.lastChild;o.firstChild;)a.appendChild(o.firstChild);for(n.insertNode(a),i=this.contain.lastChild;i&&3===i.nodeType&&i.previousSibling&&/^\s*$/.test(i.data);)i=i.previousSibling;t&&(i&&t===i&&1===t.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(t))}},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},canAppendChild:function(e){var t,i,n=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],o=this.getRange();return t=e||o.startContainer,t&&(i=(t.tagName||t.nodeName).toLowerCase()),-1===n.indexOf(i)},splitElementAtCaret:function(t,i){var n,o,a,r,s,l=this.getSelection();if(l.rangeCount>0){n=l.getRangeAt(0).cloneRange(),n.setEndAfter(t),o=n.extractContents(),s=o.childNodes;for(var d=s.length;d--;)e.dom.domNode(s[d]).is.visible()||o.removeChild(s[d]);t.parentNode.insertBefore(o,t.nextSibling),i?(a=i.firstChild||i,r=i.lastChild||i,t.parentNode.insertBefore(i,t.nextSibling),a&&r&&(n.setStartBefore(a),n.setEndAfter(r),this.setSelection(n))):(n.setStartAfter(t),n.setEndAfter(t)),e.dom.domNode(t).is.visible()||(""===e.dom.getTextContent(t)?t.parentNode.removeChild(t):t.parentNode.replaceChild(this.doc.createTextNode(" "),t))}},surround:function(e){var t,i=this.getOwnRanges(),n=[];if(0==i.length)return n;for(var o=i.length;o--;){t=this.doc.createElement(e.nodeName),n.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{i[o].surroundContents(t),this.selectNode(t)}catch(a){t.appendChild(i[o].extractContents()),i[o].insertNode(t)}}return n},deblockAndSurround:function(t){var i,n,o,a=this.doc.createElement("div"),r=rangy.createRange(this.doc);if(a.className=t.className,this.composer.commands.exec("formatBlock",t),i=this.contain.querySelectorAll("."+t.className),i[0])for(i[0].parentNode.insertBefore(a,i[0]),r.setStartBefore(i[0]),r.setEndAfter(i[i.length-1]),n=r.extractContents();n.firstChild;)if(o=n.firstChild,1==o.nodeType&&e.dom.hasClass(o,t.className)){for(;o.firstChild;)a.appendChild(o.firstChild);"BR"!==o.nodeName&&a.appendChild(this.doc.createElement("br")),n.removeChild(o)}else a.appendChild(o);else a=null;return a},scrollIntoView:function(){var i,n=this.doc,o=5,a=n.documentElement.scrollHeight>n.documentElement.offsetHeight,r=n._wysihtml5ScrollIntoViewElement=n._wysihtml5ScrollIntoViewElement||function(){var t=n.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();a&&(this.insertNode(r),i=t(r),r.parentNode.removeChild(r),i>=n.body.scrollTop+n.documentElement.offsetHeight-o&&(n.body.scrollTop=i))},selectLine:function(){var t=rangy.createRange();e.browser.supportsSelectionModify()?this._selectLine_W3C():t.nativeRange&&t.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var e=this.getSelection(),t=e.getRangeAt(0),i=function(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")},n=function(e){return 1===e.nodeType?e.childNodes&&e.childNodes.length||0:e.data&&e.data.length||0},o=1===e.anchorNode.nodeType?e.anchorNode.childNodes[e.anchorOffset]:e.anchorNode,a=1===e.focusNode.nodeType?e.focusNode.childNodes[e.focusOffset]:e.focusNode;a&&e.focusOffset===n(a)&&a.nextSibling&&i(a.nextSibling)&&t.setEndAfter(a.nextSibling),o&&0===e.anchorOffset&&o.previousSibling&&i(o.previousSibling)&&t.setStartBefore(o.previousSibling),t.select()},_selectLine_W3C:function(){var e=this.win.getSelection(),t=[e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset];e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary"),e.anchorNode===t[0]&&e.anchorOffset===t[1]&&e.focusNode===t[2]&&e.focusOffset===t[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(t,i){if(i="undefined"==typeof i?!1:i,e.browser.supportsSelectionModify()){var n=this.win.getSelection();n.modify("extend",t,"lineboundary"),i&&("left"===t?n.collapseToStart():"right"===t&&n.collapseToEnd())}},getRangeRect:function(e){var t,i=(this.doc.createTextNode("i"),this.doc.createTextNode("i"));return e.collapsed?(e.insertNode(i),e.selectNode(i),t=e.nativeRange.getBoundingClientRect(),e.deleteContents()):t=e.nativeRange.getBoundingClientRect(),t},_selectLineUniversal:function(){var t,i,n,o,a,r,s=this.getSelection(),l=s.getRangeAt(0),d=0,c=this,h=function(t){return t&&1===t.nodeType&&("block"===c.win.getComputedStyle(t).display||e.lang.array(["BR","HR"]).contains(t.nodeName))},u=function(e){var t=e;if(t)for(;t&&(1===t.nodeType&&t.classList.contains("rangySelectionBoundary")||3===t.nodeType&&/^\s*$/.test(t.data));)t=t.previousSibling;return t};i=l.cloneRange(),n=l.cloneRange(),l.collapsed&&(3===l.startContainer.nodeType&&l.startOffset<l.startContainer.data.length?l.moveEnd("character",1):1===l.startContainer.nodeType&&l.startContainer.childNodes[l.startOffset]&&3===l.startContainer.childNodes[l.startOffset].nodeType&&l.startContainer.childNodes[l.startOffset].data.length>0?l.moveEnd("character",1):l.startOffset>0&&(3===l.startContainer.nodeType||1===l.startContainer.nodeType&&!h(u(l.startContainer.childNodes[l.startOffset-1])))&&l.moveStart("character",-1)),l.collapsed||l.insertNode(this.doc.createTextNode(e.INVISIBLE_SPACE)),t=l.nativeRange.getBoundingClientRect();do o=l.moveStart("character",-1),a=l.nativeRange.getBoundingClientRect(),a&&Math.floor(a.top)===Math.floor(t.top)||(l.moveStart("character",1),r=!0),d++;while(0!==o&&!r&&2e3>d);d=0,r=!1,t=l.nativeRange.getBoundingClientRect();do o=l.moveEnd("character",1),a=l.nativeRange.getBoundingClientRect(),a&&Math.floor(a.bottom)===Math.floor(t.bottom)||(l.moveEnd("character",-1),l.endContainer&&1===l.endContainer.nodeType&&l.endContainer.childNodes[l.endOffset]&&1===l.endContainer.childNodes[l.endOffset].nodeType&&"BR"===l.endContainer.childNodes[l.endOffset].nodeName&&l.endContainer.childNodes[l.endOffset].previousSibling&&(1===l.endContainer.childNodes[l.endOffset].previousSibling.nodeType?l.setEnd(l.endContainer.childNodes[l.endOffset].previousSibling,l.endContainer.childNodes[l.endOffset].previousSibling.childNodes.length):3===l.endContainer.childNodes[l.endOffset].previousSibling.nodeType&&l.setEnd(l.endContainer.childNodes[l.endOffset].previousSibling,l.endContainer.childNodes[l.endOffset].previousSibling.data.length)),r=!0),d++;while(0!==o&&!r&&2e3>d);l.select(),this.includeRangyRangeHelpers()},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var i=this.getRange();return i?i.getNodes(Array.isArray(e)?e:[e],t):[]},getOwnNodes:function(e,t,i){for(var n=this.getOwnRanges(),o=[],a=0,r=n.length;r>a;a++)n[a]&&(i&&n[a].splitBoundaries(),o=o.concat(n[a].getNodes(Array.isArray(e)?e:[e],t)));return o},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var i=e.endContainer.previousElementSibling;i&&e.setEnd(i,this._endOffsetForNode(i))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=a.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),i=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(i),i},getOwnUneditables:function(){var t=a.query(this.contain,"."+this.unselectableClass),i=a.query(t,"."+this.unselectableClass);return e.lang.array(t).without(i)},getOwnRanges:function(){var e,t=[],i=this.getRange();if(i&&t.push(i),this.unselectableClass&&this.contain&&i){var n,o=this.getOwnUneditables();if(o.length>0)for(var a=0,r=o.length;r>a;a++){e=[];for(var s=0,l=t.length;l>s;s++){if(t[s])switch(t[s].compareNode(o[a])){case 2:break;case 3:n=t[s].cloneRange(),n.setEndBefore(o[a]),e.push(n),n=t[s].cloneRange(),n.setStartAfter(o[a]),e.push(n);break;default:e.push(t[s])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(e){var t=rangy.getSelection(this.win);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function(){var t,i=this.createRange(),o=this.composer,a=this,r=n(this.composer.element),s=n(this.composer.element),l=function(){i.setStart(o.element,0),i.setEnd(o.element,o.element.childNodes.length),t=a.setSelection(i)},d=function(){return!t||t.nativeSelection&&t.nativeSelection.type&&("Caret"===t.nativeSelection.type||"None"===t.nativeSelection.type)};e.dom.removeInvisibleSpaces(this.composer.element),l(),this.composer.element.firstChild&&d()&&(this.composer.element.appendChild(r),l(),d()&&(r.parentNode.removeChild(r),this.composer.element.insertBefore(s,this.composer.element.firstChild),l(),d()&&(this.composer.element.appendChild(r),l())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(t){var i=this.getRange(),n=i.commonAncestorContainer,o=i.startContainer,a=i.endContainer;if(n.nodeType===e.TEXT_NODE&&(n=n.parentNode),o.nodeType===e.TEXT_NODE&&!/^\s*$/.test(o.data.substr(i.startOffset)))return!1;if(a.nodeType===e.TEXT_NODE&&!/^\s*$/.test(a.data.substr(i.endOffset)))return!1;for(;o&&o!==n;){if(o.nodeType!==e.TEXT_NODE&&!e.dom.contains(n,o))return!1;if(e.dom.domNode(o).prev({ignoreBlankTexts:!0}))return!1;o=o.parentNode}for(;a&&a!==n;){if(a.nodeType!==e.TEXT_NODE&&!e.dom.contains(n,a))return!1;if(e.dom.domNode(a).next({ignoreBlankTexts:!0}))return!1;a=a.parentNode}return e.lang.array(t).contains(n.nodeName)?n:!1},isInThisEditable:function(){var t=this.getSelection(),i=t.focusNode,n=t.anchorNode;return i&&1!==i.nodeType&&(i=i.parentNode),n&&1!==n.nodeType&&(n=n.parentNode),n&&i&&(e.dom.contains(this.composer.element,i)||this.composer.element===i)&&(e.dom.contains(this.composer.element,n)||this.composer.element===n)},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml5),function(e,t){function i(e,t,i){if(!e.className)return!1;var n=e.className.match(i)||[];return n[n.length-1]===t}function n(e,t){return e.getAttribute&&e.getAttribute("style")?(e.getAttribute("style").match(t),e.getAttribute("style").match(t)?!0:!1):!1}function o(e,t,i){e.getAttribute("style")?(s(e,i),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function a(e,t,i){e.className?(r(e,i),e.className+=" "+t):e.className=t}function r(e,t){e.className&&(e.className=e.className.replace(t,""))}function s(e,t){var i,n=[];if(e.getAttribute("style")){i=e.getAttribute("style").split(";");for(var o=i.length;o--;)i[o].match(t)||/^\s*$/.test(i[o])||n.push(i[o]);n.length?e.setAttribute("style",n.join(";")):e.removeAttribute("style")}}function l(e,t){var i=[],n=t.split(";"),o=e.getAttribute("style");if(o){o=o.replace(/\s/gi,"").toLowerCase(),i.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var a=n.length;a-->0;)/^\s*$/.test(n[a])||i.push(new RegExp("(^|\\s|;)"+n[a].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var r=0,s=i.length;s>r;r++)if(o.match(i[r]))return i[r]}return!1}function d(i,n,o,a){return o?l(i,o):a?e.dom.hasClass(i,a):t.dom.arrayContains(n,i.tagName.toLowerCase())}function c(e,t,i,n){for(var o=e.length;o--;)if(!d(e[o],t,i,n))return!1;return e.length?!0:!1}function h(e,t,i){var n=l(e,t);return n?(s(e,n),"remove"):(o(e,t,i),"change")}function u(e,t){return e.className.replace(w," ")==t.className.replace(w," ")}function m(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function p(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var i,n,o,a=0,r=e.attributes.length;r>a;++a)if(i=e.attributes[a],o=i.name,"class"!=o){if(n=t.attributes.getNamedItem(o),i.specified!=n.specified)return!1;if(i.specified&&i.nodeValue!==n.nodeValue)return!1}return!0}function g(e,i){return t.dom.isCharacterDataNode(e)?0==i?!!e.previousSibling:i==e.length?!!e.nextSibling:!0:i>0&&i<e.childNodes.length}function f(e,i,n,o){var a;if(t.dom.isCharacterDataNode(i)&&(0==n?(n=t.dom.getNodeIndex(i),i=i.parentNode):n==i.length?(n=t.dom.getNodeIndex(i)+1,i=i.parentNode):a=t.dom.splitDataNode(i,n)),!(a||o&&i===o)){a=i.cloneNode(!1),a.id&&a.removeAttribute("id");for(var r;r=i.childNodes[n];)a.appendChild(r);t.dom.insertAfter(a,i)}return i==e?a:f(e,a.parentNode,t.dom.getNodeIndex(a),o)}function y(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function b(e,t,i,n,o,a,r){this.tagNames=e||[v],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=i,this.cssStyle=o||"",this.similarStyleRegExp=a,this.normalize=n,this.applyToAnyTagName=!1,this.container=r}var v="span",w=/\s+/g;y.prototype={doMerge:function(){for(var e,t,i,n=[],o=0,a=this.textNodes.length;a>o;++o)e=this.textNodes[o],t=e.parentNode,n[o]=e.data,o&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=i=n.join(""),i},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,i=this.textNodes.length;i>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},b.prototype={getAncestorWithClass:function(n){for(var o;n;){if(o=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&o)return n;n=n.parentNode}return!1},getAncestorWithStyle:function(i){for(var o;i;){if(o=this.cssStyle?n(i,this.similarStyleRegExp):!1,i.nodeType==e.ELEMENT_NODE&&"false"!=i.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&o)return i;i=i.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),i=!1;return t?this.cssStyle&&(i="class"):(t=this.getAncestorWithStyle(e),t&&(i="style")),{element:t,type:i}},postApply:function(e,t){for(var i,n,o,a=e[0],r=e[e.length-1],s=[],l=a,d=r,c=0,h=r.length,u=0,m=e.length;m>u;++u)n=e[u],o=null,n&&n.parentNode&&(o=this.getAdjacentMergeableTextNode(n.parentNode,!1)),o?(i||(i=new y(o),s.push(i)),i.textNodes.push(n),n===a&&(l=i.firstTextNode,c=l.length),n===r&&(d=i.firstTextNode,h=i.getLength())):i=null;if(r&&r.parentNode){var p=this.getAdjacentMergeableTextNode(r.parentNode,!0);p&&(i||(i=new y(r),s.push(i)),i.textNodes.push(p))}if(s.length){for(u=0,m=s.length;m>u;++u)s[u].doMerge();t.setStart(l,c),t.setEnd(d,h)}},getAdjacentMergeableTextNode:function(t,i){var n,o=t.nodeType==e.TEXT_NODE,a=o?t.parentNode:t,r=i?"nextSibling":"previousSibling";if(o){if(n=t[r],n&&n.nodeType==e.TEXT_NODE)return n}else if(n=a[r],n&&this.areElementsMergeable(t,n))return n[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,i){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&u(e,i)&&p(e,i)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var i=e.parentNode;if(1==i.childNodes.length&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase()))this.cssClass&&a(i,this.cssClass,this.similarClassRegExp),this.cssStyle&&o(i,this.cssStyle,this.similarStyleRegExp);else{var n=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&""===e.lang.string(i.className).trim()&&(!i.getAttribute("style")||""===e.lang.string(i.getAttribute("style")).trim())},undoToTextNode:function(e,t,i,n){var o=i?!1:!0,a=i||n,s=!1;if(!t.containsNode(a)){var l=t.cloneRange();l.selectNode(a),l.isPointInRange(t.endContainer,t.endOffset)&&g(t.endContainer,t.endOffset)&&(f(a,t.endContainer,t.endOffset,this.container),t.setEndAfter(a)),l.isPointInRange(t.startContainer,t.startOffset)&&g(t.startContainer,t.startOffset)&&(a=f(a,t.startContainer,t.startOffset,this.container))}!o&&this.similarClassRegExp&&r(a,this.similarClassRegExp),o&&this.similarStyleRegExp&&(s="change"===h(a,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(a)&&!s&&m(a)},applyToRange:function(t){for(var i,n=t.length;n--;){if(i=t[n].getNodes([e.TEXT_NODE]),!i.length)try{var o=this.createContainer(t[n].endContainer.ownerDocument);return t[n].surroundContents(o),this.selectNode(t[n],o),void 0}catch(a){}if(t[n].splitBoundaries(),i=t[n].getNodes([e.TEXT_NODE]),i.length){for(var r,s=0,l=i.length;l>s;++s)r=i[s],this.getMatchingAncestor(r).element||this.applyToTextNode(r);t[n].setStart(i[0],0),r=i[i.length-1],t[n].setEnd(r,r.length),this.normalize&&this.postApply(i,t[n])
}}},undoToRange:function(t){for(var i,n,o,a=t.length;a--;){if(i=t[a].getNodes([e.TEXT_NODE]),i.length)t[a].splitBoundaries(),i=t[a].getNodes([e.TEXT_NODE]);else{var r=t[a].endContainer.ownerDocument,s=r.createTextNode(e.INVISIBLE_SPACE);t[a].insertNode(s),t[a].selectNode(s),i=[s]}for(var l=0,d=i.length;d>l;++l)t[a].isValid()&&(n=i[l],o=this.getMatchingAncestor(n),"style"===o.type?this.undoToTextNode(n,t[a],!1,o.element):o.element&&this.undoToTextNode(n,t[a],o.element));1==d?this.selectNode(t[a],i[0]):(t[a].setStart(i[0],0),n=i[i.length-1],t[a].setEnd(n,n.length),this.normalize&&this.postApply(i,t[a]))}},selectNode:function(t,i){var n=i.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in i?i.canHaveHTML:!0,a=n?i.innerHTML:i.data,r=""===a||a===e.INVISIBLE_SPACE;if(r&&n&&o)try{i.innerHTML=e.INVISIBLE_SPACE}catch(s){}t.selectNodeContents(i),r&&n?t.collapse(!1):r&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(e,t){var i=t.cloneRange();i.selectNodeContents(e);var n=i.intersection(t),o=n?n.toString():"";return i.detach(),o},isAppliedToRange:function(t){for(var i,n,o=[],a="full",r=t.length;r--;){if(n=t[r].getNodes([e.TEXT_NODE]),!n.length)return i=this.getMatchingAncestor(t[r].startContainer).element,i?{elements:[i],coverage:a}:!1;for(var s,l=0,d=n.length;d>l;++l)s=this.getTextSelectedByRange(n[l],t[r]),i=this.getMatchingAncestor(n[l]).element,i&&""!=s?(o.push(i),1===e.dom.getTextNodes(i,!0).length?a="full":"full"===a&&(a="inline")):i||(a="partial")}return o.length?{elements:o,coverage:a}:!1},toggleRange:function(e){var t,i=this.isAppliedToRange(e);i?"full"===i.coverage?this.undoToRange(e):"inline"===i.coverage?(t=c(i.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(c(i.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=b}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var i=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),o=i&&i.exec,a=null;if(this.composer.hasPlaceholderSet()&&!wysihtml5.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(e)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),o)n.unshift(this.composer),a=o.apply(i,n);else try{a=this.doc.execCommand(e,!1,t)}catch(r){}return this.editor.fire("aftercommand:composer"),a},remove:function(e){var t=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),n=t&&t.remove;return n?(i.unshift(this.composer),n.apply(t,i)):void 0},state:function(e){var t=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),n=t&&t.state;if(n)return i.unshift(this.composer),n.apply(t,i);try{return this.doc.queryCommandState(e)}catch(o){return!1}},stateValue:function(e){var t=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),n=t&&t.stateValue;return n?(i.unshift(this.composer),n.apply(t,i)):!1}}),function(e){var t={nodeName:"B",toggle:!0};e.commands.bold={exec:function(i,n){e.commands.formatInline.exec(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){function t(t){return e.lang.object({}).merge(i).merge({attribute:t}).get()}var i={nodeName:"A",toggle:!1};e.commands.createLink={exec:function(i,n,o){var a=t(o);if(i.selection.isCollapsed()&&!this.state(i,n)){var r=i.doc.createTextNode(a.attribute.href);i.selection.insertNode(r),i.selection.selectNode(r)}e.commands.formatInline.exec(i,n,a)},state:function(t,n){return e.commands.formatInline.state(t,n,i)}}}(wysihtml5),function(e){var t={nodeName:"A"};e.commands.removeLink={exec:function(i,n){e.commands.formatInline.remove(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(i,n,o){e.commands.formatInline.exec(i,n,{className:"wysiwyg-font-size-"+o,classRegExp:t,toggle:!0})},state:function(t,i,n){return e.commands.formatInline.state(t,i,{className:"wysiwyg-font-size-"+n})}}}(wysihtml5),function(e){e.commands.fontSizeStyle={exec:function(t,i,n){n=n.size||n,/^\s*$/.test(n)||e.commands.formatInline.exec(t,i,{styleProperty:"fontSize",styleValue:n,toggle:!1})},state:function(t,i,n){return e.commands.formatInline.state(t,i,{styleProperty:"fontSize",styleValue:n||void 0})},remove:function(t,i){return e.commands.formatInline.remove(t,i,{styleProperty:"fontSize"})},stateValue:function(t,i){var n,o=this.state(t,i);return o&&e.lang.object(o).isArray()&&(o=o[0]),o&&(n=o.getAttribute("style"))?e.quirks.styleParser.parseFontSize(n):!1}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(i,n,o){e.commands.formatInline.exec(i,n,{className:"wysiwyg-color-"+o,classRegExp:t,toggle:!0})},state:function(t,i,n){return e.commands.formatInline.state(t,i,{className:"wysiwyg-color-"+n})}}}(wysihtml5),function(e){e.commands.foreColorStyle={exec:function(t,i,n){var o,a;n&&(o=e.quirks.styleParser.parseColor("color:"+(n.color||n),"color"),o&&(a=(1===o[3]?"rgb("+[o[0],o[1],o[2]].join(", "):"rgba("+o.join(", "))+")",e.commands.formatInline.exec(t,i,{styleProperty:"color",styleValue:a})))},state:function(t,i,n){var o,a=n?e.quirks.styleParser.parseColor("color:"+(n.color||n),"color"):null;return a&&(o=(1===a[3]?"rgb("+[a[0],a[1],a[2]].join(", "):"rgba("+a.join(", "))+")"),e.commands.formatInline.state(t,i,{styleProperty:"color",styleValue:o})},remove:function(t,i){return e.commands.formatInline.remove(t,i,{styleProperty:"color"})},stateValue:function(t,i,n){var o,a=this.state(t,i),r=!1;return a&&e.lang.object(a).isArray()&&(a=a[0]),a&&(o=a.getAttribute("style"))?(r=e.quirks.styleParser.parseColor(o,"color"),e.quirks.styleParser.unparseColor(r,n)):!1}}}(wysihtml5),function(e){e.commands.bgColorStyle={exec:function(t,i,n){var o,a=e.quirks.styleParser.parseColor("background-color:"+(n.color||n),"background-color");a&&(o=(1===a[3]?"rgb("+[a[0],a[1],a[2]].join(", "):"rgba("+a.join(", "))+")",e.commands.formatInline.exec(t,i,{styleProperty:"backgroundColor",styleValue:o}))},state:function(t,i,n){var o,a=n?e.quirks.styleParser.parseColor("background-color:"+(n.color||n),"background-color"):null;return a&&(o=(1===a[3]?"rgb("+[a[0],a[1],a[2]].join(", "):"rgba("+a.join(", "))+")"),e.commands.formatInline.state(t,i,{styleProperty:"backgroundColor",styleValue:o})},remove:function(t,i){return e.commands.formatInline.remove(t,i,{styleProperty:"backgroundColor"})},stateValue:function(t,i,n){var o,a=this.state(t,i),r=!1;return a&&e.lang.object(a).isArray()&&(a=a[0]),a&&(o=a.getAttribute("style"))?(r=e.quirks.styleParser.parseColor(o,"background-color"),e.quirks.styleParser.unparseColor(r,n)):!1}}}(wysihtml5),function(e){function t(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function i(e,t){return 3===e.nodeType?e:e.childNodes[t]||e}function n(e){return e&&1===e.nodeType&&"BR"===e.nodeName}function o(e,t){return e&&1===e.nodeType&&"block"===t.win.getComputedStyle(e).display}function a(e){return e&&1===e.nodeType&&e.classList.contains("rangySelectionBoundary")}function r(e,t){return n(e)||o(e,t)}function s(t,i){e.dom.removeInvisibleSpaces(t.element);for(var n,o=t.element,a=o.querySelectorAll(A),r=t.config.classNames.uneditableContainer+[""].concat(A.split(",")).join(", "+t.config.classNames.uneditableContainer+" "),s=o.querySelectorAll(r),l=e.lang.array(a).without(s),d=l.length;d--;)""===l[d].innerHTML.replace(/[\uFEFF]/g,"")&&(n=e.lang.array(i).indexOf(l[d]),n>-1&&i.splice(n,1),l[d].parentNode.removeChild(l[d]));return i}function l(e){return e.config.useLineBreaks?"DIV":"P"}function d(e,t,i){for(var n=e,o=null;n&&t&&n!==t;)1===n.nodeType&&n.matches(i?A:_)&&(o=n),n=n.parentNode;return o}function c(e,t){for(var i,n,o,a=e,r=null;a&&t&&a!==t;)1===a.nodeType&&a.matches(L)&&(n=a,null===r?(r=a.cloneNode(!1),i=r):(o=a.cloneNode(!1),o.appendChild(r),r=o)),a=a.parentNode;return{parent:n,outerNode:r,innerNode:i}}function h(t,i,n){return t||(t=n.doc.createElement(i.nodeName||l(n)),t.appendChild(n.doc.createTextNode(e.INVISIBLE_SPACE))),i.nodeName&&t.nodeName!==i.nodeName&&(t=N.renameElement(t,i.nodeName)),i.classRegExp&&(t.className=t.className.replace(i.classRegExp,"")),i.className&&t.classList.add(i.className),i.styleProperty&&"undefined"!=typeof i.styleValue&&(t.style[e.browser.fixStyleKey(i.styleProperty)]=i.styleValue),t}function u(t,i,n){var o,a=t.previousSibling,r=t.nextSibling,s=!1;i.styleProperty&&(t.style[e.browser.fixStyleKey(i.styleProperty)]=""),i.className&&t.classList.remove(i.className),i.classRegExp&&(t.className=t.className.replace(i.classRegExp,"")),null!==t.getAttribute("class")&&""===t.getAttribute("class").trim()&&t.removeAttribute("class"),i.nodeName&&t.nodeName.toLowerCase()===i.nodeName.toLowerCase()&&(o=t.getAttribute("style"),o&&""!==o.trim()?t=N.renameElement(t,l(n)):(N.unwrap(t),s=!0)),null!==t.getAttribute("style")&&""===t.getAttribute("style").trim()&&t.removeAttribute("style"),s&&w(a,r,n)}function m(t){for(var i,n,o=t.querySelectorAll(A)||[],a=o.length;a--;)i=e.dom.domNode(o[a]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),n=e.dom.domNode(o[a]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),i&&1!==i.nodeType&&"BR"!==i.nodeName&&""!==(o[a].innerHTML||o[a].nodeValue||"").trim()&&o[a].parentNode.insertBefore(o[a].ownerDocument.createElement("BR"),i),i&&1!==i.nodeType&&"BR"!==i.nodeName&&""!==(o[a].innerHTML||o[a].nodeValue||"").trim()&&o[a].parentNode.insertBefore(o[a].ownerDocument.createElement("BR"),i),e.dom.unwrap(o[a])}function p(e,t){var i,n=e.startContainer,o=e.endContainer;return n&&1===n.nodeType&&n===o?(n.firstChild===n.lastChild&&1===e.endOffset&&n!==t.element&&"LI"!==n.nodeName&&"TD"!==n.nodeName&&(e.setStartBefore(n),e.setEndAfter(o)),void 0):n&&1===n.nodeType&&3===o.nodeType?(n.firstChild===o&&e.endOffset===o.data.length&&n!==t.element&&"LI"!==n.nodeName&&"TD"!==n.nodeName&&e.setEndAfter(n),void 0):o&&1===o.nodeType&&3===n.nodeType?(o.firstChild===n&&0===e.startOffset&&o!==t.element&&"LI"!==o.nodeName&&"TD"!==o.nodeName&&e.setStartBefore(o),void 0):n&&3===n.nodeType&&n===o&&1===n.parentNode.childNodes.length?(e.endOffset==o.data.length&&0===e.startOffset&&(i=n.parentNode,i!==t.element&&"LI"!==i.nodeName&&"TD"!==i.nodeName&&(e.setStartBefore(i),e.setEndAfter(i))),void 0):void 0}function g(t){for(var i,n,o,a,r,s,l=[],d=0,c=t.length;c>d;d++)if(1===t[d].startContainer.nodeType&&t[d].startContainer.matches("ul, ol")&&t[d].setStart(t[d].startContainer.childNodes[t[d].startOffset],0),1===t[d].endContainer.nodeType&&t[d].endContainer.matches("ul, ol")&&(s=t[d].endContainer.childNodes[Math.max(t[d].endOffset-1,0)],s.childNodes&&t[d].setEnd(s,s.childNodes.length)),i=t[d].getNodes([1],function(e){return"LI"===e.nodeName}),i.length>0){for(n=0,o=i.length;o>n;n++)r=t[d].compareNode(i[n]),(r===t[d].NODE_AFTER||r===t[d].NODE_INSIDE)&&(a=t[d].cloneRange(),s=e.dom.domNode(i[n]).prev({nodeTypes:[1]}),s?a.setEnd(s,s.childNodes.length):i[n].closest("ul, ol")?a.setEndBefore(i[n].closest("ul, ol")):a.setEndBefore(i[n]),l.push(a),t[d].setStart(i[n],0)),(r===t[d].NODE_BEFORE||r===t[d].NODE_INSIDE)&&(a=t[d].cloneRange(),a.setEnd(i[n],i[n].childNodes.length),l.push(a),s=e.dom.domNode(i[n]).next({nodeTypes:[1]}),s?t[d].setStart(s,0):i[n].closest("ul, ol")?t[d].setStartAfter(i[n].closest("ul, ol")):t[d].setStartAfter(i[n]));l.push(t[d])}else l.push(t[d]);return l}function f(t,i,n){var o=t?e.lang.object(t).clone(!0):null;return o&&(o.nodeName=o.nodeName||i||l(n)),o}function y(t,i,n,o){var a,s,l,h,u,m=i.startContainer,o=o||d(m,n.element,!0);if(o)s=t.firstChild,l=t.lastChild,n.selection.splitElementAtCaret(o,t),u=e.dom.domNode(l).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),h=e.dom.domNode(s).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),s&&!r(s,n)&&h&&!r(h,n)&&s.parentNode.insertBefore(n.doc.createElement("br"),s),l&&!r(l,n)&&u&&!r(u,n)&&u.parentNode.insertBefore(n.doc.createElement("br"),u);else if(a=c(m,n.element),a.outerNode&&a.innerNode&&a.parent){if(1===t.childNodes.length){for(;t.firstChild.firstChild;)a.innerNode.appendChild(t.firstChild.firstChild);t.firstChild.appendChild(a.outerNode)}n.selection.splitElementAtCaret(a.parent,t)}else i.insertNode(t)}function b(t,n,o){for(var a,s,l=t.cloneRange(),d=i(l.startContainer,l.startOffset).previousSibling,c=i(l.endContainer,l.endOffset).nextSibling,h=l.extractContents(),u=o.doc.createDocumentFragment(),p=!0;h.firstChild;){if(1===h.firstChild.nodeType&&h.firstChild.matches(A)){m(h.firstChild),a=e.dom.unwrap(h.firstChild),a.length>0&&(u.lastChild&&(1!==u.lastChild.nodeType||!r(u.lastChild,o))||!u.lastChild&&d&&(1!==d.nodeType||r(d,o)))&&u.appendChild(o.doc.createElement("BR"));for(var g=0,f=a.length;f>g;g++)u.appendChild(a[g]);a.length>0&&(1===u.lastChild.nodeType&&r(u.lastChild,o)||(c||u.lastChild!==h.lastChild)&&u.appendChild(o.doc.createElement("BR")))}else u.appendChild(h.firstChild);p=!1}return s=e.lang.array(u.childNodes).get(),y(u,l,o),s}function v(t,i,o){var a=t&&e.dom.domNode(t).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});n(i)&&i.parentNode.removeChild(i),!n(t)||a&&1===a.nodeType&&"block"===o.win.getComputedStyle(a).display||t.parentNode.removeChild(t)}function w(e,t,i){var o;e&&a(e)&&(e=e.previousSibling),t&&a(t)&&(t=t.nextSibling),o=e&&e.previousSibling,e&&(1!==e.nodeType||"block"!==i.win.getComputedStyle(e).display&&!n(e))&&e.parentNode&&e.parentNode.insertBefore(i.doc.createElement("br"),e.nextSibling),t&&(1!==t.nodeType||"block"!==i.win.getComputedStyle(t).display)&&t.parentNode&&t.parentNode.insertBefore(i.doc.createElement("br"),t)}function C(n,o,a,r){var s,l,c=o?t(o):null,u=n.cloneRange(),p=u.startContainer,g=e.dom.domNode(i(u.startContainer,u.startOffset)).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),b=e.dom.domNode(i(u.endContainer,u.endOffset)).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),w=u.extractContents(),C=r.doc.createDocumentFragment(),E=c?e.dom.getParentElement(p,c,null,r.element):null,x=!a||!o||"BLOCKQUOTE"===o.nodeName&&"BLOCKQUOTE"===a,S=E||d(p,r.element,x);if(o&&"BLOCKQUOTE"===o.nodeName){var k=h(null,o,r);k.appendChild(w),C.appendChild(k),l=[k]}else{if(w.firstChild)for(;w.firstChild;)if(1==w.firstChild.nodeType&&w.firstChild.matches(A))h(w.firstChild,o,r),w.firstChild.matches(_)&&m(w.firstChild),C.appendChild(w.firstChild);else{for(s=h(null,f(o,a,r),r);w.firstChild&&(1!==w.firstChild.nodeType||!w.firstChild.matches(A));)1==w.firstChild.nodeType&&s.matches(_)&&m(w.firstChild),s.appendChild(w.firstChild);C.appendChild(s)}else C.appendChild(h(null,o,r));l=e.lang.array(C.childNodes).get()}return y(C,u,r,S),v(g,b,r),l}function E(t,i){var n=e.dom.getParentElement(t,{query:A},null,i.element);return n?n.nodeName:null}function x(t,i){var n,o=e.dom.getParentElement(t.selection.getOwnRanges()[0].startContainer,{query:_+", "+(i?i.toLowerCase():"div")},null,t.element);o?(n=t.selection.createRange(),n.selectNode(o),t.selection.setSelection(n)):t.isEmpty()||t.selection.selectLine()}function S(e,t){var i=t.selection.createRange(),n=e[e.length-1],o=1===n.nodeType&&n.childNodes?0|n.childNodes.length:n.length||0;i.setStart(e[0],0),i.setEnd(n,o),i.select()}function k(e,t,i){var n,o=t.selection.getOwnRanges(),a=[];o=g(o);for(var r=o.length;r--;)p(o[r],t),n=E(o[r].startContainer,t),a="remove"===e?a.concat(b(o[r],n,t)):a.concat(C(o[r],i,n,t));return a}function T(e){return"string"==typeof e&&(e={nodeName:e.toUpperCase()}),e}var N=e.dom,_="h1, h2, h3, h4, h5, h6, p, pre",A="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",L="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u";e.commands.formatBlock={exec:function(e,t,i){i=T(i);var n,o,a=[];if(i&&i.toggle&&(o=this.state(e,t,i)),o){n=rangy.saveSelection(e.win);for(var r=0,l=o.length;l>r;r++)u(o[r],i,e)}else e.selection.isCollapsed()&&(n=rangy.saveSelection(e.win),x(e,i&&i.nodeName?i.nodeName.toUpperCase():void 0)),a=i?k("apply",e,i):k("remove",e);a=s(e,a),n?rangy.restoreSelection(n):S(a,e)},remove:function(e,t,i){i=T(i);var n,o;e.selection.isCollapsed()&&(o=rangy.saveSelection(e.win),x(e,i&&i.nodeName?i.nodeName.toUpperCase():void 0)),n=k("remove",e),n=s(e,n),o?rangy.restoreSelection(o):S(n,e)},state:function(t,i,n){n=T(n);for(var o,a=t.selection.filterElements(function(t){return e.dom.domNode(t).test(n||{query:A})}.bind(this)),r=t.selection.getSelectedOwnNodes(),s=0,l=r.length;l>s;s++)o=N.getParentElement(r[s],n||{query:A},null,t.element),o&&-1===a.indexOf(o)&&a.push(o);return 0===a.length?!1:a}}}(wysihtml5),function(e){e.commands.formatCode={exec:function(t,i,n){var o,a,r,s=this.state(t)[0];s?t.selection.executeAndRestore(function(){o=s.querySelector("code"),e.dom.replaceWithChildNodes(s),o&&e.dom.replaceWithChildNodes(o)}):(a=t.selection.getRange(),r=a.extractContents(),s=t.doc.createElement("pre"),o=t.doc.createElement("code"),n&&(o.className=n),s.appendChild(o),o.appendChild(r),a.insertNode(s),t.selection.selectNode(s))},state:function(t){var i,n=t.selection.getSelectedNode();return n&&n.nodeName&&"PRE"==n.nodeName&&n.firstChild&&n.firstChild.nodeName&&"CODE"==n.firstChild.nodeName?[n]:(i=e.dom.getParentElement(n,{query:"pre code"}),i?[i.parentNode]:!1)}}}(wysihtml5),function(e){function t(e){return/^\s*$/.test(e.className)}function i(e){return!e.getAttribute("style")||/^\s*$/.test(e.getAttribute("style"))}function n(t){var i=e.dom.getAttributes(t);return e.lang.object(i).isEmpty()}function o(t,i){var n,o,a,r;return 1!==t.nodeType||1!==i.nodeType?!1:t.nodeName!==i.nodeName?!1:(n=t.className.trim().replace(/\s+/g," ").split(" "),o=i.className.trim().replace(/\s+/g," ").split(" "),e.lang.array(n).without(o).length>0?!1:(a=e.dom.getAttributes(t),r=e.dom.getAttributes(i),a.length===r.length&&e.lang.object(e.lang.object(a).difference(r)).isEmpty()?!0:!1))}function a(t,i){var n=i&&i.nodeName||R,o=t.ownerDocument.createElement(n);if(i.classRegExp&&(o.className=o.className.replace(i.classRegExp,"")),i.className&&o.classList.add(i.className),i.styleProperty&&"undefined"!=typeof i.styleValue&&(o.style[e.browser.fixStyleKey(i.styleProperty)]=i.styleValue),i.attribute)if("object"==typeof i.attribute)for(var a in i.attribute)i.attribute.hasOwnProperty(a)&&o.setAttribute(a,i.attribute[a]);else"undefined"!=typeof i.attributeValue&&o.setAttribute(i.attribute,i.attributeValue);return o}function r(e,t){for(var i in e)if(e.hasOwnProperty(i)&&(void 0===typeof t[i]||t[i]!==e[i]))return!1;return!0}function s(t,i,n){var o,a=e.dom.getAttributes(t),s=r(i,a);if(e.lang.object(a).difference(i),s&&n!==!1)for(o in i)i.hasOwnProperty(o)&&t.removeAttribute(o);else for(o in i)i.hasOwnProperty(o)&&t.setAttribute(o,i[o])}function l(o,a){var r,l,d;a.className&&(a.toggle!==!1&&o.classList.contains(a.className)?o.classList.remove(a.className):(a.classRegExp&&(o.className=o.className.replace(a.classRegExp,"")),o.classList.add(a.className)),t(o)&&o.removeAttribute("class")),a.styleProperty&&(o.style[e.browser.fixStyleKey(a.styleProperty)]=a.toggle!==!1&&o.style[e.browser.fixStyleKey(a.styleProperty)].trim().replace(/, /g,",")===a.styleValue?"":a.styleValue),i(o)&&o.removeAttribute("style"),a.attribute&&("object"==typeof a.attribute?r=a.attribute:(r={},r[a.attribute]=a.attributeValue||""),s(o,r,a.toggle)),l=a.nodeName?I[a.nodeName.toLowerCase()]||a.nodeName.toLowerCase():null,d=l?e.dom.domNode(o).test({query:l}):!1,(!a.nodeName||a.nodeName===R||d)&&(a.toggle!==!1&&d||!a.nodeName&&o.nodeName===R)&&t(o)&&i(o)&&n(o)&&e.dom.unwrap(o)}function d(t,i){var n=[];return t.isCollapsed()||(n=n.concat(t.getOwnNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()},i))),n}function c(e,t,i,n){var o=e,a=n?t:h(t);do{if(1===o.nodeType&&u(o,a))return o;o=o.parentNode}while(o&&o!==i);return null}function h(e){return{nodeName:e.nodeName||null,className:e.classRegExp?null:e.className||null,classRegExp:e.classRegExp||null,styleProperty:e.styleProperty||null}}function u(t,i){var n;if(i.nodeName){var o=I[i.nodeName.toLowerCase()]||i.nodeName.toLowerCase();return e.dom.domNode(t).test({query:o})}return n=e.lang.object(i).clone(),n.query=O,e.dom.domNode(t).test(n)}function m(t,i){var n=document.documentElement||document.body,o=n.scrollTop,a=n.scrollLeft;rangy.getSelection(t.win),rangy.getSelection(t.win).removeAllRanges();try{rangy.getSelection(t.win).addRange(i)}catch(r){}t.doc.activeElement&&e.dom.contains(t.element,t.doc.activeElement)||(t.element.focus(),n.scrollTop=o,n.scrollLeft=a,rangy.getSelection(t.win).addRange(i))}function p(e,t){var i=rangy.createRange(t.doc),n=e[e.length-1];e[0]&&n&&(i.setStart(e[0],0),i.setEnd(n,n.length),m(t,i))}function g(e,t,i,n){var o=rangy.createRange(e.doc);t&&(o.setStart(t,i),o.setEnd(t,"undefined"!=typeof n?n:i),m(e,o))}function f(e,t,i){var n,o,a,r=d(e.selection),s=[],l=!1;if(e.selection.isInThisEditable()){if(0===r.length&&e.selection.isCollapsed()){if(a=e.selection.getSelection().anchorNode,!a)return{nodes:[],partial:!1};3===a.nodeType&&(r=[a])}r.length||(o=e.selection.getOwnRanges()[0],o&&(r=[o.endContainer]));for(var h=0,u=r.length;u>h;h++)n=c(r[h],t,e.element,i),n?s.push(n):l=!0}return{nodes:s,partial:l}}function y(e){var t,i,n,o;return e&&(t=e.anchorNode,i=e.anchorOffset,t&&3===t.nodeType&&i>0&&i<t.data.length)?(n=t.data[i-1],o=t.data[i],/\w/.test(n)&&/\w/.test(o)):!1}function b(t){var i,n,o,a,r,s,l=[];if(t&&(i=t.anchorNode,n=r=s=t.anchorOffset,o=i.ownerDocument,a=rangy.createRange(o),i&&3===i.nodeType)){for(;r>0&&/\w/.test(i.data[r-1]);)r--;for(;s<i.data.length&&/\w/.test(i.data[s]);)s++;return a.setStartAndEnd(i,r,s),a.splitBoundaries(),l=a.getNodes([3],function(t){return!e.dom.domNode(t).is.emptyTextNode()}),{wordOffset:n-r,range:a,textNode:l[0]}}return!1}function v(e,t){for(;t.firstChild;)e.appendChild(t.firstChild);t.parentNode.removeChild(t)}function w(e){for(var t=e.length;t--;)e[t]&&e[t].parentNode&&(e[t].nextSibling&&o(e[t],e[t].nextSibling)&&v(e[t],e[t].nextSibling),e[t].previousSibling&&o(e[t],e[t].previousSibling)&&v(e[t].previousSibling,e[t]))}function C(e,t,i){t.length>0&&p(t,e),w(f(e,i).nodes),t.length>0&&p(t,e)}function E(e,t,i,n){g(e,t,i),w(f(e,n).nodes),g(e,t,i)}function x(e,t){var i=a(e,t);e.parentNode.insertBefore(i,e),i.appendChild(e)}function S(t,i,n){var o,a=i.element,r=c(t,n,a);r&&(o=r.cloneNode(!1),e.dom.domNode(t).escapeParent(r,o),l(o,n))}function k(t,i,n){var o=i.element,a=c(t,n,o);a&&e.dom.domNode(t).escapeParent(a)}function T(e,t,i){var n=a(e.endContainer,i);e.surroundContents(n),t.selection.selectNode(n)}function N(t,i,n,o){var a,r,s,d,h=f(t,o,!0),u=t.selection.getSelection();if(i.length){if(h.partial||o.toggle===!1)for(d=i.length;d--;)c(i[d],o,t.element)&&S(i[d],t,o),c(i[d],o,t.element)||x(i[d],o);else for(d=i.length;d--;)S(i[d],t,o);C(t,i,o)}else if(o.toggle!==!1)if(y(u))a=b(u),r=a.textNode,S(a.textNode,t,o),E(t,a.textNode,a.wordOffset,o);else{r=t.doc.createTextNode(e.INVISIBLE_SPACE),s=n.nodes[0].cloneNode(!1),s.appendChild(r),t.selection.splitElementAtCaret(n.nodes[0],s),l(s,o),C(t,[r],o);var m=t.selection.getSelection();if(m.anchorNode&&m.focusNode)try{m.collapseToEnd()}catch(p){}}else for(d=n.nodes.length;d--;)l(n.nodes[d],o)}function _(t,i,n,o){var a,r,s,l=t.selection.getSelection();if(i.length){for(s=i.length;s--;)k(i[s],t,o);C(t,i,o)}else{for(a=l.anchorNode,r=l.anchorOffset,s=n.nodes.length;s--;)e.dom.unwrap(n.nodes[s]);E(t,a,r,o)}}function A(e,t,i){var n,o,a=e.selection.getSelection();if(t.length){for(o=t.length;o--;)x(t[o],i);C(e,t,i)}else if(y(a))n=b(a),x(n.textNode,i),E(e,n.textNode,n.wordOffset,i);else{var r=e.selection.getOwnRanges()[0];r&&T(r,e,i)}}function L(e){return e="string"==typeof e?{nodeName:e}:e,e.nodeName&&(e.nodeName=e.nodeName.toUpperCase()),e}var R="SPAN",O="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",I={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};e.commands.formatInline={exec:function(e,t,i){i=L(i),e.element.normalize();var n=d(e.selection,!0),o=f(e,i);o.nodes.length>0?N(e,n,o,i):A(e,n,i),e.element.normalize()},remove:function(e,t,i){i=L(i),e.element.normalize();var n=d(e.selection,!0),o=f(e,i);o.nodes.length>0&&_(e,n,o,i),e.element.normalize()},state:function(e,t,i){i=L(i);var n=f(e,i,!0).nodes;return 0===n.length?!1:n}}}(wysihtml5),function(e){var t={nodeName:"BLOCKQUOTE",toggle:!0};e.commands.insertBlockQuote={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){e.commands.insertHTML={exec:function(e,t,i){e.selection.insertHTML(i)},state:function(){return!1}}}(wysihtml5),function(e){var t="IMG";e.commands.insertImage={exec:function(i,n,o){o="object"==typeof o?o:{src:o};var a,r,s=i.doc,l=this.state(i);if(l&&!o.src)return i.selection.setBefore(l),r=l.parentNode,r.removeChild(l),e.dom.removeEmptyTextNodes(r),"A"!==r.nodeName||r.firstChild||(i.selection.setAfter(r),r.parentNode.removeChild(r)),e.quirks.redraw(i.element),void 0;if(l)for(var d in o)o.hasOwnProperty(d)&&l.setAttribute("className"===d?"class":d,o[d]);else{l=s.createElement(t);for(var c in o)l.setAttribute("className"===c?"class":c,o[c]);i.selection.insertNode(l),e.browser.hasProblemsSettingCaretAfterImg()?(a=s.createTextNode(e.INVISIBLE_SPACE),i.selection.insertNode(a),i.selection.setAfter(a)):i.selection.setAfter(l)}},state:function(i){var n,o,a,r=i.doc;return e.dom.hasElementWithTagName(r,t)?(n=i.selection.getSelectedNode())?n.nodeName===t?n:n.nodeType!==e.ELEMENT_NODE?!1:(o=i.selection.getText(),(o=e.lang.string(o).trim())?!1:(a=i.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==a.length?!1:a[0])):!1:!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(e){e.selection.insertHTML(t)},state:function(){return!1}}}(wysihtml5),function(e){e.commands.insertOrderedList={exec:function(t,i){e.commands.insertList.exec(t,i,"OL")},state:function(t,i){return e.commands.insertList.state(t,i,"OL")}}}(wysihtml5),function(e){e.commands.insertUnorderedList={exec:function(t,i){e.commands.insertList.exec(t,i,"UL")},state:function(t,i){return e.commands.insertList.state(t,i,"UL")}}}(wysihtml5),wysihtml5.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var i=t.length;i--;)if(e.nodeName===t[i])return!0}return!1},i=function(i,n,o){var a={el:null,other:!1};if(i){var r=e.dom.getParentElement(i,{query:"li"},!1,o.element),s="UL"===n?"OL":"UL";t(i,n)?a.el=i:t(i,s)?a={el:i,other:!0}:r&&(t(r.parentNode,n)?a.el=r.parentNode:t(r.parentNode,s)&&(a={el:r.parentNode,other:!0}))}return a.el&&!o.element.contains(a.el)&&(a.el=null),a},n=function(t,i,n){var o,r,s="UL"===i?"OL":"UL";n.selection.executeAndRestoreRangy(function(){if(o=a(s,n),o.length)for(var l=o.length;l--;)e.dom.renameElement(o[l],i.toLowerCase());else{r=a(["OL","UL"],n);for(var d=r.length;d--;)e.dom.resolveList(r[d],n.config.useLineBreaks);e.dom.resolveList(t,n.config.useLineBreaks)}})},o=function(t,i,n){var o="UL"===i?"OL":"UL";n.selection.executeAndRestoreRangy(function(){for(var r=[t].concat(a(o,n)),s=r.length;s--;)e.dom.renameElement(r[s],i.toLowerCase())})},a=function(e,i){for(var n=i.selection.getOwnRanges(),o=[],a=n.length;a--;)o=o.concat(n[a].getNodes([1],function(i){return t(i,e)}));return o},r=function(t,i){var n;i.selection.isCollapsed()||(n=rangy.saveSelection(i.win));var o,a,r="_wysihtml5-temp-"+(new Date).getTime(),s=i.selection.deblockAndSurround({nodeName:"div",className:r});s.innerHTML=s.innerHTML.replace(e.INVISIBLE_SPACE_REG_EXP,""),s&&(o=/^(\s|(<br>))+$/i.test(s.innerHTML),a=e.dom.convertToList(s,t.toLowerCase(),i.parent.config.classNames.uneditableContainer),n&&rangy.restoreSelection(n),o&&i.selection.selectNode(a.querySelector("li"),!0))};return{exec:function(e,t,a){var s=e.doc,l="OL"===a?"insertOrderedList":"insertUnorderedList",d=e.selection.getSelectedNode(),c=i(d,a,e);c.el?c.other?o(c.el,a,e):n(c.el,a,e):e.commands.support(l)?s.execCommand(l,!1,null):r(a,e)},state:function(e,t,n){var o=e.selection.getSelectedNode(),a=i(o,n,e);return a.el&&!a.other?a.el:!1}}}(wysihtml5),function(e){var t={nodeName:"I",toggle:!0};e.commands.italic={exec:function(i,n){e.commands.formatInline.exec(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyCenter={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyLeft={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyRight={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};e.commands.justifyFull={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"right",toggle:!0};e.commands.alignRightStyle={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"left",toggle:!0};e.commands.alignLeftStyle={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"center",toggle:!0};e.commands.alignCenterStyle={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){var t={styleProperty:"textAlign",styleValue:"justify",toggle:!0};e.commands.alignJustifyStyle={exec:function(i){return e.commands.formatBlock.exec(i,"formatBlock",t)},state:function(i){return e.commands.formatBlock.state(i,"formatBlock",t)}}}(wysihtml5),function(e){e.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(){return!1}}}(wysihtml5),function(e){var t={nodeName:"U",toggle:!0};e.commands.underline={exec:function(i,n){e.commands.formatInline.exec(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){e.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(){return!1}}}(wysihtml5),function(e){e.commands.createTable={exec:function(e,t,i){var n,o,a;if(i&&i.cols&&i.rows&&parseInt(i.cols,10)>0&&parseInt(i.rows,10)>0){for(a=i.tableStyle?'<table style="'+i.tableStyle+'">':"<table>",a+="<tbody>",o=0;o<i.rows;o++){for(a+="<tr>",n=0;n<i.cols;n++)a+="<td><br></td>";a+="</tr>"}a+="</tbody></table>",e.commands.exec("insertHTML",a)}},state:function(){return!1}}}(wysihtml5),function(e){e.commands.mergeTableCells={exec:function(t,i){t.tableSelection&&t.tableSelection.start&&t.tableSelection.end&&(this.state(t,i)?e.dom.table.unmergeCell(t.tableSelection.start):e.dom.table.mergeCellsBetween(t.tableSelection.start,t.tableSelection.end))},state:function(t){if(t.tableSelection){var i=t.tableSelection.start,n=t.tableSelection.end;if(i&&n&&i==n&&(e.dom.getAttribute(i,"colspan")&&parseInt(e.dom.getAttribute(i,"colspan"),10)>1||e.dom.getAttribute(i,"rowspan")&&parseInt(e.dom.getAttribute(i,"rowspan"),10)>1))return[i]}return!1}}}(wysihtml5),function(e){e.commands.addTableCells={exec:function(t,i,n){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var o=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end);"before"==n||"above"==n?e.dom.table.addCells(o.start,n):("after"==n||"below"==n)&&e.dom.table.addCells(o.end,n),setTimeout(function(){t.tableSelection.select(o.start,o.end)},0)}},state:function(){return!1}}}(wysihtml5),function(e){e.commands.deleteTableCells={exec:function(t,i,n){if(t.tableSelection&&t.tableSelection.start&&t.tableSelection.end){var o,a=e.dom.table.orderSelectionEnds(t.tableSelection.start,t.tableSelection.end),r=e.dom.table.indexOf(a.start),s=t.tableSelection.table;
    e.dom.table.removeCells(a.start,n),setTimeout(function(){o=e.dom.table.findCell(s,r),o||("row"==n&&(o=e.dom.table.findCell(s,{row:r.row-1,col:r.col})),"column"==n&&(o=e.dom.table.findCell(s,{row:r.row,col:r.col-1}))),o&&t.tableSelection.select(o,o)},0)}},state:function(){return!1}}}(wysihtml5),function(e){e.commands.indentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,e.selection):!1},state:function(){return!1},tryToPushLiLevel:function(t,i){var n,o,a,r,s,l=!1;return i.executeAndRestoreRangy(function(){for(var i=t.length;i--;)r=t[i],n="OL"===r.parentNode.nodeName?"OL":"UL",o=r.ownerDocument.createElement(n),a=e.dom.domNode(r).prev({nodeTypes:[e.ELEMENT_NODE]}),s=a?a.querySelector("ul, ol"):null,a&&(s?s.appendChild(r):(o.appendChild(r),a.appendChild(o)),l=!0)}),l}}}(wysihtml5),function(e){e.commands.outdentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,e):!1},state:function(){return!1},tryToPullLiLevel:function(t,i){var n,o,a,r,s,l=!1,d=this;return i.selection.executeAndRestoreRangy(function(){for(var c=t.length;c--;)if(r=t[c],r.parentNode&&(n=r.parentNode,"OL"===n.tagName||"UL"===n.tagName)){if(l=!0,o=e.dom.getParentElement(n.parentNode,{query:"ol, ul"},!1,i.element),a=e.dom.getParentElement(n.parentNode,{query:"li"},!1,i.element),o&&a)r.nextSibling&&(s=d.getAfterList(n,r),r.appendChild(s)),o.insertBefore(r,a.nextSibling);else{r.nextSibling&&(s=d.getAfterList(n,r),r.appendChild(s));for(var h=r.childNodes.length;h--;)n.parentNode.insertBefore(r.childNodes[h],n.nextSibling);n.parentNode.insertBefore(document.createElement("br"),n.nextSibling),r.parentNode.removeChild(r)}0===n.childNodes.length&&n.parentNode.removeChild(n)}}),l},getAfterList:function(e,t){for(var i=e.nodeName,n=document.createElement(i);t.nextSibling;)n.appendChild(t.nextSibling);return n}}}(wysihtml5),function(e){var t={nodeName:"SUB",toggle:!0};e.commands.subscript={exec:function(i,n){e.commands.formatInline.exec(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){var t={nodeName:"SUP",toggle:!0};e.commands.superscript={exec:function(i,n){e.commands.formatInline.exec(i,n,t)},state:function(i,n){return e.commands.formatInline.state(i,n,t)}}}(wysihtml5),function(e){var t=90,i=89,n=8,o=46,a=25,r="data-wysihtml5-selection-node",s="data-wysihtml5-selection-offset",l=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,a=this;this.composer.sandbox.getDocument(),l.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var n=e.keyCode,o=n===t&&!e.shiftKey,r=n===t&&e.shiftKey||n===i;o?(a.undo(),e.preventDefault()):r&&(a.redo(),e.preventDefault())}}),l.observe(this.element,"keydown",function(t){var i=t.keyCode;i!==e&&(e=i,(i===n||i===o)&&a.transact())}),this.editor.on("newword:composer",function(){a.transact()}).on("beforecommand:composer",function(){a.transact()})},transact:function(){var t,i,n,o,l,d=this.historyStr[this.position-1],c=this.composer.getValue(!1,!1),h=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(c!==d){var u=this.historyStr.length=this.historyDom.length=this.position;u>a&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,h&&(t=this.composer.selection.getRange(),i=t&&t.startContainer?t.startContainer:this.element,n=t&&t.startOffset?t.startOffset:0,i.nodeType===e.ELEMENT_NODE?o=i:(o=i.parentNode,l=this.getChildNodeIndex(o,i)),o.setAttribute(s,n),"undefined"!=typeof l&&o.setAttribute(r,l));var m=this.element.cloneNode(!!c);this.historyDom.push(m),this.historyStr.push(c),o&&(o.removeAttribute(s),o.removeAttribute(r))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t=0,i=e.childNodes,n=e.childNodes.length;n>t;t++)this.element.appendChild(i[t].cloneNode(!0));var o,a,l;e.hasAttribute(s)?(o=e.getAttribute(s),l=e.getAttribute(r),a=this.element):(a=this.element.querySelector("["+s+"]")||this.element,o=a.getAttribute(s),l=a.getAttribute(r),a.removeAttribute(s),a.removeAttribute(r)),null!==l&&(a=this.getChildNodeByIndex(a,+l)),this.composer.selection.set(a,o)},getChildNodeIndex:function(e,t){for(var i=0,n=e.childNodes,o=n.length;o>i;i++)if(n[i]===t)return i},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,i){this.parent=e,this.element=t,this.config=i,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,i=e.browser;e.views.Composer=e.views.View.extend({name:"composer",constructor:function(e,t,i){this.base(e,t,i),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(t,i){var n=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(n=this.parent.parse(n,i===!1?!1:!0)),n},setValue:function(e,t){t!==!1&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(i){this.element.innerText=e}},cleanUp:function(e){var t;this.selection&&this.selection.isInThisEditable()&&(t=rangy.saveSelection(this.win)),this.parent.parse(this.element,void 0,e),t&&rangy.restoreSelection(t)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var i=this.element.lastChild;t&&i&&this.selection&&("BR"===i.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var e={};return e.y="undefined"!=typeof this.win.pageYOffset?this.win.pageYOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,e.x="undefined"!=typeof this.win.pageXOffset?this.win.pageXOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,e}},setScrollPos:function(e){e&&"undefined"!=typeof e.x&&"undefined"!=typeof e.y&&this.win.scrollTo(e.x,e.y)},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe();var i=this.textarea.element;t.insert(this.editableArea).after(i),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function(){var n=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),t.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var o=this.config.name;o&&(t.addClass(this.element,o),this.config.contentEditableMode||t.addClass(this.editableArea,o)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var a="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");a&&t.simulatePlaceholder(this.parent,this,a,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||i.isIos()||setTimeout(function(){n.focus(!0)},100),i.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var n=this,o=i.canDisableAutoLinking(),a=i.doesAutoLinkingInContentEditable();if(o&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){(!a||a&&o)&&(this.parent.on("newword:composer",function(){if(t.getTextContent(n.element).match(t.autoLink.URL_REG_EXP)){for(var i=n.selection.getSelectedNode(),o=n.element.querySelectorAll("."+n.config.classNames.uneditableContainer),a=!1,r=o.length;r--;)e.dom.contains(o[r],i)&&(a=!0);a||t.autoLink(i,[n.config.classNames.uneditableContainer])}}),t.observe(this.element,"blur",function(){t.autoLink(n.element,[n.config.classNames.uneditableContainer])}));var r=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,l=function(i){var n=e.lang.string(t.getTextContent(i)).trim();return"www."===n.substr(0,4)&&(n="http://"+n),n};t.observe(this.element,"keydown",function(e){if(r.length){var i,o=n.selection.getSelectedNode(e.target.ownerDocument),a=t.getParentElement(o,{query:"a"},4);a&&(i=l(a),setTimeout(function(){var e=l(a);e!==i&&e.match(s)&&a.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),i.supportsEvent("resizeend")){var n=["width","height"],o=n.length,a=this.element;t.observe(a,"resizeend",function(t){var i,r=t.target||t.srcElement,s=r.style,l=0;if("IMG"===r.nodeName){for(;o>l;l++)i=n[l],s[i]&&(r.setAttribute(i,parseInt(s[i],10)),s[i]="");e.quirks.redraw(a)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function n(e){var i=t.getParentElement(e,{query:"p, div"},2);i&&t.contains(o.element,i)&&o.selection.executeAndRestore(function(){o.config.useLineBreaks?t.replaceWithChildNodes(i):"P"!==i.nodeName&&t.renameElement(i,"p")})}var o=this,a="li, p, h1, h2, h3, h4, h5, h6",r="ul, ol, menu";this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(o.isEmpty()){var e=o.doc.createElement("P");o.element.innerHTML="",o.element.appendChild(e),i.displaysCaretInEmptyContentEditableCorrectly()?o.selection.selectNode(e,!0):(e.innerHTML="<br>",o.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(i){var s=i.keyCode;if(!i.shiftKey&&(s===e.ENTER_KEY||s===e.BACKSPACE_KEY)){var l=t.getParentElement(o.selection.getSelectedNode(),{query:a},4);return l?(setTimeout(function(){var i,a=o.selection.getSelectedNode();if("LI"===l.nodeName){if(!a)return;i=t.getParentElement(a,{query:r},2),i||n(a)}s===e.ENTER_KEY&&l.nodeName.match(/^H[1-6]$/)&&n(a)},0),void 0):(o.config.useLineBreaks&&s===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(i.preventDefault(),o.commands.exec("insertLineBreak")),void 0)}})}})}(wysihtml5),function(e){var t=e.dom,i=document,n=window,o=i.createElement("div"),a=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],r=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],s=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(e){if(e.setActive)try{e.setActive()}catch(o){}else{var a=e.style,r=i.documentElement.scrollTop||i.body.scrollTop,s=i.documentElement.scrollLeft||i.body.scrollLeft,l={position:a.position,top:a.top,left:a.left,WebkitUserSelect:a.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),n.scrollTo&&n.scrollTo(s,r)}};e.views.Composer.prototype.style=function(){var n,d=this,c=i.querySelector(":focus"),h=this.textarea.element,u=h.hasAttribute("placeholder"),m=u&&h.getAttribute("placeholder"),p=h.style.display,g=h.disabled;this.focusStylesHost=o.cloneNode(!1),this.blurStylesHost=o.cloneNode(!1),this.disabledStylesHost=o.cloneNode(!1),u&&h.removeAttribute("placeholder"),h===c&&h.blur(),h.disabled=!1,h.style.display=n="none",(h.getAttribute("rows")&&"auto"===t.getStyle("height").from(h)||h.getAttribute("cols")&&"auto"===t.getStyle("width").from(h))&&(h.style.display=n=p),t.copyStyles(r).from(h).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(a).from(h).to(this.element).andTo(this.blurStylesHost),t.insertCSS(s).into(this.element.ownerDocument),h.disabled=!0,t.copyStyles(r).from(h).to(this.disabledStylesHost),t.copyStyles(a).from(h).to(this.disabledStylesHost),h.disabled=g,h.style.display=p,l(h),h.style.display=n,t.copyStyles(r).from(h).to(this.focusStylesHost),t.copyStyles(a).from(h).to(this.focusStylesHost),h.style.display=p,t.copyStyles(["display"]).from(h).to(this.editableArea);var f=e.lang.array(r).without(["display"]);return c?c.focus():h.blur(),u&&h.setAttribute("placeholder",m),this.parent.on("focus:composer",function(){t.copyStyles(f).from(d.focusStylesHost).to(d.editableArea),t.copyStyles(a).from(d.focusStylesHost).to(d.element)}),this.parent.on("blur:composer",function(){t.copyStyles(f).from(d.blurStylesHost).to(d.editableArea),t.copyStyles(a).from(d.blurStylesHost).to(d.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(f).from(d.disabledStylesHost).to(d.editableArea),t.copyStyles(a).from(d.disabledStylesHost).to(d.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(f).from(d.blurStylesHost).to(d.editableArea),t.copyStyles(a).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(e){var t=e.dom,i=e.browser,n={66:"bold",73:"italic",85:"underline"},o=function(e,t,i){for(var n=0,o=t.length;o>n;n++)e.addEventListener(t[n],i,!1)},a=function(e,t,i){for(var n=0,o=t.length;o>n;n++)e.removeEventListener(t[n],i,!1)},r=function(t,i){if(t.selection.caretIsLastInSelection()){var n=t.selection.getSelection(),o=n.anchorNode;if(o&&1===o.nodeType&&(e.dom.getParentElement(o,{query:"td, th"},!1,t.element)||i)){var a=o.childNodes[n.anchorOffset];if(a&&1===a.nodeType&"BR"===a.nodeName)return a.parentNode.removeChild(a),!0}}return!1},s=function(e){var t=e.selection.getBeforeSelection(!0);if(t&&("element"===t.type||"leafnode"===t.type)&&1===t.node.nodeType&&t.node.classList.contains(e.config.classNames.uneditableContainer)){if(r(e,!0))return!0;try{var i=new CustomEvent("wysihtml5:uneditable:delete");t.node.dispatchEvent(i)}catch(n){}return t.node.parentNode.removeChild(t.node),!0}return!1},l=function(t){var i=t.selection,n=i.getPreviousNode();if(i.caretIsFirstInSelection()&&n&&1===n.nodeType&&/block/.test(t.win.getComputedStyle(n).display)){if(/^\s*$/.test(n.textContent||n.innerText))return n.parentNode.removeChild(n),!0;if(n.lastChild){var o=n.lastChild,a=i.getSelectedNode(),r=e.dom.domNode(n).commonAncestor(a,t.element);if(curNode=r?e.dom.getParentElement(a,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,r):null){for(;curNode.firstChild;)n.appendChild(curNode.firstChild);return i.setAfter(o),!0}if(3===a.nodeType)return n.appendChild(a),i.setAfter(o),!0}}return!1},d=function(e,t){var i=t.selection;if(t.element,i.isCollapsed()){if(l(t))return e.preventDefault(),void 0;if(r(t))return e.preventDefault(),void 0;if(s(t))return e.preventDefault(),void 0}else i.containsUneditable()&&(e.preventDefault(),i.deleteContents())},c=function(e,t,i){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("li"))if(i){if(e.commands.exec("outdentList"))return}else if(e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")},h=function(){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},u=function(e){this.parent.fire("beforeinteraction",e).fire("beforeinteraction:composer",e),setTimeout(function(){this.parent.fire("interaction",e).fire("interaction:composer",e)}.bind(this),0)},m=function(e){this.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},p=function(e){if(this.focusState!==this.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",e).fire("blur:composer",e)},g=function(e){this.parent.fire(e.type,e).fire(e.type+":composer",e),"paste"===e.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},f=function(t){this.config.copyedFromMarking&&(e.browser.supportsModernPaste()&&(t.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),t.clipboardData.setData("text/plain",this.selection.getPlainText()),t.preventDefault()),this.parent.fire(t.type,t).fire(t.type+":composer",t))},y=function(t){var i=t.keyCode;(i===e.SPACE_KEY||i===e.ENTER_KEY)&&this.parent.fire("newword:composer")},b=function(t){if(!i.canSelectImagesInContentEditable()){var n=t.target,o=this.element.querySelectorAll("img"),a=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),r=e.lang.array(o).without(a);"IMG"===n.nodeName&&e.lang.array(r).contains(n)&&this.selection.selectNode(n)}},v=function(e){var t,i={IMG:"Image: ",A:"Link: "},n=e.target,o=n.nodeName;("A"===o||"IMG"===o)&&(n.hasAttribute("title")||(t=i[o]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",t)))},w=function(t){if(this.config.classNames.uneditableContainer){var i=e.dom.getParentElement(t.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);i&&this.selection.setAfter(i)}},C=function(){i.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},E=function(t){var i,o,a=t.keyCode,r=n[a];return!t.ctrlKey&&!t.metaKey||t.altKey||65!==a?((t.ctrlKey||t.metaKey)&&!t.altKey&&r&&(this.commands.exec(r),t.preventDefault()),a===e.BACKSPACE_KEY&&d(t,this),(a===e.BACKSPACE_KEY||a===e.DELETE_KEY)&&(i=this.selection.getSelectedNode(!0),i&&"IMG"===i.nodeName&&(t.preventDefault(),o=i.parentNode,o.removeChild(i),"A"!==o.nodeName||o.firstChild||o.parentNode.removeChild(o),setTimeout(function(){e.quirks.redraw(this.element)}.bind(this),0))),this.config.handleTabKey&&a===e.TAB_KEY&&(t.preventDefault(),c(this,this.element,t.shiftKey)),void 0):(this.selection.selectAll(),t.preventDefault(),void 0)},x=function(){var t=function(){window.removeEventListener("load",t),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),i=function(){t.call(this),a(this.sandbox.getIframe(),["focus","mouseup","mouseover"],i)}.bind(this);this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?o(this.sandbox.getIframe(),["focus","mouseup","mouseover"],i):window.addEventListener("load",t)),this.tableSelection=e.quirks.tableCellsSelection(this.element,this.parent)};e.views.Composer.prototype.observe=function(){var e=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),n=(this.element,i.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),e.addEventListener(["DOMNodeRemoved"],h.bind(this),!1),i.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){t.contains(document.documentElement,e)||h.call(this)},250)),this.config.handleTables&&x.call(this),o(n,["drop","paste","mouseup","focus","keyup"],u.bind(this)),n.addEventListener("focus",m.bind(this),!1),n.addEventListener("blur",p.bind(this),!1),o(this.element,["drop","paste","beforepaste"],g.bind(this),!1),this.element.addEventListener("copy",f.bind(this),!1),this.element.addEventListener("mousedown",b.bind(this),!1),this.element.addEventListener("mouseover",v.bind(this),!1),this.element.addEventListener("click",w.bind(this),!1),this.element.addEventListener("drop",C.bind(this),!1),this.element.addEventListener("keyup",y.bind(this),!1),this.element.addEventListener("keydown",E.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,i){this.editor=e,this.textarea=t,this.composer=i,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var i,n=this,o=this.textarea.element.form,a=function(){i=setInterval(function(){n.fromComposerToTextarea()},t)},r=function(){clearInterval(i),i=null};a(),o&&(e.dom.observe(o,"submit",function(){n.sync(!0)}),e.dom.observe(o,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||i?"textarea"===e&&(n.fromComposerToTextarea(!0),r()):(n.fromTextareaToComposer(!0),a())}),this.editor.on("destroy:composer",r)}})}(wysihtml5),function(e){e.views.SourceView=Base.extend({constructor:function(e,t){this.editor=e,this.composer=t,this._observe()},switchToTextarea:function(e){var t=this.composer.win.getComputedStyle(this.composer.element),i=parseFloat(t.width),n=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=i+"px",this.textarea.style.height=n+"px",this.textarea.value=this.editor.getValue(e,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(e){var t=this.textarea.value;t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(e){"composer"===e?this.switchToComposer(!0):"textarea"===e&&this.switchToTextarea(!0)}.bind(this))}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,i){this.base(e,t,i),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t!==!1&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(e){var t=this.parent.parse(this.element.value,void 0,e);this.element.value=t},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,i=this.element.value,n=!i;return e&&n||i===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,i={focusin:"focus",focusout:"blur"},n=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,n,function(e){var n=i[e.type]||e.type;t.fire(n).fire(n+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,i={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,n){if(this.editableElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(i).merge(n).get(),this._isCompatible=e.browser.supported(),n&&n.classNames&&e.lang.object(this.config.classNames).merge(n.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var o=this;return setTimeout(function(){o.fire("beforeload").fire("load")},0),void 0}e.dom.addClass(document.body,this.config.classNames.body),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new e.views.SourceView(this,this.composer):this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(e){this.currentView.cleanUp(e)},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.toolbar&&this.toolbar.destroy(),this.off()},parse:function(t,i,n){var o=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,a=this.config.parser(t,{rules:n||this.config.parserRules,cleanUp:this.config.cleanUp,context:o,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:i});return"object"==typeof t&&e.quirks.redraw(t),a},_initParser:function(){var t;e.browser.supportsModernPaste()?this.on("paste:composer",function(i){i.preventDefault(),t=e.dom.getPastedHtml(i),t&&this._cleanAndPaste(t)}.bind(this)):this.on("beforepaste:composer",function(t){t.preventDefault();var i=this.composer.getScrollPos();e.dom.getPastedHtmlWithDiv(this.composer,function(e){e&&this._cleanAndPaste(e),this.composer.setScrollPos(i)}.bind(this))}.bind(this))},_cleanAndPaste:function(t){var i=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(i)}})}(wysihtml5);var wysihtml5ParserRulesDefaults={blockLevelEl:{keep_styles:{textAlign:/^((left)|(right)|(center))$/i,"float":1},check_attributes:{id:"any"}},makeDiv:{rename_tag:"div",keep_styles:{textAlign:1,"float":1,margin:1,marginLeft:1,marginRight:1},check_attributes:{id:"any"}}},wysihtml5ParserRules={classes:"any",classes_blacklist:{"Apple-interchange-newline":1,MsoNormal:1,MsoPlainText:1},comments:1,attributes:{id:"any","data-*":"any",name:"any",title:"any",alt:"any",itemscope:function(e){return"undefined"!=typeof e?null===e?"":""+e:!1},itemtype:"any",itemref:"any",itemprop:"any",itemid:"any"},type_definitions:{alignment_object:{styles:{"text-align":["left","right","center"]}},valid_image_src:{attrs:{src:/^[^data\:]/i}},text_color_object:{styles:{color:!0,"background-color":!0}},text_fontsize_object:{styles:{"font-size":!0}}},tags:{tr:{},strike:{},form:{check_attributes:{"accept-charset":"any",action:"any",autocomplete:"any",enctype:"any",method:"any",novalidate:"any",style:"any",target:"any"}},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{},details:{unwrap:1},h4:wysihtml5ParserRulesDefaults.blockLevelEl,em:{},title:{remove:1},multicol:{unwrap:1},figure:{unwrap:1},xmp:{unwrap:1},small:{rename_tag:"span"},area:{remove:1},time:{unwrap:1},dir:{rename_tag:"ul"},bdi:{unwrap:1},command:{unwrap:1},ul:{check_attributes:{id:"any"}},progress:{rename_tag:"span"},dfn:{unwrap:1},iframe:{check_attributes:{src:"any",width:"dimension",height:"dimension",frameborder:"any",style:"any",id:"any"}},figcaption:{unwrap:1},a:{check_attributes:{href:"any",rel:"any",target:"any",id:"any",onclick:"any"}},img:{one_of_type:{valid_image_src:1},check_attributes:{width:"dimension",alt:"alt",align:"any",src:"src",height:"dimension",id:"any",style:"any"}},rb:{unwrap:1},footer:wysihtml5ParserRulesDefaults.makeDiv,noframes:{remove:1},abbr:{unwrap:1},u:{},bgsound:{remove:1},sup:{},address:{unwrap:1},basefont:{remove:1},nav:{unwrap:1},h1:wysihtml5ParserRulesDefaults.blockLevelEl,head:{unwrap:1},tbody:wysihtml5ParserRulesDefaults.blockLevelEl,dd:{},s:{unwrap:1},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers",rowSpan:"numbers",colSpan:"numbers",valign:"any",align:"any",id:"any",width:"dimension",height:"dimension",bgcolor:"any"},keep_styles:{backgroundColor:1,width:1,height:1,margin:1,padding:1,verticalAlign:1,textAlign:1,border:1,borderLeft:1,borderRight:1,borderBottom:1,borderTop:1}},object:{check_attributes:{width:"dimension",height:"dimension",id:"any"}},div:{check_attributes:{id:"any",contenteditable:"any",unselectable:"any",style:"any"}},option:{check_attributes:{disabled:"any",label:"",selected:"any",value:"any"}},select:{check_attributes:{autofocus:"any",disabled:"any",form:"any",multiple:"any",required:"any",size:"any",type:"any"}},i:{},track:{remove:1},wbr:{remove:1},fieldset:{check_attributes:{disabled:"any",form:"any"}},big:{rename_tag:"span"},button:{check_attributes:{autofocus:"any",disabled:"any",form:"any",required:"any",type:"any",value:"any"}},noscript:{},svg:{},input:{check_attributes:{accept:"any",autocomplete:"any",autofocus:"any",boder:"any",checked:"any",disabled:"any",form:"any",max:"any",maxlength:"any",min:"any",multiple:"any",pattern:"any",placeholder:"any",readonly:"any",required:"any",size:"any",src:"any",step:"any",style:"any",type:"any",value:"any",width:"any"}},table:{keep_styles:{width:1,textAlign:1,"float":1,cssFloat:1,borderCollapse:1,border:1,borderLeft:1,borderRight:1,borderBottom:1,borderTop:1,borderSpacing:1,tableLayout:1,verticalAlign:1},check_attributes:{id:"any",width:"dimension",height:"dimension",border:"any",cellpadding:"any",cellspacing:"any",align:"any"}},keygen:{remove:1},h5:wysihtml5ParserRulesDefaults.blockLevelEl,meta:{remove:1},map:{remove:1},isindex:{remove:1},mark:{},caption:wysihtml5ParserRulesDefaults.blockLevelEl,tfoot:wysihtml5ParserRulesDefaults.blockLevelEl,base:{remove:1},video:{check_attributes:{width:"dimension",height:"dimension",id:"any",controls:"any",autoplay:"any",loop:"any",muted:"any",poster:"any",preload:"any",src:"any"}},strong:{},canvas:{},output:{unwrap:1},marquee:{unwrap:1},b:{},q:{check_attributes:{cite:"url",id:"any"}},applet:{remove:1},span:{keep_styles:{color:1,backgroundColor:1,fontSize:1},check_attributes:{id:"any"}},rp:{unwrap:1},spacer:{remove:1},source:{check_attributes:{sizes:"any",srcset:"any",src:"any",type:"any"}},aside:wysihtml5ParserRulesDefaults.makeDiv,frame:{remove:1},section:wysihtml5ParserRulesDefaults.makeDiv,body:{unwrap:1},ol:{},nobr:{unwrap:1},html:{unwrap:1},summary:{unwrap:1},"var":{unwrap:1},del:{},blockquote:{keep_styles:{textAlign:1,"float":1,margin:1,marginLeft:1,marginRight:1},check_attributes:{cite:"url",id:"any"}},style:{check_attributes:{type:"any",media:"any",scoped:"any",title:"any",disabled:"any"}},device:{remove:1},meter:{unwrap:1},h3:wysihtml5ParserRulesDefaults.blockLevelEl,textarea:{check_attributes:{autofocus:"any",cols:"any",disabled:"any",form:"any",maxlength:"any",placeholder:"any",readonly:"any",required:"any",rows:"any",wrap:"any"}},embed:{check_attributes:{width:"dimension",height:"dimension",id:"any",src:"any"}},hgroup:{unwrap:1},font:{rename_tag:"span"},tt:{unwrap:1},noembed:{remove:1},thead:{check_attributes:{id:"any"}},blink:{unwrap:1},plaintext:{unwrap:1},xml:{remove:1},h6:wysihtml5ParserRulesDefaults.blockLevelEl,param:{check_attributes:{name:"any",value:"any"}},th:{check_attributes:{rowspan:"numbers",colspan:"numbers",rowSpan:"numbers",colSpan:"numbers",valign:"any",align:"any",id:"any",width:"dimension",height:"dimension",bgcolor:"any"},keep_styles:{backgroundColor:1,width:1,height:1}},legend:{unwrap:1},hr:{},label:{check_attributes:{"for":"any",form:"any"}},dl:{},kbd:{unwrap:1},listing:{unwrap:1},dt:{},nextid:{remove:1},pre:{},center:wysihtml5ParserRulesDefaults.makeDiv,audio:{remove:1},datalist:{unwrap:1},samp:{unwrap:1},col:{remove:1},article:wysihtml5ParserRulesDefaults.makeDiv,cite:{},link:{remove:1},script:{check_attributes:{type:"any",src:"any",charset:"any",async:"any",defer:"any",crossorigin:"any"}},bdo:{unwrap:1},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{unwrap:1},h2:wysihtml5ParserRulesDefaults.blockLevelEl,ins:{unwrap:1},p:wysihtml5ParserRulesDefaults.blockLevelEl,sub:{},comment:{remove:1},frameset:{remove:1},optgroup:{check_attributes:{disabled:"any",label:"any"}},header:wysihtml5ParserRulesDefaults.makeDiv}};
!function(e,t){var i=function(e,i){if(e&&e.length){var n=t.keys(t.omit(e.inlineStyles(),i));t.each(n,function(t){e.css(t,"")})}},n=function(t){var n,o,a=e(t).find(".edy-padding-resizer-wrapper"),r=e(t).find(".edy-container-resizable-area"),s=e(t).find("picture"),l=e(t).find("picture img"),d=e(t).find("a"),c=["width","height","max-width","text-align","float","margin-left","margin-right","display","position"],h=["overflow"],u=["position","padding-bottom"],m=["position","display","max-width","width","height","left","top"];i(e(t),c),i(r,h),i(a,u),i(s,m),i(l,m),d.length>0&&d.removeAttr("style"),n=parseFloat(e(t).css("width")),o=parseFloat(a.css("padding-bottom")),a.css("padding-bottom").indexOf("px")>-1?a.css("padding-bottom",100*(o/n)+"%"):o*=n/100,s.css("left").indexOf("px")>-1&&s.css("left",100*(parseFloat(s.css("left"))/n)+"%"),s.css("top").indexOf("px")>-1&&s.css("top",100*(parseFloat(s.css("top"))/o)+"%"),s.css({width:"auto"===s.inlineStyle("width")?"auto":"100%",height:"auto"===s.inlineStyle("height")?"auto":"100%"}),l.css({width:"auto"===s.inlineStyle("width")?"auto":"100%",height:"auto"===s.inlineStyle("height")?"auto":"100%"}),e(t).find("iframe").css({width:"100%",height:"100%"}),e(t).find("source").length>0&&(-1===navigator.appName.indexOf("Internet Explorer")||-1===navigator.appVersion.indexOf("MSIE 9"))&&(/<!--\[if IE 9\]>/i.test(e(t).find("source").parent().html())||e(t).find("source").before('<!--[if IE 9]><video style="display: none;"><![endif]-->').after("<!--[if IE 9]></video><![endif]-->"))},o=wysihtml5.lang.object(wysihtml5ParserRules).clone(!0);o.comments=!1,o.selectors={"a u":"unwrap",".edy-texteditor-container .Apple-interchange-newline":"remove"},o.tags.style={remove:1},o.tags.script={remove:1},o.tags.head={remove:1};var a=wysihtml5.lang.object(o).clone(!0);a.tags.div.one_of_type={alignment_object:1},a.tags.div.remove_action="unwrap",a.tags.div.check_attributes=!1,a.tags.div.keep_styles={textAlign:/^((left)|(right)|(center))$/i},a.tags.iframe={remove:1},a.tags.footer={unwrap:1},a.tags.aside={unwrap:1},a.tags.section={unwrap:1},a.tags.center={unwrap:1},a.tags.article={unwrap:1},a.tags.header={unwrap:1},a.tags.span.keep_styles=!1,a.selectors[".edy-texteditor-container"]=n,a.classes=!1,a.attributes=!1;var r=wysihtml5.lang.object(a).clone(!0);r.classes={},window.wysihtml5ParserPasteRulesets=[{condition:/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument|class="OutlineElement|id="?docs\-internal\-guid\-/i,set:r},{condition:/<meta name="copied-from" content="wysihtml5">/i,set:o},{set:a}]}(Edicy.jQuery,Edicy.Underscore),function(e){"use strict";var t=t||function(){var e={};return{add:function(t,i){if("object"==typeof t){var n;for(n=0;n<t.length;n++){var o=t[n];e[o]||(e[o]=[]),e[o].push(i)}}else e[t]||(e[t]=[]),e[t].push(i)},get:function(t){return e[t]?e[t]:void 0}}}(),i=i||function(i){"function"!=typeof String.prototype.repeat&&(String.prototype.repeat=function(e){if(1>e)return"";if(e%2)return this.repeat(e-1)+this;var t=this.repeat(e/2);return t+t}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){if(null===this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],o=arguments[1],a=0;i>a;a++)if(a in t){var r=t[a];e.call(o,r,a,t)&&n.push(r)}return n});var n,o,a={textarea:null,replaceTab:!0,softTabs:!0,tabSize:4,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0,fence:!1},r={keyMap:[{open:'"',close:'"',canBreak:!1},{open:"'",close:"'",canBreak:!1},{open:"(",close:")",canBreak:!1},{open:"[",close:"]",canBreak:!0},{open:"{",close:"}",canBreak:!0},{open:"<",close:">",canBreak:!1}]},s={_callHook:function(i,n){var o=t.get(i);if(n="boolean"==typeof n&&n===!1?!1:!0,o)if(n){var r,l=a.textarea,d=l.value,c=s.cursor.get();for(r=0;r<o.length;r++)o[r].call(e,{editor:{element:l,text:d,levelsDeep:s.levelsDeep()},caret:{pos:c},lines:{current:s.cursor.getLine(d,c),total:s.editor.getLines(d)}})}else for(r=0;r<o.length;r++)o[r].call(e)},defineNewLine:function(){var e=document.createElement("textarea");e.value="\n",o=2==e.value.length?"\r\n":"\n"},defineTabSize:function(e){return"undefined"!=typeof a.textarea.style.OTabSize?(a.textarea.style.OTabSize=e,void 0):"undefined"!=typeof a.textarea.style.MozTabSize?(a.textarea.style.MozTabSize=e,void 0):"undefined"!=typeof a.textarea.style.tabSize?(a.textarea.style.tabSize=e,void 0):void 0},cursor:{getLine:function(e,t){return e.substring(0,t).split("\n").length},get:function(){if("number"==typeof document.createElement("textarea").selectionStart)return a.textarea.selectionStart;if(document.selection){var e=0,t=a.textarea.createTextRange(),i=document.selection.createRange().duplicate(),n=i.getBookmark();for(t.moveToBookmark(n);0!==t.moveStart("character",-1);)e++;return e}},set:function(e,t){if(t||(t=e),a.textarea.setSelectionRange)a.textarea.focus(),a.textarea.setSelectionRange(e,t);else if(a.textarea.createTextRange){var i=a.textarea.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select()}},selection:function(){var e,t,i,n,r,l=a.textarea,d=0,c=0;return"number"==typeof l.selectionStart&&"number"==typeof l.selectionEnd?(d=l.selectionStart,c=l.selectionEnd):(t=document.selection.createRange(),t&&t.parentElement()==l&&(e=s.editor.get(),n=e.length,i=l.createTextRange(),i.moveToBookmark(t.getBookmark()),r=l.createTextRange(),r.collapse(!1),i.compareEndPoints("StartToEnd",r)>-1?d=c=n:(d=-i.moveStart("character",-n),d+=e.slice(0,d).split(o).length-1,i.compareEndPoints("EndToEnd",r)>-1?c=n:(c=-i.moveEnd("character",-n),c+=e.slice(0,c).split(o).length-1)))),d==c?!1:{start:d,end:c}}},editor:{getLines:function(e){return e.split("\n").length},get:function(){return a.textarea.value.replace(/\r/g,"")},set:function(e){a.textarea.value=e}},fenceRange:function(){if("string"==typeof a.fence){for(var e=s.editor.get(),t=s.cursor.get(),i=0,n=e.indexOf(a.fence),o=0;n>=0&&(o++,!(n+i>t));)i+=n+a.fence.length,e=e.substring(n+a.fence.length),n=e.indexOf(a.fence);return t>i&&n+i>t&&0===o%2?!0:!1}return!0},isEven:function(e,t){return t%2},levelsDeep:function(){var e,t,i=s.cursor.get(),n=s.editor.get(),o=n.substring(0,i),a=0;for(e=0;e<o.length;e++)for(t=0;t<r.keyMap.length;t++)r.keyMap[t].canBreak&&(r.keyMap[t].open==o.charAt(e)&&a++,r.keyMap[t].close==o.charAt(e)&&a--);var l=0,d=["'",'"'];for(e=0;e<r.keyMap.length;e++)if(r.keyMap[e].canBreak)for(t in d)l+=o.split(d[t]).filter(s.isEven).join("").split(r.keyMap[e].open).length-1;var c=a-l;return c>=0?c:0},deepExtend:function(e,t){for(var i in t)t[i]&&t[i].constructor&&t[i].constructor===Object?(e[i]=e[i]||{},s.deepExtend(e[i],t[i])):e[i]=t[i];return e},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},removeEvent:function(e,t,i){e.addEventListener?e.removeEventListener(t,i,!1):e.attachEvent&&e.detachEvent("on"+t,i)},preventDefaultEvent:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}},l={tabKey:function(e){if(s.fenceRange()){if(9==e.keyCode){s.preventDefaultEvent(e);var t=!0;s._callHook("tab:before");var i=s.cursor.selection(),o=s.cursor.get(),a=s.editor.get();if(i){for(var r=i.start;r--;)if("\n"==a.charAt(r)){i.start=r+1;break}var l,d=a.substring(i.start,i.end),c=d.split("\n");if(e.shiftKey){for(l=0;l<c.length;l++)c[l].substring(0,n.length)==n&&(c[l]=c[l].substring(n.length));d=c.join("\n"),s.editor.set(a.substring(0,i.start)+d+a.substring(i.end)),s.cursor.set(i.start,i.start+d.length)}else{for(l in c)c[l]=n+c[l];d=c.join("\n"),s.editor.set(a.substring(0,i.start)+d+a.substring(i.end)),s.cursor.set(i.start,i.start+d.length)}}else{var h=a.substring(0,o),u=a.substring(o),m=h+n+u;e.shiftKey?a.substring(o-n.length,o)==n&&(m=a.substring(0,o-n.length)+u,s.editor.set(m),s.cursor.set(o-n.length)):(s.editor.set(m),s.cursor.set(o+n.length),t=!1)}s._callHook("tab:after")}return t}},enterKey:function(e){if(s.fenceRange()&&13==e.keyCode&&!e.ctrlKey){s.preventDefaultEvent(e),s._callHook("enter:before");var t,i,a=s.cursor.get(),l=s.editor.get(),d=l.substring(0,a),c=l.substring(a),h=d.charAt(d.length-1),u=c.charAt(0),m=s.levelsDeep(),p="",g="";if(m){for(;m--;)p+=n;for(p=p,t=p.length+1,i=0;i<r.keyMap.length;i++)r.keyMap[i].open==h&&r.keyMap[i].close==u&&(g=o)}else t=1;var f=d+o+p+g+p.substring(0,p.length-n.length)+c;s.editor.set(f),s.cursor.set(a+t),s._callHook("enter:after")}},deleteKey:function(e){if(s.fenceRange()&&8==e.keyCode&&!e.altKey){s.preventDefaultEvent(e),s._callHook("delete:before");var t,i=s.cursor.get(),n=s.editor.get(),o=n.substring(0,i),a=n.substring(i),l=o.charAt(o.length-1),d=a.charAt(0);if(s.cursor.selection()===!1){for(t=0;t<r.keyMap.length;t++)if(r.keyMap[t].open==l&&r.keyMap[t].close==d){var c=n.substring(0,i-1)+n.substring(i+1);return s.editor.set(c),s.cursor.set(i-1),void 0}var c=n.substring(0,i-1)+n.substring(i);s.editor.set(c),s.cursor.set(i-1)}else{var h=s.cursor.selection(),c=n.substring(0,h.start)+n.substring(h.end);s.editor.set(c),s.cursor.set(i)}s._callHook("delete:after")}}},d={openedChar:function(e,t){s.preventDefaultEvent(t),s._callHook("openChar:before");var i=s.cursor.get(),n=s.editor.get(),o=n.substring(0,i),r=n.substring(i),l=o+e.open+e.close+r;a.textarea.value=l,s.cursor.set(i+1),s._callHook("openChar:after")},closedChar:function(e,t){var i=s.cursor.get(),n=s.editor.get(),o=n.substring(i,i+1);return o==e.close?(s.preventDefaultEvent(t),s._callHook("closeChar:before"),s.cursor.set(s.cursor.get()+1),s._callHook("closeChar:after"),!0):!1}},c={filter:function(e){if(s.fenceRange()){var t=e.which||e.keyCode;if(39!=t&&(40!=t||0!==e.which)){var i,n=String.fromCharCode(t);for(i=0;i<r.keyMap.length;i++)if(r.keyMap[i].close==n){var o=a.overwrite&&d.closedChar(r.keyMap[i],e);!o&&r.keyMap[i].open==n&&a.autoOpen&&d.openedChar(r.keyMap[i],e)}else r.keyMap[i].open==n&&a.autoOpen&&d.openedChar(r.keyMap[i],e)}}},listen:function(){a.replaceTab&&s.addEvent(a.textarea,"keydown",l.tabKey),a.autoIndent&&s.addEvent(a.textarea,"keydown",l.enterKey),a.autoStrip&&s.addEvent(a.textarea,"keydown",l.deleteKey),s.addEvent(a.textarea,"keypress",c.filter),s.addEvent(a.textarea,"keydown",function(){s._callHook("keydown")}),s.addEvent(a.textarea,"keyup",function(){s._callHook("keyup")})}},h=function(e){e.textarea&&(s._callHook("init:before",!1),s.deepExtend(a,e),s.defineNewLine(),a.softTabs?n=" ".repeat(a.tabSize):(n="	",s.defineTabSize(a.tabSize)),c.listen(),s._callHook("init:after",!1))};this.destroy=function(){s.removeEvent(a.textarea,"keydown",l.tabKey),s.removeEvent(a.textarea,"keydown",l.enterKey),s.removeEvent(a.textarea,"keydown",l.deleteKey),s.removeEvent(a.textarea,"keypress",c.filter)},h(i)};"undefined"!=typeof module&&module.exports&&(module.exports=i),"undefined"==typeof ender&&(this.Behave=i,this.BehaveHooks=t),"function"==typeof define&&define.amd&&define("behave",[],function(){return i})}.call(this),function(e){function t(e,i){return i=i?i:"",e?t(--e,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+i):i}function n(e,t){var i,n=e.apiendpoint,o="";n+=n.indexOf("?")<=0?"?":"&",n=n.replace("#","%23"),null===e.maxWidth||"undefined"!=typeof e.params.maxwidth&&null!==e.params.maxwidth||(e.params.maxwidth=e.maxWidth),null===e.maxHeight||"undefined"!=typeof e.params.maxheight&&null!==e.params.maxheight||(e.params.maxheight=e.maxHeight);for(i in e.params)i!=e.callbackparameter&&null!==e.params[i]&&(o+="&"+escape(i)+"="+e.params[i]);return n+="format="+e.format+"&url="+escape(t)+o,"json"!=e.dataType&&(n+="&"+e.callbackparameter+"=?"),n}function o(t,i,n){e("#jqoembeddata").data(i,t.code),s.beforeEmbed.call(n,t),s.onEmbed.call(n,t),s.afterEmbed.call(n,t)}function a(i,a,r){if(void 0!=e("#jqoembeddata").data(a)&&"iframe"!=r.embedtag.tag){var l={code:e("#jqoembeddata").data(a)};o(l,a,i)}else if(r.yql){var d=r.yql.from||"htmlstring",c=r.yql.url?r.yql.url(a):a,h="SELECT * FROM "+d+' WHERE url="'+c+'" and '+(/html/.test(d)?"xpath":"itemPath")+"='"+(r.yql.xpath||"/")+"'";"html"==d&&(h+=" and compat='html5'");var u=e.extend({url:"//query.yahooapis.com/v1/public/yql",dataType:"jsonp",data:{q:h,format:"json",env:"store://datatables.org/alltableswithkeys",callback:"?"},success:function(t){var n;if(r.yql.xpath&&"//meta|//title|//link"==r.yql.xpath){var s={};null==t.query&&(t.query={}),null==t.query.results&&(t.query.results={meta:[]});for(var l=0,d=t.query.results.meta.length;d>l;l++){var h=t.query.results.meta[l].name||t.query.results.meta[l].property||null;null!=h&&(s[h.toLowerCase()]=t.query.results.meta[l].content)}if(s.hasOwnProperty("title")&&s.hasOwnProperty("og:title")||null!=t.query.results.title&&(s.title=t.query.results.title),!s.hasOwnProperty("og:image")&&t.query.results.hasOwnProperty("link"))for(var l=0,d=t.query.results.link.length;d>l;l++)t.query.results.link[l].hasOwnProperty("rel")&&"apple-touch-icon"==t.query.results.link[l].rel&&(s["og:image"]="/"==t.query.results.link[l].href.charAt(0)?c.match(/^(([a-z]+:)?(\/\/)?[^\/]+\/).*$/)[1]+t.query.results.link[l].href:t.query.results.link[l].href);n=r.yql.datareturn(s)}else n=r.yql.datareturn?r.yql.datareturn(t.query.results):t.query.results.result;if(n!==!1){var u=e.extend({},n);u.code=n,o(u,a,i)}},error:s.onError.call(i,a,r)},s.ajaxOptions||{});e.ajax(u)}else if(r.templateRegex)if(""!==r.embedtag.tag){var m=r.embedtag.flashvars||"",p=r.embedtag.tag||"embed",g=r.embedtag.width||"auto",f=r.embedtag.height||"auto",y=a.replace(r.templateRegex,r.apiendpoint);r.nocache||(y+="&jqoemcache="+t(5)),r.apikey&&(y=y.replace("_APIKEY_",s.apikeys[r.name]));var b=e("<"+p+"/>").attr("src",y).attr("width",g).attr("height",f).attr("allowfullscreen",r.embedtag.allowfullscreen||"true").attr("allowscriptaccess",r.embedtag.allowfullscreen||"always").css("max-height",s.maxHeight||"auto").css("max-width",s.maxWidth||"auto");"embed"==p&&b.attr("type",r.embedtag.type||"application/x-shockwave-flash").attr("flashvars",a.replace(r.templateRegex,m)),"iframe"==p&&b.attr("scrolling",r.embedtag.scrolling||"no").attr("frameborder",r.embedtag.frameborder||"0"),o({code:b},a,i)}else r.apiendpoint?(r.apikey&&(r.apiendpoint=r.apiendpoint.replace("_APIKEY_",s.apikeys[r.name])),u=e.extend({url:a.replace(r.templateRegex,r.apiendpoint),dataType:"jsonp",success:function(t){var n=e.extend({},t);n.code=r.templateData(t),o(n,a,i)},error:s.onError.call(i,a,r)},s.ajaxOptions||{}),e.ajax(u)):o({code:a.replace(r.templateRegex,r.template)},a,i);else{var v=n(r,a);u=e.extend({url:v,dataType:r.dataType||"jsonp",success:function(t){var n=e.extend({},t);switch(n.type){case"file":case"photo":n.code=e.fn.oembed.getPhotoCode(a,n);break;case"video":case"rich":n.code=e.fn.oembed.getRichCode(a,n);break;default:n.code=e.fn.oembed.getGenericCode(a,n)}o(n,a,i)},error:s.onError.call(i,a,r)},s.ajaxOptions||{}),e.ajax(u)}}function r(e){if(null===e)return null;var t,i={};for(t in e)null!==t&&(i[t.toLowerCase()]=e[t]);return i}e.fn.oembed=function(t,i,n){s=e.extend(!0,e.fn.oembed.defaults,i);var o=["0rz.tw","1link.in","1url.com","2.gp","2big.at","2tu.us","3.ly","307.to","4ms.me","4sq.com","4url.cc","6url.com","7.ly","a.gg","a.nf","aa.cx","abcurl.net","ad.vu","adf.ly","adjix.com","afx.cc","all.fuseurl.com","alturl.com","amzn.to","ar.gy","arst.ch","atu.ca","azc.cc","b23.ru","b2l.me","bacn.me","bcool.bz","binged.it","bit.ly","bizj.us","bloat.me","bravo.ly","bsa.ly","budurl.com","canurl.com","chilp.it","chzb.gr","cl.lk","cl.ly","clck.ru","cli.gs","cliccami.info","clickthru.ca","clop.in","conta.cc","cort.as","cot.ag","crks.me","ctvr.us","cutt.us","dai.ly","decenturl.com","dfl8.me","digbig.com","http://digg.com/[^/]+$","disq.us","dld.bz","dlvr.it","do.my","doiop.com","dopen.us","easyuri.com","easyurl.net","eepurl.com","eweri.com","fa.by","fav.me","fb.me","fbshare.me","ff.im","fff.to","fire.to","firsturl.de","firsturl.net","flic.kr","flq.us","fly2.ws","fon.gs","freak.to","fuseurl.com","fuzzy.to","fwd4.me","fwib.net","g.ro.lt","gizmo.do","gl.am","go.9nl.com","go.ign.com","go.usa.gov","goo.gl","goshrink.com","gurl.es","hex.io","hiderefer.com","hmm.ph","href.in","hsblinks.com","htxt.it","huff.to","hulu.com","hurl.me","hurl.ws","icanhaz.com","idek.net","ilix.in","is.gd","its.my","ix.lt","j.mp","jijr.com","kl.am","klck.me","korta.nu","krunchd.com","l9k.net","lat.ms","liip.to","liltext.com","linkbee.com","linkbun.ch","liurl.cn","ln-s.net","ln-s.ru","lnk.gd","lnk.ms","lnkd.in","lnkurl.com","lru.jp","lt.tl","lurl.no","macte.ch","mash.to","merky.de","migre.me","miniurl.com","minurl.fr","mke.me","moby.to","moourl.com","mrte.ch","myloc.me","myurl.in","n.pr","nbc.co","nblo.gs","nn.nf","not.my","notlong.com","nsfw.in","nutshellurl.com","nxy.in","nyti.ms","o-x.fr","oc1.us","om.ly","omf.gd","omoikane.net","on.cnn.com","on.mktw.net","onforb.es","orz.se","ow.ly","ping.fm","pli.gs","pnt.me","politi.co","post.ly","pp.gg","profile.to","ptiturl.com","pub.vitrue.com","qlnk.net","qte.me","qu.tc","qy.fi","r.ebay.com","r.im","rb6.me","read.bi","readthis.ca","reallytinyurl.com","redir.ec","redirects.ca","redirx.com","retwt.me","ri.ms","rickroll.it","riz.gd","rt.nu","ru.ly","rubyurl.com","rurl.org","rww.tw","s4c.in","s7y.us","safe.mn","sameurl.com","sdut.us","shar.es","shink.de","shorl.com","short.ie","short.to","shortlinks.co.uk","shorturl.com","shout.to","show.my","shrinkify.com","shrinkr.com","shrt.fr","shrt.st","shrten.com","shrunkin.com","simurl.com","slate.me","smallr.com","smsh.me","smurl.name","sn.im","snipr.com","snipurl.com","snurl.com","sp2.ro","spedr.com","srnk.net","srs.li","starturl.com","stks.co","su.pr","surl.co.uk","surl.hu","t.cn","t.co","t.lh.com","ta.gd","tbd.ly","tcrn.ch","tgr.me","tgr.ph","tighturl.com","tiniuri.com","tiny.cc","tiny.ly","tiny.pl","tinylink.in","tinyuri.ca","tinyurl.com","tk.","tl.gd","tmi.me","tnij.org","tnw.to","tny.com","to.ly","togoto.us","totc.us","toysr.us","tpm.ly","tr.im","tra.kz","trunc.it","twhub.com","twirl.at","twitclicks.com","twitterurl.net","twitterurl.org","twiturl.de","twurl.cc","twurl.nl","u.mavrev.com","u.nu","u76.org","ub0.cc","ulu.lu","updating.me","ur1.ca","url.az","url.co.uk","url.ie","url360.me","url4.eu","urlborg.com","urlbrief.com","urlcover.com","urlcut.com","urlenco.de","urli.nl","urls.im","urlshorteningservicefortwitter.com","urlx.ie","urlzen.com","usat.ly","use.my","vb.ly","vevo.ly","vgn.am","vl.am","vm.lc","w55.de","wapo.st","wapurl.co.uk","wipi.es","wp.me","x.vu","xr.com","xrl.in","xrl.us","xurl.es","xurl.jp","y.ahoo.it","yatuc.com","ye.pe","yep.it","yfrog.com","yhoo.it","yiyd.com","youtu.be","yuarel.com","z0p.de","zi.ma","zi.mu","zipmyurl.com","zud.me","zurl.ws","zz.gd","zzang.kr","›.ws","✩.ws","✿.ws","❥.ws","➔.ws","➞.ws","➡.ws","➨.ws","➯.ws","➹.ws","➽.ws"];return 0===e("#jqoembeddata").length&&e('<span id="jqoembeddata"></span>').appendTo("body"),this.each(function(){var i,l=e(this),d=!t||t.indexOf("http://")&&t.indexOf("https://")?l.attr("href"):t;if(n?s.onEmbed=n:s.onEmbed||(s.onEmbed=function(t){e.fn.oembed.insertCode(this,s.embedMethod,t)}),null!==d&&void 0!==d){if(i=e.fn.oembed.getOEmbedProvider(d),!i||"opengraph"===i.name&&"https:"!==window.location.protocol){for(var c=0,h=o.length;h>c;c++){var u=new RegExp("://"+o[c]+"/","i");if(null!==d.match(u)){var m=e.extend({url:"http://api.longurl.org/v2/expand",dataType:"jsonp",data:{url:d,format:"json"},success:function(t){d=t["long-url"],i=e.fn.oembed.getOEmbedProvider(t["long-url"]),!!s.fallback==!1&&(i="opengraph"===i.name.toLowerCase()?null:i),null!==i?(i.params=r(s[i.name])||{},i.maxWidth=s.maxWidth,i.maxHeight=s.maxHeight,a(l,d,i)):s.onProviderNotFound.call(l,d)},error:function(){s.onError.call(l,d)}},s.ajaxOptions||{});return e.ajax(m),l}}i=e.fn.oembed.getOEmbedProvider(d)}!!s.fallback==!1&&(i="opengraph"===i.name.toLowerCase()?null:i),null!==i?(i.params=r(s[i.name])||{},i.maxWidth=s.maxWidth,i.maxHeight=s.maxHeight,a(l,d,i)):s.onProviderNotFound.call(l,d)}return l})};var s;e.fn.oembed.defaults={fallback:!0,maxWidth:null,maxHeight:null,includeHandle:!0,embedMethod:"auto",onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:!1,onError:function(e,t,i,n){console.log("err:",e,t,i,n)},ajaxOptions:{}},e.fn.oembed.insertCode=function(t,i,n){if(null!==n)switch("auto"===i&&null!==t.attr("href")?i="append":"auto"==i&&(i="replace"),i){case"replace":t.replaceWith(n.code);break;case"fill":t.html(n.code);break;case"append":t.wrap('<div class="oembedall-container"></div>');var o=t.parent();s.includeHandle&&e('<span class="oembedall-closehide">&darr;</span>').insertBefore(t).click(function(){var t=encodeURIComponent(e(this).text());e(this).html("%E2%86%91"==t?"&darr;":"&uarr;"),e(this).parent().children().last().toggle()}),o.append("<br/>");try{n.code.clone().appendTo(o)}catch(a){o.append(n.code)}if(s.maxWidth){var r=o.parent().width();if(r<s.maxWidth){var l=e("iframe",o).width(),d=e("iframe",o).height(),c=l/r;e("iframe",o).width(l/c),e("iframe",o).height(d/c)}else s.maxWidth&&e("iframe",o).width(s.maxWidth),s.maxHeight&&e("iframe",o).height(s.maxHeight)}}},e.fn.oembed.getPhotoCode=function(e,t){var i,n=t.title?t.title:"";if(n+=t.author_name?" - "+t.author_name:"",n+=t.provider_name?" - "+t.provider_name:"",t.url)i='<div><a href="'+e+"\" target='_blank'><img src=\""+t.url+'" alt="'+n+'"/></a></div>';else if(t.thumbnail_url){var o=t.thumbnail_url.replace("_s","_b");i='<div><a href="'+e+"\" target='_blank'><img src=\""+o+'" alt="'+n+'"/></a></div>'}else i="<div>Error loading this picture</div>";return t.html&&(i+="<div>"+t.html+"</div>"),i},e.fn.oembed.getRichCode=function(e,t){return t.html},e.fn.oembed.getGenericCode=function(e,t){var i=t.title&&null!==t.title?t.title:e,n='<a href="'+e+'">'+i+"</a>";return t.html&&(n+="<div>"+t.html+"</div>"),n},e.fn.oembed.getOEmbedProvider=function(t){for(var i=0;i<e.fn.oembed.providers.length;i++)for(var n=0,o=e.fn.oembed.providers[i].urlschemes.length;o>n;n++){var a=new RegExp(e.fn.oembed.providers[i].urlschemes[n],"i");if(null!==t.match(a))return e.fn.oembed.providers[i]}return null},e.fn.oembed.OEmbedProvider=function(e,t,i,n,o){this.name=e,this.type=t,this.urlschemes=i,this.apiendpoint=n,this.maxWidth=500,this.maxHeight=400,o=o||{},o.useYQL&&(o.yql="xml"==o.useYQL?{xpath:"//oembed/html",from:"xml",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=xml&url="+e},datareturn:function(e){return e.html.replace(/.*\[CDATA\[(.*)\]\]>$/,"$1")||""}}:{from:"json",apiendpoint:this.apiendpoint,url:function(e){return this.apiendpoint+"?format=json&url="+e},datareturn:function(e){return"video"!=e.json.type&&(e.json.url||e.json.thumbnail_url)?'<img src="'+(e.json.url||e.json.thumbnail_url)+'" />':e.json.html||""}},this.apiendpoint=null);for(var a in o)this[a]=o[a];this.format=this.format||"json",this.callbackparameter=this.callbackparameter||"callback",this.embedtag=this.embedtag||{tag:""}},e.fn.updateOEmbedProvider=function(t,i,n,o,a){for(var r=0;r<e.fn.oembed.providers.length;r++)if(e.fn.oembed.providers[r].name===t&&(null!==i&&(e.fn.oembed.providers[r].type=i),null!==n&&(e.fn.oembed.providers[r].urlschemes=n),null!==o&&(e.fn.oembed.providers[r].apiendpoint=o),null!==a)){e.fn.oembed.providers[r].extraSettings=a;for(var s in a)null!==s&&null!==a[s]&&(e.fn.oembed.providers[r][s]=a[s])}},e.fn.oembed.providers=[new e.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?","youtu\\.be/[\\w-]+","youtube.com/embed"],"https://www.youtube.com/embed/$1?wmode=transparent",{templateRegex:/.*(?:v\=|be\/|embed\/)([\w\-]+)&?.*/,embedtag:{tag:"iframe",width:"425",height:"349"}}),new e.fn.oembed.OEmbedProvider("wistia","video",["wistia.com/m/.+","wistia.com/embed/.+","wi.st/m/.+","wi.st/embed/.+"],"https://fast.wistia.com/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("xtranormal","video",["xtranormal\\.com/watch/.+"],"//www.xtranormal.com/xtraplayr/$1/$2",{templateRegex:/.*com\/watch\/([\w\-]+)\/([\w\-]+).*/,embedtag:{tag:"iframe",width:"320",height:"269"}}),new e.fn.oembed.OEmbedProvider("scivee","video",["scivee.tv/node/.+"],"//www.scivee.tv/flash/embedCast.swf?",{templateRegex:/.*tv\/node\/(.+)/,embedtag:{width:"480",height:"400",flashvars:"id=$1&type=3"}}),new e.fn.oembed.OEmbedProvider("veoh","video",["veoh.com/watch/.+"],"//www.veoh.com/swf/webplayer/WebPlayer.swf?version=AFrontend.5.7.0.1337&permalinkId=$1&player=videodetailsembedded&videoAutoPlay=0&id=anonymous",{templateRegex:/.*watch\/([^\?]+).*/,embedtag:{width:"410",height:"341"}}),new e.fn.oembed.OEmbedProvider("gametrailers","video",["gametrailers\\.com/video/.+"],"//media.mtvnservices.com/mgid:moses:video:gametrailers.com:$2",{templateRegex:/.*com\/video\/([\w\-]+)\/([\w\-]+).*/,embedtag:{width:"512",height:"288"}}),new e.fn.oembed.OEmbedProvider("funnyordie","video",["funnyordie\\.com/videos/.+"],"//player.ordienetworks.com/flash/fodplayer.swf?",{templateRegex:/.*videos\/([^\/]+)\/([^\/]+)?/,embedtag:{width:512,height:328,flashvars:"key=$1"}}),new e.fn.oembed.OEmbedProvider("colledgehumour","video",["collegehumor\\.com/video/.+"],"//www.collegehumor.com/moogaloop/moogaloop.swf?clip_id=$1&use_node_id=true&fullscreen=1",{templateRegex:/.*video\/([^\/]+).*/,embedtag:{width:600,height:338}}),new e.fn.oembed.OEmbedProvider("metacafe","video",["metacafe\\.com/watch/.+"],"//www.metacafe.com/fplayer/$1/$2.swf",{templateRegex:/.*watch\/(\d+)\/(\w+)\/.*/,embedtag:{width:400,height:345}}),new e.fn.oembed.OEmbedProvider("bambuser","video",["bambuser\\.com/channel/.*/broadcast/.*"],"//static.bambuser.com/r/player.swf?vid=$1",{templateRegex:/.*bambuser\.com\/channel\/.*\/broadcast\/(\w+).*/,embedtag:{width:512,height:339}}),new e.fn.oembed.OEmbedProvider("twitvid","video",["twitvid\\.com/.+"],"//www.twitvid.com/embed.php?guid=$1&autoplay=0",{templateRegex:/.*twitvid\.com\/(\w+).*/,embedtag:{tag:"iframe",width:480,height:360}}),new e.fn.oembed.OEmbedProvider("aniboom","video",["aniboom\\.com/animation-video/.+"],"//api.aniboom.com/e/$1",{templateRegex:/.*animation-video\/(\d+).*/,embedtag:{width:594,height:334}}),new e.fn.oembed.OEmbedProvider("vzaar","video",["vzaar\\.com/videos/.+","vzaar.tv/.+"],"//view.vzaar.com/$1/player?",{templateRegex:/.*\/(\d+).*/,embedtag:{tag:"iframe",width:576,height:324}}),new e.fn.oembed.OEmbedProvider("snotr","video",["snotr\\.com/video/.+"],"//www.snotr.com/embed/$1",{templateRegex:/.*\/(\d+).*/,embedtag:{tag:"iframe",width:400,height:330},nocache:1}),new e.fn.oembed.OEmbedProvider("youku","video",["v.youku.com/v_show/id_.+"],"//player.youku.com/player.php/sid/$1/v.swf",{templateRegex:/.*id_(.+)\.html.*/,embedtag:{width:480,height:400},nocache:1}),new e.fn.oembed.OEmbedProvider("tudou","video",["tudou.com/programs/view/.+/"],"//www.tudou.com/v/$1/v.swf",{templateRegex:/.*view\/(.+)\//,embedtag:{width:480,height:400},nocache:1}),new e.fn.oembed.OEmbedProvider("embedr","video",["embedr\\.com/playlist/.+"],"//embedr.com/swf/slider/$1/425/520/default/false/std?",{templateRegex:/.*playlist\/([^\/]+).*/,embedtag:{width:425,height:520}}),new e.fn.oembed.OEmbedProvider("blip","video",["blip\\.tv/.+"],"//blip.tv/oembed/"),new e.fn.oembed.OEmbedProvider("minoto-video","video",["//api.minoto-video.com/publishers/.+/videos/.+","//dashboard.minoto-video.com/main/video/details/.+","//embed.minoto-video.com/.+"],"//api.minoto-video.com/services/oembed.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("animoto","video",["animoto.com/play/.+"],"//animoto.com/services/oembed"),new e.fn.oembed.OEmbedProvider("hulu","video",["hulu\\.com/watch/.*"],"//www.hulu.com/api/oembed.json"),new e.fn.oembed.OEmbedProvider("ustream","video",["ustream\\.tv/recorded/.*"],"//www.ustream.tv/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("videojug","video",["videojug\\.com/(film|payer|interview).*"],"//www.videojug.com/oembed.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("sapo","video",["videos\\.sapo\\.pt/.*"],"//videos.sapo.pt/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("vodpod","video",["vodpod.com/watch/.*"],"//vodpod.com/oembed.js",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("vimeo","video",["www.vimeo.com/groups/.*/videos/.*","www.vimeo.com/.*","vimeo.com/groups/.*/videos/.*","vimeo.com/.*"],"//vimeo.com/api/oembed.json"),new e.fn.oembed.OEmbedProvider("dailymotion","video",["dailymotion\\.com/.+"],"//www.dailymotion.com/services/oembed"),new e.fn.oembed.OEmbedProvider("5min","video",["www\\.5min\\.com/.+"],"//api.5min.com/oembed.xml",{useYQL:"xml"}),new e.fn.oembed.OEmbedProvider("National Film Board of Canada","video",["nfb\\.ca/film/.+"],"//www.nfb.ca/remote/services/oembed/",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("qik","video",["qik\\.com/\\w+"],"//qik.com/api/oembed.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("revision3","video",["revision3\\.com"],"//revision3.com/api/oembed/"),new e.fn.oembed.OEmbedProvider("dotsub","video",["dotsub\\.com/view/.+"],"//dotsub.com/services/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("clikthrough","video",["clikthrough\\.com/theater/video/\\d+"],"//clikthrough.com/services/oembed"),new e.fn.oembed.OEmbedProvider("Kinomap","video",["kinomap\\.com/.+"],"//www.kinomap.com/oembed"),new e.fn.oembed.OEmbedProvider("VHX","video",["vhx.tv/.+"],"//vhx.tv/services/oembed.json"),new e.fn.oembed.OEmbedProvider("bambuser","video",["bambuser.com/.+"],"//api.bambuser.com/oembed/iframe.json"),new e.fn.oembed.OEmbedProvider("justin.tv","video",["justin.tv/.+"],"//api.justin.tv/api/embed/from_url.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("vine","video",["vine.co/v/.*"],null,{templateRegex:/https?:\/\/w?w?w?.?vine\.co\/v\/([a-zA-Z0-9]*).*/,template:'<iframe src="https://vine.co/v/$1/embed/postcard" width="600" height="600" allowfullscreen="true" allowscriptaccess="always" scrolling="no" frameborder="0"></iframe><script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>',nocache:1}),new e.fn.oembed.OEmbedProvider("boxofficebuz","video",["boxofficebuz\\.com\\/embed/.+"],"//boxofficebuz.com/embed/$1/$2",{templateRegex:[/.*boxofficebuz\.com\/embed\/(\w+)\/([\w*\-*]+)/],embedtag:{tag:"iframe",width:480,height:360}}),new e.fn.oembed.OEmbedProvider("clipsyndicate","video",["clipsyndicate\\.com/video/play/.+","clipsyndicate\\.com/embed/iframe?.+"],"//eplayer.clipsyndicate.com/embed/iframe?pf_id=1&show_title=0&va_id=$1&windows=1",{templateRegex:[/.*www\.clipsyndicate\.com\/video\/play\/(\w+)\/.*/,/.*eplayer\.clipsyndicate\.com\/embed\/iframe\?.*va_id=(\w+).*.*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("coub","video",["coub\\.com/.+"],"//www.coub.com/embed/$1?muted=false&autostart=false&originalSize=false&hideTopBar=false&noSiteButtons=false&startWithHD=false",{templateRegex:[/.*coub\.com\/embed\/(\w+)\?*.*/,/.*coub\.com\/view\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("discoverychannel","video",["snagplayer\\.video\\.dp\\.discovery\\.com/.+"],"//snagplayer.video.dp.discovery.com/$1/snag-it-player.htm?auto=no",{templateRegex:[/.*snagplayer\.video\.dp\.discovery\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360}}),new e.fn.oembed.OEmbedProvider("telly","video",["telly\\.com/.+"],"//www.telly.com/embed.php?guid=$1&autoplay=0",{templateRegex:[/.*telly\.com\/embed\.php\?guid=(\w+).*/,/.*telly\.com\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360}}),new e.fn.oembed.OEmbedProvider("minilogs","video",["minilogs\\.com/.+"],"//www.minilogs.com/e/$1",{templateRegex:[/.*minilogs\.com\/e\/(\w+).*/,/.*minilogs\.com\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("viddy","video",["viddy\\.com/.+"],"//www.viddy.com/embed/video/$1",{templateRegex:[/.*viddy\.com\/embed\/video\/(\.*)/,/.*viddy\.com\/video\/(\.*)/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("worldstarhiphop","video",["worldstarhiphop\\.com/embed/.+"],"//www.worldstarhiphop.com/embed/$1",{templateRegex:/.*worldstarhiphop\.com\/embed\/(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("zapiks","video",["zapiks\\.fr/.+"],"//www.zapiks.fr/index.php?action=playerIframe&media_id=$1&autoStart=fals",{templateRegex:/.*zapiks\.fr\/index.php\?[\w\=\&]*media_id=(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("official.fm","rich",["official.fm/.+"],"//official.fm/services/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("chirbit","rich",["chirb.it/.+"],"//chirb.it/oembed.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("chirbit","audio",["chirb\\.it/.+"],"//chirb.it/wp/$1",{templateRegex:[/.*chirb\.it\/wp\/(\w+).*/,/.*chirb\.it\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("Huffduffer","rich",["huffduffer.com/[-.\\w@]+/\\d+"],"//huffduffer.com/oembed"),new e.fn.oembed.OEmbedProvider("Spotify","rich",["open.spotify.com/(track|album|user)/"],"https://embed.spotify.com/oembed/"),new e.fn.oembed.OEmbedProvider("shoudio","rich",["shoudio.com/.+","shoud.io/.+"],"//shoudio.com/api/oembed"),new e.fn.oembed.OEmbedProvider("mixcloud","rich",["mixcloud.com/.+"],"//www.mixcloud.com/oembed/",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("rdio.com","rich",["rd.io/.+","rdio.com"],"//www.rdio.com/api/oembed/"),new e.fn.oembed.OEmbedProvider("Soundcloud","rich",["soundcloud.com/.+","snd.sc/.+"],"//soundcloud.com/oembed",{format:"js"}),new e.fn.oembed.OEmbedProvider("bandcamp","rich",["bandcamp\\.com/album/.+"],null,{yql:{xpath:"//meta[contains(@content, \\'EmbeddedPlayer\\')]",from:"html",datareturn:function(e){return e.meta?'<iframe width="400" height="100" src="'+e.meta.content+'" allowtransparency="true" frameborder="0"></iframe>':!1
}}}),new e.fn.oembed.OEmbedProvider("deviantart","photo",["deviantart.com/.+","fav.me/.+","deviantart.com/.+"],"//backend.deviantart.com/oembed",{format:"jsonp"}),new e.fn.oembed.OEmbedProvider("skitch","photo",["skitch.com/.+"],null,{yql:{xpath:"json",from:"json",url:function(e){return"//skitch.com/oembed/?format=json&url="+e},datareturn:function(t){return e.fn.oembed.getPhotoCode(t.json.url,t.json)}}}),new e.fn.oembed.OEmbedProvider("mobypicture","photo",["mobypicture.com/user/.+/view/.+","moby.to/.+"],"//api.mobypicture.com/oEmbed"),new e.fn.oembed.OEmbedProvider("flickr","photo",["flickr\\.com/photos/.+"],"//flickr.com/services/oembed",{callbackparameter:"jsoncallback"}),new e.fn.oembed.OEmbedProvider("photobucket","photo",["photobucket\\.com/(albums|groups)/.+"],"//photobucket.com/oembed/"),new e.fn.oembed.OEmbedProvider("instagram","photo",["instagr\\.?am(\\.com)?/.+"],"//api.instagram.com/oembed"),new e.fn.oembed.OEmbedProvider("SmugMug","photo",["smugmug.com/[-.\\w@]+/.+"],"//api.smugmug.com/services/oembed/"),new e.fn.oembed.OEmbedProvider("dribbble","photo",["dribbble.com/shots/.+"],"//api.dribbble.com/shots/$1?callback=?",{templateRegex:/.*shots\/([\d]+).*/,templateData:function(e){return e.image_teaser_url?'<img src="'+e.image_teaser_url+'"/>':!1}}),new e.fn.oembed.OEmbedProvider("chart.ly","photo",["chart\\.ly/[a-z0-9]{6,8}"],"//chart.ly/uploads/large_$1.png",{templateRegex:/.*ly\/([^\/]+).*/,embedtag:{tag:"img"},nocache:1}),new e.fn.oembed.OEmbedProvider("circuitlab","photo",["circuitlab.com/circuit/.+"],"https://www.circuitlab.com/circuit/$1/screenshot/540x405/",{templateRegex:/.*circuit\/([^\/]+).*/,embedtag:{tag:"img"},nocache:1}),new e.fn.oembed.OEmbedProvider("23hq","photo",["23hq.com/[-.\\w@]+/photo/.+"],"//www.23hq.com/23/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("img.ly","photo",["img\\.ly/.+"],"//img.ly/show/thumb/$1",{templateRegex:/.*ly\/([^\/]+).*/,embedtag:{tag:"img"},nocache:1}),new e.fn.oembed.OEmbedProvider("twitgoo.com","photo",["twitgoo\\.com/.+"],"//twitgoo.com/show/thumb/$1",{templateRegex:/.*com\/([^\/]+).*/,embedtag:{tag:"img"},nocache:1}),new e.fn.oembed.OEmbedProvider("imgur.com","photo",["imgur\\.com/gallery/.+"],"//imgur.com/$1l.jpg",{templateRegex:/.*gallery\/([^\/]+).*/,embedtag:{tag:"img"},nocache:1}),new e.fn.oembed.OEmbedProvider("visual.ly","rich",["visual\\.ly/.+"],null,{yql:{xpath:"//a[@id=\\'gc_article_graphic_image\\']/img",from:"htmlstring"}}),new e.fn.oembed.OEmbedProvider("gravtar","photo",["mailto:.+"],null,{templateRegex:/mailto:([^\/]+).*/,template:function(e,t){return'<img src="//gravatar.com/avatar/'+t.md5()+'.jpg" alt="on Gravtar" class="jqoaImg">'}}),new e.fn.oembed.OEmbedProvider("achewood","photo",["achewood\\.com\\/index.php\\?date=.+"],"//www.achewood.com/comic.php?date=$1",{templateRegex:/.*achewood\.com\/index.php\?date=(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("fotokritik","photo",["fotokritik\\.com/.+"],"//www.fotokritik.com/embed/$1",{templateRegex:[/.*fotokritik\.com\/embed\/(\w+).*/,/.*fotokritik\.com\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("giflike","photo",["giflike\\.com/.+"],"//www.giflike.com/embed/$1",{templateRegex:[/.*giflike\.com\/embed\/(\w+).*/,/.*giflike\.com\/a\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("twitter","rich",["twitter.com/.+"],"https://api.twitter.com/1/statuses/oembed.json"),new e.fn.oembed.OEmbedProvider("gmep","rich",["gmep.imeducate.com/.*","gmep.org/.*"],"//gmep.org/oembed.json"),new e.fn.oembed.OEmbedProvider("urtak","rich",["urtak.com/(u|clr)/.+"],"//oembed.urtak.com/1/oembed"),new e.fn.oembed.OEmbedProvider("cacoo","rich",["cacoo.com/.+"],"//cacoo.com/oembed.json"),new e.fn.oembed.OEmbedProvider("dailymile","rich",["dailymile.com/people/.*/entries/.*"],"//api.dailymile.com/oembed"),new e.fn.oembed.OEmbedProvider("dipity","rich",["dipity.com/timeline/.+"],"//www.dipity.com/oembed/timeline/",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("sketchfab","rich",["sketchfab.com/show/.+"],"//sketchfab.com/oembed",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("speakerdeck","rich",["speakerdeck.com/.+"],"//speakerdeck.com/oembed.json",{useYQL:"json"}),new e.fn.oembed.OEmbedProvider("popplet","rich",["popplet.com/app/.*"],"//popplet.com/app/Popplet_Alpha.swf?page_id=$1&em=1",{templateRegex:/.*#\/([^\/]+).*/,embedtag:{width:460,height:460}}),new e.fn.oembed.OEmbedProvider("pearltrees","rich",["pearltrees.com/.*"],"//cdn.pearltrees.com/s/embed/getApp?",{templateRegex:/.*N-f=1_(\d+).*N-p=(\d+).*/,embedtag:{width:460,height:460,flashvars:"lang=en_US&amp;embedId=pt-embed-$1-693&amp;treeId=$1&amp;pearlId=$2&amp;treeTitle=Diagrams%2FVisualization&amp;site=www.pearltrees.com%2FF"}}),new e.fn.oembed.OEmbedProvider("prezi","rich",["prezi.com/.*"],"//prezi.com/bin/preziloader.swf?",{templateRegex:/.*com\/([^\/]+)\/.*/,embedtag:{width:550,height:400,flashvars:"prezi_id=$1&amp;lock_to_path=0&amp;color=ffffff&amp;autoplay=no&amp;autohide_ctrls=0"}}),new e.fn.oembed.OEmbedProvider("tourwrist","rich",["tourwrist.com/tours/.+"],null,{templateRegex:/.*tours.([\d]+).*/,template:function(e,t){return setTimeout(function(){loadEmbeds&&loadEmbeds()},2e3),"<div id='"+t+"' class='tourwrist-tour-embed direct'></div> <script type='text/javascript' src='//tourwrist.com/tour_embed.js'></script>"}}),new e.fn.oembed.OEmbedProvider("meetup","rich",["meetup\\.(com|ps)/.+"],"//api.meetup.com/oembed"),new e.fn.oembed.OEmbedProvider("ebay","rich",["ebay\\.*"],"//togo.ebay.com/togo/togo.swf?2008013100",{templateRegex:/.*\/([^\/]+)\/(\d{10,13}).*/,embedtag:{width:355,height:300,flashvars:"base=//togo.ebay.com/togo/&lang=en-us&mode=normal&itemid=$2&query=$1"}}),new e.fn.oembed.OEmbedProvider("wikipedia","rich",["wikipedia.org/wiki/.+"],"//$1.wikipedia.org/w/api.php?action=parse&page=$2&format=json&section=0&callback=?",{templateRegex:/.*\/\/([\w]+).*\/wiki\/([^\/]+).*/,templateData:function(e){if(!e.parse)return!1;var t=e.parse.text["*"].replace(/href="\/wiki/g,'href="//en.wikipedia.org/wiki');return'<div id="content"><h3><a class="nav-link" href="//en.wikipedia.org/wiki/'+e.parse.displaytitle+'">'+e.parse.displaytitle+"</a></h3>"+t+"</div>"}}),new e.fn.oembed.OEmbedProvider("imdb","rich",["imdb.com/title/.+"],"//www.imdbapi.com/?i=$1&callback=?",{templateRegex:/.*\/title\/([^\/]+).*/,templateData:function(e){return e.Title?'<div id="content"><h3><a class="nav-link" href="//imdb.com/title/'+e.imdbID+'/">'+e.Title+"</a> ("+e.Year+")</h3><p>Rating: "+e.imdbRating+"<br/>Genre: "+e.Genre+"<br/>Starring: "+e.Actors+'</p></div>  <div id="view-photo-caption">'+e.Plot+"</div></div>":!1}}),new e.fn.oembed.OEmbedProvider("livejournal","rich",["livejournal.com/"],"//ljpic.seacrow.com/json/$2$4?jsonp=?",{templateRegex:/(http:\/\/(((?!users).)+)\.livejournal\.com|.*users\.livejournal\.com\/([^\/]+)).*/,templateData:function(e){return e.username?'<div><img src="'+e.image+'" align="left" style="margin-right: 1em;" /><span class="oembedall-ljuser"><a href="//'+e.username+'.livejournal.com/profile"><img src="//www.livejournal.com/img/userinfo.gif" alt="[info]" width="17" height="17" /></a><a href="//'+e.username+'.livejournal.com/">'+e.username+"</a></span><br />"+e.name+"</div>":!1}}),new e.fn.oembed.OEmbedProvider("circuitbee","rich",["circuitbee\\.com/circuit/view/.+"],"//c.circuitbee.com/build/r/schematic-embed.html?id=$1",{templateRegex:/.*circuit\/view\/(\d+).*/,embedtag:{tag:"iframe",width:"500",height:"350"}}),new e.fn.oembed.OEmbedProvider("googlecalendar","rich",["www.google.com/calendar/embed?.+"],"$1",{templateRegex:/(.*)/,embedtag:{tag:"iframe",width:"800",height:"600"}}),new e.fn.oembed.OEmbedProvider("jsfiddle","rich",["jsfiddle.net/[^/]+/?"],"//jsfiddle.net/$1/embedded/result,js,resources,html,css/?",{templateRegex:/.*net\/([^\/]+).*/,embedtag:{tag:"iframe",width:"100%",height:"300"}}),new e.fn.oembed.OEmbedProvider("jsbin","rich",["jsbin.com/.+"],"//jsbin.com/$1/?",{templateRegex:/.*com\/([^\/]+).*/,embedtag:{tag:"iframe",width:"100%",height:"300"}}),new e.fn.oembed.OEmbedProvider("jotform","rich",["form.jotform.co/form/.+"],"$1?",{templateRegex:/(.*)/,embedtag:{tag:"iframe",width:"100%",height:"507"}}),new e.fn.oembed.OEmbedProvider("reelapp","rich",["reelapp\\.com/.+"],"//www.reelapp.com/$1/embed",{templateRegex:/.*com\/(\S{6}).*/,embedtag:{tag:"iframe",width:"400",height:"338"}}),new e.fn.oembed.OEmbedProvider("linkedin","rich",["linkedin.com/pub/.+"],"https://www.linkedin.com/cws/member/public_profile?public_profile_url=$1&format=inline&isFramed=true",{templateRegex:/(.*)/,embedtag:{tag:"iframe",width:"368px",height:"auto"}}),new e.fn.oembed.OEmbedProvider("timetoast","rich",["timetoast.com/timelines/[0-9]+"],"//www.timetoast.com/flash/TimelineViewer.swf?passedTimelines=$1",{templateRegex:/.*timelines\/([0-9]*)/,embedtag:{width:550,height:400},nocache:1}),new e.fn.oembed.OEmbedProvider("pastebin","rich",["pastebin\\.com/[\\S]{8}"],"//pastebin.com/embed_iframe.php?i=$1",{templateRegex:/.*\/(\S{8}).*/,embedtag:{tag:"iframe",width:"100%",height:"auto"}}),new e.fn.oembed.OEmbedProvider("mixlr","rich",["mixlr.com/.+"],"//mixlr.com/embed/$1?autoplay=ae",{templateRegex:/.*com\/([^\/]+).*/,embedtag:{tag:"iframe",width:"100%",height:"auto"}}),new e.fn.oembed.OEmbedProvider("pastie","rich",["pastie\\.org/pastes/.+"],null,{yql:{xpath:'//pre[@class="textmate-source"]'}}),new e.fn.oembed.OEmbedProvider("github","rich",["gist.github.com/.+"],"https://github.com/api/oembed"),new e.fn.oembed.OEmbedProvider("github","rich",["github.com/[-.\\w@]+/[-.\\w@]+"],"https://api.github.com/repos/$1/$2?callback=?",{templateRegex:/.*\/([^\/]+)\/([^\/]+).*/,templateData:function(e){return e.data.html_url?'<div class="oembedall-githubrepos"><ul class="oembedall-repo-stats"><li>'+e.data.language+'</li><li class="oembedall-watchers"><a title="Watchers" href="'+e.data.html_url+'/watchers">&#x25c9; '+e.data.watchers+'</a></li><li class="oembedall-forks"><a title="Forks" href="'+e.data.html_url+'/network">&#x0265; '+e.data.forks+'</a></li></ul><h3><a href="'+e.data.html_url+'">'+e.data.name+'</a></h3><div class="oembedall-body"><p class="oembedall-description">'+e.data.description+'</p><p class="oembedall-updated-at">Last updated: '+e.data.pushed_at+"</p></div></div>":!1}}),new e.fn.oembed.OEmbedProvider("facebook","rich",["facebook.com"],null,{templateRegex:/.*\/([^\/]+)\/([^\/]+).*/,template:function(t){if(!e.fn.oembed.facebokScriptHasBeenAdded){e('<div id="fb-root"></div>').appendTo("body");var i=document.createElement("script");i.type="text/javascript",i.text='(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));',document.body.appendChild(i),e.fn.oembed.facebokScriptHasBeenAdded=!0}return'<div class="fb-post" data-href="'+t+'" data-width="520"><div class="fb-xfbml-parse-ignore"><a href="'+t+'"></div></div>'}}),new e.fn.oembed.OEmbedProvider("stackoverflow","rich",["stackoverflow.com/questions/[\\d]+"],"//api.stackoverflow.com/1.1/questions/$1?body=true&jsonp=?",{templateRegex:/.*questions\/([\d]+).*/,templateData:function(t){if(!t.questions)return!1;var n=t.questions[0],o=e(n.body).text(),a='<div class="oembedall-stoqembed"><div class="oembedall-statscontainer"><div class="oembedall-statsarrow"></div><div class="oembedall-stats"><div class="oembedall-vote"><div class="oembedall-votes"><span class="oembedall-vote-count-post"><strong>'+(n.up_vote_count-n.down_vote_count)+'</strong></span><div class="oembedall-viewcount">vote(s)</div></div></div><div class="oembedall-status"><strong>'+n.answer_count+'</strong>answer</div></div><div class="oembedall-views">'+n.view_count+' view(s)</div></div><div class="oembedall-summary"><h3><a class="oembedall-question-hyperlink" href="//stackoverflow.com/questions/'+n.question_id+'/">'+n.title+'</a></h3><div class="oembedall-excerpt">'+o.substring(0,100)+'...</div><div class="oembedall-tags">';for(i in n.tags)a+='<a title="" class="oembedall-post-tag" href="//stackoverflow.com/questions/tagged/'+n.tags[i]+'">'+n.tags[i]+"</a>";return a+='</div><div class="oembedall-fr"><div class="oembedall-user-info"><div class="oembedall-user-gravatar32"><a href="//stackoverflow.com/users/'+n.owner.user_id+"/"+n.owner.display_name+'"><img width="32" height="32" alt="" src="//www.gravatar.com/avatar/'+n.owner.email_hash+'?s=32&amp;d=identicon&amp;r=PG"></a></div><div class="oembedall-user-details"><a href="//stackoverflow.com/users/'+n.owner.user_id+"/"+n.owner.display_name+'">'+n.owner.display_name+'</a><br><span title="reputation score" class="oembedall-reputation-score">'+n.owner.reputation+"</span></div></div></div></div></div>"}}),new e.fn.oembed.OEmbedProvider("wordpress","rich",["wordpress\\.com/.+","blogs\\.cnn\\.com/.+","techcrunch\\.com/.+","wp\\.me/.+"],"//public-api.wordpress.com/oembed/1.0/?for=jquery-oembed-all"),new e.fn.oembed.OEmbedProvider("screenr","rich",["screenr.com"],"//www.screenr.com/embed/$1",{templateRegex:/.*\/([^\/]+).*/,embedtag:{tag:"iframe",width:"650",height:396}}),new e.fn.oembed.OEmbedProvider("gigpans","rich",["gigapan\\.org/[-.\\w@]+/\\d+"],"//gigapan.org/gigapans/$1/options/nosnapshots/iframe/flash.html",{templateRegex:/.*\/(\d+)\/?.*/,embedtag:{tag:"iframe",width:"100%",height:400}}),new e.fn.oembed.OEmbedProvider("scribd","rich",["scribd\\.com/.+"],"//www.scribd.com/embeds/$1/content?start_page=1&view_mode=list",{templateRegex:/.*doc\/([^\/]+).*/,embedtag:{tag:"iframe",width:"100%",height:600}}),new e.fn.oembed.OEmbedProvider("kickstarter","rich",["kickstarter\\.com/projects/.+"],"$1/widget/card.html",{templateRegex:/([^\?]+).*/,embedtag:{tag:"iframe",width:"220",height:380}}),new e.fn.oembed.OEmbedProvider("amazon","rich",["amzn.com/B+","amazon.com.*/(B\\S+)($|\\/.*)"],"//rcm.amazon.com/e/cm?t=_APIKEY_&o=1&p=8&l=as1&asins=$1&ref=qf_br_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr",{apikey:!0,templateRegex:/.*\/(B[0-9A-Z]+)($|\/.*)/,embedtag:{tag:"iframe",width:"120px",height:"240px"}}),new e.fn.oembed.OEmbedProvider("slideshare","rich",["slideshare.net"],"//www.slideshare.net/api/oembed/2",{format:"jsonp"}),new e.fn.oembed.OEmbedProvider("roomsharejp","rich",["roomshare\\.jp/(en/)?post/.*"],"//roomshare.jp/oembed.json"),new e.fn.oembed.OEmbedProvider("lanyard","rich",["lanyrd.com/\\d+/.+"],null,{yql:{xpath:'(//div[@class="primary"])[1]',from:"htmlstring",datareturn:function(e){return e.result?'<div class="oembedall-lanyard">'+e.result+"</div>":!1}}}),new e.fn.oembed.OEmbedProvider("asciiartfarts","rich",["asciiartfarts.com/\\d+.html"],null,{yql:{xpath:"//pre/font",from:"htmlstring",datareturn:function(e){return e.result?'<pre style="background-color:#000;">'+e.result+"</div>":!1}}}),new e.fn.oembed.OEmbedProvider("coveritlive","rich",["coveritlive.com/"],null,{templateRegex:/(.*)/,template:'<iframe src="$1" allowtransparency="true" scrolling="no" width="615px" frameborder="0" height="625px"></iframe>'}),new e.fn.oembed.OEmbedProvider("polldaddy","rich",["polldaddy.com/"],null,{templateRegex:/(?:https?:\/\/w?w?w?.?polldaddy.com\/poll\/)([0-9]*)\//,template:'<script async type="text/javascript" charset="utf-8" src="//static.polldaddy.com/p/$1.js"></script>',nocache:1}),new e.fn.oembed.OEmbedProvider("360io","rich",["360\\.io/.+"],"//360.io/$1",{templateRegex:/.*360\.io\/(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("bubbli","rich",["on\\.bubb\\.li/.+"],"//on.bubb.li/$1",{templateRegex:/.*on\.bubb\.li\/(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("cloudup","rich",["cloudup\\.com/.+"],"//cloudup.com/$1?chromeless",{templateRegex:[/.*cloudup\.com\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360}}),new e.fn.oembed.OEmbedProvider("codepen","rich",["codepen.io/.+"],"//codepen.io/$1/embed/$2",{templateRegex:[/.*io\/(\w+)\/pen\/(\w+).*/,/.*io\/(\w+)\/full\/(\w+).*/],embedtag:{tag:"iframe",width:"100%",height:"300"},nocache:1}),new e.fn.oembed.OEmbedProvider("googleviews","rich",["(.*maps\\.google\\.com\\/maps\\?).+(output=svembed).+(cbp=(.*)).*"],"https://maps.google.com/maps?layer=c&panoid=$3&ie=UTF8&source=embed&output=svembed&cbp=$5",{templateRegex:/(.*maps\.google\.com\/maps\?).+(panoid=(\w+)&).*(cbp=(.*)).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("googlemaps","rich",["google\\.com/maps/place/.+"],"//maps.google.com/maps?t=m&q=$1&output=embed",{templateRegex:/.*google\.com\/maps\/place\/([\w\+]*)\/.*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("imajize","rich",["embed\\.imajize\\.com/.+"],"//embed.imajize.com/$1",{templateRegex:/.*embed\.imajize\.com\/(.*)/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("mapjam","rich",["mapjam\\.com/.+"],"//www.mapjam.com/$1",{templateRegex:/.*mapjam\.com\/(.*)/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("polar","rich",["polarb\\.com/.+"],"//assets-polarb-com.a.ssl.fastly.net/api/v4/publishers/unknown/embedded_polls/iframe?poll_id=$1",{templateRegex:/.*polarb\.com\/polls\/(\w+).*/,embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("ponga","rich",["ponga\\.com/.+"],"https://www.ponga.com/embedded?id=$1",{templateRegex:[/.*ponga\.com\/embedded\?id=(\w+).*/,/.*ponga\.com\/(\w+).*/],embedtag:{tag:"iframe",width:480,height:360},nocache:1}),new e.fn.oembed.OEmbedProvider("opengraph","rich",[".*"],null,{yql:{xpath:"//meta|//title|//link",from:"html",datareturn:function(t){if(!t["og:title"]&&t.title&&t.description&&(t["og:title"]=t.title),!t["og:title"]&&!t.title)return!1;var i=e("<p/>");if(t["og:video"]){var n=e('<embed src="'+t["og:video"]+'"/>');n.attr("type",t["og:video:type"]||"application/x-shockwave-flash").css("max-height",s.maxHeight||"auto").css("max-width",s.maxWidth||"auto"),t["og:video:width"]&&n.attr("width",t["og:video:width"]),t["og:video:height"]&&n.attr("height",t["og:video:height"]),i.append(n)}else if(t["og:image"]){var o=e('<img src="'+t["og:image"]+'">');o.css("max-height",s.maxHeight||"auto").css("max-width",s.maxWidth||"auto"),t["og:image:width"]&&o.attr("width",t["og:image:width"]),t["og:image:height"]&&o.attr("height",t["og:image:height"]),i.append(o)}return t["og:title"]&&i.append("<b>"+t["og:title"]+"</b><br/>"),t["og:description"]?i.append(t["og:description"]+"<br/>"):t.description&&i.append(t.description+"<br/>"),i}}})]}(Edicy.jQuery),String.prototype.md5=function(){var e=function(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i},t=function(e,t){return e<<t|e>>>32-t},i=function(i,n,o,a,r,s){return e(t(e(e(n,i),e(a,s)),r),o)},n=function(e,t,n,o,a,r,s){return i(t&n|~t&o,e,t,a,r,s)},o=function(e,t,n,o,a,r,s){return i(t&o|n&~o,e,t,a,r,s)},a=function(e,t,n,o,a,r,s){return i(t^n^o,e,t,a,r,s)},r=function(e,t,n,o,a,r,s){return i(n^(t|~o),e,t,a,r,s)},s=function(t){var i,s,l,d,c,h=t.length,u=1732584193,m=-271733879,p=-1732584194,g=271733878;for(c=0;h>c;c+=16)i=u,s=m,l=p,d=g,u=n(u,m,p,g,t[c+0],7,-680876936),g=n(g,u,m,p,t[c+1],12,-389564586),p=n(p,g,u,m,t[c+2],17,606105819),m=n(m,p,g,u,t[c+3],22,-1044525330),u=n(u,m,p,g,t[c+4],7,-176418897),g=n(g,u,m,p,t[c+5],12,1200080426),p=n(p,g,u,m,t[c+6],17,-1473231341),m=n(m,p,g,u,t[c+7],22,-45705983),u=n(u,m,p,g,t[c+8],7,1770035416),g=n(g,u,m,p,t[c+9],12,-1958414417),p=n(p,g,u,m,t[c+10],17,-42063),m=n(m,p,g,u,t[c+11],22,-1990404162),u=n(u,m,p,g,t[c+12],7,1804603682),g=n(g,u,m,p,t[c+13],12,-40341101),p=n(p,g,u,m,t[c+14],17,-1502002290),m=n(m,p,g,u,t[c+15],22,1236535329),u=o(u,m,p,g,t[c+1],5,-165796510),g=o(g,u,m,p,t[c+6],9,-1069501632),p=o(p,g,u,m,t[c+11],14,643717713),m=o(m,p,g,u,t[c+0],20,-373897302),u=o(u,m,p,g,t[c+5],5,-701558691),g=o(g,u,m,p,t[c+10],9,38016083),p=o(p,g,u,m,t[c+15],14,-660478335),m=o(m,p,g,u,t[c+4],20,-405537848),u=o(u,m,p,g,t[c+9],5,568446438),g=o(g,u,m,p,t[c+14],9,-1019803690),p=o(p,g,u,m,t[c+3],14,-187363961),m=o(m,p,g,u,t[c+8],20,1163531501),u=o(u,m,p,g,t[c+13],5,-1444681467),g=o(g,u,m,p,t[c+2],9,-51403784),p=o(p,g,u,m,t[c+7],14,1735328473),m=o(m,p,g,u,t[c+12],20,-1926607734),u=a(u,m,p,g,t[c+5],4,-378558),g=a(g,u,m,p,t[c+8],11,-2022574463),p=a(p,g,u,m,t[c+11],16,1839030562),m=a(m,p,g,u,t[c+14],23,-35309556),u=a(u,m,p,g,t[c+1],4,-1530992060),g=a(g,u,m,p,t[c+4],11,1272893353),p=a(p,g,u,m,t[c+7],16,-155497632),m=a(m,p,g,u,t[c+10],23,-1094730640),u=a(u,m,p,g,t[c+13],4,681279174),g=a(g,u,m,p,t[c+0],11,-358537222),p=a(p,g,u,m,t[c+3],16,-722521979),m=a(m,p,g,u,t[c+6],23,76029189),u=a(u,m,p,g,t[c+9],4,-640364487),g=a(g,u,m,p,t[c+12],11,-421815835),p=a(p,g,u,m,t[c+15],16,530742520),m=a(m,p,g,u,t[c+2],23,-995338651),u=r(u,m,p,g,t[c+0],6,-198630844),g=r(g,u,m,p,t[c+7],10,1126891415),p=r(p,g,u,m,t[c+14],15,-1416354905),m=r(m,p,g,u,t[c+5],21,-57434055),u=r(u,m,p,g,t[c+12],6,1700485571),g=r(g,u,m,p,t[c+3],10,-1894986606),p=r(p,g,u,m,t[c+10],15,-1051523),m=r(m,p,g,u,t[c+1],21,-2054922799),u=r(u,m,p,g,t[c+8],6,1873313359),g=r(g,u,m,p,t[c+15],10,-30611744),p=r(p,g,u,m,t[c+6],15,-1560198380),m=r(m,p,g,u,t[c+13],21,1309151649),u=r(u,m,p,g,t[c+4],6,-145523070),g=r(g,u,m,p,t[c+11],10,-1120210379),p=r(p,g,u,m,t[c+2],15,718787259),m=r(m,p,g,u,t[c+9],21,-343485551),u=e(u,i),m=e(m,s),p=e(p,l),g=e(g,d);return[u,m,p,g]},l=function(e){var t,i="0123456789abcdef",n="",o=4*e.length;for(t=0;o>t;t++)n+=i.charAt(15&e[t>>2]>>8*(t%4)+4)+i.charAt(15&e[t>>2]>>8*(t%4));return n},d=function(e){var t,i,n=(e.length+8>>6)+1,o=[],a=16*n,r=e.length;for(t=0;a>t;t++)o.push(0);for(i=0;r>i;i++)o[i>>2]|=(255&e.charCodeAt(i))<<8*(i%4);return o[i>>2]|=128<<8*(i%4),o[16*n-2]=8*r,o};return l(s(d(this)))},function(e){function t(e){throw RangeError(L[e])}function i(e,t){for(var i=e.length;i--;)e[i]=t(e[i]);return e}function n(e,t){return i(e.split(A),t).join(".")}function o(e){for(var t,i,n=[],o=0,a=e.length;a>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&a>o?(i=e.charCodeAt(o++),56320==(64512&i)?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),o--)):n.push(t);return n}function a(e){return i(e,function(e){var t="";return e>65535&&(e-=65536,t+=I(55296|1023&e>>>10),e=56320|1023&e),t+=I(e)}).join("")}function r(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:v}function s(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function l(e,t,i){var n=0;for(e=i?O(e/x):e>>1,e+=O(e/t);e>R*C>>1;n+=v)e=O(e/R);return O(n+(R+1)*e/(e+E))}function d(e){var i,n,o,s,d,c,h,u,m,p,g=[],f=e.length,y=0,E=k,x=S;for(n=e.lastIndexOf(T),0>n&&(n=0),o=0;n>o;++o)e.charCodeAt(o)>=128&&t("not-basic"),g.push(e.charCodeAt(o));for(s=n>0?n+1:0;f>s;){for(d=y,c=1,h=v;s>=f&&t("invalid-input"),u=r(e.charCodeAt(s++)),(u>=v||u>O((b-y)/c))&&t("overflow"),y+=u*c,m=x>=h?w:h>=x+C?C:h-x,!(m>u);h+=v)p=v-m,c>O(b/p)&&t("overflow"),c*=p;i=g.length+1,x=l(y-d,i,0==d),O(y/i)>b-E&&t("overflow"),E+=O(y/i),y%=i,g.splice(y++,0,E)}return a(g)}function c(e){var i,n,a,r,d,c,h,u,m,p,g,f,y,E,x,N=[];for(e=o(e),f=e.length,i=k,n=0,d=S,c=0;f>c;++c)g=e[c],128>g&&N.push(I(g));for(a=r=N.length,r&&N.push(T);f>a;){for(h=b,c=0;f>c;++c)g=e[c],g>=i&&h>g&&(h=g);for(y=a+1,h-i>O((b-n)/y)&&t("overflow"),n+=(h-i)*y,i=h,c=0;f>c;++c)if(g=e[c],i>g&&++n>b&&t("overflow"),g==i){for(u=n,m=v;p=d>=m?w:m>=d+C?C:m-d,!(p>u);m+=v)x=u-p,E=v-p,N.push(I(s(p+x%E,0))),u=O(x/E);N.push(I(s(u,0))),d=l(n,y,a==r),n=0,++a}++n,++i}return N.join("")}function h(e){return n(e,function(e){return N.test(e)?d(e.slice(4).toLowerCase()):e})}function u(e){return n(e,function(e){return _.test(e)?"xn--"+c(e):e})}var m="object"==typeof exports&&exports,p="object"==typeof module&&module&&module.exports==m&&module,g="object"==typeof global&&global;(g.global===g||g.window===g)&&(e=g);var f,y,b=2147483647,v=36,w=1,C=26,E=38,x=700,S=72,k=128,T="-",N=/^xn--/,_=/[^ -~]/,A=/\x2E|\u3002|\uFF0E|\uFF61/g,L={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=v-w,O=Math.floor,I=String.fromCharCode;if(f={version:"1.2.4",ucs2:{decode:o,encode:a},decode:d,encode:c,toASCII:u,toUnicode:h},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return f});else if(m&&!m.nodeType)if(p)p.exports=f;else for(y in f)f.hasOwnProperty(y)&&(m[y]=f[y]);else e.punycode=f}(this),function(e){function t(e,t,i,n){if(e.tag.format&&!e.tag.isInline&&!e.tag.disallowNest&&i.length>0){i.push("\n");for(var o=0;n>o;o++)i.push("    ")}}function i(n,o){var a=[],r=0==n.attributes.length,s=0;if(n.tag.isComment)o.allowComments&&(a.push("<!--"),a.push(n.tag.rawAttributes),a.push(">"),o.format&&t(n,o,a,s-1));else{var l=n.tag.render&&(0==o.allowedTags.length||e.inArray(n.tag.name,o.allowedTags)>-1)&&(0==o.removeTags.length||-1==e.inArray(n.tag.name,o.removeTags));if(!n.isRoot&&l&&(a.push("<"),a.push(n.tag.name),e.each(n.attributes,function(){if(-1==e.inArray(this.name,o.removeAttrs)){var t=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),i=t[2],r=t[1]||"'";"class"==this.name&&o.allowedClasses.length>0&&(i=e.grep(i.split(" "),function(t){return e.grep(o.allowedClasses,function(i){return i==t||i[0]==t&&(1==i.length||e.inArray(n.tag.name,i[1])>-1)}).length>0}).join(" ")),null!=i&&(i.length>0||e.inArray(this.name,n.tag.requiredAttributes)>-1)&&(a.push(" "),a.push(this.name),a.push("="),a.push(r),a.push(i),a.push(r))}})),n.tag.isSelfClosing)l&&a.push(" />"),r=!1;else if(n.tag.isNonClosing)r=!1;else{if(!n.isRoot&&l&&a.push(">"),s=o.formatIndent++,n.tag.toProtect)m=e.htmlClean.trim(n.children.join("")).replace(/<br>/gi,"\n"),a.push(m),r=0==m.length;else{for(var m=[],g=0;g<n.children.length;g++){var f=n.children[g],y=e.htmlClean.trim(p(h(f)?f:f.childrenToString()));u(f)&&g>0&&y.length>0&&(d(f)||c(n.children[g-1]))&&m.push(" "),h(f)?y.length>0&&(m.push(y),l||m.push(" ")):(g!=n.children.length-1||"br"!=f.tag.name)&&(o.format&&t(f,o,m,s),m=m.concat(i(f,o)))}o.formatIndent--,m.length>0&&(o.format&&"\n"!=m[0]&&t(n,o,a,s),a=a.concat(m),r=!1)}!n.isRoot&&l&&(o.format&&t(n,o,a,s-1),a.push("</"),a.push(n.tag.name),a.push(">"))}if(!o.format||n.tag.isInline||n.tag.requiredParent||a.push("\n"),!n.tag.allowEmpty&&r)return[]}return a}function n(t,i){return a(t,function(t){return e.inArray(t.tag.nameOriginal,i)>-1})}function o(e){return a(e,function(e){return e.isRoot||!e.tag.isInline})}function a(e,t,i){i=i||1;var n=e[e.length-i];return t(n)?!0:e.length-i>0&&a(e,t,i+1)?(e.pop(),!0):!1}function r(e){return e?(this.tag=e,this.isRoot=!1):(this.tag=new l("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(e){for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].name==e)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function s(e,t){return this.name=e,this.value=t,this}function l(t,i,n,o){return this.name=t.toLowerCase(),this.nameOriginal=this.name,this.render=!0,this.init=function(){if("--"==this.name?(this.isComment=!0,this.isSelfClosing=!0,this.format=!0):(this.isComment=!1,this.isSelfClosing=e.inArray(this.name,C)>-1,this.isNonClosing=e.inArray(this.name,E)>-1,this.isClosing=void 0!=i&&i.length>0,this.isInline=e.inArray(this.name,g)>-1,this.disallowNest=e.inArray(this.name,y)>-1,this.requiredParent=v[e.inArray(this.name,v)+1],this.allowEmpty=o&&e.inArray(this.name,o.allowEmpty)>-1,this.toProtect=e.inArray(this.name,w)>-1,this.format=e.inArray(this.name,f)>-1||!this.isInline),this.rawAttributes=n,this.requiredAttributes=S[e.inArray(this.name,S)+1],o){if(o.tagAttributesCache||(o.tagAttributesCache=[]),-1==e.inArray(this.name,o.tagAttributesCache)){for(var t=x[e.inArray(this.name,x)+1].slice(0),a=0;a<o.allowedAttributes.length;a++){var r=o.allowedAttributes[a][0];((1==o.allowedAttributes[a].length||e.inArray(this.name,o.allowedAttributes[a][1])>-1)&&-1==e.inArray(r,t)||o.allowAllAttributes)&&t.push(r)}o.tagAttributesCache.push(this.name),o.tagAttributesCache.push(t)}this.allowedAttributes=o.tagAttributesCache[e.inArray(this.name,o.tagAttributesCache)+1]}},this.init(),this.rename=function(e){this.name=e,this.init()},this}function d(t){for(;m(t)&&t.children.length>0;)t=t.children[0];if(!h(t))return!1;var i=p(t);return i.length>0&&e.htmlClean.isWhitespace(i.charAt(0))}function c(t){for(;m(t)&&t.children.length>0;)t=t.children[t.children.length-1];if(!h(t))return!1;var i=p(t);return i.length>0&&e.htmlClean.isWhitespace(i.charAt(i.length-1))}function h(e){return e.constructor==String}function u(e){return h(e)||e.tag.isInline}function m(e){return e.constructor==r}function p(e){return e.replace(/\s\s+/g," ")}e.fn.htmlClean=function(t){return this.each(function(){this.value?this.value=e.htmlClean(this.value,t):this.innerHTML=e.htmlClean(this.innerHTML,t)})},e.htmlClean=function(t,a){a=e.extend({},e.htmlClean.defaults,a),a.allowEmpty=b.concat(a.allowEmpty);var d,c=/(<(\/)?(\w+:)?([\w]+)([^>]*)>)|<!--(.*?--)>/gi,u=/([\w\-]+)\s*=\s*(".*?"|'.*?'|[^\s>\/]*)/gi,m=new r,p=[m],g=m;a.bodyOnly&&(d=/<body[^>]*>((\n|.)*)<\/body>/i.exec(t))&&(t=d[1]),t=t.concat("<xxx>");for(var f;d=c.exec(t);){var y=d[6]?new l("--",null,d[6],a):new l(d[4],d[2],d[5],a),v=t.substring(f,d.index);if(v.length>0){var w=g.children[g.children.length-1];g.children.length>0&&h(w=g.children[g.children.length-1])?g.children[g.children.length-1]=w.concat(v):g.children.push(v)}if(f=c.lastIndex,y.isClosing)n(p,[y.name])&&(p.pop(),g=p[p.length-1]);else{for(var C,E=new r(y);C=u.exec(y.rawAttributes);){if("style"==C[1].toLowerCase()&&a.replaceStyles)for(var x=!y.isInline,S=0;S<a.replaceStyles.length;S++)a.replaceStyles[S][0].test(C[2])&&(x||(y.render=!1,x=!0),g.children.push(E),p.push(E),g=E,y=new l(a.replaceStyles[S][1],"","",a),E=new r(y));(null!=y.allowedAttributes&&(0==y.allowedAttributes.length||e.inArray(C[1],y.allowedAttributes)>-1)||a.allowAllAttributes)&&E.attributes.push(new s(C[1],C[2]))}e.each(y.requiredAttributes,function(){var e=this.toString();E.hasAttribute(e)||E.attributes.push(new s(e,""))});for(var k=0;k<a.replace.length;k++)for(var T=0;T<a.replace[k][0].length;T++){var N="string"==typeof a.replace[k][0][T];if(N&&a.replace[k][0][T]==y.name||!N&&a.replace[k][0][T].test(d)){y.rename(a.replace[k][1]),k=a.replace.length;break}}var _=!0;if(g.isRoot||(g.tag.isInline&&!y.isInline?(_=o(p))&&(g=p[p.length-1]):g.tag.disallowNest&&y.disallowNest&&!y.requiredParent?_=!1:y.requiredParent&&(_=n(p,y.requiredParent))&&(g=p[p.length-1])),_)if(g.children.push(E),y.toProtect)for(var A;A=c.exec(t);){var L=new l(A[4],A[1],A[5],a);if(L.isClosing&&L.name==y.name){E.children.push(RegExp.leftContext.substring(f)),f=c.lastIndex;break}}else y.isSelfClosing||y.isNonClosing||(p.push(E),g=E)}}return e.htmlClean.trim(i(m,a).join(""))},e.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],allowAllAttributes:!1,removeAttrs:[],allowedClasses:[],format:!0,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]],allowComments:!1,allowEmpty:[]},e.htmlClean.trim=function(t){return e.htmlClean.trimStart(e.htmlClean.trimEnd(t))},e.htmlClean.trimStart=function(t){return t.substring(e.htmlClean.trimStartIndex(t))},e.htmlClean.trimStartIndex=function(t){for(var i=0;i<t.length-1&&e.htmlClean.isWhitespace(t.charAt(i));i++);return i},e.htmlClean.trimEnd=function(t){return t.substring(0,e.htmlClean.trimEndIndex(t))},e.htmlClean.trimEndIndex=function(t){for(var i=t.length-1;i>=0&&e.htmlClean.isWhitespace(t.charAt(i));i--);return i+1},e.htmlClean.isWhitespace=function(t){return-1!=e.inArray(t,k)};var g=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","option","param","small","span","strike","strong","sub","sup","tt","u","var"],f=["address","button","caption","code","input","label","legend","select","option","param"],y=["h1","h2","h3","h4","h5","h6","p","th","td","object"],b=["th","td"],v=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"],"param",["object"]],w=["script","style","pre","code"],C=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],E=["!doctype","?xml"],x=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"iframe",["class","height","name","sandbox","seamless","src","srcdoc","width"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"],"param",["name","value"],"embed",["height","src","type","width"]],S=[[],"img",["alt"]],k=["Ā "," ","	","\n","\r","\f"]
}(Edicy.jQuery),function(){this.JST||(this.JST={}),this.JST["admin/templates/string_value_editor"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-string-value-editor-inner edy-form-group edy-tibtn-container ">\n  <input type="text" name="stringvalue" class="edy-form-control edy-input-small" autocomplete="off">\n  <div class="edy-tibtns">\n    <button class="edy-btn edy-btn-gray-dark-fg edy-btn-small" data-behavior="showtitle" title="',I18n.t("imageeditor_toolbar.toggle_title_visibility_title"),'">\n      <svg width="25" height="25" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25">\n    <path d="M12.5 5c-5.799 0-10.5 7.5-10.5 7.5s4.702 7.5 10.5 7.5 10.5-7.5 10.5-7.5-4.701-7.5-10.5-7.5zm0 12c-2.485 0-4.5-2.015-4.5-4.5s2.014-4.5 4.5-4.5 4.5 2.015 4.5 4.5-2.015 4.5-4.5 4.5zm-.001-6.5c-1.104 0-1.999.896-1.999 2s.895 2 1.999 2 2.001-.896 2.001-2-.896-2-2.001-2z" fill="currentColor"/>\n</svg>\n\n    </button>\n  </div>\n</div> \n');return __p.join("")}}.call(this),function(e){Edicy.SearchCollection=Edicy.Backbone.Collection.extend({mailtoTest:/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i,addressTest:/^[a-z0-9_\-\.]+\.[a-z]{2,4}/i,isWeblinkTest:/^(https?:)?\/\//i,isMailtoTest:/^mailto:(.+)/i,isAnchor:/^#(.+)/i,isLocal:/^\/(.+)/i,initialize:function(){this.fetchSearchEntries=e.debounce(this.fetchSearchEntries,500)},comparator:function(e){if(this.length<2)return 1;if("link_to"===e.get("type"))return 1;var t=this.indexOf(e);return 1>=t?0:t+1},testExistngLink:function(e){var t={title:e,type:"link_to"};return this.isWeblinkTest.test(e)?t.type="web_link":this.isMailtoTest.test(e)?(t.title=e.replace(/^mailto:/i,""),t.type="mail_link"):this.isAnchor.test(e)?t.type="anchor_link":this.isLocal.test(e)&&(t.type="page"),t},addExisting:function(e){var t=this.testExistngLink(e);this.add({type:t.type,title:t.title,url:e})},search:function(e){this.reset(),this.addExisting(e),this.mailtoTest.test(e)&&this.add({type:"mail_link",title:e,url:"mailto:"+e}),this.addressTest.test(e)&&this.add({type:"web_link",title:"http://"+e,url:"http://"+e}),this.isAnchor.test(e)||this.fetchSearchEntries(e)},fetchSearchEntries:function(e){var t=Edicy.SearchCollection.url;t+=(t.indexOf("?")>0?"&":"?")+"search="+encodeURIComponent(e),this.fetch({url:t,remove:!1})}})}(Edicy.Underscore),function(e){Edicy.ElementSearchCollection=Edicy.Backbone.Collection.extend({initialize:function(){this.fetchSearchEntries=e.debounce(this.fetchSearchEntries,500)},search:function(e){this.reset(),this.fetchSearchEntries(e)},fetchSearchEntries:function(e){var t=this.url;t+=(t.indexOf("?")>0?"&":"?")+"search="+e,this.fetch({url:t,remove:!1})}})}(Edicy.Underscore),function(){Edicy.DateEditorView=Edicy.Backbone.View.extend({events:{change:"handleChange",input:"handleChange"},initialize:function(){},handleChange:function(){this.trigger("change",{editor:this,target:this.el})},handleClick:function(){this.datePicker.show()},handleDatePick:function(e){this.$el.val(e).trigger("change")},isDateInputSupported:function(){var e=document.createElement("input");return e.setAttribute("type","date"),"text"!==e.type},getValue:function(){return this.$el.val()}}),Edicy.DatePickerView=Edicy.Backbone.View.extend({render:function(){return this.setBody("Date picker placeholder"),this}}),Edicy.Backbone.mixin(Edicy.DatePickerView,Edicy.PopoverViewMixin)}(Edicy.jQuery,Edicy.Underscore),function(){this.JST||(this.JST={}),this.JST["admin/templates/embededitor"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-form-group edy-tibtn-container edy-embed-compact-view">\n  <input type="text" name="code" class="edy-form-control edy-input-large" placeholder="',I18n.t("embededitor.insert_link_or_code"),'" autocomplete="off">\n  <div class="edy-tibtns">\n    <div class="edy-embed-loader edy-tibtn-item edy-hidden"></div>\n    <button class="edy-btn edy-btn-large edy-btn-green" data-behavior="insert">',I18n.t("embededitor.insert"),'</button>\n  </div>    \n</div>\n<div class="edy-codeedit-view edy-embed-extended-view edy-hidden">\n  <textarea name="code" class="edy-form-control"></textarea>\n  <div class="edy-codeedit-tools edy-align-right">\n    <button class="edy-btn edy-btn-gray edy-btn-large" data-behavior="close">',I18n.t("embededitor.cancel"),'</button>\n    <button class="edy-btn edy-btn-green edy-btn-large" data-behavior="insertsnippet">',I18n.t("embededitor.insert"),'</button>\n  </div>\n</div>\n<div class="edy-embed-preview edy-hidden"></div>\n');return __p.join("")}}.call(this),function(e,t){var i=RegExp("^\\s*(((https?:\\/\\/|www\\.)[^\\s<]{3,})|((http[s]?:\\/\\/){0,1}(www\\.){0,1}((\\.([a-z]{1,64}))|([a-zA-Z0-9\\.\\-]+\\.([a-z]{1,64})))(\\/[^\\s]*)?\\s*$))","i");Edicy.EmbedEditorView=Edicy.Backbone.View.extend({popoverOptions:{body:JST["admin/templates/embededitor"],containerClass:"edy-embededitor",propagateClicks:!1},events:{'click [data-behavior="insert"]':"handleInsertClick",'click [data-behavior="close"]':"handleCloseClick",'click [data-behavior="insertsnippet"]':"handleInsertSnippetClick",'input input[name="code"]':"handleCodeInputChanged"},initialize:function(){t.bindAll(this,"handleClose","handleCodeInputChanged","handleEmbedSuccess","handleEmbedError"),this.mode="embed",this.on("edicy:popover:closed",this.handleClose),this.handleCodeInputChanged=t.debounce(this.handleCodeInputChanged,250)},showLoader:function(){this.$(".edy-embed-loader").removeClass("edy-hidden").dotLoader()},hideLoader:function(){this.$(".edy-embed-loader").dotLoader(!1).addClass("edy-hidden")},resetView:function(){this.$("input, textarea").val(""),this.showCompactView()},setValue:function(e){this.$('input[name="code"]').val(e),this.processInputValue()},focus:function(){this.$('input[name="code"]').focus()},showCompactView:function(){this.$(".edy-embed-extended-view, .edy-embed-preview").addClass("edy-hidden"),this.$(".edy-embed-compact-view").removeClass("edy-hidden"),this.$('input[name="code"]').val(this.$('textarea[name="code"]').val()).focus()},showExtendedView:function(){this.$(".edy-embed-compact-view, .edy-embed-preview").addClass("edy-hidden"),this.$(".edy-embed-extended-view").removeClass("edy-hidden"),this.$('textarea[name="code"]').val(this.$('input[name="code"]').val()).focus(),this.setTextSelection(this.$('input[name="code"]'),this.$('textarea[name="code"]'))},setTextSelection:function(e,t){var i=t.get(0),n=this.getTextSelectionPos(e);"undefined"!=typeof i.selectionStart&&"undefined"!=typeof i.selectionEnd&&(i.selectionStart=n.start,i.selectionEnd=n.end)},getTextSelectionPos:function(e){var t=e.get(0);return{start:"undefined"!=typeof t.selectionStart?t.selectionStart:0,end:"undefined"!=typeof t.selectionEnd?t.selectionEnd:0}},fitPreview:function(){var e=this.$(".edy-embed-preview").children().first(),t=this.$(".edy-embed-preview").width();if(e.attr("width")&&e.attr("height")){var i=t/e.width();e.width(t),e.height(e.height()*i)}},handleCodeInputChanged:function(){this.processInputValue()},processInputValue:function(){var t=this.$('input[name="code"]').val();if(/[<>\n\r]/gi.test(t))this.$(".edy-embedded-preview").empty().addClass("edy-hidden"),this.showExtendedView(),this.mode="html";else if(""!=t){if(t.match(i)){var n=e("<span/>").html(t).text().trim();/^https?:\/\//i.test(n)||(n="http://"+n),this.showLoader(),this.$(".edy-embed-preview").empty().oembed(n,{includeHandle:!1,embedMethod:"fill",afterEmbed:this.handleEmbedSuccess,onError:this.handleEmbedError})}}else this.showCompactView()},handleEmbedSuccess:function(e){this.hideLoader(),this.$(".edy-embed-preview").removeClass("edy-hidden"),this.embedData=e,this.fitPreview()},handleEmbedError:function(){this.hideLoader(),this.$(".edy-embed-preview").addClass("edy-hidden")},handleInsertClick:function(){if(this.embedData||(this.embedData={}),this.embedData.code){var t=e("<div>").append(this.embedData.code),i=t.children().first();!this.embedData.width&&i.attr("width")&&(this.embedData.width=i.attr("width")),!this.embedData.height&&i.attr("height")&&(this.embedData.height=i.attr("height")),this.embedData.code=t.html()}this.embedData.mode=this.mode,this.trigger("embedcode:insert",{data:this.embedData}),this.hide()},handleInsertSnippetClick:function(){this.trigger("embedcode:insert",{data:{code:this.$("textarea").val(),mode:this.mode}}),this.hide()},handleClose:function(){this.resetView()},handleCloseClick:function(){this.hide()}}),Edicy.Backbone.mixin(Edicy.EmbedEditorView,Edicy.PopoverViewMixin)}(Edicy.jQuery,Edicy.Underscore),function(){this.JST||(this.JST={}),this.JST["admin/templates/mapeditor"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-modal-x" data-behavior="closes-modal"><?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="close-big" fill="none" stroke-width="2" stroke="#000000">\n        <path class="shape" d="M1,1 L19,19 M1,19 L19,1"></path>\n    </g>\n</svg></div>\n<div class="edy-mapeditor-tools">\n  <div class="edy-mapeditor-search">\n    <div class="edy-form-group edy-tibtn-container">\n      <input type="text" name="location" class="edy-form-control edy-input-large" placeholder="',I18n.t("mapeditor.search_for_location"),'" autocomplete="off">\n      <div class="edy-tibtns">\n        <div class="edy-mapeditor-loader"></div>\n        <button class="edy-btn edy-btn-large edy-btn-white-grayicon" data-behavior="locate"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2 13h9v9l9.982-19-18.982 10z" fill="currentColor"/>\n</svg>\n</button>\n        <button class="edy-btn edy-btn-large edy-btn-green" data-behavior="search"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12.7 14.7c-1.2.815-2.6 1.3-4.2 1.3-4.142 0-7.5-3.358-7.5-7.5 0-4.142 3.358-7.5 7.5-7.5 4.142 0 7.5 3.358 7.5 7.5 0 1.56-.476 3-1.3 4.209l4.3 4.3-2 2-4.3-4.3zm-4.2-.709c3 0 5.5-2.5 5.5-5.5s-2.5-5.5-5.5-5.5-5.5 2.5-5.5 5.5 2.5 5.5 5.5 5.5z" fill="currentColor"/>\n</svg>\n</button>\n        <button class="edy-btn edy-btn-blue edy-btn-large" data-behavior="addmap">',I18n.t("mapeditor.insert"),'</button>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="edy-mapeditor-map"></div>\n');return __p.join("")}}.call(this),function(){window.handleGmapsInitialize=function(){Edicy.trigger("edicy:gmapsloaded")},Edicy.MapEditorView=Edicy.Backbone.View.extend({panelOptions:{body:JST["admin/templates/mapeditor"],containerClass:"edy-mapeditor",propagateClicks:!1},events:{'click [data-behavior="addmap"]':"handleAddmapClick",'click [data-behavior="search"]':"handleSearchClick",'click [data-behavior="locate"]':"handleLocateClick",'keyup input[name="location"]':"handleSearchKeyup"},initialize:function(){Edicy.on("edicy:gmapsloaded",this.handleMapsLoaded,this),this.model={lat:0,lng:0,mlat:0,mlng:0,zoom:12}},render:function(){return navigator.geolocation||this.$('[data-behavior="locate"]').hide(),setTimeout(this.loadScript.bind(this),0),this},showLoader:function(){this.$('button[data-behavior="locate"]').hide(),this.$(".edy-mapeditor-loader").dotLoader()},hideLoader:function(){this.$(".edy-mapeditor-loader").dotLoader(!1),this.$('button[data-behavior="locate"]').show()},focus:function(){this.$('[data-behavior="search"]').focus()},loadScript:function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps&&3==parseInt(google.maps.version,10))this.handleMapsLoaded();else{var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=handleGmapsInitialize",document.body.appendChild(e)}},geocodeSearch:function(e){var t=new google.maps.Geocoder;t.geocode({address:e},this.handleGeocodeSearchResults.bind(this)),this.showLoader()},handleGeocodeSearchResults:function(e,t){this.hideLoader(),t==google.maps.GeocoderStatus.OK&&(this.map.setCenter(e[0].geometry.location),this.map.setZoom(16),this.marker.setPosition(this.map.getCenter()))},handleMapsLoaded:function(){var e={streetViewControl:!0,zoom:this.model.zoom,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},center:new google.maps.LatLng(this.model.lat,this.model.lng)};this.map=new google.maps.Map(this.el.querySelector(".edy-mapeditor-map"),e),this.marker=new google.maps.Marker({map:this.map,draggable:!0,position:new google.maps.LatLng(this.model.mlat,this.model.mlng)});var t=this.map.getStreetView();t.setOptions({addressControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),0==this.model.lat&&0==this.model.lng&&Edicy.userLocation(this.handleGeoipLocateSuccess.bind(this))},handleSearchKeyup:function(e){13==e.keyCode&&this.geocodeSearch(this.el.querySelector('input[name="location"]').value)},handleSearchClick:function(){this.geocodeSearch(this.el.querySelector('input[name="location"]').value)},handleLocateClick:function(){this.showLoader(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(this.handleLocateSuccess.bind(this),this.handleLocateFailed.bind(this))},handleLocateSuccess:function(e){this.setValue({lat:e.coords.latitude,lng:e.coords.longitude,zoom:16,mlat:e.coords.latitude,mlng:e.coords.longitude}),this.hideLoader()},handleLocateFailed:function(){},handleGeoipLocateSuccess:function(e){e.latitude&&e.longitude&&this.setValue({lat:e.latitude,lng:e.longitude,zoom:6,mlat:e.latitude,mlng:e.loncitude})},handleAddmapClick:function(){this.trigger("map:insert",this.getValue()),this.hide()},setValue:function(e){if(e&&(e.zoom||(e.zoom=12),e.lat&&e.lng&&(this.model=e)),this.map&&this.model.lat&&this.model.lng){var t=new google.maps.LatLng(this.model.lat,this.model.lng);this.map.setCenter(t),this.map.setZoom(this.model.zoom),this.marker&&this.marker.setPosition(t)}this.model.search&&(this.el.querySelector('input[name="location"]').value=this.model.search)},getValue:function(){var e={search:this.el.querySelector('input[name="location"]').value,lat:this.map.getCenter().lat(),lng:this.map.getCenter().lng(),zoom:this.map.getZoom(),type:this.map.getMapTypeId(),mlat:this.marker.getPosition().lat(),mlng:this.marker.getPosition().lng()},t=this.map.getStreetView();if(t.visible){var i=t.getPov();e.pov=!0,e["pov-heading"]=i.heading,e["pov-pitch"]=i.pitch,e["pov-zoom"]=i.zoom}return e}}),Edicy.Backbone.mixin(Edicy.MapEditorView,Edicy.PanelViewMixin)}(),function(){this.JST||(this.JST={}),this.JST["admin/templates/itempicker"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-form-group edy-tibtn-container">\n  <input type="text" name="query" class="edy-form-control edy-input-large" placeholder="',I18n.t("itempicker.type_url_here"),'" autocomplete="off">\n  <div class="edy-itempicker-input-btns">\n    <button class="edy-btn edy-btn-gray-dark-fg edy-btn-small edy-itempicker-preview" title="',I18n.t("itempicker.preview"),'" data-behavior="preview"><svg width="25" height="25" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25">\n    <path d="M12.5 5c-5.799 0-10.5 7.5-10.5 7.5s4.702 7.5 10.5 7.5 10.5-7.5 10.5-7.5-4.701-7.5-10.5-7.5zm0 12c-2.485 0-4.5-2.015-4.5-4.5s2.014-4.5 4.5-4.5 4.5 2.015 4.5 4.5-2.015 4.5-4.5 4.5zm-.001-6.5c-1.104 0-1.999.896-1.999 2s.895 2 1.999 2 2.001-.896 2.001-2-.896-2-2.001-2z" fill="currentColor"/>\n</svg>\n</button>\n    <button class="edy-btn edy-btn-gray-dark-fg edy-btn-small edy-itempicker-clear" title="',I18n.t("itempicker.remove"),'" data-behavior="remove"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg">\n    <path d="M7.788 9l-3.108-3.108 1.212-1.212 3.108 3.108 3.108-3.108 1.212 1.212-3.108 3.108 3.108 3.108-1.212 1.212-3.108-3.108-3.108 3.108-1.212-1.212 3.108-3.108zm1.212 8c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z" fill="currentColor"/>\n</svg>\n</button>\n\n    <button class="edy-btn edy-btn-large edy-btn-green" style="display:none;" data-behavior="change">',I18n.t("itempicker.change"),'</button>\n    <button class="edy-btn edy-btn-large edy-btn-green" data-behavior="insert">',I18n.t("itempicker.insert"),'</button>\n  </div>\n</div>\n<div class="edy-itempicker-items"></div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/itempicker_item"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-itempicker-item" data-url="',url,'" data-title="',title,'" data-type="',type,'">\n  <div class="edy-btn edy-btn-white-grayicon edy-itempicker-right-btn" data-behavior="new_window" title="',I18n.t("itempicker_item.in_new_window"),'"><svg width="23px" height="18px" viewBox="0 0 23 18" xmlns="http://www.w3.org/2000/svg">\n  <path d="M12,0 L16,4 L7.999,12 L2.999,7 L0,10 L7.999,18 L19,7 L23,11 L23,0 L12,0" stroke="none" stroke-width="1" fill="currentColor"></path>\n</svg>\n</div>\n  <div class="edy-itempicker-name">',title,'</div>\n  <div class="edy-itempicker-small">',I18n.t("itempicker_item.type_"+type)," ",type_details,"</div>\n</div>\n");return __p.join("")}}.call(this),function(e,t){Edicy.ItemPickerView=Edicy.Backbone.View.extend({popoverOptions:{body:JST["admin/templates/itempicker"],containerClass:"edy-itempicker",propagateClicks:!1},events:{'keydown input[name="query"]':"handleSearchKeydown",'keyup input[name="query"]':"handleSearchKeyup",'paste input[name="query"]':"handleInputPaste",'click [data-behavior="insert"]':"handleInsertClick",'click [data-behavior="preview"]':"handlePreviewClick",'click [data-behavior="change"]':"handleInsertClick",'click [data-behavior="remove"]':"handleRemoveClick","mouseover .edy-itempicker-item":"handleItemMouseover","click .edy-itempicker-item":"handleItemClick","click .edy-itempicker-right-btn":"handleItemRightBtnClick"},initialize:function(e){t.bindAll(this,"handleItemAdded"),this.options=e,this.collection=this.options.collection,this.collection.on({add:this.handleItemAdded,reset:this.handleItemsReset},this),this.rememberInputValue(),this.itemTpl=JST["admin/templates/itempicker_item"],this.on("edicy:popover:opened",this.handlePopoverShow.bind(this))},showPreviewBtn:function(){this.$(".edy-itempicker-preview").show(),this.updateInputWidth()},hidePreviewBtn:function(){this.$(".edy-itempicker-preview").hide(),this.updateInputWidth()},showClearBtn:function(){this.$(".edy-itempicker-clear").show(),this.updateInputWidth()},hideClearBtn:function(){this.$(".edy-itempicker-clear").hide(),this.updateInputWidth()},showChangeBtn:function(){this.$('[data-behavior="change"]').show(),this.updateInputWidth()},hideChangeBtn:function(){this.$('[data-behavior="change"]').hide(),this.updateInputWidth()},showInsertBtn:function(){this.$('[data-behavior="change"]').show(),this.updateInputWidth()},hideInsertBtn:function(){this.$('[data-behavior="change"]').hide(),this.updateInputWidth()},rememberInputValue:function(){var e=this.$('input[name="query"]');e.data("previous-value",e.val())},handleSearchKeydown:function(e){38==e.keyCode&&(e.preventDefault(),this.selectPreviousSuggestion()),40==e.keyCode&&(e.preventDefault(),this.selectNextSuggestion()),13==e.keyCode&&e.preventDefault()},handleSearchKeyup:function(e){if(38==e.keyCode||40==e.keyCode||27==e.keyCode)return e.preventDefault(),void 0;var t=this.$('input[name="query"]');13==e.keyCode&&(this.selectItem(this.$(".edy-itempicker-selecteditem")),this.hide()),t.data("previous-value")&&t.data("previous-value").length>1&&t.val().length>1?(t.val()==t.data("previous-value")?(this.showPreviewBtn(),this.showClearBtn(),this.hideChangeBtn()):(this.hidePreviewBtn(),this.hideClearBtn(),this.showChangeBtn()),this.collection.search(t.val())):0===t.val().length?this.collection.reset():this.collection.search(t.val())},handleInputPaste:function(){var e=this.$('input[name="query"]');t.defer(t.bind(function(){e.val()!=e.data("previous-value")&&e.val().length>1?this.collection.search(e.val()):0===e.val().length&&this.collection.reset()},this))},handleInsertClick:function(e){e.preventDefault(),this.selectItem(this.$(".edy-itempicker-selecteditem")),this.hide()},handleRemoveClick:function(){this.selectItem([])},handlePreviewClick:function(){var e=this.$('input[name="query"]');document.location=e.val()},focus:function(){this.$('input[name="query"]').focus()},handleItemAdded:function(i,n){this.options.keepOrder?(this.$(".edy-itempicker-items").empty(),t.each(n.models,function(i){e(this.itemTpl({title:i.get("title"),type:i.get("type"),url:i.get("url"),type_details:this.getTypeDetails(i)})).data("item",t.defaults(i.attributes,{id:i.id})).appendTo(this.$(".edy-itempicker-items")),0===this.$(".edy-itempicker-selecteditem").length&&this.$(".edy-itempicker-item:first").addClass("edy-itempicker-selecteditem")},this)):(e(this.itemTpl({title:i.get("title"),type:i.get("type"),url:i.get("url"),type_details:this.getTypeDetails(i)})).data("item",t.defaults(i.attributes,{id:i.id})).appendTo(this.$(".edy-itempicker-items")),0===this.$(".edy-itempicker-selecteditem").length&&this.$(".edy-itempicker-item:first").addClass("edy-itempicker-selecteditem"))},getTypeDetails:function(e){return"page"==e.get("type")?e.get("url"):"article"==e.get("type")&&e.has("page_title")?e.get("page_title"):e.has("type_details")?e.get("type_details"):null},handleItemsReset:function(){this.$(".edy-itempicker-items").empty()},handleItemClick:function(t){t.preventDefault(),0===e(t.target).closest(".edy-itempicker-right-btn").length&&this.selectItem(e(t.target).closest(".edy-itempicker-item"))},handleItemRightBtnClick:function(t){t.preventDefault(),this.selectItem(e(t.target).closest(".edy-itempicker-item"),{target:"_blank"})},handleItemMouseover:function(t){t.preventDefault(),this.$(".edy-itempicker-selecteditem").removeClass("edy-itempicker-selecteditem"),e(t.target).closest(".edy-itempicker-item").addClass("edy-itempicker-selecteditem")},selectItem:function(e,t){this.trigger("item:selected",e.length>0?e.data("item"):{},t),this.hide(),this.collection.reset(),this.$('input[name="query"]').val("")},selectPreviousSuggestion:function(){var e=this.$(".edy-itempicker-selecteditem");e.prev().length>0&&(this.$(".edy-itempicker-selecteditem").removeClass("edy-itempicker-selecteditem"),e.prev().addClass("edy-itempicker-selecteditem"))},selectNextSuggestion:function(){var e=this.$(".edy-itempicker-selecteditem");e.next().length>0&&(this.$(".edy-itempicker-selecteditem").removeClass("edy-itempicker-selecteditem"),e.next().addClass("edy-itempicker-selecteditem"))},handlePopoverShow:function(){this.updateInputWidth()},updateInputWidth:function(){var e=this.$('input[name="query"]'),t=this.$(".edy-itempicker-input-btns").innerWidth(),i=this.$(".edy-tibtn-container").outerWidth();e.css("width",i-t)}}),Edicy.Backbone.mixin(Edicy.ItemPickerView,Edicy.PopoverViewMixin)}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.PlaintextEditorView=Edicy.Backbone.View.extend({events:{keydown:"handleKeydown",keyup:"handleKeyup",input:"handleInput",paste:"handlePaste",focus:"handleFocus",blur:"handleBlur"},initialize:function(){t.bindAll(this,"cleanContents"),this.cleanContents=t.throttle(this.cleanContents,100),this.$el.attr({contentEditable:"true",designMode:"off"}),this.$el.data("placeholder")&&""==this.$el.text()&&(this.$el.text(this.$el.data("placeholder")),this.hasPlaceholder=!0)},deinitialize:function(){this.$el.removeAttr("contentEditable").removeAttr("designMode"),this.unbind()},handleFocus:function(){if(this.$el.hasClass("edy-texteditor-active")||this.$el.addClass("edy-texteditor-active").trigger("content:activate"),this.hasPlaceholder){this.$el.text(""),this.hasPlaceholder=!1;try{var e=rangy.createRange();e.selectNodeContents(this.el),rangy.getSelection().setSingleRange(e)}catch(t){}}},handleBlur:function(){this.$el.hasClass("edy-texteditor-active")&&this.$el.removeClass("edy-texteditor-active").trigger("content:deactivate"),""==this.$el.text()&&(this.$el.text(this.$el.data("placeholder")),this.hasPlaceholder=!0)},handleKeydown:function(e){return 13==e.keyCode?!1:void 0},handleKeyup:function(){this.cleanContents()},handleInput:function(){this.handleContentChange()},handlePaste:function(){t.defer(t.bind(function(){this.$("br").replaceWith(" "),this.cleanContents(),this.handleContentChange()},this),0)},handleContentChange:function(){this.trigger("change",{editor:this,target:this.el})},cleanContents:function(){this.$("*").each(function(t,i){e(i).contents().unwrap()}),this.el.normalize()},getValue:function(){return this.hasPlaceholder?"":this.$el.text()}})}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.ContentPartialView=Edicy.Backbone.View.extend({events:{click:"handleClick",'click [data-behavior~="open-partial-editor"]':"handleOpenEditorClick"},initialize:function(e){this.handleDocumentClick=this.handleDocumentClick.bind(this),this.model=Edicy.content_partials.add(new Edicy.ContentPartial({id:this.$el.data("content-partial-id"),body:this.$(".edy-contentpartial-body").html(),metainfo:this.$el.data("content-partial-metainfo")}),{silent:!0}),e.focus&&this.showEditor(),Edicy.on("edicy:save",this.handleSave,this)},initEditor:function(){"map"==this.getPartialType()?this.initMapEditor():this.initEmbedEditor()},initMapEditor:function(){this.editor=new Edicy.MapEditorView({}).render(),this.editor.on("map:insert",this.handleMapInsert,this)},initEmbedEditor:function(){this.editor=new Edicy.EmbedEditorView({parent:this.el,relative:!1}).render(),this.editor.on("embedcode:insert",this.handleEmbedCodeInsert,this)},getPartialType:function(){return this.el.getAttribute("data-content-partial-type")},remove:function(){Edicy.content_partials.remove(this.model),Edicy.off("edicy:save",this.handleSave,this)},setBody:function(e){this.el.querySelector(".edy-contentpartial-body").innerHTML=e,this.el.classList.toggle("edy-cp-empty",""===e)},fitBody:function(){var e=this.el.querySelector(".edy-contentpartial-body"),t=e.firstChild,i=e.getBoundingClientRect().width;if(t&&t.hasAttribute("width")&&t.hasAttribute("height")){var n=t.getBoundingClientRect().width,o=t.getBoundingClientRect().height,a=i/n;t.setAttribute("width",i+"px"),t.setAttribute("height",parseInt(o*a,10)+"px")}return e.innerHTML},showEditor:function(){this.editor||this.initEditor(),"map"==this.getPartialType()?this.editor.setValue(this.model.getMetainfo("mapdata")):this.editor.setValue(this.model.get("body")),this.editor.show(),this.editor.focus()},handleClick:function(){this.activate()},handleOpenEditorClick:function(e){this.showEditor(),"map"!=this.getPartialType()&&this.editor.setParent(Edicy.dom.closest(e.target,'[data-behavior~="open-partial-editor"]'))},handleEmbedCodeInsert:function(e){var t=e.data.code||"";this.setBody(t),t=this.fitBody(),this.model.set("body",t),this.model.setMetainfo("embeddata",e)},handleMapInsert:function(t){var i=this.$el.width(),n=parseInt(i/1.618,10),o=document.createElement("iframe");o.setAttribute("src",Edicy.mapsUrl+"?"+e.param(t)),o.setAttribute("allowtransparency","true"),o.setAttribute("scrolling","no"),o.setAttribute("frameborder",0),o.setAttribute("width","100%"),o.setAttribute("height",n+"px"),this.model.set("body",o.outerHTML),this.model.setMetainfo("mapdata",t),this.setBody(this.model.get("body"))},handleDocumentClick:function(e){this.el.contains(e.target)||this.editor&&this.editor.el.contains(e.target)||(this.deactivate(),document.body.removeEventListener("click",this.handleDocumentClick))},activate:function(){this.$el.hasClass("edy-cp-active")||(document.body.addEventListener("click",this.handleDocumentClick),this.$el.addClass("edy-cp-active").trigger("content:activate"))},deactivate:function(){this.$el.hasClass("edy-cp-active")&&this.$el.removeClass("edy-cp-active").trigger("content:deactivate")},handleSave:function(){if(this.model.hasPendingChanges()){var e=this.model.save();Edicy.trigger("edicy:saving",e)}}})}(Edicy.jQuery),function(){this.JST||(this.JST={}),this.JST["admin/templates/codeeditor"]=function(obj){var __p=[];with(obj||{})__p.push('<textarea></textarea>\n<div class="edy-codeedit-tools">\n  <div class="edy-srcedit-links edy-hide-small">\n    <a class="edy-srcedit-format">',I18n.t("codeeditor.reformat"),'</a>\n    <a class="edy-srcedit-cleanup">',I18n.t("codeeditor.clean_up"),'</a>\n    <a class="edy-srcedit-undo" style="display: none;">',I18n.t("codeeditor.undo"),'</a>\n  </div>\n  <div class="edy-srcedit-btns">\n    <button class="edy-btn edy-btn-gray edy-btn-large edy-srcedit-cancel">',I18n.t("codeeditor.cancel"),'</button>\n    <button class="edy-btn edy-btn-green edy-btn-large edy-srcedit-update">',I18n.t("codeeditor.update"),"</button>\n  </div>\n</div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/colorpicker"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-colorpicker-colors"></div>\n<div class="edy-tb-color-tab-content-bottom edy-popover-form">\n  <div class="edy-tb-color-alpha-slider-outer">\n    <span class="edy-tb-color-alpha-text">',I18n.t("colorpicker.opacity"),': <span class="edy-tb-color-alpha-value"><span class="edy-tb-color-alpha-nr"></span>%</span></span>\n    <div class="edy-tb-color-alpha-slider">\n      <div class="edy-tb-color-alpha-slider-inner">\n        <div class="edy-tb-color-alpha-btn"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="edy-tb-color-custom-container">\n    <input type="text" class="edy-tb-color-custom textinput" placeholder="',I18n.t("colorpicker.custom"),'">\n    <div class="edy-tb-color-picked">\n      <svg width="100%" height="100%" class="no-color">\n        <line x1="0" y1="100%" x2="100%" y2="0" stroke="rgba(255,0,0,0.75)" stroke-width="1" />\n      </svg>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/textcolormodal"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-tb-dropdown-content">\n  <div class="row edy-tb-tabs">\n    <button class="edy-btn edy-btn-blue edy-tb-color-tab" data-tab-id="foreground">',I18n.t("colorpicker.text"),'</button>\n    <button class="edy-btn edy-btn-white edy-tb-color-tab" data-tab-id="background">',I18n.t("colorpicker.highlight"),'</button>\n  </div>\n  <div class="edy-tb-color-tab-content" data-tab-id="foreground"></div>\n  <div class="edy-tb-color-tab-content edy-hidden" data-tab-id="background"></div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/texteditor_toolbar"]=function(obj){var __p=[];with(obj||{})__p.push('<button class="edy-tb-cmd" data-cmd="bold" title="',I18n.t("texteditor_toolbar.button_bold_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <path d="M15.232 10.346c-.181-.535-.437-1.005-.767-1.41-.331-.406-.731-.727-1.201-.962-.472-.235-1.002-.355-1.589-.355-.597 0-1.102.118-1.514.354-.412.236-.732.497-.959.777h-.034v-5.25h-2.668v12.764h2.458v-1.099h.032c.26.428.632.757 1.114.987.484.232.996.348 1.541.348.605 0 1.147-.123 1.625-.37.479-.248.883-.578 1.215-.987.328-.412.582-.888.757-1.429.172-.54.26-1.103.26-1.688-.002-.585-.092-1.144-.27-1.68zm-2.425 2.481c-.08.265-.203.499-.365.7-.162.203-.363.367-.602.49-.24.125-.518.187-.832.187-.303 0-.574-.062-.813-.187s-.442-.287-.61-.49c-.168-.201-.298-.434-.39-.69-.093-.26-.139-.524-.139-.795s.045-.533.137-.792c.093-.26.223-.492.39-.693.169-.201.372-.365.61-.488.24-.125.51-.187.813-.187.314 0 .594.062.832.187.237.123.439.283.604.48.162.196.283.426.365.686.08.258.121.521.121.791.002.272-.039.536-.121.801z" fill="#1B2124"/>\n</svg>\n</button>\n<button class="edy-tb-cmd" data-cmd="italic" title="',I18n.t("texteditor_toolbar.button_italic_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(7 3)" fill="#1B2124">\n        <path d="M2.926 14l1.765-8.912h-2.448l-1.743 8.912h2.426z" id="Shape"/>\n        <path d="M5.096.863c-.27-.242-.604-.363-1.007-.363-.401 0-.752.134-1.058.402-.306.268-.456.61-.456 1.029 0 .432.141.765.425 1 .284.237.625.353 1.025.353.418 0 .764-.143 1.049-.431.283-.288.426-.622.426-1 0-.418-.135-.749-.404-.99z"/>\n    </g>\n</svg>\n</button>\n<button class="edy-tb-cmd" data-cmd="underline" title="',I18n.t("texteditor_toolbar.button_underline_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <title>\n        Slice 1\n    </title>\n    <g transform="translate(6 5)" fill="#1B2124">\n        <path d="M9.141-.5h-2.271v4.791c0 .291-.042.578-.132.862-.09.284-.217.535-.387.752-.17.219-.391.397-.662.536-.27.14-.581.209-.934.209-.365 0-.659-.072-.878-.217-.221-.146-.394-.33-.52-.554-.127-.223-.209-.475-.247-.754-.038-.278-.057-.544-.057-.798v-4.827h-2.268v5.444c0 .447.062.882.189 1.306.126.424.324.799.595 1.125.272.327.618.591 1.041.791.422.199.929.299 1.521.299.68 0 1.27-.168 1.768-.499.498-.333.849-.718 1.051-1.153h.037v1.397h2.154v-8.71z"/>\n        <rect y="11" width="11" height=".908"/>\n    </g>\n</svg>\n</button>\n<div class="edy-tb-menucontainer">\n  <button class="edy-tb-act edy-tb-paragraph edy-tb-g edy-tb-arrow" data-behavior="showstyles" title="',I18n.t("texteditor_toolbar.button_styles_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <path d="M11.5 17.5v-12.5h1.5v12.5h1.5v-14h-4.5c-.714 0-3.5 0-3.5 3s2.5 3 3.5 3v8h1.5z" fill="#1B2124"/>\n</svg>\n</button>\n  <div class="edy-tb-dropdown edy-tb-stylemenu edy-hidden">\n    <div class="edy-tb-dropdown-content">\n      <button class="edy-tb-cmd edy-tb-style-h1" data-cmd="format" data-value="h1">',I18n.t("texteditor_toolbar.title"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-h2" data-cmd="format" data-value="h2">',I18n.t("texteditor_toolbar.heading"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-h3" data-cmd="format" data-value="h3">',I18n.t("texteditor_toolbar.subheading"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-p" data-cmd="format" data-value="p">',I18n.t("texteditor_toolbar.paragraph"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-pre" data-cmd="format" data-value="pre">',I18n.t("texteditor_toolbar.fixed_width"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-p" data-cmd="format" data-blank-value="true">',I18n.t("texteditor_toolbar.plain_text"),'</button>\n      <button class="edy-tb-cmd edy-tb-style-blockquote" data-cmd="blockquote">',I18n.t("texteditor_toolbar.block_quote"),'</button>\n      <div class="edy-tb-tabletools edy-tb-table-celltools edy-tb-cellstyle-tools">\n        <button class="edy-tb-cmd edy-tb-style-th" data-cmd="tableheadercell">',I18n.t("texteditor_toolbar.header_cell"),'</button>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="edy-tb-size edy-tb-g">\n  <button class="edy-tb-size-btn edy-tb-cmd" data-cmd="fontsize" data-value="-" title="',I18n.t("texteditor_toolbar.button_fontsize_decrease_title"),'"><svg width="10" height="21" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2 10v2h6v-2h-6z" fill="currentColor"/>\n</svg>\n</button>\n  <input class="edy-tb-size-val" title="',I18n.t("texteditor_toolbar.button_fontsize_title"),'" />\n  <button class="edy-tb-size-btn edy-tb-cmd" data-cmd="fontsize" data-value="+" title="',I18n.t("texteditor_toolbar.button_fontsize_increase_title"),'"><svg width="10" height="21" xmlns="http://www.w3.org/2000/svg">\n    <path d="M1 10h3v-3h2v3h3v2h-3v3h-2v-3h-3v-2z" fill="currentColor"/>\n</svg>\n</button>\n</div>\n<div class="edy-tb-menucontainer"><button class="edy-tb-act edy-tb-color edy-tb-g" data-behavior="pickcolor" title="',I18n.t("texteditor_toolbar.button_color_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(1 1)" fill="none">\n        <circle stroke="#979797" cx="9.5" cy="9.5" r="9.5"/>\n        <path d="M3.9 15h2.2l.8-2.4h5.1l.9 2.4h2.2l-4.7-12h-1.7l-4.8 12zm3.8-4l1.8-4.7 1.7 4.7h-3.5z" fill="currentColor"/>\n    </g>\n</svg>\n</button></div>\n<div class="edy-tb-menucontainer"><button class="edy-tb-act edy-tb-g" data-behavior="insertlink" title="',I18n.t("texteditor_toolbar.button_link_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <title>\n        Slice 1\n    </title>\n    <g transform="translate(0 4)" fill="none">\n        <g fill="#1C67B2">\n            <path d="M7.946 8.197c-.14-.037-.252-.081-.34-.133-.129-.086-.229-.172-.3-.264-.074-.088-.138-.206-.195-.35l-2.685-6.841h-.453l-1.306 3.315c-.488 1.24-.934 2.358-1.34 3.354-.08.194-.16.346-.244.455-.083.11-.201.214-.352.315-.094.057-.215.106-.361.141l-.37.068v.396h3.032v-.397c-.297-.015-.568-.067-.804-.147-.239-.082-.358-.197-.358-.345l.027-.247.103-.391.18-.536c.066-.194.152-.422.258-.681h2.828l.666 1.776.035.129.011.124c0 .082-.097.15-.292.207-.196.054-.441.091-.737.111v.396h3.349v-.396c-.094-.005-.213-.024-.352-.059zm-5.312-2.787l1.203-3.078 1.221 3.078h-2.424z" id="Shape"/>\n            <path d="M13.559 3.795c-.463-.536-1.037-.805-1.727-.805-.27 0-.543.062-.818.184-.279.123-.537.308-.771.553l-.04-.011v-3.631l-.079-.085-2.055.124v.358l.405.047c.169.024.288.061.36.109.091.057.167.146.225.274.059.126.088.252.088.379v5.459c0 .361-.002.736-.011 1.124-.008.388-.021.722-.04.997l.353.077.419-.644c.262.154.541.279.837.375.295.092.6.139.904.139.699 0 1.314-.28 1.844-.844.529-.562.797-1.258.797-2.085.001-.859-.232-1.557-.691-2.094zm-.92 3.941c-.285.439-.654.659-1.119.659-.207 0-.385-.03-.523-.098-.145-.066-.271-.15-.389-.255-.112-.108-.205-.221-.27-.341-.067-.118-.112-.222-.134-.312v-3.208c.158-.174.337-.314.536-.417.199-.102.43-.153.695-.153.291 0 .541.066.75.201.205.134.375.31.504.525.127.212.223.462.285.75.059.286.09.567.09.843-.002.764-.145 1.366-.425 1.806z" id="Shape"/>\n            <path d="M18.982 8.412c.41-.258.74-.605.99-1.045l-.363-.234c-.213.352-.442.616-.689.792-.247.177-.554.264-.92.264-.508 0-.916-.219-1.229-.658-.312-.438-.47-1.003-.47-1.696 0-.439.046-.817.13-1.134.088-.316.202-.568.342-.754.152-.205.312-.347.478-.423.163-.075.338-.114.521-.114.153 0 .297.02.433.059.134.039.233.116.303.231l-.079.387c-.046.177-.066.349-.066.515 0 .138.061.263.186.374.122.111.294.167.518.167.209 0 .358-.071.451-.214.094-.145.137-.309.137-.495 0-.447-.172-.8-.519-1.059-.343-.259-.79-.388-1.336-.388-.397 0-.765.081-1.103.243-.338.162-.617.375-.842.639-.235.276-.414.582-.535.919-.123.338-.186.699-.186 1.086 0 .891.229 1.601.688 2.13.459.528 1.093.792 1.902.792.428-.001.853-.127 1.258-.384z" id="Shape"/>\n            <rect y="10" width="19.768" height=".562"/>\n        </g>\n        <path d="M15.672 10.839l-4.755-4.682v7.803l2.112-1.562 1.059 2.602 1.587-1.04-1.587-2.081 1.584-1.04zm-4.169 1.777v-5.117l3.119 3.071-3.119 2.046z" fill="#1B2124"/>\n    </g>\n</svg>\n</button></div>\n<button class="edy-tb-cmd edy-tb-g edy-hide-small" data-cmd="alignleft" title="',I18n.t("texteditor_toolbar.button_align_left_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M4 5.5h11"/>\n        <path d="M4 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M4 11.5h8"/>\n        <path d="M4 13.5h11"/>\n        <path d="M4 15.5h5"/>\n    </g>\n</svg>\n</button>\n<button class="edy-tb-cmd edy-hide-small" data-cmd="aligncenter" title="',I18n.t("texteditor_toolbar.button_align_center_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M6 7.5h9"/>\n        <path d="M4 9.5h13"/>\n        <path d="M7 11.5h7"/>\n        <path d="M5 13.5h11"/>\n        <path d="M8 15.5h5"/>\n    </g>\n</svg>\n</button>\n<button class="edy-tb-cmd edy-hide-small" data-cmd="alignright" title="',I18n.t("texteditor_toolbar.button_align_right_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M7 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M8 11.5h8"/>\n        <path d="M5 13.5h11"/>\n        <path d="M11 15.5h5"/>\n    </g>\n</svg>\n</button>\n\n<div class="edy-tb-tabletools edy-tb-table-celltools edy-tb-menucontainer edy-hide-small">\n  <button class="edy-tb-btn edy-tb-act edy-tb-valigncombo-btn edy-tb-valign-bottom" data-behavior="picktablecellvalign" title="',I18n.t("texteditor_toolbar.button_vertical_align_title"),'">\n    <span class="edy-tb-valign-btn-bottom" title="',I18n.t("texteditor_toolbar.button_vertical_bottom_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="10.5" y1="5" x2="10.5" y2="11" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 11 L13 11 L10.5 14 Z" fill="rgb(0,0,0)"/>\n  <line x1="5" y1="15.5" x2="16" y2="15.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></span>\n    <span class="edy-tb-valign-btn-top" title="',I18n.t("texteditor_toolbar.button_vertical_top_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="5" y1="5.5" x2="16" y2="5.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 10 L13 10 L10.5 7 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="9" x2="10.5" y2="16" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></span>\n    <span class="edy-tb-valign-btn-middle" title="',I18n.t("texteditor_toolbar.button_vertical_middle_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="5" y1="10.5" x2="16" y2="10.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 15 L13 15 L10.5 12 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="12" x2="10.5" y2="17" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 6 L13 6 L10.5 9 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="4" x2="10.5" y2="6" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></span>\n  </button>\n  <div class="edy-tb-dropdown edy-compact-dropdown edy-valign-dropdown edy-hidden">\n    <div class="edy-tb-dropdown-content">\n      <button class="edy-tb-cmd" data-cmd="tablecellvalign" data-value="top" title="',I18n.t("texteditor_toolbar.button_vertical_top_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="5" y1="5.5" x2="16" y2="5.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 10 L13 10 L10.5 7 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="9" x2="10.5" y2="16" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></button>\n      <button class="edy-tb-cmd" data-cmd="tablecellvalign" data-value="middle" title="',I18n.t("texteditor_toolbar.button_vertical_middle_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="5" y1="10.5" x2="16" y2="10.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 15 L13 15 L10.5 12 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="12" x2="10.5" y2="17" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 6 L13 6 L10.5 9 Z" fill="rgb(0,0,0)"/>\n  <line x1="10.5" y1="4" x2="10.5" y2="6" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></button>\n      <button class="edy-tb-cmd" data-cmd="tablecellvalign" data-value="bottom" title="',I18n.t("texteditor_toolbar.button_vertical_bottom_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <line x1="10.5" y1="5" x2="10.5" y2="11" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n  <path d="M8 11 L13 11 L10.5 14 Z" fill="rgb(0,0,0)"/>\n  <line x1="5" y1="15.5" x2="16" y2="15.5" style="stroke: rgb(0,0,0); stroke-width: 1;"/>\n</svg></button>\n    </div>\n  </div>\n</div>\n\n<button class="edy-tb-cmd edy-tb-g edy-hide-small" data-cmd="insertul" title="',I18n.t("texteditor_toolbar.button_unordered_list_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(2 3)" fill="#1B2124">\n        <circle id="Oval" cx="1.5" cy="12.5" r="1.5"/>\n        <circle id="Oval" cx="1.5" cy="2.5" r="1.5"/>\n        <circle cx="1.5" cy="7.5" r="1.5"/>\n        <path d="M6.5 2.5h9" id="Line" stroke="#1B2124"/>\n        <path d="M6.5 12.5h9" stroke="#1B2124"/>\n        <path d="M6.5 7.5h9" stroke="#1B2124"/>\n    </g>\n</svg>\n</button>\n<button class="edy-tb-cmd edy-hide-small" data-cmd="insertol" title="',I18n.t("texteditor_toolbar.button_ordered_list_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(2 3)" fill="none">\n        <path d="M2.933 4.437v-4.437h-.96l-1.459 1.071.545.746.827-.639v3.259h1.047z" id="Shape" fill="#1B2124"/>\n        <path d="M3.747 9.659v-.915h-1.811l1.028-.914.292-.28c.094-.094.177-.194.25-.304.073-.108.13-.227.172-.354.042-.127.063-.27.063-.429 0-.229-.044-.43-.134-.602-.09-.171-.21-.313-.361-.426-.15-.113-.321-.197-.514-.251-.192-.053-.391-.081-.595-.081-.218 0-.423.033-.617.098s-.367.16-.518.283c-.15.125-.274.274-.373.451-.098.177-.159.377-.184.603l1.008.138c.021-.2.087-.362.198-.485.111-.124.254-.185.429-.185.167 0 .301.049.401.146.1.098.15.227.15.385 0 .134-.033.255-.101.363-.066.109-.154.214-.262.32l-1.729 1.563v.876h3.208z" id="Shape" fill="#1B2124"/>\n        <path d="M3.703 13.238c-.042-.109-.1-.211-.176-.301-.075-.09-.165-.166-.269-.23-.104-.064-.219-.111-.345-.141v-.021c.217-.06.396-.172.536-.342.14-.169.209-.377.209-.624 0-.213-.045-.398-.135-.557-.09-.157-.208-.287-.354-.392-.146-.105-.313-.183-.499-.233-.186-.049-.377-.074-.573-.074-.184 0-.364.023-.539.072-.175.047-.337.117-.486.213-.148.095-.276.211-.385.352-.109.141-.19.305-.244.491l.977.226c.034-.148.105-.271.216-.359.111-.09.242-.135.392-.135.146 0 .276.043.389.125.113.086.169.207.169.366 0 .109-.022.198-.066.267-.044.066-.103.119-.175.16l-.248.082-.289.021h-.305v.767h.282l.326.026c.108.021.206.051.292.095.085.044.154.104.206.18.052.074.079.168.079.28 0 .105-.021.193-.06.265-.039.07-.089.127-.15.172l-.207.097-.229.032c-.201 0-.366-.057-.495-.167-.129-.11-.215-.238-.257-.384l-.977.256c.058.209.146.388.263.535.117.147.254.271.41.363.157.094.331.164.521.211.19.045.385.068.586.068.205 0 .406-.027.604-.084.198-.057.377-.143.536-.257.159-.114.287-.261.385-.438.099-.177.147-.388.147-.629.001-.125-.02-.242-.062-.354z" fill="#1B2124"/>\n        <path d="M6.5 2.5h9" id="Line" stroke="#1B2124" />\n        <path d="M6.5 12.5h9" id="Line" stroke="#1B2124" />\n        <path d="M6.5 7.5h9" stroke="#1B2124" />\n    </g>\n</svg></button>\n<div class="edy-tb-menucontainer edy-tb-list-indent-tools edy-hide-small">\n  <button class="edy-tb-cmd" data-cmd="outdentlist" title="',I18n.t("texteditor_toolbar.button_outdent_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h12"/>\n        <path d="M10 7.5h7"/>\n        <path d="M10 9.5h7"/>\n        <path d="M10 11.5h7"/>\n        <path d="M10 13.5h7"/>\n        <path d="M5 15.5h12"/>\n    </g>\n    <path d="M8 7.5 L5 10.5 L8 13.5 Z" fill="currentColor"/>\n</svg>\n</button>\n  <button class="edy-tb-cmd" data-cmd="indentlist" title="',I18n.t("texteditor_toolbar.button_indent_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h12"/>\n        <path d="M10 7.5h7"/>\n        <path d="M10 9.5h7"/>\n        <path d="M10 11.5h7"/>\n        <path d="M10 13.5h7"/>\n        <path d="M5 15.5h12"/>\n    </g>\n    <path d="M5 7.5 L8 10.5 L5 13.5 Z" fill="currentColor"/>\n</svg>\n</button>\n</div>\n\n<div class="edy-tb-menucontainer edy-tb-tabletools edy-hide-small">\n  <button class="edy-tb-btn edy-tb-act edy-tb-table edy-tb-g" data-behavior="picktable" title="',I18n.t("texteditor_toolbar.button_table_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(3 3)" fill="#1B2124">\n        <rect width="3" height="3"/>\n        <rect y="4" width="3" height="3"/>\n        <rect y="8" width="3" height="3"/>\n        <rect y="12" width="3" height="3"/>\n        <rect x="4" width="3" height="3"/>\n        <rect x="8" width="3" height="3"/>\n        <rect x="12" width="3" height="3"/>\n        <rect fill-opacity=".5" x="4" y="4" width="3" height="3"/>\n        <rect fill-opacity=".5" x="8" y="4" width="3" height="3"/>\n        <rect fill-opacity=".5" x="12" y="4" width="3" height="3"/>\n        <rect fill-opacity=".5" x="8" y="8" width="3" height="3"/>\n        <rect fill-opacity=".5" x="4" y="8" width="3" height="3"/>\n        <rect fill-opacity=".5" x="4" y="12" width="3" height="3"/>\n        <rect fill-opacity=".5" x="8" y="12" width="3" height="3"/>\n        <rect fill-opacity=".5" x="12" y="12" width="3" height="3"/>\n        <rect fill-opacity=".5" x="12" y="8" width="3" height="3"/>\n    </g>\n</svg>\n</button>\n</div>\n<div class="edy-tb-tabletools edy-tb-table-celltools edy-tb-menucontainer edy-hide-small">\n  <button class="edy-tb-btn edy-tb-act" data-behavior="pickaddcells" title="',I18n.t("texteditor_toolbar.button_add_cells_title"),'"><svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8 6v-5h-2v5h-5v2h5v5h2v-5h5v-2h-5z" fill="currentColor"/>\n</svg>\n</button>\n  <div class="edy-tb-dropdown edy-table-add-picker edy-hidden">\n    <div class="edy-tb-dropdown-content">\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="addtablecells" data-value="above">',I18n.t("texteditor_toolbar.add_row_above"),'</button>\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="addtablecells" data-value="below">',I18n.t("texteditor_toolbar.add_row_below"),'</button>\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="addtablecells" data-value="before">',I18n.t("texteditor_toolbar.add_column_before"),'</button>\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="addtablecells" data-value="after">',I18n.t("texteditor_toolbar.add_column_after"),'</button>\n    </div>\n  </div>\n</div>\n<div class="edy-tb-tabletools edy-tb-table-celltools edy-tb-menucontainer edy-hide-small">\n  <button class="edy-tb-btn edy-tb-act" data-behavior="pickdeletecells" title="',I18n.t("texteditor_toolbar.button_remove_cells_title"),'"><svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">\n    <g id="icon-trashcan-14" pointer-events="none" stroke="currentColor" fill="none">\n        <path d="M8.5 6.5v5" stroke-linecap="round"/>\n        <path d="M5.5 6.5v5" stroke-linecap="round"/>\n        <path d="M2.5 5v8.5h9l0-8.5" stroke-linejoin="round"/>\n        <path d="M5.5.5v1h-4v3h11v-3h-4v-1h-3z" stroke-linejoin="round"/>\n    </g>\n</svg>\n</button>\n  <div class="edy-tb-dropdown edy-table-delete-picker edy-hidden">\n    <div class="edy-tb-dropdown-content">\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="deletetablecells" data-value="row">',I18n.t("texteditor_toolbar.remove_row"),'</button>\n      <button class="edy-tb-cmd edy-tb-menuitem" data-cmd="deletetablecells" data-value="column">',I18n.t("texteditor_toolbar.remove_column"),'</button>\n    </div>\n  </div>\n</div>\n<button class="edy-tb-tabletools edy-tb-table-celltools edy-tb-cmd edy-hide-small" data-cmd="mergetablecells" title="',I18n.t("texteditor_toolbar.button_table_merge_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none">\n        <path d="M6.5 2v-2.5h-7v11.961l7 .039v-2.5" stroke-opacity=".5" stroke="#1B2124" stroke-linejoin="round" transform="translate(2 5)"/>\n        <path d="M10.531 2v-2.481h6.972v11.959h-6.972v-2.478" stroke-opacity=".5" stroke="#1B2124" stroke-linejoin="round" transform="translate(2 5)"/>\n        <path d="M7 11h-3v-1h3v-2l2.978 2.5-2.978 2.5v-2z" fill="#1B2124"/>\n        <path d="M14 11h3v-1h-3v-2l-3 2.492 3 2.492v-1.985z" fill="#1B2124"/>\n    </g>\n</svg>\n</button>\n<button class="edy-tb-act edy-tb-g edy-hide-small" data-behavior="insertmap" title="',I18n.t("texteditor_toolbar.button_map_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <path d="M4 8.729c0 3.164 6 10.271 6 10.271s6-7.107 6-10.271c0-3.164-2.688-5.729-6-5.729-3.313 0-6 2.565-6 5.729zm3.107-.067c0-1.483 1.259-2.686 2.813-2.686 1.555 0 2.812 1.203 2.812 2.686 0 1.483-1.257 2.686-2.812 2.686-1.554 0-2.813-1.203-2.813-2.686z" fill="#1B2124"/>\n</svg>\n</button>\n<div class="edy-tb-menucontainer edy-hide-small"><button class="edy-tb-act" data-behavior="insertembed" title="',I18n.t("texteditor_toolbar.button_video_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(2 6)" fill="#1B2124">\n        <path d="M12 4v2l5 4v-10l-5 4z" id="Shape"/>\n        <path d="M8.5 10h-6c-1.409 0-2.5-1.271-2.5-2.5v-5c0-1.23 1.142-2.5 2.55-2.5h5.95c1.409 0 2.5 1.27 2.5 2.5v5c0 1.229-1.095 2.5-2.5 2.5z"/>\n    </g>\n</svg>\n</button></div>\n<button class="edy-tb-cmd edy-tb-g" data-cmd="source" title="',I18n.t("texteditor_toolbar.button_source_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g transform="translate(0 6)" fill="#1B2124">\n        <path d="M6.314 2.42l-6.314 2.433v1.547l6.314 2.433v-1.671l-3.954-1.523v-.025l3.954-1.523v-1.671z" id="Shape"/>\n        <path d="M7.896 9.568l1.41.432 3.743-9.569-1.42-.431-3.733 9.568z" id="Shape"/>\n        <path d="M13.686 8.833l6.314-2.433v-1.547l-6.314-2.433v1.671l3.957 1.523v.025l-3.957 1.523v1.671z"/>\n    </g>\n</svg>\n</button>\n');
    return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/container_image"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-texteditor-container image-container" contenteditable="false" unselectable="on" style="width: ',container_width,'; max-width: 100%; text-align: left;"'),id&&__p.push(' data-image-id="',id,'"'),__p.push('>\n  <div class="edy-container-resizable-area" style="overflow: hidden;" unselectable="on">\n    <div class="edy-padding-resizer-wrapper" style="padding-bottom: ',height_percent,'%; position: relative;">\n      <picture title="" style="position: absolute; display: block; max-width: none; width: 100%; height: 100%;">\n        <!--[if IE 9]><video style="display: none;"><![endif]-->\n        <source sizes="',viewportsizes,'" srcset="',sizes,'">\n        <!--[if IE 9]></video><![endif]-->\n        <img src="',url,'" title="" alt="" style="position: absolute; max-width: none; width: auto; height: 100%;">\n      </picture>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/container_align_toolbar"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-tb-container-align edy-tb-menucontainer">\n  <button class="edy-tb-act edy-tb-g edy-tb-container-align" data-behavior="pickalign" title="',I18n.t("texteditor_toolbar.button_alignment_title"),'">\n    <span class="edy-left-block"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M4 5.5h11"/>\n        <path d="M4 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M4 11.5h8"/>\n        <path d="M4 13.5h11"/>\n        <path d="M4 15.5h5"/>\n    </g>\n</svg>\n</span>\n    <span class="edy-center"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M6 7.5h9"/>\n        <path d="M4 9.5h13"/>\n        <path d="M7 11.5h7"/>\n        <path d="M5 13.5h11"/>\n        <path d="M8 15.5h5"/>\n    </g>\n</svg>\n</span>\n    <span class="edy-right-block"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M7 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M8 11.5h8"/>\n        <path d="M5 13.5h11"/>\n        <path d="M11 15.5h5"/>\n    </g>\n</svg>\n</span>\n    <span class="edy-left"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <rect x="4.5" y="5.5" width="5" height="4" stroke="currentColor"/>\n    <g fill="none" stroke="currentColor">\n      <path d="M11 5.5h4"/>\n      <path d="M11 7.5h4"/>\n      <path d="M11 9.5h4"/>\n      <path d="M4 11.5h11"/>\n      <path d="M4 13.5h11"/>\n      <path d="M4 15.5h11"/>\n    </g>\n</svg>\n</span>\n    <span class="edy-right"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <rect x="9.5" y="5.5" width="5" height="4" stroke="currentColor"/>\n    <g fill="none" stroke="currentColor">\n      <path d="M4 5.5h4"/>\n      <path d="M4 7.5h4"/>\n      <path d="M4 9.5h4"/>\n      <path d="M4 11.5h11"/>\n      <path d="M4 13.5h11"/>\n      <path d="M4 15.5h11"/>\n    </g>\n</svg></span>\n  </button>\n  <div class="edy-tb-dropdown edy-compact-dropdown edy-tb-container-align-dropdown edy-hidden">\n    <div class="edy-tb-dropdown-content">\n      <div class="edy-tb-menucontainer"><button class="edy-tb-act" data-behavior="alignleft" title="',I18n.t("texteditor_toolbar.button_align_left_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M4 5.5h11"/>\n        <path d="M4 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M4 11.5h8"/>\n        <path d="M4 13.5h11"/>\n        <path d="M4 15.5h5"/>\n    </g>\n</svg>\n</button></div>\n      <div class="edy-tb-menucontainer"><button class="edy-tb-act" data-behavior="aligncenter" title="',I18n.t("texteditor_toolbar.button_align_center_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M6 7.5h9"/>\n        <path d="M4 9.5h13"/>\n        <path d="M7 11.5h7"/>\n        <path d="M5 13.5h11"/>\n        <path d="M8 15.5h5"/>\n    </g>\n</svg>\n</button></div>\n      <div class="edy-tb-menucontainer"><button class="edy-tb-act" data-behavior="alignright" title="',I18n.t("texteditor_toolbar.button_align_right_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" stroke="currentColor">\n        <path d="M5 5.5h11"/>\n        <path d="M7 7.5h9"/>\n        <path d="M4 9.5h12"/>\n        <path d="M8 11.5h8"/>\n        <path d="M5 13.5h11"/>\n        <path d="M11 15.5h5"/>\n    </g>\n</svg>\n</button></div>\n      <div class="edy-tb-menucontainer"><button class="edy-tb-act" data-behavior="floatleft" title="',I18n.t("texteditor_toolbar.button_float_left_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <rect x="4.5" y="5.5" width="5" height="4" stroke="currentColor"/>\n    <g fill="none" stroke="currentColor">\n      <path d="M11 5.5h4"/>\n      <path d="M11 7.5h4"/>\n      <path d="M11 9.5h4"/>\n      <path d="M4 11.5h11"/>\n      <path d="M4 13.5h11"/>\n      <path d="M4 15.5h11"/>\n    </g>\n</svg>\n</button></div>\n      <div class="edy-tb-menucontainer"><button class="edy-tb-act" data-behavior="floatright" title="',I18n.t("texteditor_toolbar.button_float_right_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n  <rect x="9.5" y="5.5" width="5" height="4" stroke="currentColor"/>\n    <g fill="none" stroke="currentColor">\n      <path d="M4 5.5h4"/>\n      <path d="M4 7.5h4"/>\n      <path d="M4 9.5h4"/>\n      <path d="M4 11.5h11"/>\n      <path d="M4 13.5h11"/>\n      <path d="M4 15.5h11"/>\n    </g>\n</svg></button></div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/imageeditor_toolbar"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="edy-tb-menucontainer"><button class="edy-tb-act " data-behavior="insertimagelink" title="',I18n.t("texteditor_toolbar.button_link_title"),'"><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg">\n    <title>\n        Slice 1\n    </title>\n    <g transform="translate(0 4)" fill="none">\n        <g fill="#1C67B2">\n            <path d="M7.946 8.197c-.14-.037-.252-.081-.34-.133-.129-.086-.229-.172-.3-.264-.074-.088-.138-.206-.195-.35l-2.685-6.841h-.453l-1.306 3.315c-.488 1.24-.934 2.358-1.34 3.354-.08.194-.16.346-.244.455-.083.11-.201.214-.352.315-.094.057-.215.106-.361.141l-.37.068v.396h3.032v-.397c-.297-.015-.568-.067-.804-.147-.239-.082-.358-.197-.358-.345l.027-.247.103-.391.18-.536c.066-.194.152-.422.258-.681h2.828l.666 1.776.035.129.011.124c0 .082-.097.15-.292.207-.196.054-.441.091-.737.111v.396h3.349v-.396c-.094-.005-.213-.024-.352-.059zm-5.312-2.787l1.203-3.078 1.221 3.078h-2.424z" id="Shape"/>\n            <path d="M13.559 3.795c-.463-.536-1.037-.805-1.727-.805-.27 0-.543.062-.818.184-.279.123-.537.308-.771.553l-.04-.011v-3.631l-.079-.085-2.055.124v.358l.405.047c.169.024.288.061.36.109.091.057.167.146.225.274.059.126.088.252.088.379v5.459c0 .361-.002.736-.011 1.124-.008.388-.021.722-.04.997l.353.077.419-.644c.262.154.541.279.837.375.295.092.6.139.904.139.699 0 1.314-.28 1.844-.844.529-.562.797-1.258.797-2.085.001-.859-.232-1.557-.691-2.094zm-.92 3.941c-.285.439-.654.659-1.119.659-.207 0-.385-.03-.523-.098-.145-.066-.271-.15-.389-.255-.112-.108-.205-.221-.27-.341-.067-.118-.112-.222-.134-.312v-3.208c.158-.174.337-.314.536-.417.199-.102.43-.153.695-.153.291 0 .541.066.75.201.205.134.375.31.504.525.127.212.223.462.285.75.059.286.09.567.09.843-.002.764-.145 1.366-.425 1.806z" id="Shape"/>\n            <path d="M18.982 8.412c.41-.258.74-.605.99-1.045l-.363-.234c-.213.352-.442.616-.689.792-.247.177-.554.264-.92.264-.508 0-.916-.219-1.229-.658-.312-.438-.47-1.003-.47-1.696 0-.439.046-.817.13-1.134.088-.316.202-.568.342-.754.152-.205.312-.347.478-.423.163-.075.338-.114.521-.114.153 0 .297.02.433.059.134.039.233.116.303.231l-.079.387c-.046.177-.066.349-.066.515 0 .138.061.263.186.374.122.111.294.167.518.167.209 0 .358-.071.451-.214.094-.145.137-.309.137-.495 0-.447-.172-.8-.519-1.059-.343-.259-.79-.388-1.336-.388-.397 0-.765.081-1.103.243-.338.162-.617.375-.842.639-.235.276-.414.582-.535.919-.123.338-.186.699-.186 1.086 0 .891.229 1.601.688 2.13.459.528 1.093.792 1.902.792.428-.001.853-.127 1.258-.384z" id="Shape"/>\n            <rect y="10" width="19.768" height=".562"/>\n        </g>\n        <path d="M15.672 10.839l-4.755-4.682v7.803l2.112-1.562 1.059 2.602 1.587-1.04-1.587-2.081 1.584-1.04zm-4.169 1.777v-5.117l3.119 3.071-3.119 2.046z" fill="#1B2124"/>\n    </g>\n</svg>\n</button></div>\n',align_buttons,'\n<div class="edy-tb-menucontainer"><button class="edy-tb-act edy-tb-g" data-behavior="imageoverlaycolor" title="',I18n.t("imageeditor_toolbar.button_overlay_title"),'"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21">\n    <defs>\n        <filter id="shadow" x="-2" y="-2" width="21" height="28">\n            <feOffset result="offOut" in="SourceGraphic" dx="-1" dy="1"/>\n            <feGaussianBlur result="blurOut" in="offOut" stdDeviation="1"/>\n        </filter>\n    </defs>\n    <circle filter="url(#shadow)" fill="black" cx="11" cy="10" r="8"/>\n    <circle fill="currentColor" cx="10" cy="10" r="8" stroke="white" stroke-width="2"/> \n</svg></button></div>\n<div class="edy-tb-menucontainer"><button class="edy-tb-act edy-tb-g" data-behavior="moveImageCrop" title="',I18n.t("imageeditor_toolbar.reposition"),'"><svg width="23" height="23" viewBox="0 0 23 23" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <defs>\n    <path pointer-events="none" id="arrows" d="m11.5,4 l3,4 l-2,0 l0,7 l2,0 l-3,4 l-3,-4 l2,0 l0,-7 l-2,0 l3,-4z" fill="#1B2124"/>\n  </defs>\n  <use xlink:href="#arrows"/>\n  <use xlink:href="#arrows" transform="rotate(90, 11.5,11.5)"/>\n</svg></button></div>\n<div class="edy-tb-menucontainer"><button class="edy-tb-act edy-tb-g" data-behavior="insertimagetitle" title="',I18n.t("texteditor_toolbar.title"),'"><svg width="13px" height="17px" viewBox="0 0 13 17" xmlns="http://www.w3.org/2000/svg">\n    <g stroke="none" stroke-width="1" fill-rule="evenodd" fill="#1B2124">\n        <path d="M7,15 L4,15 L4,6 L0,6 L0,3 L11,3 L11,6 L7,6 L7,15 Z"></path>\n        <path d="M12,0 L13,0 L13,17 L12,17 L12,0 Z"></path>\n    </g>\n</svg></button></div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/imageeditor_crop_overlay"]=function(obj){var __p=[];with(obj||{})__p.push('<span class="edy-img-crop-overlay-icon"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10 1l4 6h-3v6h3l-4 6-4-6h3v-6h-3l4-6z" fill="currentColor"/>\n</svg>\n</span>\n<span class="edy-img-crop-overlay-text">',I18n.t("imageeditor_toolbar.reposition"),'.</span>\n<a href="#done-image-crop" class="edy-img-crop-overlay-done">',I18n.t("imageeditor_toolbar.done"),"</a>\n");return __p.join("")}}.call(this),function(){Edicy.TextEditorContainerView=Edicy.Backbone.View.extend({initialize:function(){this.editor=null,this.$el.hasClass("embed-container")&&(this.editor=new Edicy.EmbedContainerView({el:this.el}).render()),this.$el.hasClass("image-container")&&(this.editor=new Edicy.ImageEditorView({el:this.el}).render())},remove:function(){this.editor&&this.editor.remove&&this.editor.remove()}})}(),function(e){var t=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i};Edicy.EmbedContainerView=Edicy.Backbone.View.extend({events:{mouseenter:"handleMouseEnter","wysihtml5:uneditable:delete":"remove","texteditor:unloadcontainer":"remove","resizable:resizestart":"handleResizeStart","texteditor:blurcontainer":"hideTools"},initialize:function(){this.sizeEl=this.el.querySelector(".edy-padding-resizer-wrapper"),this.handleDocumentMouseUp=this.handleDocumentMouseUp.bind(this),this.moveDragStartHandler=this.handleMoveDragStart.bind(this),this.viewportResizeHandler=this.handleViewportResize.bind(this),this.docKeyDownHandler=this.handleKeyDown.bind(this),this.createToolbar(),this.fixParameters()},render:function(){return this.createMask(),this.el.setAttribute("contenteditable","false"),this.el.setAttribute("unselectable","on"),this},remove:function(){this.hideMask(),this.resizable&&this.resizable.destroy(),this.hideToolbar(),document.removeEventListener("keydown",this.docKeyDownHandler),this.el.dispatchEvent(new CustomEvent("editorcontainer:deleting",{bubbles:!0,cancelable:!0}))},fixParameters:function(){this.fixMissingYoutubeWmdoe()},fixMissingYoutubeWmdoe:function(){this.$el.find('iframe[src*="youtube"]').each(function(t,i){-1===e(i).attr("src").indexOf("wmode")&&(e(i).attr("src").indexOf("?")>-1?e(i).attr("src",e(i).attr("src")+"&wmode=transparent"):e(i).attr("src",e(i).attr("src")+"?wmode=transparent"))})},passIframeMouseEvent:function(t,i){e(i.contentWindow).on(t,function(e){var n=i.getBoundingClientRect(),o=i.ownerDocument.createEvent("MouseEvent");o.initMouseEvent(t,!0,!0,i.ownerDocument.defaultView,0,n.left+e.clientX,n.top+e.clientY,n.left+e.clientX,n.top+e.clientY,!1,!1,!1,!1,0,null),i.dispatchEvent(o)})},passMouseEvent:function(e,t){var i=t.getBoundingClientRect(),n=document.createEvent("MouseEvent");n.initMouseEvent(e.type,!0,!0,window,0,i.left+e.clientX+window.pageXOffset,i.top+e.clientY+window.pageYOffset,i.left+e.clientX,i.top+e.clientY,!1,!1,!1,!1,0,null),t.dispatchEvent(n)},createIEMaskElement:function(){var t=e("<iframe/>").attr({allowTransparency:"true",scrolling:"no",frameborder:"0"}).addClass("edy-embed-container-mask").get(0);return t.onload=e.proxy(function(){this.passIframeMouseEvent("mousedown",t),this.passIframeMouseEvent("mouseup",t),this.passIframeMouseEvent("mousemove",t),this.passIframeMouseEvent("mouseover",t),this.passIframeMouseEvent("mouseout",t),this.passIframeMouseEvent("click",t)},this),t},createMask:function(){this.mask=/MSIE (\d+\.\d+);/.test(navigator.userAgent)?e(this.createIEMaskElement()):e("<div/>").addClass("edy-embed-container-mask"),this.mask.on("mouseleave",this.handleMouseLeave.bind(this)),this.mask.on("mousedown",this.handleMouseDown.bind(this)),this.mask.on("mouseup",this.handleMaskMouseUp.bind(this)),this.mask.on("click",this.handleMaskClick.bind(this)),Edicy.dragdrop.draggable(this.mask.get(0),{helper:this.getDragProxy,payload:this.getDragPayload.bind(this),droppables:".edy-accepts-embeds",tolerance:"overlap",distance:20}),this.mask.get(0).addEventListener("draggable:dragstart",this.moveDragStartHandler),this.mask.get(0).__relatedContainer=this.el},showMask:function(){this.mask.appendTo(document.body),this.positionMask()},hideMask:function(){this.mask.detach()},positionMask:function(){var e=this.el.getBoundingClientRect();this.mask.css({top:e.top+window.pageYOffset,left:e.left+window.pageXOffset,width:e.width,height:e.height})},getDragProxy:function(){return e("<div/>",{"class":"edy-embed-dragproxy"}).get(0)},getDragPayload:function(){return{type:"embed",element:this.el}},updateResizehandlers:function(){var e=["s"],t=window.getComputedStyle(this.el);"right"===t.cssFloat?(e.push("w"),e.push("sw")):("none"!==t.cssFloat||"auto"!==this.el.style.marginLeft||"auto"===this.el.style.marginRight)&&(e.push("e"),e.push("se")),"none"===t.cssFloat&&"auto"===this.el.style.marginLeft&&(e.push("w"),e.push("sw")),this.resizable.setHandles(e.join(","))},handleResizeStart:function(){this.clickStartedInside=!0,this.initialMarginLeft=this.el.style.marginLeft,this.initialMarginRight=this.el.style.marginRight},resize:function(e){if(!(e.width<10||e.height<10)){this.el.style.marginLeft="",this.el.style.marginRight="";var i,n=window.getComputedStyle(this.el),o=e.width+parseFloat(n.marginLeft),a="bottom"===e.handlerPosition[1]&&["left","right"].indexOf(e.handlerPosition[0])>-1;this.el.classList.contains("edy-positionable-container-maxwidth")&&(this.el.classList.remove("edy-positionable-container-maxwidth"),this.el.classList.add("edy-positionable-container-center")),n=window.getComputedStyle(this.el);var r=parseFloat(n.marginLeft)+parseFloat(n.marginRight)+parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)+parseFloat(n.borderRightWidth)+parseFloat(n.borderLeftWidth);this.el.style.marginLeft=this.initialMarginLeft,this.el.style.marginRight=this.initialMarginRight,o+r>=this.el.parentNode.getBoundingClientRect().width?(this.removePositioningClasses(this.el,"edy-positionable-container-"),this.el.classList.add("edy-positionable-container-maxwidth"),this.el.style.marginLeft="",this.el.style.marginRight="",this.el.style.cssFloat="none",this.el.style.width="auto",this.el.style.display="block"):(this.el.classList.contains("edy-positionable-container-center")&&(this.el.style.marginLeft="auto",this.el.style.marginRight="auto"),this.el.style.width=e.width+"px"),this.updateResizehandlers(),n=window.getComputedStyle(this.el),i=a?e.height/e.width:e.height/parseFloat(n.width),this.el.style.height="",this.sizeEl.style.paddingBottom=t(100*i,2)+"%",this.positionMask(),this.positionToolbar()}},handleMaskClick:function(e){e.stopPropagation(),e.preventDefault(),this.passMouseEvent(e,this.el)},handleMaskMouseUp:function(t){this.resizable||(this.resizable=new Edicy.dragdrop.Resizable(this.el,{handler:"edy-resize-handler",updateDimensions:this.resize.bind(this),aspectRatio:!0,grid:10})),this.resizable.show();var i=document.createEvent("MouseEvents");i.initEvent("mouseup",!0,!0),this.el.dispatchEvent(i),e(document.body).on("mouseup",this.handleDocumentMouseUp),this.passMouseEvent(t,this.el),t.preventDefault(),this.showToolbar(),document.addEventListener("keydown",this.docKeyDownHandler)},handleDocumentMouseUp:function(e){this.clickStartedInside||e.originalEvent.defaultPrevented||e.target===this.el||this.el.contains(e.target)||this.hideTools(),this.clickStartedInside=!1},handleKeyDown:function(e){46===e.keyCode&&(e.preventDefault(),this.remove(),this.el.parentNode&&this.el.parentNode.removeChild(this.el))},hideTools:function(){this.resizable&&(this.resizable.hide(),this.hideToolbar()),e(document.body).off("mouseup",this.handleDocumentMouseUp),document.removeEventListener("keydown",this.docKeyDownHandler)},handleMouseEnter:function(){this.showMask()},handleMouseLeave:function(){this.hideMask()},handleMouseDown:function(e){this.clickStartedInside=!0,this.passMouseEvent(e,this.el)},handleMoveDragStart:function(){this.resizable&&(this.resizable.hide(),this.hideToolbar()),e(document.body).off("mouseup",this.handleDocumentMouseUp),document.removeEventListener("keydown",this.docKeyDownHandler)},removePositioningClasses:function(e,t){for(var i=["left","right","center","left-block","right-block"],n=i.length-1;n>=0;n--)e.classList.remove(t+i[n])},createToolbar:function(){this.toolbar=document.createElement("div"),this.toolbar.className="edy-tb edy-embedcontainer-tb",this.toolbar.innerHTML=JST["admin/templates/container_align_toolbar"](),this.toolbar.addEventListener("click",this.handleToolbarClick.bind(this)),this.toolbar.addEventListener("mousedown",function(e){e.stopPropagation()},!0),this.toolbar.addEventListener("mouseup",function(e){e.stopPropagation()},!0)},showToolbar:function(){this.toolbar&&!this.toolbar.parentNode&&(this.positionToolbar(),document.body.appendChild(this.toolbar)),window.addEventListener("resize",this.viewportResizeHandler),this.updateToolbarStates(),this.el.dispatchEvent(new CustomEvent("editorcontainer:showtoolbar",{bubbles:!0,cancelable:!0}))},hideToolbar:function(){this.toolbar&&this.toolbar.parentNode&&document.body.removeChild(this.toolbar),window.removeEventListener("resize",this.viewportResizeHandler),this.el.dispatchEvent(new CustomEvent("editorcontainer:hidetoolbar",{bubbles:!0,cancelable:!0})),this.alignSideClickHandler&&this.alignSideClickHandler()},handleToolbarClick:function(e){e.preventDefault(),e.stopPropagation();var t,i=Edicy.dom.closest(e.target,".edy-tb-act[data-behavior]");if(i)switch(t=i.dataset?i.dataset.behavior:i.getAttribute("data-behavior")){case"alignleft":this.align("left-block");break;case"aligncenter":this.align("center");break;case"alignright":this.align("right-block");break;case"floatleft":this.align("left");break;case"floatright":this.align("right");break;case"pickalign":this.toggleAlignDropdown()}},toggleAlignDropdown:function(){var e=this.toolbar.querySelector(".edy-tb-container-align-dropdown");e.classList.toggle("edy-hidden"),this.alignSideClickHandler||(this.alignSideClickHandler=function(){e.classList.add("edy-hidden"),document.body.removeEventListener("click",this.alignSideClickHandler),delete this.alignSideClickHandler}.bind(this),this.alignSideClickHandler.bind(this),document.body.addEventListener("click",this.alignSideClickHandler))},handleViewportResize:function(){this.positionToolbar()},positionToolbar:function(){var e=this.el.getBoundingClientRect();this.toolbar.style.left=e.left+window.pageXOffset+"px",this.toolbar.style.top=e.top+window.pageYOffset+"px"},getAlignWrapper:function(){return Edicy.dom.closest(this.el,".edy-texteditor-container-wrapper")||!1},getCurrentAlignment:function(){for(var e=this.getAlignWrapper(),t=e?".edy-texteditor-container-wrapper-":".edy-positionable-container-",i=e||this.el,n=["left","right","center","left-block","right-block"],o=n.length;o--;)if(Edicy.dom.matches(i,t+n[o]))return n[o];return!1},updateToolbarStates:function(){var e,t,i=this.toolbar.querySelector('[data-behavior="pickalign"]'),n=this.getCurrentAlignment(),o=this.getAlignWrapper(),a=o?/.edy-texteditor-container-wrapper-([^$ ]+)/:/edy-positionable-container-([^$ ]+)/;e=this.toolbar.querySelectorAll(".edy-tb-container-align-dropdown .edy-tb-active");for(var r=e.length;r--;)e[r].classList.remove("edy-tb-active");switch(n){case"left-block":this.toolbar.querySelector('[data-behavior="alignleft"]').classList.add("edy-tb-active");break;case"right-block":this.toolbar.querySelector('[data-behavior="alignright"]').classList.add("edy-tb-active");break;case"center":this.toolbar.querySelector('[data-behavior="aligncenter"]').classList.add("edy-tb-active");break;case"left":this.toolbar.querySelector('[data-behavior="floatleft"]').classList.add("edy-tb-active");break;case"right":this.toolbar.querySelector('[data-behavior="floatright"]').classList.add("edy-tb-active")}i.classList.remove("edy-maxwidth"),this.removePositioningClasses(i,"edy-"),a.test((o||this.el).className)&&(t=(o||this.el).className.match(a),t[1]&&i.classList.add("edy-"+t[1]))},align:function(e){-1!==["left","right","center","left-block","right-block"].indexOf(e)&&(this.el.dispatchEvent(new CustomEvent("editorcontainer:align",{bubbles:!0,cancelable:!0,detail:{position:e}})),this.positionToolbar(),this.updateToolbarStates(),this.resizable&&(this.resizable.positionHandlers(),this.updateResizehandlers()),this.alignSideClickHandler&&this.alignSideClickHandler())}})}(Edicy.jQuery),function(){var e=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i};Edicy.ImageEditorView=Edicy.Backbone.View.extend({events:{click:"handleClick","resizable:resizestart":"handleResizeStart","resizable:resizeend":"handleResizeEnd","wysihtml5:uneditable:delete":"remove",mousedown:"handleMouseDown","texteditor:unloadcontainer":"remove","texteditor:blurcontainer":"hideTools"},initialize:function(e){return this.sizeEl=this.el.querySelector(".edy-padding-resizer-wrapper"),this.picture=this.el.querySelector("picture"),this.isValidImage()?(this.bgColorAlphaDefault=e.bgColorAlphaDefault||.25,this.cropDragStartHandler=this.handleCropDragStart.bind(this),this.cropDragEndHandler=this.handleCropDragEnd.bind(this),this.cropDragHandler=this.handleCropDrag.bind(this),this.moveDragStartHandler=this.handleMoveDragStart.bind(this),this.viewportResizeHandler=this.handleViewportResize.bind(this),this.docMouseUpHandler=this.handleSideClickMouseUp.bind(this),this.docKeyDownHandler=this.handleKeyDown.bind(this),this.removeDeprecated(),this.createToolbar(),this.setMoveMode(),(""===this.picture.style.left||""===this.picture.style.top)&&this.centerImage(),void 0):(this.el.parentNode.removeChild(this.el),void 0)},isValidImage:function(){var e,t;return this.picture?this.sizeEl?(e=this.picture.querySelector("source"),t=this.picture.querySelector("img"),e&&e.getAttribute("srcset")||t&&t.getAttribute("src")?!0:!1):!1:!1},remove:function(){this.resizable&&this.resizable.destroy(),document.removeEventListener("mouseup",this.docMouseUpHandler),document.removeEventListener("keydown",this.docKeyDownHandler),this.hideToolbar(),this.hideCropOverlay(),delete this.toolbar,this.el.dispatchEvent(new CustomEvent("editorcontainer:deleting",{bubbles:!0,cancelable:!0}))},setMoveMode:function(){this.removeDraggableObject(),this.cropMode=!1,this.hideCropOverlay(),this.dragObject=new Edicy.dragdrop.Draggable(this.el,{helper:this.getDragHelper.bind(this),payload:this.getDragPayload.bind(this),droppables:".edy-accepts-assets",tolerance:"overlap",distance:20}),this.el.addEventListener("draggable:dragstart",this.moveDragStartHandler),this.updateToolbarStates()},setCropMode:function(){this.removeDraggableObject(),this.dragObject=new Edicy.dragdrop.Draggable(this.sizeEl,{propagate:!1}),this.sizeEl.addEventListener("draggable:dragstart",this.cropDragStartHandler),this.sizeEl.addEventListener("draggable:dragend",this.cropDragEndHandler),this.sizeEl.addEventListener("draggable:drag",this.cropDragHandler),this.cropMode=!0,this.showCropOverlay(),this.updateToolbarStates()},removeDraggableObject:function(){this.dragObject&&(this.sizeEl.removeEventListener("draggable:dragstart",this.cropDragStartHandler),this.sizeEl.removeEventListener("draggable:dragend",this.cropDragEndHandler),this.sizeEl.removeEventListener("draggable:drag",this.cropDragHandler),this.el.removeEventListener("draggable:dragstart",this.moveDragStartHandler),this.dragObject.destroy(),delete this.dragObject)},cropModeToggle:function(){this.cropMode?this.setMoveMode():this.setCropMode()},reInitializeDragMode:function(){this.cropMode?his.setCropMode():this.setMoveMode()},handleMouseDown:function(){this.clickStartedInside=!0,document.removeEventListener("mouseup",this.docMouseUpHandler),document.addEventListener("mouseup",this.docMouseUpHandler)},handleSideClickMouseUp:function(e){this.clickStartedInside||e.defaultPrevented||!this.docMouseUpHandler||e.target===this.el||this.el.contains(e.target)||this.cropOverlay&&this.cropOverlay.contains(e.target)||this.colorModal&&this.colorModal.el.contains(e.target)||(this.setMoveMode(),this.hideTools(),document.removeEventListener("mouseup",this.docMouseUpHandler)),this.clickStartedInside=!1},handleKeyDown:function(e){46===e.keyCode&&(e.preventDefault(),this.remove(),this.el.parentNode&&this.el.parentNode.removeChild(this.el))},handleContainerBlur:function(){this.hideTools(),document.removeEventListener("mouseup",this.docMouseUpHandler)},hideTools:function(){this.resizable&&this.resizable.hide(),this.hideToolbar(),this.hideCropOverlay(),document.removeEventListener("keydown",this.docKeyDownHandler)},handleClick:function(e){Edicy.dom.closestUntil(e.target,this.el,"a")&&e.preventDefault(),this.resizable||(this.resizable=new Edicy.dragdrop.Resizable(this.sizeEl,{handler:"edy-resize-handler",updateDimensions:this.resize.bind(this),aspectRatio:!0,grid:10})),this.updateResizehandlers(),this.resizable.show(),this.showToolbar(),document.addEventListener("keydown",this.docKeyDownHandler)},updateResizehandlers:function(){var e=["s"],t=window.getComputedStyle(this.el);"right"===t.cssFloat?(e.push("w"),e.push("sw")):("none"!==t.cssFloat||"auto"!==this.el.style.marginLeft||"auto"===this.el.style.marginRight)&&(e.push("e"),e.push("se")),"none"===t.cssFloat&&"auto"===this.el.style.marginLeft&&(e.push("w"),e.push("sw")),this.resizable.setHandles(e.join(","))},handleResizeStart:function(){this.clickStartedInside=!0,this.focusPoint=this.getFocusPoint(),this.initialMarginLeft=this.el.style.marginLeft,this.initialMarginRight=this.el.style.marginRight,this.naturalWidth=this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,this.naturalHeight=this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight},handleResizeEnd:function(){this.updateToolbarStates(),this.naturalWidth=void 0,this.naturalHeight=void 0,window.picturefill&&picturefill({reevaluate:!0})},resize:function(t){if(!(t.width<10||t.height<10)){this.el.style.marginLeft="",this.el.style.marginRight="";var i,n=window.getComputedStyle(this.el),o=t.width+parseFloat(n.marginLeft),a="bottom"===t.handlerPosition[1]&&["left","right"].indexOf(t.handlerPosition[0])>-1;this.el.classList.contains("edy-positionable-container-maxwidth")&&(this.el.classList.remove("edy-positionable-container-maxwidth"),this.el.classList.add("edy-positionable-container-center")),n=window.getComputedStyle(this.el);var r=parseFloat(n.marginLeft)+parseFloat(n.marginRight)+parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)+parseFloat(n.borderRightWidth)+parseFloat(n.borderLeftWidth);this.el.style.marginLeft=this.initialMarginLeft,this.el.style.marginRight=this.initialMarginRight,o+r>=this.el.parentNode.getBoundingClientRect().width?(this.removePositioningClasses(this.el,"edy-positionable-container-"),this.el.classList.add("edy-positionable-container-maxwidth"),this.el.style.marginLeft="",this.el.style.marginRight="",this.el.style.cssFloat="none",this.el.style.width="auto",this.el.style.display="block",this.el.querySelector("source").setAttribute("sizes","100vw")):(this.el.classList.contains("edy-positionable-container-center")&&(this.el.style.marginLeft="auto",this.el.style.marginRight="auto"),this.el.style.width=t.width+"px",this.correctSourceSizesAttribute(t.width,t.height)),this.updateResizehandlers(),n=window.getComputedStyle(this.el),i=a?t.height/t.width:t.height/parseFloat(n.width),this.sizeEl.style.paddingBottom=e(100*i,2)+"%",this.setFocusPoint(this.focusPoint),this.positionToolbar()}},correctSourceSizesAttribute:function(e,t){var i=this.el.querySelector("img"),n=i.naturalWidth/i.naturalHeight,o=e/t,a=e*(n/o),r=Math.ceil(Math.max(e,a));this.el.querySelector("source").setAttribute("sizes",isNaN(r)?"100ww":r+"px")},setImgPos:function(e){this.picture.style.width=e.width||this.picture.style.width||"auto",this.picture.style.height=e.height||this.picture.style.height||"auto",this.picture.style.left=e.left||this.picture.style.left||"0",this.picture.style.top=e.top||this.picture.style.top||"0",this.picture.querySelector("img").style.width=e.width||this.picture.style.width||"auto",this.picture.querySelector("img").style.height=e.height||this.picture.style.height||"auto"},getFocusPoint:function(){var e=this.sizeEl.getBoundingClientRect(),t=this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,i=this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight,n=Math.min(t/e.width,i/e.height),o=parseFloat(this.picture.style.top)/100*e.height,a=parseFloat(this.picture.style.left)/100*e.width;return{left:(-1*a+e.width/2)*n,top:(-1*o+e.height/2)*n}},setFocusPoint:function(t){var i=this.sizeEl.getBoundingClientRect(),n=this.naturalWidth||this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,o=this.naturalHeight||this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight,a=i.width/i.height>n/o,r=Math.min(n/i.width,o/i.height),s=-1*(t.top/r-i.height/2),l=-1*(t.left/r-i.width/2),d=100*((i.height-o*(i.width/n))/i.height),c=100*((i.width-n*(i.height/o))/i.width),h=Math.max(100*(s/i.height),d),u=Math.max(100*(l/i.width),c);u=Math.min(u,0),h=Math.min(h,0),this.setImgPos({top:e(h,2)+"%",left:e(u,2)+"%",width:a?"100%":"auto",height:a?"auto":"100%"})},centerImage:function(){var t,i,n=this.sizeEl.getBoundingClientRect(),o=this.naturalWidth||this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,a=this.naturalHeight||this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight;if(!o||0===o){var r=function(){this.picture.removeEventListener("load",r),this.picture.querySelector("img").removeEventListener("load",r),this.centerImage()}.bind(this);return this.picture.addEventListener("load",r),this.picture.querySelector("img").addEventListener("load",r),void 0}n.width/n.height>o/a?(t=100*((n.height-a*(n.width/o))/n.height/2),i={width:"100%",height:"auto",left:0,top:e(t,2)+"%"}):(t=100*((n.width-o*(n.height/a))/n.width/2),i={width:"auto",height:"100%",left:e(t,2)+"%",top:0}),this.setImgPos(i)},getDragHelper:function(e){var t=this.getPhotoByWidth(e.querySelector("picture source").getAttribute("srcset"),96),i=document.createElement("div");
    return i.className="edy-asset-dragproxy",i.style.backgroundImage=t?'url("'+t+'")':"",i},getPhotoByWidth:function(e,t){for(var i,n,o,a,r=e.split(","),s=null,l=r.length;l--;)o=r[l].trim().split(" "),a={url:o[0].trim(),width:parseFloat(o[1].trim().replace("w$",""))},i=a.width-t,(!s||0>n&&i>=0||(n>=0&&i>=0||0>n&&0>i)&&Math.abs(i)<Math.abs(n))&&(s=a.url,n=i);return s},handleMoveDragStart:function(){this.hideTools()},getDragPayload:function(){return{type:"photo",element:this.el}},handleCropDragStart:function(e){e.stopPropagation();var t=e.detail,i=this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,n=this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight;this.dimensions=this.sizeEl.getBoundingClientRect(),this.dragStart={x:t.pageX,y:t.pageY},this.picturePosition={left:parseFloat(this.picture.style.left),top:parseFloat(this.picture.style.top),maxLeft:100*((this.dimensions.width-i*(this.dimensions.height/n))/this.dimensions.width),maxTop:100*((this.dimensions.height-n*(this.dimensions.width/i))/this.dimensions.height)}},handleCropDrag:function(t){t.stopPropagation();var i=t.detail,n={x:i.pageX-this.dragStart.x,y:i.pageY-this.dragStart.y};this.setImgPos({left:e(Math.min(Math.max(this.picturePosition.left+100*(n.x/this.dimensions.width),this.picturePosition.maxLeft),0),2)+"%",top:e(Math.min(Math.max(this.picturePosition.top+100*(n.y/this.dimensions.height),this.picturePosition.maxTop),0),2)+"%"})},handleCropDragEnd:function(e){e.stopPropagation(),e.detail},createToolbar:function(){this.toolbar=document.createElement("div"),this.toolbar.className="edy-tb edy-imagecontainer-tb",this.toolbar.innerHTML=JST["admin/templates/imageeditor_toolbar"]({align_buttons:JST["admin/templates/container_align_toolbar"]()}),this.toolbar.addEventListener("click",this.handleToolbarClick.bind(this)),this.toolbar.addEventListener("mousedown",function(e){e.stopPropagation()},!0),this.toolbar.addEventListener("mouseup",function(e){e.stopPropagation()},!0)},handleToolbarClick:function(e){e.preventDefault(),e.stopPropagation();var t,i=Edicy.dom.closest(e.target,".edy-tb-act[data-behavior]");if(i)switch(this.hideModals(),t=i.dataset?i.dataset.behavior:i.getAttribute("data-behavior")){case"moveImageCrop":this.cropModeToggle();break;case"insertimagelink":this.showLinkEditor();break;case"insertimagetitle":this.showTitleEditor();break;case"imageoverlaycolor":this.showColorPicker();break;case"alignleft":this.align("left-block");break;case"aligncenter":this.align("center");break;case"alignright":this.align("right-block");break;case"floatleft":this.align("left");break;case"floatright":this.align("right");break;case"pickalign":this.toggleAlignDropdown()}},showToolbar:function(){this.toolbar&&!this.toolbar.parentNode&&(this.positionToolbar(),document.body.appendChild(this.toolbar)),window.addEventListener("resize",this.viewportResizeHandler),this.updateToolbarStates(),this.el.dispatchEvent(new CustomEvent("editorcontainer:showtoolbar",{bubbles:!0,cancelable:!0}))},hideToolbar:function(){this.toolbar&&this.toolbar.parentNode&&document.body.removeChild(this.toolbar),window.removeEventListener("resize",this.viewportResizeHandler),this.el.dispatchEvent(new CustomEvent("editorcontainer:hidetoolbar",{bubbles:!0,cancelable:!0})),this.alignSideClickHandler&&this.alignSideClickHandler(),this.hideModals()},hideModals:function(){this.hideTitleEditor(),this.hideColorPicker(),this.hideLinkEditor(),this.hideAlignDropdown()},toggleAlignDropdown:function(){var e=this.toolbar.querySelector(".edy-tb-container-align-dropdown");e.classList.toggle("edy-hidden"),this.alignSideClickHandler||(this.alignSideClickHandler=function(){e.classList.add("edy-hidden"),document.body.removeEventListener("click",this.alignSideClickHandler),delete this.alignSideClickHandler}.bind(this),this.alignSideClickHandler.bind(this),document.body.addEventListener("click",this.alignSideClickHandler))},hideAlignDropdown:function(){if(this.toolbar){var e=this.toolbar.querySelector(".edy-tb-container-align-dropdown");e&&(e.classList.add("edy-hidden"),this.alignSideClickHandler&&(document.body.removeEventListener("click",this.alignSideClickHandler),delete this.alignSideClickHandler))}},handleViewportResize:function(){this.positionToolbar()},positionToolbar:function(){var e=this.el.getBoundingClientRect();this.toolbar.style.left=e.left+window.pageXOffset+"px",this.toolbar.style.top=e.top+window.pageYOffset+"px",this.updateCropOverlay()},getAlignWrapper:function(){return Edicy.dom.closest(this.el,".edy-texteditor-container-wrapper")||!1},getCurrentAlignment:function(){for(var e=this.getAlignWrapper(),t=e?".edy-texteditor-container-wrapper-":".edy-positionable-container-",i=e||this.el,n=["left","right","center","left-block","right-block"],o=n.length;o--;)if(Edicy.dom.matches(i,t+n[o]))return n[o];return!1},updateToolbarStates:function(){var e,t,i=this.toolbar.querySelector('[data-behavior="pickalign"]'),n=this.getCurrentAlignment(),o=this.getAlignWrapper(),a=o?/.edy-texteditor-container-wrapper-([^$ ]+)/:/edy-positionable-container-([^$ ]+)/;this.toolbar.querySelector('[data-behavior="insertimagelink"]').classList[this.hasLink()?"add":"remove"]("edy-tb-active"),this.toolbar.querySelector('[data-behavior="insertimagetitle"]').classList[this.hasTitle()?"add":"remove"]("edy-tb-active"),this.toolbar.querySelector('[data-behavior="moveImageCrop"]').classList[this.cropMode?"add":"remove"]("edy-tb-active"),this.toolbar.querySelector('[data-behavior="imageoverlaycolor"]').style.color=this.el.style.backgroundColor||"",e=this.toolbar.querySelectorAll(".edy-tb-container-align-dropdown .edy-tb-active");for(var r=e.length;r--;)e[r].classList.remove("edy-tb-active");switch(n){case"left-block":this.toolbar.querySelector('[data-behavior="alignleft"]').classList.add("edy-tb-active");break;case"right-block":this.toolbar.querySelector('[data-behavior="alignright"]').classList.add("edy-tb-active");break;case"center":this.toolbar.querySelector('[data-behavior="aligncenter"]').classList.add("edy-tb-active");break;case"left":this.toolbar.querySelector('[data-behavior="floatleft"]').classList.add("edy-tb-active");break;case"right":this.toolbar.querySelector('[data-behavior="floatright"]').classList.add("edy-tb-active");break;default:this.toolbar.querySelector('[data-behavior="alignleft"]').classList.add("edy-tb-active")}i.classList.remove("edy-maxwidth"),this.removePositioningClasses(i,"edy-"),a.test((o||this.el).className)?(t=(o||this.el).className.match(a),t[1]&&i.classList.add("edy-"+t[1])):i.classList.add("edy-left-block")},hasTitle:function(){return!!this.picture.getAttribute("title")},hasLink:function(){return this.picture&&"a"===this.picture.parentNode.tagName.toLowerCase()},removePositioningClasses:function(e,t){for(var i=["left","right","center","left-block","right-block"],n=i.length-1;n>=0;n--)e.classList.remove(t+i[n])},align:function(e){-1!==["left","right","center","left-block","right-block"].indexOf(e)&&(this.el.dispatchEvent(new CustomEvent("editorcontainer:align",{bubbles:!0,cancelable:!0,detail:{position:e}})),this.positionToolbar(),this.updateToolbarStates(),this.resizable&&(this.resizable.positionHandlers(),this.updateResizehandlers()),this.alignSideClickHandler&&this.alignSideClickHandler())},createColorPicker:function(){this.colorPicker=new Edicy.ColorpickerView({showAlpha:!0,initialAlpha:this.bgColorAlphaDefault}).render(),this.colorPicker.on("colorchange",this.handleColorChange.bind(this)),this.colorModal=new Edicy.PopoverView({parent:Edicy.dom.closest(this.toolbar.querySelector('[data-behavior="imageoverlaycolor"]'),".edy-tb-menucontainer"),arrow:"big",containerClass:"edy-img-color-picker",body:'<div class="edy-img-color-picker-inner"></div>'}).render(),this.colorModal.el.querySelector(".edy-img-color-picker-inner").appendChild(this.colorPicker.el)},showColorPicker:function(){var e=this.el.style.backgroundColor,t=this.picture.style.opacity?Math.round(100*(1-this.picture.style.opacity))/100:this.bgColorAlphaDefault;this.colorModal||this.createColorPicker(),this.colorPicker.setValue(e,t),this.colorModal.toggle()},hideColorPicker:function(){this.colorModal&&this.colorModal.hide()},handleColorChange:function(e,t,i){var n,o;this.el.classList.remove("image-container-light"),this.el.classList.remove("image-container-dark"),this.el.classList.remove("image-container-has-background"),i&&Object.getOwnPropertyNames(i).length>0?(n="rgb("+[i.r,i.g,i.b].join(",")+")","grid"===t&&0===i.a?(o=1-this.bgColorAlphaDefault,setTimeout(function(){this.colorPicker.setValue(n,1-o)}.bind(this))):o=1-i.a,this.picture.style.opacity=o,i.lightness>.5?this.el.classList.add("image-container-light"):this.el.classList.add("image-container-dark"),this.el.classList.add("image-container-has-background")):(n="rgba(0,0,0,0)",this.picture.style.opacity=1,setTimeout(function(){this.colorPicker.setValue(n,0)}.bind(this))),this.el.style.backgroundColor=n,this.updateToolbarStates()},createTitleEditor:function(){return this.titleeditor=new Edicy.StringValueEditorView({parent:Edicy.dom.closest(this.toolbar.querySelector('[data-behavior="insertimagetitle"]'),".edy-tb-menucontainer"),placeholder:I18n.t("imageeditor_toolbar.type_title_here"),initialValue:this.picture.getAttribute("alt")}).render(),this.titleeditor.on("stringvalue:change",this.handleTitleChange.bind(this)),this.titleeditor.on("stringvalue:btnclick:showtitle",this.handleShowTitleToggle.bind(this)),this.updateTitleVisibleState(),this.titleeditor},showTitleEditor:function(){(this.titleeditor||this.createTitleEditor()).toggle()},hideTitleEditor:function(){this.titleeditor&&this.titleeditor.hide()},handleTitleChange:function(e){this.picture.setAttribute("alt",e),this.picture.setAttribute("title",e),this.picture.querySelector("img").alt=e,this.picture.querySelector("img").title=e,e?this.el.setAttribute("data-title",e):"undefined"!=typeof this.el.getAttribute("data-title")&&this.el.removeAttribute("data-title"),this.updateToolbarStates()},handleShowTitleToggle:function(){this.el.classList.toggle("edy-image-container-with-title"),this.updateTitleVisibleState()},updateTitleVisibleState:function(){this.titleeditor&&(this.el.classList.contains("edy-image-container-with-title")?this.titleeditor.setBtnActivity("showtitle",!0):this.titleeditor.setBtnActivity("showtitle",!1))},createLinkEditor:function(){var e=Edicy.dom.closest(this.toolbar.querySelector('[data-behavior="insertimagelink"]'),".edy-tb-menucontainer");this.linkeditor=new Edicy.LinkEditorView({parent:e,relative:!0,collection:new Edicy.SearchCollection}).render(),this.linkeditor.on("item:selected",function(e,t){!e.url||/^\s*$/.test(e.url)?this.removeLink():this.insertLink(e,t)},this)},showLinkEditor:function(){this.linkeditor||this.createLinkEditor(),this.setLinkUrl(),this.linkeditor.toggle(),this.linkeditor.isVisible()&&this.linkeditor.focus()},hideLinkEditor:function(){this.linkeditor&&this.linkeditor.hide()},removeLink:function(){if(this.hasLink()){var e=this.picture.parentNode;e.parentNode.insertBefore(this.picture,e),e.parentNode.removeChild(e),this.updateToolbarStates()}},insertLink:function(e,t){var i,n=document.location.protocol+"//"+punycode.toASCII(document.location.hostname),o=document.location.protocol+"//"+punycode.toUnicode(document.location.hostname),a=e.url.replace(o,"").replace(n,"");this.hasLink()?(i=this.picture.parentNode,i.href=a,i.title=e.title):(i=document.createElement("a"),i.href=a,i.title=e.title,this.picture.parentNode.insertBefore(i,this.picture),i.appendChild(this.picture)),i.target=t&&t.target||"",this.updateToolbarStates()},setLinkUrl:function(){this.hasLink()?this.linkeditor.setLink(this.picture.parentNode):this.linkeditor.setLink(!1)},removeDeprecated:function(){var e,t,i,n,o,a,r=this.el.querySelector(".edy-image-container-title"),s=this.el.querySelector(".edy-container-resizable-area"),l=this.el.querySelector(".edy-padding-resizer-wrapper img");if(s&&(this.el.style.overflow="hidden",this.el.style.position="relative",s.parentNode.insertBefore(this.sizeEl,s),s.parentNode.removeChild(s)),r&&(r.parentNode.removeChild(r),this.el.setAttribute("data-title",this.picture.getAttribute("title"))),this.el.getAttribute("data-original-size")&&this.el.removeAttribute("data-original-size"),this.el.classList.contains("draggable-container")&&this.el.classList.remove("draggable-container"),this.sizeEl.style.overflow="hidden",e=document.location.protocol+"//"+punycode.toASCII(document.location.hostname),t=document.location.protocol+"//"+punycode.toUnicode(document.location.hostname),a=this.el.querySelector("picture source"),i=a?a.getAttribute("srcset"):"",n=i,o=l?(l.getAttribute("src")||"").trim():"",o&&(0===o.indexOf(t)?l.setAttribute("src",o.replace(t,"")):0===o.indexOf(e)&&l.setAttribute("src",o.replace(e,""))),n){for(;n.indexOf(t)>-1;)n=n.replace(t,"");for(;n.indexOf(e)>-1;)n=n.replace(e,"");n&&n!==i&&this.el.querySelector("picture source").setAttribute("srcset",n),n.match(/[^\s]*/)&&(l?o||l.setAttribute("src",n.match(/[^\s]*/)[0]):(l=document.createElement("img"),l.setAttribute("style","position: absolute; max-width: none; width: auto; height: 100%;"),this.picture.appendChild(l),l.setAttribute("src",n.match(/[^\s]*/)[0])))}},showCropOverlay:function(){this.cropOverlay||(this.cropOverlay=document.createElement("div"),this.cropOverlay.className="edy-img-crop-overlay",this.cropOverlay.innerHTML=JST["admin/templates/imageeditor_crop_overlay"](),this.cropOverlay.querySelector(".edy-img-crop-overlay-done").addEventListener("click",this.handleCropDoneClick.bind(this))),document.body.appendChild(this.cropOverlay),this.updateCropOverlay()},handleCropDoneClick:function(e){e.preventDefault(),this.setMoveMode()},hideCropOverlay:function(){this.cropOverlay&&this.cropOverlay.parentNode&&this.cropOverlay.parentNode.removeChild(this.cropOverlay)},updateCropOverlay:function(){if(this.cropOverlay&&this.cropOverlay.parentNode){var e,t=this.sizeEl.getBoundingClientRect(),i=this.picture.naturalWidth||this.picture.querySelector("img").naturalWidth,n=this.picture.naturalHeight||this.picture.querySelector("img").naturalHeight;t.width/t.height<i/n?this.cropOverlay.classList.add("edy-crop-horizontal"):this.cropOverlay.classList.remove("edy-crop-horizontal"),this.cropOverlay.querySelector(".edy-img-crop-overlay-icon").style.display="inline-block",this.cropOverlay.querySelector(".edy-img-crop-overlay-text").style.display="inline-block",e=this.cropOverlay.getBoundingClientRect(),t.width<e.width&&(this.cropOverlay.querySelector(".edy-img-crop-overlay-text").style.display="none",this.cropOverlay.querySelector(".edy-img-crop-overlay-icon").style.display="none"),this.cropOverlay.style.left=t.left+t.width/2+window.pageXOffset+"px",this.cropOverlay.style.top=t.top+t.height/2+window.pageYOffset+"px"}}})}(),function(){Edicy.StringValueEditorView=Edicy.Backbone.View.extend({events:{"keydown input":"handleInputKeyDown","input input":"handleInput",mouseup:"handleBtnMouseUp","click .edy-tibtns button":"handleBtnClick"},popoverOptions:{containerClass:"edy-string-value-editor",body:JST["admin/templates/string_value_editor"],propagateClicks:!1,changeOrientation:!0,orientation:"right"},initialize:function(e){this.value=e.initialValue||"",this.on("edicy:popover:opened",this.handlePopoverOpen.bind(this))},render:function(){return this.input=this.el.querySelector("input"),this.input.placeholder=this.options.placeholder,this.input.value=this.value,this},handleInputKeyDown:function(e){(13===e.which||27===e.which)&&(e.preventDefault(),this.hide())},handlePopoverOpen:function(){this.el.querySelector(".edy-tibtns").getBoundingClientRect(),this.strechInput(!0),this.el.querySelector("input").focus()},handleInput:function(){this.strechInput(),this.triggerValueChange()},strechInput:function(e){e&&(this.input.style.width="auto");var t,i=window.getComputedStyle(this.input),n=i.width,o=this.input.style.width;this.input.style.width="auto",i=window.getComputedStyle(this.input),t=this.input.scrollWidth+parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)+30,this.input.style.width=t>parseFloat(n)?t+"px":t-30<parseFloat(n)?t+"px":o},triggerValueChange:function(){this.value!==this.input.value&&(this.value=this.input.value,this.trigger("stringvalue:change",this.input.value))},setValue:function(e){this.value=e,this.el.querySelector("input").value=this.value},handleBtnClick:function(e){e.preventDefault(),e.stopPropagation();var t=Edicy.dom.closest(e.target,"button").getAttribute("data-behavior");this.trigger("stringvalue:btnclick:"+t)},handleBtnMouseUp:function(e){e.stopPropagation()},setBtnActivity:function(e,t){var i=this.el.querySelector('.edy-tibtns button[data-behavior="'+e+'"]');i&&(t?i.classList.add("edy-btn-active"):i.classList.remove("edy-btn-active"))}}),Edicy.Backbone.mixin(Edicy.StringValueEditorView,Edicy.PopoverViewMixin)}(),function(e,t){Edicy.TableEditorMixin={events:{"command:createtable":"createTable","command:addtablecells":"addTableCells","command:deletetablecells":"deleteTableCells","command:mergetablecells":"mergeTableCells","command:tablecellvalign":"tableCellValign","command:tableheadercell":"tableCellHeader","behavior:deletecellsover":"handleDeleteCellsOver","behavior:deletecellsout":"handleDeleteCellsOut","behavior:addcellsover":"handleAddCellsOver","behavior:addcellsout":"handleAddCellsOut"},initializeInteractions:function(){t.bindAll(this,"handleCellResizeStart","handleCellResizeEnd"),this.editor.on("tableselectstart",this.handleTableSelect.bind(this)),this.editor.on("tableselectchange",this.handleTableSelect.bind(this)),this.editor.on("tableselect",this.handleTableSelect.bind(this)),this.editor.on("tableunselect",this.handleTableUnSelect.bind(this))},handleEditorInteraction:function(){this.updateCellResize()},handleTableSelect:function(){var e=this.editor.composer.tableSelection;this.toolbar.setMergeState(e,this.editor.composer.commands.state("mergeTableCells")),this.toolbar.showCellTools(),this.toolbar.setTabletoolsStates(this.getCellStates(e)),1===e.cells.length?this.showCellResize(e.start):this.hideCellResize(),this.editor.fire("interaction")},handleTableUnSelect:function(){this.toolbar.hideCellTools(),this.hideCellResize(),this.editor.fire("interaction")},getCellStates:function(t){var i="bottom";return t&&t.start&&(e(t.start).attr("valign")?i=e(t.start).attr("valign"):e(t.start).css("vertical-align")&&(i=e(t.start).css("vertical-align"))),{valign:i}},handleDeleteCellsOver:function(e,t){var i,n=this.editor.composer.tableSelection;i="row"==t?this.$(wysihtml5.dom.table.findRowByCell(n.start)):this.$(wysihtml5.dom.table.findColumnByCell(n.start)),this.$(n.table).find("td, th").removeClass("edy-tmp-delete-marked-cell"),i.addClass("edy-tmp-delete-marked-cell")},handleDeleteCellsOut:function(){var e=this.editor.composer.tableSelection;this.$(e.table).find("td, th").removeClass("edy-tmp-delete-marked-cell")},handleAddCellsOver:function(e,i){var n,o=this.editor.composer.tableSelection,a=t.contains(["after","below"],i)?o.end:o.start;n=t.contains(["before","after"],i)?this.$(wysihtml5.dom.table.findColumnByCell(a)):this.$(wysihtml5.dom.table.findRowByCell(a)),this.$(o.table).find("td, th").removeClass(["before","after","below","above"].map(function(e){return"edy-tmp-add"+e+"-marked-cell"}).join(" ")),n.addClass("edy-tmp-add"+i+"-marked-cell")},handleAddCellsOut:function(){var e=this.editor.composer.tableSelection;this.$(e.table).find("td, th").removeClass(["before","after","below","above"].map(function(e){return"edy-tmp-add"+e+"-marked-cell"}).join(" "))},addTableCells:function(e,t){this.editor.composer.commands.exec("addTableCells",t)},createTable:function(e,t){this.restoreSelection()&&this.editor.composer.commands.exec("createTable",t)},deleteTableCells:function(e,t){this.editor.composer.commands.exec("deleteTableCells",t)},mergeTableCells:function(e,t){this.editor.composer.commands.exec("mergeTableCells",t),this.handleTableSelect()},tableCellValign:function(t,i){this.editor.composer.tableSelection&&(i===this.getCellStates(this.editor.composer.tableSelection).valign?e(this.editor.composer.tableSelection.cells).removeAttr("valign",i).css("vertical-align",""):e(this.editor.composer.tableSelection.cells).attr("valign",i),this.toolbar.setTabletoolsStates(this.getCellStates(this.editor.composer.tableSelection)),this.editor.fire("interaction"))},tableCellHeader:function(){var t=this.editor.composer.tableSelection;if(t){var i=e(t.cells).is("th")?"td":"th";e(t.cells).replaceWith(function(){var t=e("<"+i+"/>").append(e(this).contents());return e.each(this.attributes,function(i,n){e(t).attr(n.name,n.value)}),t})}},showCellResize:function(e){this.resizableCell!=e&&(this.hideCellResize(),this.resizableCell||(this.resizable=new Edicy.dragdrop.Resizable(e,{handler:"edy-resize-handler",handles:"e,s",propagatePointerEvents:!1,validateDimensions:this.validateCellDimensions,updateDimensions:this.updateCellDimensions.bind(this)}),e.addEventListener("resizable:resizestart",this.handleCellResizeStart),e.addEventListener("resizable:resizeend",this.handleCellResizeEnd),this.resizable.show(),this.resizableCell=e))},hideCellResize:function(){this.resizable&&(this.resizable.destroy(),this.resizable.el.removeEventListener("resizable:resizestart",this.handleCellResizeStart),this.currentResizeCell=null),this.resizableCell=null},handleCellResizeStart:function(){e("body").on("click",this.blockPointerEventsPropagation),this.deactivateUneditables();var t=this.resizable.el,i=e(t).closest("table"),n=this.getCellIndex(t),o=n.column+(t.colSpan||1)-1,a=this.findColResizeCell(i,o),r=n.row+(t.rowSpan||1)-1,s=this.findRowResizeCell(i,r);this.currentResizeCell={rowCell:s,height:e(s).height(),colCell:a,width:e(a).width()}},handleCellResizeEnd:function(){t.defer(function(){e("body").off("click",this.blockPointerEventsPropagation)}.bind(this))},blockPointerEventsPropagation:function(e){e.originalEvent.stopPropagation()},updateCellResize:function(){this.resizable&&this.resizable.positionHandlers()},validateCellDimensions:function(e){return e.initialHeight!=e.height?e.height>10:e.initialWidth!=e.width?e.width>10:!0},updateCellDimensions:function(t){if(this.resizableCell){var i=e(this.resizableCell);t.handlerPosition.indexOf("right")>-1&&t.initialWidth!=t.width&&this.setColWidth(this.resizableCell,t.width-(i.outerWidth()-parseFloat(window.getComputedStyle(this.resizableCell).width))),t.handlerPosition.indexOf("bottom")>-1&&t.initialHeight!=t.height&&this.changeRowHeight(t.height-t.initialHeight)}},updateToRealCellWidths:function(e){var t=[];e.each(function(e,i){t[e]=parseFloat(window.getComputedStyle(i).width)}),e.each(function(e,i){i.style.width=t[e]+"px"})},getMaxColumnIndex:function(t){var i=e(t).find("tr").not(e(t).find("table tr")).eq(0),n=i.children("td, th").last();return this.getCellIndex(n.get(0)).column+(n.get(0).colSpan||1)-1},getCellIndex:function(t){for(var i,n,o,a,r,s=e(t).closest("table").get(0),l=[],d=0,c=s.rows.length;c>d;d++)for(i=0,o=s.rows[d].cells.length;o>i;i++){for(n=i;l[d]&&l[d][n];n++);for(r=n;r<n+s.rows[d].cells[i].colSpan;r++)for(a=d;a<d+s.rows[d].cells[i].rowSpan;a++)l[a]||(l[a]=[]),l[a][r]=!0;if(t===s.rows[d].cells[i])return{row:d,column:n}}},findColResizeCell:function(t,i){var n,o,a=e(t).find("tr").not(e(t).find("table tr"));return this.getMaxColumnIndex(t),a.each(function(t,a){var r,s=e(a).children("td, th");return s.each(function(e,t){return r=this.getCellIndex(t).column,r===i?(t.colSpan<2&&(n=t),(!o||o.colSpan>t.colSpan)&&(o=t),!1):r>i?!1:void 0}.bind(this)),n?!1:void 0}.bind(this)),n||o},findAllColResizeCells:function(e){for(var t=this.getMaxColumnIndex(e),i=[],n=0;t>=n;n++)i.push(this.findColResizeCell(e,n));return i},findRowResizeCell:function(t,i){var n,o,a=e(t).get(0).rows[i];if(a)for(var r=0,s=a.cells.length;s>r;r++){if(a.cells[r].rowSpan<2)return a.cells[r];(!o||a.cells[r].rowSpan<o)&&(n=a.cells[r],o=n.rowSpan)}return n},fixTableWidths:function(t){if(t){var i=e(this.findAllColResizeCells(e(t)));this.updateToRealCellWidths(i)}},setColWidth:function(t,i){var n,o=i-parseFloat(window.getComputedStyle(t).width),a=e(t).closest("table"),r=this.getCellIndex(t).column+(t.colSpan||1)-1,s=e(this.findColResizeCell(a,r)),l=e(this.findAllColResizeCells(a)),d=s.get(0)===l.last().get(0),c=l.index(s),h=[],u=!1,m=!1;i>0&&(a.css("max-width","100%"),l.each(function(e,t){h[e]=parseFloat(window.getComputedStyle(t).width)}),d?(n=a.get(0).getBoundingClientRect().width,n+o>=this.$el.width()&&(o=this.$el.width()-n),a.find("tr").not(a.find("table tr")).children("td, th").removeAttr("width").css("width",""),0>o&&(a.removeAttr("width").css("width",""),s.width(Math.max(h[c]+o,0)),o=s.width()-h[c]),a.removeAttr("width").css("width",n+o),h[c]=h[c]+o):(a.find("tr").not(a.find("table tr")).children("td, th").removeAttr("width").css("width",""),u=parseInt(l.eq(c).attr("colspan")||1,10)>1,m=parseInt(l.eq(c+1).attr("colspan")||1,10)>1,o>0&&!m||0>o&&u?(l.eq(c+1).width(Math.max(h[c+1]-o,0)),o=h[c+1]-l.eq(c+1).width()):0>o&&(l.eq(c).width(Math.max(h[c]+o,0)),o=l.eq(c).width()-h[c]),h[c]=h[c]+o,h[c+1]=h[c+1]-o),l.each(function(t,i){e(i).width(h[t])}),this.updateToRealCellWidths(l),a.width()>=this.$el.width()?a.removeAttr("width").css({width:"100%"}).addClass("edy-table-maxwidth"):a.removeClass("edy-table-maxwidth"))},changeRowHeight:function(t){this.currentResizeCell&&this.currentResizeCell.rowCell&&(e(e(this.currentResizeCell.rowCell).closest("tr").get(0).cells).css("height","").removeAttr("height"),e(this.currentResizeCell.rowCell).removeAttr("height").height(Math.max(this.currentResizeCell.height+t,10)))}}}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.TableToolbarMixin={events:{'click .edy-tb-act[data-behavior="picktable"]':"handleTablePickClick",'click .edy-tb-act[data-behavior="pickaddcells"]':"handleCellsAddClick",'click .edy-tb-act[data-behavior="pickdeletecells"]':"handleCellsDeleteClick",'click .edy-tb-act[data-behavior="picktablecellvalign"]':"handleCellsValignDropClick",'mouseover .edy-tb-cmd[data-cmd="deletetablecells"] ':"handleCellsDeleteOver",'mouseout .edy-tb-cmd[data-cmd="deletetablecells"] ':"handleCellsDeleteOut",'mouseover .edy-tb-cmd[data-cmd="addtablecells"] ':"handleCellsAddOver",'mouseout .edy-tb-cmd[data-cmd="addtablecells"] ':"handleCellsAddOut"},showCellTools:function(){this.$(".edy-tb-tabletools").addClass("edy-tb-table-active"),this.setPosition()},hideCellTools:function(){this.$(".edy-tb-table-active").removeClass("edy-tb-table-active"),this.setPosition()},setMergeState:function(e,t){this.$('.edy-tb-cmd[data-cmd="mergetablecells"]').removeClass("edy-tb-active").removeAttr("disabled"),t?this.$('.edy-tb-cmd[data-cmd="mergetablecells"]').addClass("edy-tb-active"):e.start!==e.end&&wysihtml5.dom.table.canMerge(e.start,e.end)||this.$('.edy-tb-cmd[data-cmd="mergetablecells"]').attr("disabled","disabled")},handleTablePickClick:function(){this.tablepicker||(this.tablepicker=(new Edicy.TablepickerView).render(),this.tablepicker.on("pick",this.handleTablePickerPick,this),this.$('.edy-tb-act[data-behavior="picktable"]').closest("div").append(this.tablepicker.el)),this.tablepicker.toggle()},handleTablePickerPick:function(e){this.$parent.trigger("command:createtable",e)},handleCellsAddClick:function(e){this.toggleDropdown(e.target,".edy-table-add-picker")},handleCellsDeleteClick:function(e){this.toggleDropdown(e.target,".edy-table-delete-picker")},handleCellsValignDropClick:function(e){this.toggleDropdown(e.target,".edy-valign-dropdown")},handleCellsDeleteOver:function(t){var i=e(t.target).closest("button").data("value");this.$parent.trigger("behavior:deletecellsover",i)},handleCellsDeleteOut:function(){this.$parent.trigger("behavior:deletecellsout")},handleCellsAddOver:function(t){var i=e(t.target).closest("button").data("value");this.$parent.trigger("behavior:addcellsover",i)},handleCellsAddOut:function(){this.$parent.trigger("behavior:addcellsout")},setTabletoolsStates:function(e){e.valign?this.$(".edy-tb-valigncombo-btn").removeClass("edy-tb-valign-top edy-tb-valign-middle edy-tb-valign-bottom").addClass("edy-tb-valign-"+e.valign):this.$(".edy-tb-valigncombo-btn").removeClass("edy-tb-valign-top edy-tb-valign-middle").addClass("edy-tb-valign-bottom")}}}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.TablepickerView=Edicy.Backbone.View.extend({tagName:"div",className:"edy-tb-dropdown edy-tablepicker edy-hidden",events:{"click .edy-tablepicker-grid .edy-tablepicker-row div":"handleCellClick","mouseover .edy-tablepicker-grid .edy-tablepicker-row div":"handleCellOver","mousedown .edy-colorpicker-colors div":"handleMousedown"},initialize:function(e){this.options=e},render:function(){return this.$wrap=e("<div/>").addClass("edy-tb-dropdown-content"),this.$grid=e("<div/>").addClass("edy-tablepicker-grid"),this.$sizeInfo=e("<div/>").addClass("edy-tablepicker-size-info"),this.$wrap.append(this.$grid,this.$sizeInfo),this.$el.append(this.$wrap),this},toggle:function(){this.el.classList.contains("edy-hidden")?this.show():this.hide()},show:function(){this.$grid.html(this.getGrid(5,5)),this.setSizeInfo(),this.el.classList.remove("edy-hidden"),e(document.body).one("click",this.hide.bind(this))},hide:function(){this.el.classList.add("edy-hidden")},handleMousedown:function(e){e.preventDefault()},handleCellClick:function(t){this.trigger("pick",e.extend({tableStyle:"width: 100%"},this.getTargetPos(t.target))),this.hide()},handleCellOver:function(e){var t=this.getTargetPos(e.target),i=this.$(".edy-tablepicker-row").length,n=this.$(".edy-tablepicker-row:first div").length;this.$(".edy-tablepicker-row div").removeClass("edy-tablepicker-cell-active"),this.$(".edy-tablepicker-row:lt("+t.rows+")").find("div:lt("+t.cols+")").addClass("edy-tablepicker-cell-active"),t.cols===n&&this.addColumn(),t.rows===i&&this.addRow(),this.setSizeInfo(t.rows,t.cols)},addRow:function(){var e=this.$(".edy-tablepicker-row:first div").length,t='<div class="edy-tablepicker-row">'+new Array(e+1).join("<div></div>")+"</div>";this.$(".edy-tablepicker-grid").append(t)},addColumn:function(){this.$(".edy-tablepicker-row").append("<div/>")},getTargetPos:function(t){return{cols:e(t).parent().find("div").index(t)+1,rows:e(t).parent().parent().find(".edy-tablepicker-row").index(e(t).parent())+1}},getGrid:function(e,t){var i=new Array(t+1).join("<div></div>"),n=new Array(e+1).join('<div class="edy-tablepicker-row">'+i+"</div>");return n},setSizeInfo:function(e,t){this.$sizeInfo.html(e&&t?e+" × "+t:"")}})}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.LinkEditorView=Edicy.ItemPickerView.extend({setLink:function(t){if(this.collection.reset(),t){var i=decodeURI(e(t).attr("href"));this.$('input[name="query"]').val(i),this.collection.addExisting(i),this.rememberInputValue(),this.$('[data-behavior="insert"]').hide(),this.$('[data-behavior="change"]').hide(),this.$('[data-behavior="remove"]').show(),this.showPreviewBtn()}else this.$('input[name="query"]').val(""),this.rememberInputValue(),this.$('[data-behavior="insert"]').show(),this.$('[data-behavior="change"]').hide(),this.$('[data-behavior="remove"]').hide(),this.hidePreviewBtn(),this.hide()}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.ColorpickerView=Edicy.Backbone.View.extend({tagName:"div",className:"edy-colorpicker",events:{click:"stopMousePropagation","click .edy-colorpicker-colors div":"handleColorClick","change .edy-tb-color-custom":"handleInputChange","keydown .edy-tb-color-custom":"handleInputKeyDown","click .edy-tb-color-alpha-slider-outer":"handleAlphaSliderDrag","draggable:drag .edy-tb-color-alpha-slider-outer":"handleAlphaSliderDrag"},initialize:function(e){this.options=e},render:function(){return this.$el.html(JST["admin/templates/colorpicker"]),t.each(this.getColorArray(12,9),t.bind(function(e){var t=this.renderColor(e);this.$el.find(".edy-colorpicker-colors").append(t),t.attr("data-color",t.css("background-color").replace(/\s+/g,""))},this)),Edicy.dragdrop.draggable(this.$(".edy-tb-color-alpha-slider-outer").get(0)),this.options&&this.options.showAlpha&&this.$el.addClass("with-alpha"),this},stopMousePropagation:function(e){e.stopPropagation()},renderColor:function(t){var i;return i=t?e("<div/>").css("background-color",t):e("<div/>").addClass("remove-color").html('<svg width="100%" height="100%" class="no-color"><line x1="0" y1="100%" x2="100%" y2="0" style="stroke:rgba(255,0,0,0.8);stroke-width:1;"/></svg>')},getColorArray:function(e,i){for(var n=function(e){return"hsl("+360*e[0]+","+100*e[1]+"%,"+100*e[2]+"%)"},o=[],a=[],r=[],s=e;s--;){o.unshift(n([1,0,s/(e-2)])),a.unshift(n([s/e,1,.5]));for(var l=i-2;l-->0;)(r[l]||(r[l]=[])).unshift(n([s/e,.6,(i-2-l)/(i-1)]))}return o[o.length-1]="",o.concat(a,t.flatten(r,!0))},getRGBA:function(e){if(!e||"string"!=typeof e)return{};var t=e.match(/(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*([\d\.]+)?\s*)/);return t?{r:+t[2],g:+t[3],b:+t[4],a:t[5]?Math.round(100*+t[5])/100:1,lightness:Math.round((.2126*+t[2]+.7152*+t[3]+.0722*+t[4])/2.55)/100}:{}
},getCurrentColorData:function(){this.getRGBA(this.$(".edy-tb-color-custom").val())},handleColorClick:function(t){t.stopPropagation(),t.preventDefault();var i=e(t.target),n=i.closest(".remove-color").length?!1:e(t.target).css("background-color"),o=this.getRGBA(n),a=this.getRGBA(this.$(".edy-tb-color-custom").val());o&&!e.isEmptyObject(o)&&(n=this.options&&this.options.showAlpha&&a&&!e.isEmptyObject(a)&&a.a<1?"rgba("+[o.r,o.g,o.b,a.a].join(",")+")":this.options&&this.options.initialAlpha?"rgba("+[o.r,o.g,o.b,this.options.initialAlpha].join(",")+")":"rgba("+[o.r,o.g,o.b,o.a].join(",")+")"),this.changeColor(n,"grid")},changeColor:function(e,t){var i,n,o=this.$(".edy-tb-color-picked");e?(o.addClass("active").css("background-color",e),n=this.roundColorStr(o.css("background-color")),i=this.getRGBA(n),this.trigger("colorchange",n,t,i),this.highlightSelected(n)):(o.removeClass("active").css("background-color",""),this.trigger("colorchange",!1,t,null),this.highlightSelected(!1)),"alpha-slider"!==t&&this.setAlphaSliderPos(i),this.roundInputValues()},setAlphaSliderPos:function(t){t&&!e.isEmptyObject(t)?(this.$(".edy-tb-color-alpha-btn").css("left",100*t.a+"%"),this.$(".edy-tb-color-alpha-nr").html(Math.round(100*t.a)),this.$(".edy-tb-color-alpha-slider-outer").removeClass("edy-slider-disabled")):(this.$(".edy-tb-color-alpha-btn").css("left","0%"),this.$(".edy-tb-color-alpha-nr").html(0),this.$(".edy-tb-color-alpha-slider-outer").addClass("edy-slider-disabled"))},setValue:function(t,i){var n=t?this.getRGBA(t):null,o=t;n&&!e.isEmptyObject(n)&&"undefined"!=typeof i&&(n.a=i,o="rgba("+[n.r,n.g,n.b,n.a].join(",")+")"),this.highlightSelected(o),this.setAlphaSliderPos(n)},highlightSelected:function(t){if(this.$(".edy-colorpicker-colors div.active").removeClass("active"),this.$(".edy-tb-color-custom").val(t||""),t){var i=this.getRGBA(t),n=i&&!e.isEmptyObject(i)?"rgb("+[i.r,i.g,i.b].join(",")+")":"";this.$('.edy-colorpicker-colors div[data-color="'+n+'"]').addClass("active"),this.$(".edy-tb-color-picked").addClass("active").css("background-color",t)}else this.$(".edy-colorpicker-colors div.remove-color").addClass("active"),this.$(".edy-tb-color-picked").removeClass("active").css("background-color","")},handleInputChange:function(e){e.stopPropagation(),e.preventDefault(),this.changeColorByInput(e.target)},handleInputKeyDown:function(t){13===t.which&&(t.preventDefault(),e(t.target).blur())},roundInputValues:function(){var e=this.roundColorStr(this.$(".edy-tb-color-custom").val());e&&this.$(".edy-tb-color-custom").val(e)},roundColorStr:function(t){var i=this.getRGBA(t),n=null;return i&&!e.isEmptyObject(i)&&(n=1===i.a?"rgb("+[i.r,i.g,i.b].join(",")+")":"rgba("+[i.r,i.g,i.b,i.a].join(",")+")"),n},changeColorByInput:function(t){var i=e(t).val();this.changeColor(i,"input")},handleAlphaSliderDrag:function(t){if(!this.$(".edy-tb-color-alpha-slider-outer").is(".edy-slider-disabled")){var i=this.$(".edy-tb-color-alpha-slider-inner").offset(),n=this.$(".edy-tb-color-alpha-slider-inner").width(),o=t.originalEvent.detail.pageX||t.pageX,a=Math.min(Math.max((o-i.left)/n,0),1),r=this.getRGBA(this.$(".edy-tb-color-custom").val());this.$(".edy-tb-color-alpha-btn").css("left",100*a+"%"),this.$(".edy-tb-color-alpha-nr").html(Math.round(100*a)),r&&!e.isEmptyObject(r)&&this.changeColor("rgba("+r.r+","+r.g+","+r.b+","+a+")","alpha-slider")}}}),Edicy.TextColorModalView=Edicy.Backbone.View.extend({tagName:"div",className:"edy-tb-dropdown edy-tb-color-modal edy-hidden",events:{"click .edy-tb-color-tab":"handleTabClick",mousedown:"handleMouseDown"},initialize:function(e){t.bindAll(this,"hide","handleSideclick"),this.options=e},render:function(){return this.$el.html(JST["admin/templates/textcolormodal"]),this.fgcolor=(new Edicy.ColorpickerView).render().on("colorchange",t.bind(function(e,t){this.trigger("color:foreground",e),"grid"===t&&this.hide()},this)),this.$('.edy-tb-color-tab-content[data-tab-id="foreground"]').append(this.fgcolor.$el),this.bgcolor=(new Edicy.ColorpickerView).render().on("colorchange",t.bind(function(e,t){this.trigger("color:background",e),"grid"===t&&this.hide()},this)),this.$('.edy-tb-color-tab-content[data-tab-id="background"]').append(this.bgcolor.$el),this},toggle:function(){this.el.classList.contains("edy-hidden")?this.show():this.hide()},show:function(t){t&&(this.fgcolor.highlightSelected(t.color||null),this.bgcolor.highlightSelected(t.bgcolor||null)),this.el.classList.remove("edy-hidden"),e(document.body).on("click",this.handleSideclick)},hide:function(){this.el.classList.add("edy-hidden"),e(document.body).off("click",this.handleSideclick)},handleSideclick:function(t){e(t.target).closest(this.$el).length?(t.preventDefault(),t.stopPropagation()):this.hide()},handleTabClick:function(t){var i=e(t.target).closest("button"),n=i.data("tab-id");t.preventDefault(),t.stopPropagation(),this.$el.find(".edy-tb-color-tab-content").addClass("edy-hidden"),this.$el.find('.edy-tb-color-tab-content[data-tab-id="'+n+'"]').removeClass("edy-hidden"),this.$el.find(".edy-tb-color-tab").removeClass("edy-btn-blue").addClass("edy-btn-white"),i.removeClass("edy-btn-white").addClass("edy-btn-blue")},handleMouseDown:function(t){0===e(t.target).closest("input").length&&(t.preventDefault(),t.stopPropagation())}})}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.TextEditorSourceView=Edicy.Backbone.View.extend({events:{"click .edy-srcedit-format":"handleFormatClick","click .edy-srcedit-cleanup":"handleCleanupClick","click .edy-srcedit-undo":"handleUndoClick","click .edy-srcedit-cancel":"handleCancelClick","click .edy-srcedit-update":"handleUpdateClick","keydown textarea":"handleTextareaKeydown"},panelOptions:{body:JST["admin/templates/codeeditor"],closeBtn:!1,containerClass:"edy-codeedit-view edy-srcedit-view edy-modal-custom-positioned",sideClose:!0,escapeCloses:!1,propagateClicks:!1},initialize:function(){this.cleanupLevel=0,this.isFormatting=!1,this.cleanTexts=[I18n.t("codeeditor.clean_up"),I18n.t("codeeditor.clean_more"),I18n.t("codeeditor.clean_all")]},render:function(){return this.editor=new Behave({textarea:this.$("textarea").get(0),tabSize:2}),this},setSource:function(t){this.$("textarea").val(e.trim(t)),this.baseText=e.trim(t)},handleTextareaKeydown:function(t){13==t.keyCode&&t.ctrlKey&&(t.preventDefault(),this.updateAndHide()),this.baseText=e(t.target).val(),this.resetToolbar()},handleFormatClick:function(e){e.preventDefault(),this.toggleFormatting(),this.format()},format:function(){var e=this.$("textarea"),t={allowComments:!0,allowedClasses:[],allowedTags:[],allowAllAttributes:!0,allowEmpty:[],bodyOnly:!1,format:this.isFormatting,formatIndent:0,removeAttrs:[],removeTags:[],replace:[],replaceStyles:[]};e.htmlClean(t),this.removeEmptyLines(e)},handleCleanupClick:function(e){e.preventDefault(),this.isFormatting=!0,this.cleanUp(),this.incrementCleanupLevel(),this.updateCleanupText(),this.showUndoBtn(!!this.cleanupLevel)},cleanUp:function(){var e=this.$("textarea"),t=this.cleanupLevels[this.cleanupLevel];t.format=this.isFormatting&&this.cleanupLevel<2,this.cleanupLevel<3&&e.htmlClean(t),this.removeEmptyLines(e)},removeEmptyLines:function(e){e.val(e.val().replace(/(\r\n|\n|\r){1,5}/gm,"\n"))},resetToolbar:function(){this.showUndoBtn(!1),this.resetCleanupLevel(),this.updateCleanupText(),this.isFormatting=!1},showUndoBtn:function(e){"undefined"!=typeof e&&(e?this.$(".edy-srcedit-undo").show():this.$(".edy-srcedit-undo").hide())},updateCleanupText:function(){this.$(".edy-srcedit-cleanup").text(this.cleanTexts[this.cleanupLevel])},handleUndoClick:function(e){e.preventDefault(),this.decrementCleanupLevel(),this.$("textarea").val(this.baseText),0!=this.cleanupLevel&&(this.cleanUp(),this.isFormatting&&this.format()),this.updateCleanupText(),this.showUndoBtn(!!this.cleanupLevel)},decrementCleanupLevel:function(){this.cleanupLevel>0&&(this.cleanupLevel-=1)},incrementCleanupLevel:function(){this.cleanupLevel<this.cleanupLevels.length-1&&(this.cleanupLevel+=1)},resetCleanupLevel:function(){this.cleanupLevel=0},toggleFormatting:function(){this.isFormatting=!this.isFormatting},handleCancelClick:function(e){e.preventDefault(),this.hide(),this.resetCleanupLevel()},handleUpdateClick:function(e){e.preventDefault(),this.updateAndHide(),this.resetCleanupLevel()},show:function(){this.setVisible(!0),this.$("textarea").focus(),this.resetCleanupLevel(),this.isFormatting=!1,this.updateCleanupText(),this.showUndoBtn(!1)},updateAndHide:function(){this.trigger("update:source",this.$("textarea").val()),this.hide()},cleanupLevels:[{allowedTags:["a","table","td","tr","th","tbody","tfoot","thead","b","i","u","s","del","strong","br","img","ol","ul","li","p","em","h1","h2","h3","h4","h5","h6","object","embed","iframe","param","style","span"],allowedAttributes:[["src",["img","iframe","embed"]],["href",["a"]],["target",["a"]],["colspan",["td","th"]],["rowspan",["td","th"]],["style"],["title"],["class"],["height",["iframe","object","embed"]],["width",["iframe","object","embed"]],["frameborder",["iframe"]],["allowfullscreen",["iframe","embed"]],["name",["param"]],["value",["param"]],["wmode",["embed"]],["type",["embed","style"]],["media",["style"]]],allowComments:!1,format:!0},{allowedTags:["a","table","td","tr","tbody","tfoot","thead","img","ol","ul","li","p","span"],allowedAttributes:[["src",["img"]],["href",["a"]],["target",["a"]],["colspan",["td","th"]],["rowspan",["td","th"]],["style"],["class"],["title"]],allowComments:!1,format:!0},{allowedTags:["a","img"],allowedAttributes:[["src",["img"]],["href",["a"]],["target",["a"]],["class"],["title"]],allowComments:!1,format:!0}],hide:function(){this.$el.hide()}}),Edicy.Backbone.mixin(Edicy.TextEditorSourceView,Edicy.PanelViewMixin)}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.TextEditorToolbar=Edicy.Backbone.View.extend({events:{"click .edy-tb-cmd":"handleCommandButtonClick","click .edy-tb-stylemenu":"handleStyleButtonClick","click .edy-tb-act":"handleActionButtonClick",'click .edy-tb-act[data-behavior="showstyles"]':"handleStylesButtonClick",'click .edy-tb-act[data-behavior="pickcolor"]':"handlePickColorClick",'click .edy-tb-act[data-behavior="insertlink"]':"handleInsertLinkClick",'click .edy-tb-act[data-behavior="insertimage"]':"handleInsertImageClick",'click .edy-tb-act[data-behavior="insertmap"]':"handleInsertMapClick",'click .edy-tb-act[data-behavior="insertembed"]':"handleInsertEmbedClick","blur .edy-tb-size-val":"handleFontSizeInput","keyup .edy-tb-size-val":"handleFontSizeKeyUp",click:"handleClick",touchend:"handleTouchEnd"},initialize:function(i){t.bindAll(this,"handleScroll","handleResize"),this.options=i,this.parent=i.parent,this.$parent=e(this.parent)},render:function(){return this.setSizeClass(),this.el.innerHTML=JST["admin/templates/texteditor_toolbar"](),t.each(this.options.styles,function(e,t){this.$(".edy-tb-style-"+t).css(e)},this),this.renderCustomStyles(),this.el.style.display="none",this.handleScroll=t.throttle(this.handleScroll,10),this.handleResize=t.throttle(this.handleResize,10),document.body.appendChild(this.el),this.parent.addEventListener("texteditor:change",this.setPosition.bind(this)),this},setSizeClass:function(){window.matchMedia&&window.matchMedia("screen and (max-width: 640px)").matches?(this.el.classList.remove("edy-tb-sticky"),this.el.classList.remove("edy-tb-size-m"),this.el.classList.add("edy-tb-fixed"),this.el.classList.add("edy-tb-size-l")):(this.el.classList.remove("edy-tb-fixed"),this.el.classList.remove("edy-tb-size-l"),this.el.classList.add("edy-tb-sticky"),this.el.classList.add("edy-tb-size-m"))},isSticky:function(){return this.el.classList.contains("edy-tb-sticky")},isFixed:function(){return!this.isSticky()},filterCustomStyle:function(e){var i=t.clone(e);return delete i.name,i.classname&&(i.className=i.classname,delete i.classname),i.tagname&&(i.nodeName=i.tagname.toUpperCase(),delete i.tagname),i},renderCustomStyles:function(){Edicy.siteOpts.hasOption("texteditorStyles")&&[].concat.apply([],Edicy.siteOpts.getOption("texteditorStyles")).forEach(function(i){if(t.isObject(i)){var n=this.filterCustomStyle(i);this.$(".edy-tb-stylemenu .edy-tb-dropdown-content").append(e("<button/>",{"class":"edy-tb-cmd","data-cmd":"format","data-custom-style":i.name,"data-value":JSON.stringify(n)}).html(i.name))}}.bind(this))},setPosition:function(){if(this.isFixed())return this.el.style.left="",this.el.style.right="",this.el.style.top=Math.max(window.pageYOffset,0)+"px",void 0;var e=this.parent.getBoundingClientRect(),t=this.el.getBoundingClientRect(),i=window.pageYOffset,n=e.top+window.pageYOffset,o=n+e.height,a=9;e.left+window.pageXOffset+t.width>document.body.scrollWidth?(this.el.style.left="",this.el.style.right=document.body.scrollWidth-(e.left+e.width+window.pageXOffset)+"px"):(this.el.style.right="",this.el.style.left=e.left+window.pageXOffset+"px"),n-i<t.height+a&&o>i?(this.el.classList.add("edy-tb-sticky-top"),n<t.height&&i<t.height?this.el.classList.add("edy-tb-autohide"):this.el.classList.remove("edy-tb-autohide"),this.el.style.top=""):i>=o?(this.el.classList.remove("edy-tb-sticky-top"),this.el.style.top=o+t.height+a+"px"):(this.el.classList.remove("edy-tb-sticky-top"),this.el.classList.remove("edy-tb-autohide"),this.el.style.top=e.top+window.pageYOffset+"px")},handleScroll:function(){this.setPosition()},handleResize:function(){this.setSizeClass(),this.setPosition()},handleCommandButtonClick:function(t){t.stopPropagation(),t.preventDefault();var i=e(t.target).closest(".edy-tb-cmd");i.data("cmd")&&(document.activeElement&&Edicy.dom.closest(document.activeElement,this.parent)||this.parent.focus&&this.parent.focus(),this.$parent.trigger("command:"+i.data("cmd"),i.data("value")))},handleStylesButtonClick:function(e){this.toggleDropdown(e.target,".edy-tb-stylemenu")},handleStyleButtonClick:function(e){Edicy.dom.closest(e.target,".edy-tb-stylemenu").classList.add("edy-hidden")},handlePickColorClick:function(t){this.colorpicker||(this.colorpicker=(new Edicy.TextColorModalView).render(),this.colorpicker.on({"color:foreground":function(e){this.$parent.trigger("command:fgcolor",e)},"color:background":function(e){this.$parent.trigger("command:bgcolor",e)}},this),e(t.target).closest("div").append(this.colorpicker.el)),this.colorpicker.toggle(this.state)},handleInsertLinkClick:function(){this.showLinkEditor()},createLinkEditor:function(){var e=this.$('.edy-tb-act[data-behavior="insertlink"]').closest(".edy-tb-menucontainer");this.linkeditor=new Edicy.LinkEditorView({parent:e,relative:!0,keepOrder:!0,collection:new Edicy.SearchCollection}).render(),this.linkeditor.on("item:selected",function(e,t){!e.url||/^\s*$/.test(e.url)?this.$parent.trigger("command:removelink"):this.$parent.trigger("command:insertlink",[e,t])},this)},getLinkEditor:function(){return this.linkeditor||this.createLinkEditor(),this.linkeditor},showLinkEditor:function(e){var t=this.$('.edy-tb-act[data-behavior="insertlink"]').closest(".edy-tb-menucontainer");this.linkeditor||this.createLinkEditor(),e?(this.linkeditor.setParent(e.get(0),!1),this.linkeditor.show()):(this.linkeditor.setParent(t.get(0),!0),this.linkeditor.toggle(),this.linkeditor.isVisible()&&this.linkeditor.focus())},handleFontSizeInput:function(){this.$parent.trigger("command:fontsize",this.$(".edy-tb-size-val").val())},handleFontSizeKeyUp:function(e){var t=this.$(".edy-tb-size-val");parseFloat(t.val()),13===e.which&&(e.preventDefault(),this.$(".edy-tb-size-val").blur())},handleInsertImageClick:function(){},handleInsertMapClick:function(){this.mapeditor||(this.mapeditor=new Edicy.MapEditorView({}).render(),this.mapeditor.on("map:insert",function(e){this.$parent.trigger("command:insertmap",e)},this)),this.mapeditor.show()},handleInsertEmbedClick:function(t){var i=e(t.target).closest(".edy-tb-menucontainer");this.embededitor||(this.embededitor=new Edicy.EmbedEditorView({parent:i,relative:!0}).render(),this.embededitor.on("embedcode:insert",function(e){this.$parent.trigger("command:insertembed",e)},this)),this.embededitor.toggle(),this.embededitor.isVisible()&&this.embededitor.focus()},handleTouchEnd:function(e){e.stopPropagation()},handleClick:function(t){t.stopPropagation();var i=e(t.target).closest(".edy-tb-act");this.linkeditor&&"insertlink"!=i.data("behavior")&&this.linkeditor.hide(),this.embededitor&&"insertembed"!=i.data("behavior")&&this.embededitor.hide(),this.tablepicker&&"picktable"!=i.data("behavior")&&this.tablepicker.hide(),"showstyles"!=i.data("behavior")&&this.$(".edy-tb-stylemenu").addClass("edy-hidden")},setState:function(i){var n=!1,o=!1;this.state=i,this.$(".edy-tb-color").css("color",i.color||""),this.$(".edy-tb-color circle").attr("fill",i.bgcolor||""),this.getLinkEditor().setLink((i.insertlink||[])[0]),t.each(["bold","italic","underline","insertol","insertul","insertlink","alignleft","alignright","aligncenter","blockquote"],t.bind(function(e){this.setButtonActivity(e,i[e])},this)),t.each(["h1","h2","h3","p","pre","blockquote"],t.bind(function(e){this.state[e]&&(n=!0),this.setButtonActivity("format",this.state[e],e)},this)),t.each(this.state,t.bind(function(e,t){/^custom-/.test(t)&&(this.state[t]&&(n=!0),this.setButtonActivity("format",this.state[t],t))},this)),this.setButtonActivity("showstyles",n);var a=e('.edy-tb-cmd[data-cmd="format"][data-blank-value="true"]');n?a.removeClass("edy-tb-active"):a.addClass("edy-tb-active"),t.each(["tablecellvalign_top","tablecellvalign_middle","tablecellvalign_bottom"],t.bind(function(e){var t=e.split("_");this.state[e]&&(o=!0),this.setButtonActivity(t[0],this.state[e]||!1,t[1])},this)),this.setButtonActivity("picktablecellvalign",o),i.fontSize&&this.$(".edy-tb-size-val").val(i.fontSize),i.insertol||i.insertul?this.$(".edy-tb-list-indent-tools").addClass("edy-tb-list-active"):this.$(".edy-tb-list-indent-tools").removeClass("edy-tb-list-active")},setButtonActivity:function(t,i,n){var o,a;"format"===t&&/^custom-/.test(n)?(a=n.replace(/^custom-/,""),o=e('.edy-tb-cmd[data-cmd="'+t+'"][data-custom-style="'+a+'"]')):o=n?e('.edy-tb-cmd[data-cmd="'+t+'"][data-value="'+n+'"]'):this.$('.edy-tb-act[data-behavior="'+t+'"], .edy-tb-cmd[data-cmd="'+t+'"]'),i?o.addClass("edy-tb-active"):o.removeClass("edy-tb-active")},show:function(){e(window).on("scroll",this.handleScroll),e(window).on("resize",this.handleResize),this.el.style.display="block",this.setPosition()},hide:function(){e(window).off("scroll",this.handleScroll),e(window).off("resize",this.handleResize),this.el.style.display="none",this.linkeditor&&this.linkeditor.hide(),this.mapeditor&&this.mapeditor.hide(),this.embededitor&&this.embededitor.hide()},toggleDropdown:function(t,i){var n=Edicy.dom.closest(t,".edy-tb-menucontainer").querySelector(i);n.classList.contains("edy-hidden")?(this.$(".edy-tb-dropdown").addClass("edy-hidden"),n.classList.remove("edy-hidden"),e(document.body).one("click",function(){n.classList.add("edy-hidden")})):n.classList.add("edy-hidden")}}),Edicy.Backbone.mixin(Edicy.TextEditorToolbar,Edicy.TableToolbarMixin)}(Edicy.jQuery,Edicy.Underscore),function(e,t){var i=Edicy.Modernizr.testProp("cssPointerEvents"),n=/((<script)\s*>|(<script)((?!([^>]* type=))([^>]*)|( ([^>]*)type=("|')(application\/ecmascript|application\/javascript|application\/x-javascript|text\/ecmascript|text\/javascript|text\/jscript|text\/x-javascript)("|')([^>]*)))>)/gi,o=/(<script[^>]* type=("|'))text\/plain\+voog(("|')[^>]*>)/gi,a={floatWidthTreshold:.7,floatWidthMultiplier:.45};Edicy.TextEditorView=Edicy.Backbone.View.extend({events:{"click a":"handleLinkClick",mouseup:"bookmarkSelection",mousedown:"handleMouseDown","draggable:dragenter":"handleDragEnter","draggable:dragover":"handleDragOver","draggable:drop":"handleDragDrop","draggable:dragleave":"handleDragLeave","resizable:resizestart":"handleResizeStartInside","editorcontainer:showtoolbar":"handleOtherToolbarShow","editorcontainer:hidetoolbar":"handleOtherToolbarHide","editorcontainer:align":"handleContainerAlign","editorcontainer:deleting":"handleContainerDelete","texteditor:blur":"deactivate"},initialize:function(i){this.options=e.extend({},i),t.bindAll(this,"handleDocumentClick","bookmarkSelection","activate","setToolbarState","handleEditorInteraction","handleEditorAfterCommand","handleEditorPaste","handleEditorBeforePaste","handleContentActivate","handleDocumentMouseUp","handleDocumentKeyUp","handleContentMutation","handleContentChange"),this.migrateFontTags(),this.wrapMediaToContainers(this.$("object, embed, iframe, video").not(".edy-texteditor-container object, .edy-texteditor-container embed, .edy-texteditor-container iframe, .edy-texteditor-container video, object embed")),this.editor=new wysihtml5.Editor(this.$el.get(0),{parserRules:wysihtml5ParserRules,pasteParserRulesets:wysihtml5ParserPasteRulesets,classNames:{uneditableContainer:"edy-texteditor-container",placeholder:"edy-contenteditable-placeholder"},autoLink:!1}),this.editor.on("load",function(){this.wrapMediaToContainers(this.$("img").not(".edy-texteditor-container img"),function(){this.el.dispatchEvent(new CustomEvent("texteditor:mediamigration:loaded"))}.bind(this))}.bind(this)),this.initContainers(),this.initializeInteractions(),this.initToolbar(),this.initChangeListeners(),this.fixIEBodyHeightProblem(),this.blockIEResizingControl()},remove:function(){this.unloadContainers()},initializeInteractions:function(){this.editor.on("focus",this.activate),this.editor.on("interaction",this.handleEditorInteraction),this.editor.on("aftercommand:composer",this.handleEditorAfterCommand),this.editor.on("paste",this.handleEditorPaste),this.editor.on("beforepaste",this.handleEditorBeforePaste),this.editor.on("undo:composer",this.handleEditorUndoRedo.bind(this)),this.editor.on("redo:composer",this.handleEditorUndoRedo.bind(this))},initChangeListeners:function(){this.handleContentChange=t.debounce(this.handleContentChange,500),this.$el.on("input",this.handleContentChange),this.editor.on("change",this.handleContentChange),window.MutationObserver&&t.defer(t.bind(function(){var e=new MutationObserver(this.handleContentMutation);e.observe(this.el,{attributes:!0,childList:!0,characterData:!0})},this),0)},blockIEResizingControl:function(){var e=function(e){var t=e||window.event;return t.preventDefault?t.preventDefault():(t.returnValue=!1,t.cancelBubble=!0),!1};window.attachEvent&&this.el.attachEvent("onresizestart",e)},fixIEBodyHeightProblem:function(){if(!document.caretPositionFromPoint&&!document.caretRangeFromPoint){var t=document.body.currentStyle;"100%"===t.height&&-1===["absolute","fixed"].indexOf(t.position)&&(e(document.body.setAttribute("style",(document.body.getAttribute("style")||"")+"; height: auto !important; min-height: 100% !important")),"relative"!==t.position&&(document.body.style.position="relative"))}},handleContentMutation:function(e){var i=this.el,n=t.some(e,function(e){return!("attributes"==e.type&&e.target==i)});n&&this.handleContentChange()},handleContentChange:function(){this.trigger("change",{editor:this,target:this.el}),this.el.dispatchEvent(new CustomEvent("texteditor:change",{bubbles:!0}))},migrateFontTags:function(){for(var e,t,i,n=this.el.querySelectorAll("font"),o=[10,13,16,18,24,32,48],a=n.length;a--;)if(e=n[a].getAttribute("size"),e&&!isNaN(parseInt(e,10))&&parseInt(e,10)>0){for(i=document.createElement("span"),t=parseInt(e,10),i.style.fontSize=o[t-1]?o[t-1]+"px":o[o.length-1]+"px",n[a].parentNode.insertBefore(i,n[a]);n[a].firstChild;)i.appendChild(n[a].firstChild);n[a].parentNode.removeChild(n[a])}},initContainers:function(){this.$(".edy-texteditor-container").each(function(e,t){this.initContainer(t)}.bind(this))},initContainer:function(e){e.__text_editor_container||(e.__text_editor_container=new Edicy.TextEditorContainerView({el:e}))},unloadContainers:function(){this.$(".edy-texteditor-container").each(function(e,t){this.unloadContainer(t)}.bind(this))},unloadContainer:function(e){e.__text_editor_container&&(e.dispatchEvent(new CustomEvent("texteditor:unloadcontainer")),e.__text_editor_container.remove())},isVisualNode:function(e){if(3===e.nodeType&&/[^\s]/.test(e.nodeValue))return!0;if(1===e.nodeType){if(["IMG","INPUT","BR","HR","EMBED","IFRAME","OBJECT"].indexOf(e.nodeName)>-1)return!0;for(var t=e.childNodes.length;t--;)if(this.isVisualNode(e.childNodes[t]))return!0}return!1},groupConsecutiveElements:function(t){var i,n,o=[];return t.each(function(a,r){if(0===o.length)o.push([r]);else{curFloat=(r.getAttribute("align")||r.style.cssFloat||"").trim(),i=r;do i=!i.previousSibling&&i.parentNode&&this.el.contains(i.parentNode)&&["inline","inline-block"].indexOf(window.getComputedStyle(i.parentNode).display)>-1?i.parentNode.previousSibling&&e(i.parentNode.previousSibling).is(t)?i.parentNode.previousSibling:i.parentNode.previousSibling&&i.parentNode.previousSibling.childNodes.length>0?i.parentNode.previousSibling.childNodes[i.parentNode.previousSibling.childNodes.length-1]:i.parentNode.previousSibling:i.previousSibling,i&&i.nodeName&&"A"===i.nodeName&&i.childNodes.length>0&&(i=i.childNodes[i.childNodes.length-1]);while(i&&!this.isVisualNode(i));n=!i||1!==i.nodeType||(r.getAttribute("align")||r.style.cssFloat||"").toLowerCase().trim()!==(i.getAttribute("align")||r.style.cssFloat||"").toLowerCase().trim(),i&&e(i).is(t)&&!n?o[o.length-1].push(r):o.push([r])}}.bind(this)),o},wrapMediaToContainers:function(t,i){t||(t=this.$("img, object, embed, iframe, video").not(".edy-texteditor-container img, .edy-texteditor-container object, .edy-texteditor-container embed, .edy-texteditor-container iframe, .edy-texteditor-container video, object embed"));for(var n,o,a,r,s,l,d,c=t.parent("a"),h=this.groupConsecutiveElements(t),u=!0,m=[],p=0,g=h.length;g>p;p++)if(h[p].length>1){n=[];for(var f=0,y=h[p].length;y>f;f++)l=window.getComputedStyle(h[p][f]),d=Math.max(parseFloat(l.width),h[p][f].naturalWidth?h[p][f].naturalWidth:0),(-1===["inline","inline-block"].indexOf(l.display)||d>=this.$el.width())&&(u=!1),s=Edicy.dom.closest(h[p][f],"a"),Edicy.dom.closest(s,this.el)||(s=!1),n[f]={el:h[p][f],link:s};o=document.createElement("div"),o.className="edy-texteditor-container-wrapper",o.style.lineHeight=0,u&&(o.style.display="inline-block"),n[0].el.parentNode.insertBefore(o,n[0].el),a=(n[0].el.getAttribute("align")||n[0].el.style.cssFloat||"").toLowerCase().trim(),"right"===a?(o.classList.add("edy-texteditor-container-wrapper-right"),o.style.cssFloat="right"):"left"===a?(o.classList.add("edy-texteditor-container-wrapper-left"),o.style.cssFloat="left"):o.classList.add("edy-texteditor-container-wrapper-left-block");for(var b=0,v=n.length;v>b;b++)o.appendChild(n[b].el);for(var b=0,v=n.length;v>b;b++)"IMG"===n[b].el.nodeName?function(e){e.promise(),this.wrapImageToContainer(n[b].el,!0,n[b].link?n[b].link.cloneNode(!1):!1,function(){e.resolve()}),m.push(e)}.bind(this)(e.Deferred()):(r=this.wrapEmbedObjectToContainer(h[p][b]),e(h[p][b]).after(r),e(h[p][b]).remove())}else h[p][0]&&("IMG"===h[p][0].nodeName?function(e){e.promise(),this.wrapImageToContainer(h[p][0],!1,!1,function(){e.resolve()}),m.push(e)}.bind(this)(e.Deferred()):(r=this.wrapEmbedObjectToContainer(h[p][0]),e(h[p][0]).after(r),e(h[p][0]).remove()));e.when.apply(window,m).done(function(){c.each(function(e,t){Edicy.dom.unwrap(t)}),i&&i()}.bind(this))},wrapImageToContainer:function(t,i,n,o){var a=function(){var e=this.wrapImageToContainer(t,i,n,o);this.initContainer(e)}.bind(this);if(!t.complete)return e(t).one("load",a),e(t).one("error",a),!1;var r,s,l,d,c,h=t.naturalWidth,u=t.naturalHeight,m=e(t).inlineStyle("width")||e(t).attr("width");r=m&&!isNaN(parseFloat(m))&&parseFloat(m)>0?"string"==typeof m&&m.indexOf("%")>0?this.$el.width()*(parseFloat(m)/100):parseFloat(m):h,s=r*(u/h);var p=e(JST["admin/templates/container_image"]({sizes:t.getAttribute("src")+" "+r+"w",height_percent:100*(s/r),container_width:this.$el.width()<=r?"100%":r+"px",url:t.getAttribute("src"),viewportsizes:this.$el.width()<=r?"100vw":r+"px",width:r,height:s,id:""}));t.className&&p.addClass(t.className);var g=["inline","inline-block"].indexOf(window.getComputedStyle(t)).display>-1&&("A"!==t.parentNode.nodeName||e(t.parentNode).find("img").length>1||-1===["block"].indexOf(window.getComputedStyle(t.parentNode).display));Edicy.dom.closest(t,".edy-texteditor-container-wrapper")||g?p.css("display","inline-block"):"left"===e(t).attr("align")||"left"===e(t).css("float")?p.addClass("edy-positionable-container-left").css("float","left"):"right"===e(t).attr("align")||"right"===e(t).css("float")?p.addClass("edy-positionable-container-right").css("float","right"):"center"===e(t).attr("align")?p.addClass("edy-positionable-container-center").css({"margin-left":"auto","margin-right":"auto"}):p.addClass("edy-positionable-container-left-block").css({"margin-left":0,"margin-right":"auto"}),t.style.paddingLeft&&p.css("padding-left",t.style.paddingLeft),t.style.paddingRight&&p.css("padding-right",t.style.paddingRight),t.style.paddingTop&&p.css("padding-top",t.style.paddingTop),t.style.paddingBottom&&p.css("padding-bottom",t.style.paddingBottom),t.style.border&&p.css("border",t.style.border),t.style.backgroundColor&&p.css("background-color",t.style.backgroundColor);var f=e(t).attr("title")||e(t).attr("alt");return f&&(p.find("picture, img").attr({title:f,alt:f}),p.attr("data-title",f)),i?n&&(l=p.find("picture"),l.before(n),e(n).append(l)):(d=e(t).closest("a"),d.closest(this.el).length>0&&d.attr("href")&&(c=e("<a/>").attr("href",d.attr("href")),d.attr("target")&&c.attr("target",d.attr("target")),d.attr("title")&&c.attr("title",d.attr("title")),l=p.find("picture"),l.before(c),c.append(l),this.splitElementByChild(d.get(0),t))),e(t).after(p),e(t).remove(),o&&o(),p.get(0)},wrapEmbedObjectToContainer:function(e){var t,i,n,o="OBJECT"===e.nodeName?e.querySelector('param[name="movie"]'):!1,a=o?o.getAttribute("value"):e.getAttribute("src")||e.getAttribute("data");return i=parseFloat(e.getAttribute("width")),i&&!isNaN(i)&&e.getAttribute("width").indexOf("%")>0&&(i=i/100*this.$el.width()),i||(i=this.$el.width()),n=parseFloat(e.getAttribute("height")),(!n||isNaN(n))&&(n=9*i/16),"VIDEO"===e.nodeName?this.createVideoContainer({code:e.outerHTML,width:i,height:n},!0):a?(t=this.testKnownEmbedService(a),t?this.createVideoContainer({code:'<iframe src="'+t.iframeUrl+'"></iframe>',width:i,height:n},!0):this.createVideoContainer({code:e.outerHTML,width:i,height:n},!0)):void 0},fixNestedEmbedObjects:function(){var e,t;for(counter=0;(e=document.querySelector("object > object"))&&1e3>counter;)counter++,t=e.parentNode,t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)},testKnownEmbedService:function(e){var t,i=/(https?:)?\/\/(www\.)?(youtube(-nocookie)?\.[^\/]+)\/(v\/|watch\?v=|embed\/)([^&\?$ ]+)/,n=/(https?:)?\/\/(www\.)?vimeo\.[^\/]+\/moogaloop.swf\?clip_id=([^&\?$ ]+)/;return(t=e.match(i))&&t[6]?{service:"youtube",iframeUrl:"//www.youtube.com/embed/"+t[6]+"?wmode=transparent",id:t[6]}:(t=e.match(n))&&t[3]?{service:"vimeo",iframeUrl:"//player.vimeo.com/video/"+t[3],id:t[3]}:void 0},handleDocumentClick:function(e){this.el.contains(e.target)||this.mouseClickStartedInside||this.deactivate()},handleMouseDown:function(t){this.mouseClickStartedInside=e(t.target).closest(this.el).length>0&&0===e(t.target).closest(".edy-texteditor-container").length},handleDocumentMouseUp:function(){this.mouseClickStartedInside&&this.bookmarkSelection(),setTimeout(t.bind(function(){this.mouseClickStartedInside=!1},this),0)},handleDocumentKeyUp:function(){if(this.editor.composer.selection.getSelection()){var t,i=this.editor.composer.selection.getSelection();(e(i.anchorNode).closest(this.$el).length>0||e(i.focusNode).closest(this.$el).length>0)&&0===e([i.anchorNode,i.focusNode]).closest(".edy-texteditor-container").length&&(this.bookmarkSelection(),t=e([i.anchorNode,i.focusNode]).closest(".edy-texteditor-container-wrapper"),t.length>0&&setTimeout(function(){this.cleanupContainerWrapper(t.get(0))}.bind(this),0))}},handleResizeStartInside:function(){this.mouseClickStartedInside=!0},activate:function(){this.$el.hasClass("edy-texteditor-active")||(this.showToolbar(),e(document.body).on({click:this.handleDocumentClick,touchend:this.handleDocumentClick,mouseup:this.handleDocumentMouseUp,keyup:this.handleDocumentKeyUp,"content:activate":this.handleContentActivate}),this.$el.addClass("edy-texteditor-active").trigger("content:activate"))},deactivateUneditables:function(){this.$(".edy-texteditor-container").each(function(e,t){t.dispatchEvent(new CustomEvent("texteditor:blurcontainer"))}.bind(this))},deactivate:function(){this.selBookmark=null,this.removeUnusedContainerWrappers(),this.deactivateUneditables(),this.el.blur(),e(document.body).off({click:this.handleDocumentClick,touchend:this.handleDocumentClick,mouseup:this.handleDocumentMouseUp,keyup:this.handleDocumentKeyUp,"content:activate":this.handleContentActivate}),this.$el.hasClass("edy-texteditor-active")&&(this.hideToolbar(),this.$el.removeClass("edy-texteditor-active").trigger("content:deactivate")),this.editor.fire("blur:composer"),this.editor.fire("set_placeholder")
},handleContentActivate:function(e){e.target!=this.el&&this.deactivate()},focus:function(){setTimeout(this.editor.focus.bind(this.editor),0)},updateUndoState:function(){this.editor.composer.undoManager.transact()},initToolbar:function(){this.toolbar=new Edicy.TextEditorToolbar({styles:this.readStyles(),parent:this.el}).render()},showToolbar:function(){this.toolbar.show()},hideToolbar:function(){this.toolbar&&this.toolbar.hide(),this.hideCellResize()},handleOtherToolbarShow:function(){t.defer(this.hideToolbar.bind(this))},handleOtherToolbarHide:function(){this.$el.hasClass("edy-texteditor-active")&&this.showToolbar()},handleEditorInteraction:function(){this.setToolbarState()},handleEditorBeforePaste:function(){t.defer(this.handleEditorPaste.bind(this))},handleEditorPaste:function(){var e=function(){this.migrateFontTags(),this.wrapMediaToContainers(),this.initContainers()};t.defer(e.bind(this))},handleEditorUndoRedo:function(){this.el.dispatchEvent(new CustomEvent("texteditor:beforesourceupdate")),this.unloadContainers(),this.initContainers(),this.el.dispatchEvent(new CustomEvent("texteditor:sourceupdate"))},filterCustomStyle:function(e){var i=t.clone(e);return delete i.name,i.classname&&(i.className=i.classname,delete i.classname),i.tagname&&(i.nodeName=i.tagname.toUpperCase(),delete i.tagname),i},setToolbarState:function(){var i={insertOrderedList:"insertol",insertUnorderedList:"insertul",createLink:"insertlink",alignLeftStyle:"alignleft",alignRightStyle:"alignright",alignCenterStyle:"aligncenter",insertBlockQuote:"blockquote"};if(this.toolbar){var n={color:this.editor.composer.commands.stateValue("foreColorStyle"),bgcolor:this.getBgColor(),fontSize:this.getSelectionFontSize()};if(t.each(["createLink","bold","italic","underline","insertOrderedList","insertUnorderedList","alignLeftStyle","alignRightStyle","alignCenterStyle","insertBlockQuote"],t.bind(function(e){n[i[e]||e]=this.editor.composer.commands.state(e)},this)),this.editor.composer.tableSelection&&this.editor.composer.tableSelection.cells&&this.editor.composer.selection.isCollapsed()){switch(e(this.editor.composer.tableSelection.cells).attr("align")){case"center":n[i.alignCenterStyle]=!0;break;case"left":n[i.alignLeftStyle]=!0;break;case"right":n[i.alignRightStyle]=!0}switch(e(this.editor.composer.tableSelection.cells).attr("valign")){case"top":n.tablecellvalign_top=!0;break;case"middle":n.tablecellvalign_middle=!0;break;case"bottom":n.tablecellvalign_bottom=!0}}t.each(["h1","h2","h3","p","pre"],t.bind(function(e){n[e]=this.editor.composer.commands.state("formatBlock",e)},this)),Edicy.siteOpts.hasOption("texteditorStyles")&&[].concat.apply([],Edicy.siteOpts.getOption("texteditorStyles")).forEach(function(e){var t=this.filterCustomStyle(e);n["custom-"+e.name]=this.editor.composer.commands.state("formatBlock",t)}.bind(this)),this.toolbar.setState(n)}},getSelectionNode:function(){var e=this.editor.composer.selection.getSelectedNode();return e&&1!==e.nodeType&&(e=e.parentNode),e},getSelectionFontSize:function(){var t=this.editor.composer.commands.stateValue("fontSizeStyle");if(!t){var i=this.getSelectionNode();t=i?e(i).css("font-size"):null}return t?parseFloat(t):null},getBgColor:function(){var i=this.editor.composer.commands.stateValue("bgColorStyle");if(!i&&this.editor.composer.selection.isCollapsed()&&this.editor.composer.tableSelection&&this.editor.composer.tableSelection.table){var n=t.find(this.editor.composer.tableSelection.cells,function(t){return e(t).css("background-color")});return n?e(n).css("background-color").replace(/\s+/g,""):null}return i},readStyles:function(){return t.reduce(["h1","h2","h3","p","pre"],function(t,i){var n=e("<"+i+"/>").css("visibility","hidden").appendTo(this.$el);return t[i]={"font-weight":n.css("font-weight"),"font-family":n.css("font-family")},n.remove(),t},{},this)},showCodeEditor:function(){this.codeEditor||(this.codeEditor=new Edicy.TextEditorSourceView({}).render(),this.codeEditor.on("update:source",this.handleCodeEditorUpdate,this)),this.codeEditor.setSource(this.getValue()),this.codeEditor.show()},escapeScripts:function(e){return e.replace(n,'$2$3$6 $8type="text/plain+voog"$12>')},unescapeScripts:function(e){return e.replace(o,"$1text/javascript$3")},restoreIE9SourcesShim:function(e){var t=/(?!<picture[^>]*>\s*)<video style=["']display: ?none;?["']>(\s*<source[^>]*>\s*)+<\/video>/gi;return e.replace(t,'<!--[if IE 9]><video style="display: none;"><![endif]-->$1<!--[if IE 9]></video><![endif]-->')},handleCodeEditorUpdate:function(e){this.el.dispatchEvent(new CustomEvent("texteditor:beforesourceupdate")),this.unloadContainers(),this.editor.setValue(this.escapeScripts(e)),this.migrateFontTags(),this.wrapMediaToContainers(),this.initContainers(),window.picturefill&&picturefill(),this.el.dispatchEvent(new CustomEvent("texteditor:sourceupdate"))},getValue:function(){var t,i=e("<div/>").html(this.editor.getValue(!0));return this.updateImagesBaseWidths(i),this.ensureImagesAreProtocolLess(i),t=this.unescapeScripts(i.html()),t=this.restoreIE9SourcesShim(t),this.unescapeScripts(t)},ensureImagesAreProtocolLess:function(t){var i=t.find(".edy-texteditor-container.image-container"),n=new RegExp("https?\\:(\\/\\/"+Edicy.mediaPublicHost.replace(/\./g,"\\.")+")","g");i.each(function(t,i){var o=e(i).find("img"),a=e(i).find("source");o&&o.get(0)&&o.eq(0).attr("src")&&o.eq(0).attr("src").search(n)>-1&&o.eq(0).attr("src",o.eq(0).attr("src").replace(n,"$1")),a&&a.get(0)&&a.eq(0).attr("srcset")&&a.eq(0).attr("srcset").search(n)>-1&&a.eq(0).attr("srcset",a.eq(0).attr("srcset").replace(n,"$1"))}.bind(this))},updateImagesBaseWidths:function(e){var t=e.find(".edy-texteditor-container.image-container");t.each(function(e,t){this.updateImageBaseWidths(t)}.bind(this))},updateImageBaseWidths:function(e){var t,i,n,o,a=e.querySelector("source"),r=e.querySelector("img"),s=a?a.getAttribute("srcset"):void 0,l=s?s.split(","):void 0,d=[];if(l&&r){for(var c=0,h=l.length;h>c;c++)i=l[c].trim().split(" "),n=i[0],o=parseFloat(i[1]),n&&"number"==typeof o&&2===i.length&&d.push({url:n,width:o});t=this.getPhotoByWidth(d,600),t&&r.setAttribute("src",t)}},getPhotoByWidth:function(e,t){for(var i,n,o=null,a=e.length;a--;)i=e[a].width-t,e[a].thumbnail&&"medium"===e[a].thumbnail||!(!o||0>n&&i>=0||(n>=0&&i>=0||0>n&&0>i)&&Math.abs(i)<Math.abs(n))||(o=e[a].url,n=i);return o},handleEditorAfterCommand:function(){this.handleEditorInteraction(),this.bookmarkSelection()},bookmarkSelection:function(){this.editor.composer.selection.getSelection()&&(this.selBookmark=this.editor.composer.selection.getBookmark())},restoreSelection:function(){return this.selBookmark?(this.editor.composer.selection.setBookmark(this.selBookmark),!0):!1},setSelectionAfter:function(e){this.editor.composer.selection.setAfter(e)},handleLinkClick:function(i){i.ctrlKey||i.metaKey?document.location=e(i.target).closest("a").attr("href"):0===e(i.target).closest(".edy-texteditor-container").length&&this.editor.composer.selection.isCollapsed()&&t.defer(t.bind(function(){this.toolbar.showLinkEditor(e(i.target))},this))},guessDropSize:function(t,i){var n,o,r=i.payload.element,s=!0,l=i.draggable?i.draggable.__texteditor_dragparent:null;return r?(s=this.containerIsMaxWidth(r),n=s?this.$el.innerWidth():e(r).width()):i.payload.width?(s=i.payload.width>=this.$el.innerWidth(),n=s?this.$el.innerWidth():i.payload.width):n=this.$el.innerWidth(),l&&e(l).is("td, th")&&(n=Math.min(e(l).width(),n)),s&&["left","right"].indexOf(t.floating)>-1&&(n*=a.floatWidthMultiplier),(["left","right"].indexOf(t.floating)>-1||["left","right"].indexOf(t.to)>-1)&&n>this.$el.width()*a.floatWidthTreshold&&(n=this.$el.width()*a.floatWidthMultiplier),r&&e(r).width()?o=e(r).height()/e(r).width()*n:i.payload.width&&(o=i.payload.height/i.payload.width*n),{width:n,height:o,maxWidth:s}},showPlaceholderForPosition:function(t,i,n){var o=n.payload.element,a=t.rect.top+window.pageYOffset,r=t.rect.left+window.pageXOffset,s=this.guessDropSize(t,n);"center"===t.floating?r+=(t.rect.width-s.width)/2:"right"===t.floating&&(r+=t.rect.width-s.width),this.assetPlaceholder||(this.assetPlaceholder=e("<div/>"),this.assetPlaceholder.addClass("edy-texteditor-placeholder")),["left","right"].indexOf(t.to)>-1?(o&&"baseline"===window.getComputedStyle(o).verticalAlign&&(a-=s.height-t.rect.height),this.assetPlaceholder.css({top:a,left:r+("right"===t.to?t.rect.width:-s.width),width:s.width,height:s.height})):(i?a+="before"===t.to?0:t.rect.height-20:"itself"!==t.to&&(a+="before"===t.to?0:t.rect.height),!t.onContainer&&!t.onContainerWrapper||"before"!==t.to&&"itself"!==t.to||(a-=s.height),this.assetPlaceholder.css({top:a,left:r,width:s.width,height:s.height})),this.assetPlaceholder.appendTo(document.body)},hidePlaceholderForRect:function(){this.assetPlaceholder&&this.assetPlaceholder.detach()},isLineBreakingNode:function(e){return e&&1==e.nodeType&&(Edicy.dom.matches(e,"br")||"inline"!=window.getComputedStyle(e).getPropertyValue("display"))},getSiblingAfterLinebreak:function(e){return e.previousSibling&&this.isLineBreakingNode(e.previousSibling)?e:e.previousSibling?this.getSiblingAfterLinebreak(e.previousSibling):e},isDropinElement:function(e){return e&&1==e.nodeType&&Edicy.dom.matches(e,"td, th, li, dd, dt")},getClosestDropPosition:function(e){if(1==e.nodeType&&Edicy.dom.matches(e,"tr, tbody, thead, tfoot"))return Edicy.dom.closest(e,"table");if(this.isLineBreakingNode(e))return e;if(this.isDropinElement(e))return e;var t=this.getSiblingAfterLinebreak(e);return t.parentNode==this.el?t:t!=e.parentNode.firstChild||this.isDropinElement(t.parentNode)?t:this.getClosestDropPosition(e.parentNode)},getDropTargetWithPosition:function(e,t,i){var n=3==e.nodeType?e.parentNode:e;if(!this.el.contains(n))return i&&i.call(this),void 0;Edicy.dom.closestUntil(n,this.el,".edy-texteditor-container")!=this.el&&(e=Edicy.dom.closest(n,".edy-texteditor-container"));var o=this.getClosestDropPosition(e),a=o.parentNode;this.isDropinElement(o)&&(a=o,o=null),o==this.el&&(a=this.el,o=null),a?t.call(this,a,o):i&&i.call(this)},radialNodeScan:function(e,t,i,n,o){for(var a,r,s,l=2*Math.PI,d=10,c=d,h=Math.ceil(i/d),u=8,m=0;h*l>m;m+=l/u){if(a=e+c*m*Math.sin(m),r=t+c*m*Math.cos(m)*n,s=o(a,r))return s;if(s===!1)break}return null},getNodeNearCoordinate:function(e,t,i,n){var o=function(e,t){var i,n=this.getRangeAtCoordinate(e,t);if(n===!1)return!1;if(n&&n.startContainer&&n.startContainer.__relatedContainer)return n.startContainer.__relatedContainer;if(n){if(3===n.startContainer.nodeType)i=n.startContainer;else{var o=n.startContainer,a=o.childNodes,r=n.startOffset;i=a.length>0?a[r]:n.startContainer}if(i&&(3===i.nodeType&&this.el.contains(i.parentNode)||this.el.contains(i)))return i}return null};return this.radialNodeScan(e,t,i,n,o.bind(this))},getElementNearCoordinate:function(e,t,i,n){var o=function(e,t){var i=document.elementFromPoint(e,t);return i&&this.el.contains(i)?i:void 0};return this.radialNodeScan(e,t,i,n,o.bind(this))},getClosestNodeForPoint:function(e){var t=e.detail,n=t.helper?1.5*t.helper.getBoundingClientRect().width:20;!i&&e.detail.helper&&(e.detail.helper.style.display="none");var o=this.getNodeNearCoordinate(t.clientX,t.clientY,n,.5);return o||(o=this.getElementNearCoordinate(t.clientX,t.clientY,n,.5)),!i&&t.helper&&(t.helper.style.display=""),o},setCaretToMouse:function(e){var t,n,o=e.detail;return!i&&e.detail.helper&&(e.detail.helper.style.display="none"),t=this.getRangeAtCoordinate(o.clientX,o.clientY),t&&t.commonAncestorContainer&&Edicy.dom.closest(t.commonAncestorContainer,this.el)&&(n=this.setSelection(t)),!i&&e.detail.helper&&(e.detail.helper.style.display=""),n?{selection:n,range:t}:!1},getSelection:function(e){var t,i=rangy.getSelection(window);if(i){if(e)return i;if(t=i.getRangeAt(0),t&&t.commonAncestorContainer&&Edicy.dom.closest(t.commonAncestorContainer,this.el))return i}return null},setSelection:function(e){var t=rangy.getSelection(window);return t.setSingleRange(e),t&&t.anchorNode&&t.focusNode?t:null},getPlaceholderRectFromPosition:function(t,i){var n,o,a=i.getBoundingClientRect();if(t){if(3===t.nodeType){var r=document.createRange();r.selectNode(t),n=r.getBoundingClientRect(),0===n.height&&0!==n.top&&i&&parseFloat(window.getComputedStyle(i).lineHeight)&&(o=parseFloat(window.getComputedStyle(i).lineHeight),n=e.extend({},n,{top:n.top-o,bottom:n.bottom-o}))}else n=t.getBoundingClientRect();if(0===n.top){var s=document.createElement("span");s.style.display="inline-block",s.style.height="1em",s.style.width="1em",t.parentNode.insertBefore(s,t),n=s.getBoundingClientRect(),s.parentNode.removeChild(s),3===t.nodeType&&(n=e.extend({},n,{bottom:n.top,height:0}))}return{top:n.top,left:a.left,width:a.width,height:n.height,right:a.left+a.width,bottom:n.top+n.height}}return a},dropOnContainer:function(e,t){var i=(t.draggable,t.payload&&t.payload.element,t.payload&&t.payload.element||t.draggable),n=i!==e?Edicy.dom.closest(e,".edy-texteditor-container"):!1;return n||!1},dropOnContainerWrapper:function(e,t){var i=(t.draggable,t.payload&&t.payload.element,t.payload&&t.payload.element||t.draggable),n=i!==e?Edicy.dom.closest(e,".edy-texteditor-container-wrapper"):!1;return n||!1},getDropTargetPosition:function(e,t,i){var n,o,a,r,s=this.dropOnContainer(e,i),l=this.dropOnContainerWrapper(e,i),d=this.getPlaceholderRectFromPosition(e,t),c=i.helper.getBoundingClientRect();return l&&(wrapperRect=l?l.getBoundingClientRect():null,wrapOverlap=wrapperRect?Edicy.dragdrop.utils.rectOverlappingPositions(c,wrapperRect):null,wrapOverlap&&(wrapOverlap.bottom||wrapOverlap.top)&&Math.abs(i.deltaX)<=Math.abs(i.deltaY))?(i.deltaY<0?r="after":i.deltaY>0&&(r="before"),{to:r,floating:this.getTargetFloat(e,t,i),rect:wrapperRect,onContainerWrapper:l}):s&&(o=s.getBoundingClientRect(),a=Edicy.dragdrop.utils.rectOverlappingPositions(c,o),(Math.abs(i.deltaX)>Math.abs(i.deltaY)||l)&&(r=i.deltaX<0?"right":i.deltaX>0?"left":this.previousDropPositioningX||"left",this.previousDropPositioningX=r),r)?{to:r,floating:"align",rect:o,onContainer:s}:(a=Edicy.dragdrop.utils.rectOverlappingPositions(i.helper.getBoundingClientRect(),d),r=a.bottom==a.top?i.deltaY<0?"after":i.deltaY>0?"before":this.previousDropPositioningY||"before":a.bottom?"after":"before",this.previousDropPositioningY=r,n=this.getTargetFloat(e,t,i),!i.payload.element||i.payload.element!==e&&Edicy.dom.closest(e,".edy-texteditor-container")!==i.payload.element||(r="itself"),{to:r,floating:n,rect:d,onContainer:s})},getTargetFloat:function(e,t,i){var n=this.getPlaceholderRectFromPosition(e,t),o=i.payload.element||i.draggable,a=(o&&o.classList.contains("edy-texteditor-container")?o.getBoundingClientRect().width:i.payload&&i.payload.width,n.width/6),r=n.width>=400?!0:!1;return r&&i.clientX<n.left+a?"left":r&&i.clientX>n.right-a?"right":"center"},handleDragEnter:function(){this.el.classList.contains("edy-contenteditable-placeholder")&&(this.editor.focus(),this.editor.fire("unset_placeholder")),this.dropCache=this.el.querySelectorAll("*"),this.$el.addClass("edy-texteditor-dragover")},handleDragOver:function(e){var t,i,n=e.originalEvent,o=n.detail.payload.type;n.detail.draggable.__texteditor_dragtype=o,"photo"===o||"embed"===o?this.handleImageDragOver(n):(t=this.getSelection(!0),t.isCollapsed?(i=this.setCaretToMouse(n),n.detail.draggable.__texteditor_dragselection=i):(i=this.getSelection(),n.detail.draggable.__texteditor_dragselection=i))},handleImageDragOver:function(e){var t=this.getClosestNodeForPoint(e),i=e.detail;t&&this.getDropTargetWithPosition(t,function(t,n){t==this.el&&null===n&&(n=this.el.firstChild);var o=this.getDropTargetPosition(n,t,i);"itself"===o.to&&n&&Edicy.dom.closest(n,".edy-texteditor-container-wrapper")||(this.showPlaceholderForPosition(o,!n,i),e.detail.draggable.__texteditor_dragparent=t,e.detail.draggable.__texteditor_dragpositioning=o,o.onContainerWrapper?(e.detail.draggable.__texteditor_dragposition="after"==o.to?o.onContainerWrapper.nextSibling||null:o.onContainerWrapper,e.detail.draggable.__texteditor_dragposition?e.detail.draggable.__texteditor_dragparent=e.detail.draggable.__texteditor_dragposition.parentNode:e.detail.draggable.__texteditor_dragposition=null):e.detail.draggable.__texteditor_dragposition="after"==o.to?n&&n.nextSibling?n.nextSibling:null:n)})},removeContainerPositioningClasses:function(e){for(var t=e.classList.contains("edy-texteditor-container-wrapper")?"edy-texteditor-container-wrapper-":"edy-positionable-container-",i=["left","right","center","left-block","right-block"],n=i.length-1;n>=0;n--)e.classList.remove(t+i[n])},getContainerPositioningFromClass:function(e){for(var t=e.classList.contains("edy-texteditor-container-wrapper")?"edy-texteditor-container-wrapper-":"edy-positionable-container-",i=["left","right","center","left-block","right-block"],n=i.length-1;n>=0;n--)if(e.classList.contains(t+i[n]))return i[n]},handleDragDrop:function(e){var t,i=e.originalEvent.detail,n=i.draggable,o=n.__texteditor_dragtype,a=i.payload;"photo"===o||"embed"===o?(this.handleContainerDragDrop(n,a),this.el.normalize&&this.el.normalize()):(t=i.draggable.__texteditor_dragselection,t||(t=this.setCaretToMouse(e.originalEvent)),t&&this.handleFileDragDrop(n,a))},handleFileDragDrop:function(e,t){if(t.url){var i={href:t.url,title:t.url,text:decodeURIComponent(t.url.split("/").pop()),target:"_blank"};this.editor.composer.commands.exec("createLink",i)}},handleContainerDragDrop:function(t,i){var n,o,a,r=t.__texteditor_dragparent,s=t.__texteditor_dragposition,l=t.__texteditor_dragpositioning,d=Edicy.dom.closest(t,".edy-texteditor-view");r&&(1===r.nodeType&&["TD","TH"].indexOf(r.nodeName)>-1&&/^\s*(<br\/?>)?\s*$/i.test(r.innerHTML)&&(r.innerHTML="",s=null),i&&i.element&&i.element.parentNode&&Edicy.dom.closest(i.element.parentNode,".edy-texteditor-view")&&i.element.parentNode!==r&&(a=i.element.parentNode),i&&i.element&&["left","right"].indexOf(l.floating)>-1&&(i.element.classList.contains("edy-positionable-container-left-block")||i.element.classList.contains("edy-positionable-container-right-block"))&&(l.floating=l.floating+"-block"),r&&this.el.contains(r)&&(this.deactivateUneditables(),this.updateUndoState(),n=i.element?i.element:this.createContainer(i).get(0),o=Edicy.dom.closest(r,"td, th"),o&&(this.fixTableWidths(Edicy.dom.closest(o,"table")),n.style.width&&parseFloat(n.style.width)>e(o).width()&&(n.style.width="auto",n.style.cssFloat="none",n.style.marginLeft="",n.style.marginRight="",n.style.display="block",this.removeContainerPositioningClasses(n),n.classList.add("edy-positionable-container-maxwidth"),n.querySelector("source")&&n.querySelector("source").setAttribute("sizes","100vw"),n.classList.add("edy-positionable-container-center"),this.setContainerAlignmentMargins(n,"center"))),s&&s.parentNode?["left","right"].indexOf(l.to)>-1?(this.alignContainersSideBySide(n,s,l),this.updateImageContainerSourceSizes(n,i)):(r.insertBefore(n,s),Edicy.dom.closest(n,".edy-texteditor-container-wrapper")&&this.splitElementByChild(Edicy.dom.closest(n,".edy-texteditor-container-wrapper"),n)):r.appendChild(n),d&&d!==this.el&&d.dispatchEvent(new CustomEvent("texteditor:blur")),s&&-1===["left","right"].indexOf(l.to)&&this.setContainerAlignment(n,l.floating,i),a&&e(a).is("td,th")&&/^\s*$/.test(a.innerHTML)&&(a.innerHTML="<br>"),this.removeUnusedContainerWrappers(),this.setSelectionAfter(n),this.initContainer(n),window.picturefill&&picturefill(),setTimeout(this.activate.bind(this))))},handleContainerDelete:function(){setTimeout(function(){this.removeUnusedContainerWrappers()}.bind(this),0)},handleContainerAlign:function(e){var t=e.originalEvent;this.setContainerAlignment(t.target,t.detail.position)},setContainerAlignmentMargins:function(e,t){var i="",n="";"center"===t&&"auto"!==e.style.width&&(i=n="auto"),"left-block"===t&&(i=n=""),"right-block"===t&&(i="auto",n=""),e.style.marginLeft=i,e.style.marginRight=n},setContaineWrapperAlignment:function(e,t){e.style.display="block",e.style.textAlign=t.indexOf("left")>-1?"left":t.indexOf("right")>-1?"right":"center"},setContainerAlignment:function(e,t,i){var n=Edicy.dom.closest(e,".edy-texteditor-container-wrapper")||!1,o=n?"edy-texteditor-container-wrapper-":"edy-positionable-container-",r=n||e,s=["left","right"].indexOf(t)>-1;n||(r.style.display="block",["left","right","left-block","right-block"].indexOf(t)>-1&&"auto"===r.style.width&&(r.style.width="")),r.style.cssFloat=s?t:"none",n?this.setContaineWrapperAlignment(r,t):this.setContainerAlignmentMargins(r,t),this.removeContainerPositioningClasses(r),r.classList.add(o+t),r.classList.remove(o+"maxwidth"),!n&&this.containerIsMaxWidth(r)&&r.classList.add(o+"maxwidth"),(!window.getComputedStyle(r).width||0===parseFloat(window.getComputedStyle(r).width)||r.classList.contains(o+"maxwidth")&&(r.classList.contains(o+"left-block")||r.classList.contains(o+"right-block"))&&["","auto"].indexOf(r.style.width)>-1)&&(r.classList.remove(o+"maxwidth"),r.style.width=["left","right","left-block","right-block"].indexOf(t)>-1?this.$el.width()*a.floatWidthMultiplier+"px":this.$el.width()),s&&0!==parseFloat(window.getComputedStyle(r).width)&&parseFloat(window.getComputedStyle(r).width)>this.$el.width()*a.floatWidthTreshold&&(r.style.width=this.$el.width()*a.floatWidthMultiplier+"px"),r.classList.contains(o+"maxwidth")&&(r.style.width="auto",r.style.cssFloat="none",r.style.marginLeft="",r.style.marginRight="",r.style.display="block"),this.updateImageContainerSourceSizes(r,i)},updateImageContainerSourceSizes:function(e,t){var i=e.querySelector("source"),n=e.querySelector("img"),o=e.querySelector(".edy-padding-resizer-wrapper");if(i&&n&&o)if(e.style.width.indexOf("px")>-1){var a=t&&t.width&&t.height?t.width/t.height:n.naturalWidth/n.naturalHeight,r=100/parseFloat(o.style.paddingBottom),s=parseFloat(e.style.width),l=s*(a/r),d=Math.ceil(Math.max(s,l));i.setAttribute("sizes",isNaN(d)?"100ww":d+"px")}else i.setAttribute("sizes","100vw")},cleanupContainerWrapper:function(e){for(var t,i,n=[],o=this.editor.composer.selection.getSelection().anchorNode,a=e.childNodes.length;a--;)(3===e.childNodes[a].nodeType&&/[^\s]/.test(e.childNodes[a].nodeValue)||1===e.childNodes[a].nodeType&&!e.childNodes[a].classList.contains("edy-texteditor-container")&&(["IMG","INPUT","BR","HR","EMBED"].indexOf(e.childNodes[a].tagName)||/[^\s]/.test(e.childNodes[a].innerHTML)))&&(n.push(e.childNodes[a]),o===e.childNodes[a]&&(i=e.childNodes[a]));if(n.length>0){for(var r=0,s=n.length;s>r;r++)t=Edicy.dom.closest(n[r],".edy-texteditor-container-wrapper"),this.splitElementByChild(t,n[r]);this.removeUnusedContainerWrappers()}i&&this.setSelectionAfter(i)},removeUnusedContainerWrappers:function(){var t=e(".edy-texteditor-container-wrapper");t.each(function(e,t){var i,n=t.querySelectorAll(".edy-texteditor-container");(!n||n.length<2)&&(Edicy.dom.unwrap(t),n[0]&&(i=this.getContainerPositioningFromClass(t)||"left",n[0].style.display="block",this.setContainerAlignment(n[0],i)))}.bind(this))},alignContainersSideBySide:function(t,i,n){var o,r,s=Edicy.dom.closest(i,".edy-texteditor-container-wrapper");s||(s=document.createElement("div"),s.className="edy-texteditor-container-wrapper",i.parentNode.insertBefore(s,i),["left","right"].indexOf(i.style.cssFloat)>-1&&(i.style.width=window.getComputedStyle(i).width),s.appendChild(i),o=this.getContainerPositioningFromClass(i)||"left",s.classList.add("edy-texteditor-container-wrapper-"+(o||"center")),s.style.cssFloat=i.style.cssFloat,s.style.textAlign=o.replace(/-block/,""),s.style.lineHeight=0),"left"===n.to?i.parentNode.insertBefore(t,i):i.parentNode.insertBefore(t,i.nextSibling),r=s.querySelectorAll(".edy-texteditor-container");for(var l=r.length;l--;)(["","auto","100%"].indexOf(r[l].style.width)>-1||e(r[l]).width()>this.$el.width()*a.floatWidthTreshold)&&(r[l].style.width=this.$el.width()*a.floatWidthMultiplier+"px"),this.removeContainerPositioningClasses(r[l]),r[l].style.display="inline-block",r[l].style.cssFloat="none"},containerIsMaxWidth:function(t){var i,n=t.style.marginLeft,o=t.style.marginRight;return["left","right"].indexOf(t.style.cssFloat)&&"100%"===t.style.width?!0:["auto","100%"].indexOf(t.style.width)>-1?!0:(t.style.marginLeft="",t.style.marginRight="",i=e(t).outerWidth(),t.style.marginLeft=n,t.style.marginRight=o,i>=this.$el.width())},handleDragLeave:function(){this.hidePlaceholderForRect(),this.$el.removeClass("edy-texteditor-dragover"),this.editor.fire("blur:composer"),this.editor.fire("set_placeholder")},getRangeAtCoordinate:function(e,t){var i,n,o,a,r;if(document.caretPositionFromPoint){if(r=document.elementFromPoint(e,t),Edicy.dom.closest(r,".edy-texteditor-container"))return!1;if(n=document.caretPositionFromPoint(e,t)){i=n.offsetNode;try{var s=document.createRange(),l=n.offset;i===this.el&&1===l&&this.el.childNodes[0]&&this.el.childNodes[0].classList.contains("edy-texteditor-container")&&(l=0),s.setStart(i,l),s.setEnd(i,l),o=s}catch(d){}}}else if(document.caretRangeFromPoint)o=document.caretRangeFromPoint(e,t);else if(document.body.createTextRange){if(r=document.elementFromPoint(e,t),Edicy.dom.closest(r,".edy-texteditor-container"))return!1;n=document.body.createTextRange();try{n.moveToPoint(e,t),n.select()}catch(d){n=null}n&&(a=window.getSelection(),a&&a.rangeCount>0&&(o=window.getSelection().getRangeAt(0)))}return o},getEmbedSrc:function(t){if(t.code){var i=e(t.code);return t.code=e("<div>").append(i.clone()).html(),(i.is("iframe, embed, object")||i.find("iframe, embed, object").length)&&(t.type="video"),e("<div>").append(this.createContainer(t)).html()}return!1},createContainer:function(e){return"photo"==e.type?this.createImageContainer(e):"video"==e.type?this.createVideoContainer(e):this.createEmbedContainer(e)},createImageContainer:function(i){var n,o;return n=i.width&&i.height?100*(i.height/i.width):200/3,o=t.reject(i.sizes,function(e){return e.thumbnail&&"medium"===e.thumbnail}),e(JST["admin/templates/container_image"]({sizes:t.map(o,function(e){return e.url+" "+e.width+"w"}).join(", "),height_percent:n,container_width:this.$el.width()<=i.width?"auto":i.width+"px",url:this.getPhotoByWidth(i.sizes,600),width:i.width,height:i.height,viewportsizes:this.$el.width()<=i.width?"100vw":i.width+"px",id:i.id}))},createVideoContainer:function(t,i){var n,o;return t.code?(n=t.width&&t.height?100*t.height/t.width:200/3,o=e('<div class="edy-texteditor-container embed-container" contenteditable="false" unselectable="on" style="max-width: 100%; overflow: hidden; position: relative;"><div class="edy-padding-resizer-wrapper" style="padding-bottom: '+n+'%;">'+t.code+"</div></div>"),o.find(".edy-padding-resizer-wrapper").children("iframe, embed, object, video").removeAttr("height").removeAttr("width").css({height:"",width:""}),o.find("embed").attr("wmode","transparent"),o.find("object").each(function(t){e(t).find('param[name="wmode"]')?"transparent"!==e(t).find('param[name="wmode"]').attr("value")&&e(t).find('param[name="wmode"]').attr("value","transparent"):e(t).append('<param name="wmode" value="transparent"/>')}),o.find('iframe[src*="youtube"]').each(function(t,i){-1===e(i).attr("src").indexOf("wmode")&&(e(i).attr("src").indexOf("?")>-1?e(i).attr("src",e(i).attr("src")+"&wmode=transparent"):e(i).attr("src",e(i).attr("src")+"?wmode=transparent"))}),o.find("iframe").attr("frameborder",0),o.find("embed, object, iframe, video").css({position:"absolute",display:"block",width:"100%",height:"100%"}).removeAttr("width").removeAttr("height"),i&&o.width(t.width),this.containerIsMaxWidth(o.get(0))?(o.get(0).style.width="auto",o.get(0).classList.add("edy-positionable-container-maxwidth")):(o.get(0).classList.add("edy-positionable-container-center"),o.get(0).style.marginLeft="auto",o.get(0).style.marginRight="auto"),o):null},createEmbedContainer:function(t){return t.code?e('<div class="edy-texteditor-container universal-fluid-container" contenteditable="false" style="max-width: 100%;" unselectable="on">'+t.code+"</div>"):null},splitElementByChild:function(e,t){var i,n,o,a=t;if(!Edicy.dom.closest(t,e))throw new Error("Child is not a descendant of node.");do{for(i=a.parentNode,n=i.cloneNode(!1);i.lastChild&&i.lastChild!==a;)n.insertBefore(i.lastChild,n.firstChild);i!==e&&(o=i.cloneNode(!1),o.appendChild(a),a=o),i.parentNode.insertBefore(a,i.nextSibling),""!==n.innerHTML&&i.parentNode.insertBefore(n,a.nextSibling),""===i.innerHTML&&i.parentNode.removeChild(i)}while(i&&i!==e)}});var r={events:{"command:bgcolor":"bgColorCmd","command:blockquote":"blockQuoteCmd","command:bold":"boldCmd","command:fgcolor":"fgColorCmd","command:fontsize":"fontSizeCmd","command:format":"formatCmd","command:insertembed":"insertEmbedCmd","command:insertlink":"insertLinkCmd","command:removelink":"removeLinkCmd","command:insertol":"insertOlCmd","command:insertul":"insertUlCmd","command:indentlist":"indentListCmd","command:outdentlist":"outdentListCmd","command:italic":"italicCmd","command:aligncenter":"alignCenterCmd","command:alignleft":"alignLeftCmd","command:alignright":"alignRightCmd","command:source":"sourceCmd","command:underline":"underlineCmd","command:insertmap":"insertMap"},bgColorCmd:function(i,n){rangy.getSelection().anchorNode&&0!==e(rangy.getSelection().anchorNode).closest(this.$el).length||this.restoreSelection();var o=!1,a=this.editor.composer.commands.stateValue("bgColorStyle");!a&&this.editor.composer.selection.isCollapsed()&&this.editor.composer.tableSelection&&this.editor.composer.tableSelection.table?(n&&t.each(this.editor.composer.tableSelection.cells,function(t){e(t).css("background-color").replace(/\s+/g,"")===n.replace(/\s+/g,"")&&(o=!0)}),o||!n?e(this.editor.composer.tableSelection.cells).css("background-color","").removeAttr("bgcolor"):e(this.editor.composer.tableSelection.cells).css("background-color",n).removeAttr("bgcolor"),this.editor.fire("interaction")):n?this.editor.composer.commands.exec("bgColorStyle",n):this.editor.composer.commands.remove("bgColorStyle",n)},boldCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("bold")},fgColorCmd:function(t,i){rangy.getSelection().anchorNode&&0!==e(rangy.getSelection().anchorNode).closest(this.$el).length||this.restoreSelection(),i?this.editor.composer.commands.exec("foreColorStyle",i):this.editor.composer.commands.remove("foreColorStyle",i)},fontSizeCmd:function(e,t){var i;this.restoreSelection()&&("+"===t||"-"===t?(i=Math.round(this.getSelectionFontSize())+("-"===t?-1:1),this.editor.composer.commands.exec("fontSizeStyle",i+"px")):(i=parseFloat(t),this.editor.composer.commands.exec("fontSizeStyle",i+"px")))},formatCmd:function(e,t){this.restoreSelection()&&this.editor.composer.commands.exec("formatBlock",t)},blockQuoteCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("insertBlockQuote")},insertEmbedCmd:function(t,i){if(this.restoreSelection()&&i){var n,o,a=i.data&&i.data.code?e("<div>"+i.data.code+"</div>").contents():null;a&&a.is("object, embed, iframe, video")?a.each(function(t,i){e(i).is("object, embed, iframe, video")?(n=this.wrapEmbedObjectToContainer(i),n&&(o=(o||"")+n.get(0).outerHTML)):o=8===i.nodeType?(o||"")+"<!-- "+i.nodeValue+" -->":1===i.nodeType?(o||"")+i.outerHTML:(o||"")+(i.data||"")}.bind(this)):!o&&i.data&&i.data.code&&(o="html"===i.data.mode?i.data.code:this.getEmbedSrc(i.data)),o&&this.editor.composer.commands.exec("insertHTML",this.escapeScripts(o)),this.initContainers()}},fixLocalUrls:function(e){var t=document.location.protocol+"//"+punycode.toASCII(document.location.hostname),i=document.location.protocol+"//"+punycode.toUnicode(document.location.hostname);return 0===e.indexOf(i)?e=e.replace(i,""):0===e.indexOf(t)&&(e=e.replace(t,"")),e},insertLinkCmd:function(t,i,n){if(this.restoreSelection()){var o=i.url===i.title?this.fixLocalUrls(i.url.trim()):i.title,a={href:this.fixLocalUrls(i.url.trim()),title:o,text:o};n&&e.extend(a,n),this.editor.composer.commands.exec("createLink",a)}},removeLinkCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("removeLink")},insertOlCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("insertOrderedList")},insertUlCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("insertUnorderedList")},indentListCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("indentList")},outdentListCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("outdentList")},italicCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("italic")},alignCenterCmd:function(){this.editor.composer.tableSelection&&this.editor.composer.tableSelection.cells&&this.editor.composer.selection.isCollapsed()?(e(this.editor.composer.tableSelection.cells).attr("align","center").css("text-align",""),this.editor.fire("interaction")):this.restoreSelection()&&this.editor.composer.commands.exec("alignCenterStyle")},alignLeftCmd:function(){this.editor.composer.tableSelection&&this.editor.composer.tableSelection.cells&&this.editor.composer.selection.isCollapsed()?(e(this.editor.composer.tableSelection.cells).attr("align","left").css("text-align",""),this.editor.fire("interaction")):this.restoreSelection()&&this.editor.composer.commands.exec("alignLeftStyle")
},alignRightCmd:function(){this.editor.composer.tableSelection&&this.editor.composer.tableSelection.cells&&this.editor.composer.selection.isCollapsed()?(e(this.editor.composer.tableSelection.cells).attr("align","right").css("text-align",""),this.editor.fire("interaction")):this.restoreSelection()&&this.editor.composer.commands.exec("alignRightStyle")},sourceCmd:function(){this.showCodeEditor()},underlineCmd:function(){this.restoreSelection()&&this.editor.composer.commands.exec("underline")},insertMap:function(t,i){if(this.restoreSelection()&&i){var n=this.$el.width(),o=parseInt(n/1.618,10),a=e("<iframe/>").attr({src:Edicy.mapsUrl+"?"+e.param(i),allowTransparency:"true",scrolling:"no",frameborder:"0",width:"100%",height:o});this.editor.composer.commands.exec("insertHTML",this.getEmbedSrc({code:a})),this.initContainers()}}};Edicy.Backbone.mixin(Edicy.TextEditorView,r),Edicy.Backbone.mixin(Edicy.TextEditorView,Edicy.TableEditorMixin,["handleEditorInteraction","initializeInteractions"])}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.TextPartialView=Edicy.Backbone.View.extend({events:{"edicy:partial:created":"handlePartialCreated"},initialize:function(t){this.options=e.defaults(t,{focus:!1}),this.editor=new Edicy.TextEditorView({el:this.$el}),this.editor.on("change",this.handleContentChange,this),this.model=Edicy.textpartials.add(new Edicy.TextPartial({id:this.$el.data("textpartial-id"),body:this.editor.getValue()}),{silent:!0}),this.options.focus&&(this.editor.activate(),this.editor.focus()),Edicy.on("edicy:save",this.handleSave,this)},remove:function(){Edicy.textpartials.remove(this.model),Edicy.off("edicy:save",this.handleSave,this),this.editor.remove()},handleContentChange:function(){this.model.set("body",this.editor.getValue())},handlePartialCreated:function(e,t){this.$el.attr("data-textpartial-id",t.id),this.model.set("id",t.id),this.model.handleModelSynced()},handleSave:function(){if(this.model.set("body",this.editor.getValue()),this.model.hasPendingChanges()&&this.model.isNew())this.$el.trigger("edicy:partial:addrequested",{content_options:{body:this.model.get("body")}}),this.model.handleModelSynced();else if(this.model.hasPendingChanges()){var e=this.model.save();Edicy.trigger("edicy:saving",e)}}})}(Edicy.Underscore),function(e){Edicy.FormFieldAddView=Edicy.Backbone.View.extend({events:{"click .edy-fe-additem":"handleAddItemClick"},popoverOptions:{orientation:"right",containerClass:"edy-fe-additems",propagateClicks:!1},showForField:function(e,t){this.previous_field_id=t,this.setParent(e.get(0)),this.show()},handleAddItemClick:function(t){var i=e(t.target).closest(".edy-fe-additem");t.preventDefault(),this.hide(),this.trigger("field:add",{type:i.data("field-type"),field_size:i.data("field-size"),options:i.data("options"),previous_field_id:this.previous_field_id})}}),Edicy.Backbone.mixin(Edicy.FormFieldAddView,Edicy.PopoverViewMixin)}(Edicy.jQuery),function(e){Edicy.FormSettingsView=Edicy.Backbone.View.extend({events:{"ajax:before form":"handleSaveStarted","change select":"handleSubmitActionChange"},handleSaveStarted:function(){this.$(".edy-form-save-btn").dotLoader({replace:!0})},handleSubmitActionChange:function(t){var i=e(t.target).val();"message"==i?(this.$(".edy-form-submit-action-redirect").addClass("edy-hidden"),this.$(".edy-form-submit-action-message").removeClass("edy-hidden")):(this.$(".edy-form-submit-action-message").addClass("edy-hidden"),this.$(".edy-form-submit-action-redirect").removeClass("edy-hidden"))}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.FormFieldSettingsView=Edicy.Backbone.View.extend({events:{'input input[type="text"], textarea':"handleInputChanged",'change input[type="checkbox"], select':"handleInputChanged"},popoverOptions:{orientation:"bottom",changeOrientation:!1,containerClass:"edy-fe-fs",propagateClicks:!1},render:function(){return t.contains(["select","checkbox","radio"],this.model.get("type"))&&this.$(".edy-fe-fs-options").removeClass("edy-hidden"),"textfield"==this.model.get("type")&&this.$(".edy-fe-fs-format").removeClass("edy-hidden"),t.contains(["textfield","textarea"],this.model.get("type"))&&this.$(".edy-fe-fs-placeholder").removeClass("edy-hidden"),t.contains(["textfield","textarea","select"],this.model.get("type"))&&this.$(".edy-fe-fs-size").removeClass("edy-hidden"),"textarea"==this.model.get("type")&&this.$(".edy-fe-fs-rows").removeClass("edy-hidden"),"paragraph"==this.model.get("type")?this.$(".edy-fe-fs-paragraph").removeClass("edy-hidden"):this.$(".edy-fe-fs-required").removeClass("edy-hidden"),this.$('[name="title"]').val(this.model.get("title")),this.$('[name="paragraph"]').val(this.model.get("paragraph")),this.$('[name="format"]').val(this.model.get("format")).trigger("edyselect:init"),this.$('[name="options"]').val(this.model.getOptionsStr()),this.$('[name="field_size"]').val(this.model.get("field_size")).trigger("edyselect:init"),this.$('[name="required"]').prop("checked",this.model.get("required")),this.$('[name="placeholder"]').val(this.model.get("placeholder")),this.$('[name="rows"]').val(this.model.get("rows")),this.$('[name="classname"]').val(this.model.get("classname")),this},handleInputChanged:function(t){var i=e(t.target);i.is('[name="options"]')?this.model.set("options",i.val().split("\n")):i.is('[type="checkbox"]')?this.model.set(i.attr("name"),i.prop("checked")):this.model.set(i.attr("name"),i.val())}}),Edicy.Backbone.mixin(Edicy.FormFieldSettingsView,Edicy.PopoverViewMixin)}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.FormEditorView=Edicy.Backbone.View.extend({events:{click:"activate","click .edy-fef-add":"handleAddClick","formfield:activate":"handleFieldActivate","draggable:dragstart .edy-fe-fields":"handleDragStart","draggable:dragend .edy-fe-fields":"handleDragEnd","sortable:sort":"handleSort","sortable:remove":"handleSort","sortable:receive":"handleSort","sortable:appear":"handleSort"},initialize:function(e){t.bindAll(this,"handleDocumentClick"),this.options=e,this.model=Edicy.forms.add(new Edicy.Form({id:this.$el.data("form-id"),submit_label:this.$('[data-action-id="form-editor-submit-btn"]').attr("value")}),{silent:!0}),this.model.on("change:submit_label",this.handleSubmitLabelChanged,this),this.model.fields.on("add",this.handleFieldAdded,this),Edicy.on("edicy:save",this.handleSave,this),this.initFields(),this.options.focus&&this.$(".edy-fe-field:first").trigger("click"),Edicy.dragdrop.sortable(this.el,{accepts:".edy-fe-field",items:".edy-fe-field",within:".edy-fe-fields",handle:".edy-fe-draghandle",placeholder:"edy-fe-placeholder",helper:this.getSortableHelper,droppables:".edy-fe-fields, .edy-content-trashcan"})},remove:function(){Edicy.forms.remove(this.model),Edicy.off("edicy:save",this.handleSave,this)},initFields:function(){t.each(this.$(".edy-fe-field"),function(i,n){var o=this.model.fields.add(t.extend(e(i).data("field"),{position:++n}),{silent:!0});new Edicy.FormFieldView({el:i,model:o})},this)},updateFieldPositions:function(){t.each(this.$(".edy-fe-field"),function(t,i){this.model.fields.get(e(t).attr("id")).set("position",++i)},this),this.model.fields.sort()},handleSave:function(){if(this.model.hasPendingChanges()){var e=this.model.save();Edicy.trigger("edicy:saving",e)}},getSortableHelper:function(t){return e("<div/>",{"class":"edy-fe-draghelper"}).css({width:e(t).outerWidth(!0),height:e(t).outerHeight(!0)}).get(0)},handleSubmitLabelChanged:function(e,t){var i=this.el.querySelector('[data-action-id="form-editor-submit-btn"]');i&&i.setAttribute("value",t)},handleAddClick:function(t){var i=e(t.target).closest(".edy-fef-add");t.preventDefault(),this.addView||(this.addView=new Edicy.FormFieldAddView({body:this.$(".edy-fe-additems-tpl").html()}).render(),this.addView.on("field:add",this.addField,this)),this.addView.showForField(i,i.closest(".edy-fe-field").attr("id"))},addField:function(e){var i=this.model.fields.indexOf(this.model.fields.get(e.previous_field_id));this.model.fields.add({id:"field_"+t.now(),type:e.type,field_size:e.field_size,options:e.options},{at:i>=0?i+1:null})},handleFieldAdded:function(e){var t=new Edicy.FormFieldView({model:e,template:this.$(".edy-fef-tpl").html()}).render(),i=this.model.fields.at(this.model.fields.indexOf(e)-1),n=this.$('.edy-fe-field[id="'+i.id+'"]');n.length>0?n.after(t.el):this.$(".edy-fe-fields").append(t.el),this.updateFieldPositions(),t.$el.trigger("click")},handleFieldActivate:function(){this.$(".edy-fe-field-active").removeClass("edy-fe-field-active")},showToolbar:function(){this.$(".edy-tb").removeClass("edy-hidden")},hideToolbar:function(){this.$(".edy-tb").addClass("edy-hidden")},handleDragStart:function(t){this.addView&&this.addView.hide(),e(t.target).addClass("edy-fef-dragging"),this.el.dispatchEvent(new CustomEvent("edicy:content:dragstart",{bubbles:!0}))},handleDragEnd:function(t){this.el.dispatchEvent(new CustomEvent("edicy:content:dragend",{bubbles:!0})),e(t.target).removeClass("edy-fef-dragging")},handleSort:function(){this.updateFieldPositions()},handleDocumentClick:function(t){this.el==t.target||e.contains(this.el,t.target)||(this.deactivate(),e(document.body).off("click",this.handleDocumentClick))},activate:function(){this.$el.hasClass("edy-fe-active")||(e(document.body).on("click",this.handleDocumentClick),this.$el.addClass("edy-fe-active").trigger("content:activate"),this.showToolbar())},deactivate:function(){this.$el.hasClass("edy-fe-active")&&(this.$el.removeClass("edy-fe-active").trigger("content:deactivate"),this.hideToolbar())}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.FormFieldView=Edicy.Backbone.View.extend({className:"edy-fe-field form_field",events:{mouseenter:"handleMouseEnter",click:"handleContainerClick",'click input[type="file"]':"handleFileFieldClick","draggable:dragstart":"handleDragStart","edicy:content:deleterequested":"handleContentDeleteRequested"},initialize:function(e){this.options=e,this.model.on({change:this.handleModelChange,remove:this.handleModelRemove},this)},render:function(){return this.$el.html(this.options.template).attr("id",this.model.id),this.$(".edy-fe-fieldinputs").append(this.renderInputs()),this.model.set("title",this.$(".edy-fe-label").html()),this},renderInputs:function(){var i,n=this.model.get("type");return"checkbox"==n||"radio"==n?(i=e("<div/>"),this.model.has("options")&&t.each(this.model.get("options"),function(e){i.append('<label><input type="'+n+'"/><span class="form_control_indicator"></span>'+e+"</label>")}),this.setInputClass(i.find("input"))):"paragraph"!=n&&("textfield"==n?i=e("<input/>",{type:"text"}).attr("placeholder",this.model.get("placeholder")):"textarea"==n?i=e("<textarea/>").attr({placeholder:this.model.get("placeholder"),rows:this.model.get("rows")}):"select"==n?(i=e("<select/>"),this.model.has("options")&&t.each(this.model.get("options"),function(t){i.append(e("<option/>").html(t))})):"file"==n&&(i=e("<input/>",{type:"file"})),this.setInputClass(i)),i},setInputClass:function(e){e.addClass("form_field_"+this.model.get("type")),this.model.get("field_size")&&e.is('input[type="text"], textarea, select')&&e.addClass("form_field_size_"+this.model.get("field_size"))},positionDragHandles:function(){var e=this.el.getBoundingClientRect(),t=10,i=3,n=0,o=0+i,a=o-t,r=e.height-n-i,s=r+t,l=0+i,d=l-t,c=e.width-n-i,h=c+t;this.$(".edy-fe-draghandle-top").css({top:a,left:d,width:Math.abs(d-h),height:Math.abs(a-o)}),this.$(".edy-fe-draghandle-right").css({top:o,left:c,width:t,height:Math.abs(o-r)}),this.$(".edy-fe-draghandle-bottom").css({top:r,left:d,width:Math.abs(d-h),height:Math.abs(s-r)}),this.$(".edy-fe-draghandle-left").css({top:o,left:d,width:t,height:Math.abs(o-r)})},handleModelChange:function(){this.$(".edy-fe-label").html(this.model.get("title")),this.$(".edy-fe-paragraph").html(this.model.get("paragraph")),this.$(".edy-fe-fieldinputs").empty().append(this.renderInputs())},handleMouseEnter:function(){this.positionDragHandles()},handleContainerClick:function(t){0==e(t.target).closest(".edy-fef-add").length?(this.fieldSettingsView||(this.fieldSettingsView=new Edicy.FormFieldSettingsView({parent:this.$el,body:this.$el.closest(".edy-fe-view").find(".edy-fe-fs-tpl").html(),model:this.model}).render()),this.fieldSettingsView.show()):this.fieldSettingsView&&this.fieldSettingsView.hide(),this.$el.trigger("formfield:activate").addClass("edy-fe-field-active")},handleDragStart:function(){this.fieldSettingsView&&this.fieldSettingsView.hide()},handleFileFieldClick:function(e){e.preventDefault()},handleContentDeleteRequested:function(e,t){var t=e.originalEvent.detail;t==this.el&&(e.stopPropagation(),this.model.collection.size()>1&&setTimeout(function(){this.model.collection.remove(this.model)}.bind(this),0))},handleModelRemove:function(){this.remove(),this.fieldSettingsView&&this.fieldSettingsView.remove()}})}(Edicy.jQuery,Edicy.Underscore),function(){this.JST||(this.JST={}),this.JST["admin/templates/gallery_editor_toolbar"]=function(obj){var __p=[];with(obj||{}){__p.push('<div class="edy-tb-menucontainer">\n  <button class="edy-tb-act edy-tb-text edy-tb-arrow" data-behavior="toggle-types-menu">',galleryTypes[currentType],'</button>\n  <div class="edy-tb-dropdown edy-tb-dropdown-menu edy-hidden" data-action-id="gallery-types-menu">\n    <div class="edy-tb-dropdown-content">\n    ');for(var g in galleryTypes)__p.push("\n      "),galleryTypes.hasOwnProperty(g)&&(__p.push('\n        <button class="edy-tb-dropdown-menuitem'),g===currentType&&__p.push(" edy-tb-dropdown-menuitem-active"),__p.push('" data-behavior="select-gallery-type" data-gallery-type="',g,'">',galleryTypes[g],"</button>\n      ")),__p.push("\n    ");__p.push("\n    </div>\n  </div>\n</div>\n"),galleryOptions.length>0&&(__p.push('\n<div class="edy-tb-menucontainer">\n  <button class="edy-tb-act edy-tb-g" data-behavior="toggle-options"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M135.394 190.5h-.01l-1.897-.13c-.067-.005-.123-.053-.137-.119-.278-1.302-.401-1.88-.435-2.147-.771-.225-1.499-.577-2.166-1.047l-2.017.972c-.061.03-.134.015-.179-.037l-1.248-1.433c-.044-.051-.049-.125-.012-.182l1.205-1.837c-.385-.705-.651-1.463-.791-2.255l-2.106-.753c-.064-.023-.104-.085-.1-.152l.131-1.896c.005-.068.053-.123.119-.137l2.14-.452c.234-.798.604-1.55 1.101-2.237l-1.012-1.923c-.033-.062-.018-.138.034-.184l1.433-1.248c.051-.044.124-.049.181-.013l1.845 1.183c.701-.38 1.454-.642 2.24-.78l.755-2.093c.023-.063.078-.102.152-.099l1.897.13c.067.005.123.053.137.118l.466 2.135c.759.226 1.478.576 2.14 1.041l2.009-.944c.061-.028.133-.013.178.037l1.248 1.433c.044.05.049.124.013.18l-1.179 1.841c.377.7.637 1.453.774 2.24l2.097.752c.063.023.104.085.099.152l-.131 1.896c-.005.067-.053.123-.119.137l-2.141.458c-.227.761-.578 1.482-1.045 2.144l.962 2.015c.029.061.014.134-.037.179l-1.433 1.248c-.051.045-.124.049-.181.013l-1.838-1.2c-.702.381-1.46.645-2.256.784-.071.231-.263.769-.744 2.11-.022.06-.079.099-.143.099zm-.339-5.917c-.942 0-1.828-.367-2.494-1.033-.666-.666-1.033-1.552-1.033-2.494 0-.942.367-1.828 1.033-2.494.666-.666 1.552-1.033 2.494-1.033.942 0 1.828.367 2.494 1.033.666.666 1.033 1.552 1.033 2.494 0 .943-.367 1.828-1.033 2.494-.665.666-1.551 1.033-2.493 1.033z" transform="translate(-125 -171)" stroke="currentColor" fill="none" />\n</svg>\n</button>\n  <div class="edy-tb-dropdown edy-gallery-options-panel edy-hidden" data-action-id="gallery-options-panel">\n    <div class="edy-tb-dropdown-content">\n      <div class="edy-gallery-options-header">\n        <div class="edy-gallery-options-title">',I18n.t("gallery.gallery_options"),'</div>\n        <div class="edy-gallery-options-toggle" data-behavior="toggle-options"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg">\n    <path d="M135.394 220.5h-.01l-1.897-.13c-.067-.005-.123-.053-.137-.119-.278-1.302-.401-1.88-.435-2.147-.771-.225-1.499-.577-2.166-1.047l-2.017.972c-.061.03-.134.015-.179-.037l-1.248-1.433c-.044-.051-.049-.125-.012-.182l1.205-1.837c-.385-.705-.651-1.463-.791-2.255l-2.106-.753c-.064-.023-.104-.085-.1-.152l.131-1.896c.005-.068.053-.123.119-.137l2.14-.452c.234-.798.604-1.55 1.101-2.237l-1.012-1.923c-.033-.062-.018-.138.034-.184l1.433-1.248c.051-.044.124-.049.181-.013l1.845 1.183c.701-.38 1.454-.642 2.24-.78l.755-2.093c.023-.063.078-.102.152-.099l1.897.13c.067.005.123.053.137.118l.466 2.135c.759.226 1.478.576 2.14 1.041l2.009-.944c.061-.028.133-.013.178.037l1.248 1.433c.044.05.049.124.013.18l-1.179 1.841c.377.7.637 1.453.774 2.24l2.097.752c.063.023.104.085.099.152l-.131 1.896c-.005.067-.053.123-.119.137l-2.141.458c-.227.761-.578 1.482-1.045 2.144l.962 2.015c.029.061.014.134-.037.179l-1.433 1.248c-.051.045-.124.049-.181.013l-1.838-1.2c-.702.381-1.46.645-2.256.784-.071.231-.263.769-.744 2.11-.022.06-.079.099-.143.099zm-.339-5.917c-.942 0-1.828-.367-2.494-1.033-.666-.666-1.033-1.552-1.033-2.494 0-.942.367-1.828 1.033-2.494.666-.666 1.552-1.033 2.494-1.033.942 0 1.828.367 2.494 1.033.666.666 1.033 1.552 1.033 2.494 0 .943-.367 1.828-1.033 2.494-.665.666-1.551 1.033-2.493 1.033z" transform="translate(-125 -201)" stroke="currentColor" fill="currentColor" fill-rule="evenodd"/>\n</svg>\n</div>\n      </div>\n      '),galleryOptions.forEach(function(e){if(__p.push('\n        <div class="edy-gallery-options-item">\n          <label>',I18n.t("gallery."+e.key,{fallback:e.name}),'</label>\n          <div class="edy-gallery-option-item-value">\n            <input type="text" class="edy-gallery-option" name="',e.key,'" value="',e.value,'" data-action-id="gallery-option-input" data-type="',e.type,'"/>\n            '),e.unit&&Array.isArray(e.unit)){__p.push('\n              <div class="edy-select edy-gallery-option-unit edy-gallery-option-unit-multi">\n                ');var t=function(){if(e.selectedUnit){var t=e.unit.indexOf(e.selectedUnit);return t>-1?I18n.t("gallery.unittext."+e.unitText[t],{fallback:e.unitText[t]})||e.selectedUnit:e.selectedUnit}return e.unitText&&I18n.t("gallery.unittext."+e.unitText[0],{fallback:e.unitText[0]})||e.unit[0]}();__p.push('\n                <div class="edy-select-text">',t,'</div>\n                <select data-key="',e.key,'">\n                  ');for(var i=0;i<e.unit.length;i++)__p.push("\n                    <option "),e.selectedUnit&&e.selectedUnit===e.unit[i]&&__p.push("selected"),__p.push(' value="',e.unit[i],'">\n                      '),e.unitText&&e.unitText[i]?__p.push("\n                        ",I18n.t("gallery.unittext."+e.unitText[i],{fallback:e.unitText[i]}),"\n                      "):__p.push("\n                        ",e.unit[i],"\n                      "),__p.push("\n                    </option>\n                  ");__p.push("\n                </select>\n              </div>\n            ")}else __p.push('\n              <span class="edy-gallery-option-unit">\n                ',e.unit,"\n              </span>\n            ");__p.push("\n            \n          </div>\n        </div>\n      ")}),__p.push("\n    </div>\n  </div>\n</div>\n")),__p.push("\n")}return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["admin/templates/gallery_editor_photo_toolbar"]=function(obj){var __p=[];with(obj||{})__p.push('<span class="edy-gallery-item-tb-icon"><svg width="13px" height="17px" viewBox="0 0 13 17" xmlns="http://www.w3.org/2000/svg">\n    <g stroke="none" stroke-width="1" fill-rule="evenodd" fill="#1B2124">\n        <path d="M7,15 L4,15 L4,6 L0,6 L0,3 L11,3 L11,6 L7,6 L7,15 Z"></path>\n        <path d="M12,0 L13,0 L13,17 L12,17 L12,0 Z"></path>\n    </g>\n</svg></span>\n<input class="edy-gallery-item-tb-input" data-action-id="photo-title-input" maxlength="255" name="title" value="',title,'" placeholder="',I18n.t("imageeditor_toolbar.type_title_here"),'" />\n');return __p.join("")}}.call(this),function(){Edicy.GalleryEditorToolbar=Edicy.Backbone.View.extend({className:"edy-tb edy-hidden",events:{'click [data-behavior="toggle-types-menu"]':"handleToggleTypesMenuClick",'click [data-behavior="toggle-options"]':"handleToggleOptionsClick",'click [data-behavior="select-gallery-type"]':"handleSelectGalleryTypeClick",'change [data-action-id="gallery-option-input"]':"handleGalleryOptionInputChange","change .edy-gallery-option-unit select":"handleGalleryOptionUnitChange"},initialize:function(e){this.galleryOptions=e.galleryOptions,this.galleryType=e.galleryType},render:function(){return this.el.innerHTML=JST["admin/templates/gallery_editor_toolbar"]({galleryTypes:this.getGalleryTypes(),currentType:this.galleryType,galleryOptions:this.galleryOptions}),this},getGalleryTypes:function(){var e=Edicy.siteOpts.getOption("extendGallery"),t={};return e&&e.length>0?e.forEach(function(e){t[e.galleryType]=I18n.t("gallery."+e.galleryType,{fallback:e.name})}):t={squares:I18n.t("gallery.squares",{fallback:"Squares"})},t},setGalleryOptions:function(e){var t=!this.el.classList.contains("edy-hidden")&&this.optionsIsVisible();this.galleryOptions=e.galleryOptions,this.galleryType=e.galleryType,this.render(),t&&(this.show(),this.showOptionsPanel())},show:function(){this.el.classList.remove("edy-hidden")},hide:function(){this.el.classList.add("edy-hidden"),this.hideTypesMenu(),this.hideOptionsPanel()},toggleTypesMenu:function(){var e=this.el.querySelector('[data-action-id="gallery-types-menu"]');e&&e.classList.toggle("edy-hidden")},hideTypesMenu:function(){var e=this.el.querySelector('[data-action-id="gallery-types-menu"]');e&&e.classList.add("edy-hidden")},toggleOptionsPanel:function(){var e=this.el.querySelector('[data-action-id="gallery-options-panel"]');e&&e.classList.toggle("edy-hidden")},showOptionsPanel:function(){var e=this.el.querySelector('[data-action-id="gallery-options-panel"]');e&&e.classList.remove("edy-hidden")},hideOptionsPanel:function(){var e=this.el.querySelector('[data-action-id="gallery-options-panel"]');e&&e.classList.add("edy-hidden")},optionsIsVisible:function(){var e=this.el.querySelector('[data-action-id="gallery-options-panel"]');return!e.classList.contains("edy-hidden")},handleToggleTypesMenuClick:function(){this.toggleTypesMenu(),this.hideOptionsPanel()},handleToggleOptionsClick:function(){this.toggleOptionsPanel(),this.hideTypesMenu()},handleSelectGalleryTypeClick:function(e){e.preventDefault();var t=e.target.getAttribute("data-gallery-type");this.trigger("edicy:gallery:toolbar:changetype",t),this.hideTypesMenu()},handleGalleryOptionInputChange:function(e){var t,i=e.target,n=i.getAttribute("name"),o=i.getAttribute("data-type"),a=i.value,r=i.parentNode.querySelector(".edy-gallery-option-unit-multi select");"number"===o&&(r&&(t=r.value),a=parseFloat(a)),this.trigger("edicy:gallery:toolbar:setoption",n,a,t)},handleGalleryOptionUnitChange:function(e){var t=e.target,i=t.value,n=t.getAttribute("data-key"),o=this.el.querySelector('input[name="'+n+'"]'),a=parseFloat(o.value||"");this.trigger("edicy:gallery:toolbar:setoption",n,a,i)}})}(),function(){Edicy.GalleryEditorPhotoToolbar=Edicy.Backbone.View.extend({className:"edy-gallery-item-tb edy-hidden",events:{'keydown [data-action-id="photo-title-input"]':"handleTitleKeydown",'keyup [data-action-id="photo-title-input"]':"handleTitleKeyup",'change [data-action-id="photo-title-input"]':"handlePhotoTitleChange"},show:function(e){this.model=this.collection.get(e),this.model&&(this.el.innerHTML=JST["admin/templates/gallery_editor_photo_toolbar"]({title:this.model.get("title")||""}),this.el.classList.remove("edy-hidden"))},hide:function(){this.model&&(this.model.get("title")!==this.el.querySelector('[data-action-id="photo-title-input"]').value&&this.model.set("title",this.el.querySelector('[data-action-id="photo-title-input"]').value),this.model=null),this.el.classList.add("edy-hidden")},handleTitleKeydown:function(e){(37==e.keyCode||39==e.keyCode)&&e.stopPropagation()},handleTitleKeyup:function(e){(37==e.keyCode||39==e.keyCode)&&e.stopPropagation(),13==e.keyCode&&(e.ctrlKey||this.el.querySelector('[data-action-id="photo-title-input"]').blur())},handlePhotoTitleChange:function(e){this.model&&this.model.set("title",e.target.value)}})}(),function(){Edicy.GalleryEditorView=Edicy.Backbone.View.extend({events:{"click .edy-gallery-placeholder":"handlePlaceholderClick",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","draggable:dragstart [data-gallery-photo-id]":"handleDragStart","draggable:dragend [data-gallery-photo-id]":"handleDragEnd","draggable:dragenter":"handleDragEnter","draggable:dragleave":"handleDragLeave","sortable:sort":"handleSort","sortable:receive":"handleSortReceive","sortable:appear":"handleSortAppear","sortable:remove":"handleSortRemove","sortable:dragover":"handleSortDragOver","sortable:dragenter":"handleSortDragEnter","sortable:dragleave":"handleSortDragLeave","edicy:content:deleterequested":"handleContentDeleteRequested","edicy:photo:lightbox:focus":"handlePhotoLightboxFocus","edicy:photo:lightbox:blur":"handlePhotoLightboxBlur"},initialize:function(){this.model=Edicy.galleries.add(JSON.parse(this.el.getAttribute("data-gallery")),{silent:!0,parse:!0}),this.model.on({"change:type":this.handleGalleryTypeChanged,"change:settings":this.handleGallerySettingsChanged},this),this.model.assets.on({add:this.handleAssetAdded,remove:this.handleAssetRemoved,change:this.handleAssetChanged},this),Edicy.on("edicy:save",this.handleSave,this),this.extension=this.fetchExtension(),this.initSortable(),this.initToolbar(),this.initPhotoToolbar()},render:function(){var e=this.getWrapperElement(),t=e.hasAttribute&&e.hasAttribute("data-gallery-photos")?e:e.querySelector("[data-gallery-photos]");if(!t)throw new Error('Gallery list element with attribute "data-gallery-photos" can not be found!');this.model.assets.forEach(function(e){t.appendChild(this.getImageElement(e))}.bind(this));var i=this.el.querySelector(".edy-gallery-area");return i.innerHTML="",i.appendChild(e),this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:change",{bubbles:!0})),this},remove:function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:remove",{bubbles:!0})),Edicy.galleries.remove(this.model),Edicy.off("edicy:save",this.handleSave,this)},initSortable:function(){Edicy.dragdrop.sortable(this.el,{accepts:"[data-gallery-photo-id], .edy-asset-image, .edy-asset-upload",items:"[data-gallery-photo-id]",within:"[data-gallery-photos]",droppables:".edy-accepts-assets, .edy-content-trashcan",helper:this.getSortHelper.bind(this),placeholder:this.getPlaceholder.bind(this),receive:this.getAppearedElement.bind(this),appear:this.getAppearedElement.bind(this),payload:this.getSortPayload.bind(this),acceptAppear:this.isAcceptableDrop.bind(this),acceptReceive:this.isAcceptableDrop.bind(this),tolerance:"overlap"})},getSortHelper:function(e){if(this.extension.helper){var t=this.model.assets.get(e.getAttribute("data-gallery-photo-id"));return this.extension.helper.call(this,t.attributes,e,this.fetchGallerySettings())}return this.getSortDefaultHelper(e)},getSortDefaultHelper:function(e){var t=(e.getBoundingClientRect(),document.createElement("div")),i=this.model.assets.get(e.getAttribute("data-gallery-photo-id"));return t.classList.add("edy-asset-dragproxy"),t.style.backgroundImage='url("'+i.get("thumbnail")+'")',t},fetchExtension:function(){return Edicy.siteOpts.hasOption("extendGallery")?Edicy.siteOpts.getOption("extendGallery").reduce(function(e,t){return t.galleryType==this.model.get("type")&&(e=t),e}.bind(this),{}):{}},getWrapperElement:function(){return this.extension.wrapper?this.extension.wrapper.call(this,this.model.id,this.fetchGallerySettings()):this.getDefaultWrapper(this.model.id)},getDefaultWrapper:function(e){var t=document.createElement("div");t.className="edys-gallery-area",t.setAttribute("data-gallery-id",e);var i=document.createElement("div");return i.className="edys-gallery",i.setAttribute("data-gallery-photos",""),t.appendChild(i),t},getPlaceholder:function(e,t){var i;return"upload"==t.type&&(t.thumbnail="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",t.url=t.thumbnail),i="upload"==t.type&&this.extension.uploadPlaceholder?this.extension.uploadPlaceholder.call(this,t,this.fetchGallerySettings()):this.extension.placeholder?this.extension.placeholder.call(this,t,e,this.fetchGallerySettings()):this.getDefaultPlaceholder(t,e)},getDefaultPlaceholder:function(e){var t=document.createElement("div");return t.classList.add("edy-gallery-item-placeholder"),t.classList.add("edy-gallery-sortable-placeholder"),t.style.backgroundImage='url("'+e.thumbnail+'")',t},getAppearedElement:function(e,t){return"upload"==t.type?this.getUploadElements(t):this.getImageElement(t)},getUploadElements:function(e){return e.files.reduce(function(e,t){return t.isImage()&&e.push(t),e}.bind(this),[]).map(this.getImageElement.bind(this))},getImageElement:function(e){var t,i;return i=e.attributes?e.attributes:e,e.cid&&(i.cid=e.cid),t=this.extension.item?this.extension.item.call(this,i,this.fetchGallerySettings()):this.getDefaultItem(i),e.isConfirmed&&!e.isConfirmed()?(t.setAttribute("data-gallery-photo-cid",i.cid),t.style.opacity=.5):t.setAttribute("data-gallery-photo-id",i.id),i.url&&t.setAttribute("data-original-url",i.url),i.sizes&&t.setAttribute("data-sizes",JSON.stringify(i.sizes)),i.title&&t.setAttribute("data-title",i.title),t},getDefaultItem:function(e){var t=document.createElement("div");return t.classList.add("edy-gallery-item"),t.style.backgroundImage='url("'+e.thumbnail+'")',t},fetchGallerySettings:function(){var e={};return this.fetchGalleryOptions().forEach(function(t){e[t.key]=this.model.getOption(t.key)||t.defaultValue}.bind(this)),e},fetchGalleryOptions:function(){return this.extension.options||[]},parseOptions:function(e){return e.map(function(e){var t={},i=this.model.getOption(e.key);for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return i?"number"==typeof i&&t.unit&&Array.isArray(t.unit)&&t.unitConverter?(t.value=t.unitConverter(t.value,void 0,t.unit[0],this.el.querySelector("[data-gallery-id]")),t.selectedUnit=t.unit[0]):"string"==typeof i&&t.type&&"number"===t.type&&t.unit&&Array.isArray(t.unit)?(t.selectedUnit=i.match(/[^\d\s]*$/i)[0],t.value=parseFloat(i)):t.value="number"===t.type?parseFloat(i):i:t.value="number"===t.type?parseFloat(t.defaultValue):t.defaultValue,t}.bind(this))},handleDragStart:function(e){e.stopPropagation(),e.target.classList.add("edy-hidden"),this.el.dispatchEvent(new CustomEvent("edicy:content:dragstart",{bubbles:!0}))},handleDragEnd:function(e){this.el.dispatchEvent(new CustomEvent("edicy:content:dragend",{bubbles:!0})),e.stopPropagation(),e.target.classList.remove("edy-hidden")},getSortPayload:function(e){var t=this.model.assets.get(e.getAttribute("data-gallery-photo-id")).attributes;return t.type="photo",t},isAcceptableDrop:function(e,t){return-1==this.model.assets.pluck("id").indexOf(parseInt(t.id,10))},updateAssetPositions:function(){[].forEach.call(this.el.querySelectorAll("[data-gallery-photo-id]"),function(e,t){this.model.assets.get(e.getAttribute("data-gallery-photo-id")).set("position",++t)}.bind(this)),this.model.assets.sort()},handleDragEnter:function(){this.$(".edy-gallery-msg-normal").addClass("edy-hidden"),this.$(".edy-gallery-msg-hover").removeClass("edy-hidden")},handleDragLeave:function(){this.$(".edy-gallery-msg-normal").removeClass("edy-hidden"),this.$(".edy-gallery-msg-hover").addClass("edy-hidden")},handleSortAppear:function(e){var t=e.originalEvent.detail.payload;if("upload"==t.type)return t.files.forEach(function(e){this.model.assets.add(e)}.bind(this)),void 0;this.model.assets.add(t);var i=e.originalEvent.detail.appearedElement,n=this.el.querySelectorAll("[data-gallery-photo-id]"),o=i&&n?Array.prototype.indexOf.call(n,i)+1:void 0;setTimeout(function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:change",{bubbles:!0,detail:{position:o}}))}.bind(this),0)},handleSort:function(e){this.el.dispatchEvent(new CustomEvent("edicy:content:dragend",{bubbles:!0})),this.updateAssetPositions(),this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:change",{bubbles:!0,detail:{position:e.originalEvent.detail.payload.position}}))},handleSortReceive:function(e){this.model.assets.add(e.originalEvent.detail.payload);var t=e.originalEvent.detail.receivedElement,i=this.el.querySelectorAll("[data-gallery-photo-id]"),n=t&&i?Array.prototype.indexOf.call(i,t)+1:void 0;setTimeout(function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:change",{bubbles:!0,detail:{position:n}}))}.bind(this),0)},handleSortRemove:function(e){this.model.assets.remove(e.originalEvent.detail.draggable.getAttribute("data-gallery-photo-id"))},handleSortDragOver:function(e){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:sort",{bubbles:!0,detail:{position:e.originalEvent.detail.payload.position}}))
},handleSortDragEnter:function(e){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:dragenter",{bubbles:!0,detail:{position:e.originalEvent.detail.payload.position}}))},handleSortDragLeave:function(e){setTimeout(function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:dragleave",{bubbles:!0,detail:{position:e.originalEvent.detail.payload.position}}))}.bind(this),0)},handleAssetAdded:function(){this.setPlaceholderVisibility(),this.updateAssetPositions()},handleAssetRemoved:function(e){var t=this.el.querySelector('[data-gallery-photo-id="'+e.id+'"]');t&&Edicy.dom.remove(t),this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:deleteimage",{bubbles:!0})),this.updateAssetPositions(),this.setPlaceholderVisibility()},handleAssetChanged:function(e){var t=this.el.querySelector('[data-gallery-photo-id="'+e.id+'"]');if(t||(t=this.el.querySelector('[data-gallery-photo-cid="'+e.cid+'"]')),t){var i=this.getImageElement(e);t.parentNode.replaceChild(i,t)}e.has("position")||this.updateAssetPositions();var n=this.el.querySelector('[data-gallery-photo-id="'+e.id+'"]');n&&(e.has("title")&&n.setAttribute("data-title",e.get("title")),n.dispatchEvent(new CustomEvent("edicy:gallery:photo:change",{bubbles:!0,detail:{gallery_id:this.model.id,photo_id:e.id,photos:this.model.assets.map(function(e){return e.toJSON()}),photo:e.toJSON()}})))},setPlaceholderVisibility:function(){this.model.assets.isEmpty()?this.el.classList.add("edy-gallery-empty"):this.el.classList.remove("edy-gallery-empty")},handleContentDeleteRequested:function(e){var t=e.originalEvent.detail;Edicy.dom.matches(t,"[data-gallery-photo-id]")&&this.el.contains(t)&&setTimeout(function(){this.model.assets.remove(t.getAttribute("data-gallery-photo-id"))}.bind(this),0)},handleSave:function(){if(this.model.hasPendingChanges()){var e=this.model.save();Edicy.trigger("edicy:saving",e)}},handlePlaceholderClick:function(){Edicy.trigger("edicy:openpicker","files")},initToolbar:function(){this.toolbar=new Edicy.GalleryEditorToolbar({galleryType:this.model.get("type"),galleryOptions:this.parseOptions(this.fetchGalleryOptions())}).render(),this.toolbar.on("edicy:gallery:toolbar:changetype",this.handleTypeChange.bind(this)),this.toolbar.on("edicy:gallery:toolbar:setoption",this.handleOptionSet.bind(this)),this.el.insertBefore(this.toolbar.el,this.el.firstChild)},handleTypeChange:function(e){this.model.set("type",e)},getOptionByKey:function(e){var t=this.parseOptions(this.fetchGalleryOptions());if(e&&t)for(var i=t.length;i--;)if(t[i].key===e)return t[i];return void 0},getUnitConverter:function(e){var t=this.getOptionByKey(e);return t?t.unitConverter:void 0},handleOptionSet:function(e,t,i){var n,o=(this.fetchGalleryOptions(),this.getOptionByKey(e)),a=this.getUnitConverter(e);o&&(o.selectedUnit?n=o.selectedUnit:Array.isArray(o.unit)&&o.unit.length>0&&(n=o.unit[0])),a&&i&&n&&n!==i&&(t=a(t,o&&o.selectedUnit,i,this.el.querySelector("[data-gallery-id]"))),"undefined"!=typeof i?this.model.setOption(e,t+i):this.model.setOption(e,t)},handleMouseEnter:function(){this.clearToolbarStateChange(),this.showToolbar()},handleMouseLeave:function(){this.toolbarHideTimeout=setTimeout(this.hideToolbar.bind(this),400)},clearToolbarStateChange:function(){this.toolbarHideTimeout&&clearTimeout(this.toolbarHideTimeout)},showToolbar:function(){this.toolbar.show()},hideToolbar:function(){this.toolbar.hide()},handleGalleryTypeChanged:function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:beforechange",{bubbles:!0})),this.extension=this.fetchExtension(),this.toolbar.setGalleryOptions({galleryOptions:this.parseOptions(this.fetchGalleryOptions()),galleryType:this.model.get("type")}),this.render()},handleGallerySettingsChanged:function(){this.el.querySelector("[data-gallery-id]").dispatchEvent(new CustomEvent("edicy:gallery:beforechange",{bubbles:!0})),this.toolbar.setGalleryOptions({galleryOptions:this.parseOptions(this.fetchGalleryOptions()),galleryType:this.model.get("type")}),this.render()},handlePhotoLightboxFocus:function(e){var t=parseInt(Edicy.dom.closest(e.target,"[data-gallery-photo-id]").getAttribute("data-gallery-photo-id"),10);this.photoToolbar.show(t)},handlePhotoLightboxBlur:function(e){var t=parseInt(Edicy.dom.closest(e.target,"[data-gallery-photo-id]").getAttribute("data-gallery-photo-id"),10);this.photoToolbar.hide(t)},initPhotoToolbar:function(){this.photoToolbar=new Edicy.GalleryEditorPhotoToolbar({collection:this.model.assets}).render(),document.body.appendChild(this.photoToolbar.el)}})}(),function(e,t){Edicy.ContentAreaView=Edicy.Backbone.View.extend({events:{"click .edy-ca-empty-placeholder":"handlePlaceholderClick","partials:create":"toggleAddButtons","partials:remove":"toggleAddButtons","draggable:dragstart .edy-content-element":"handleDragStart","draggable:dragend .edy-content-element":"handleDragEnd","draggable:dragenter":"handleDragEnter","draggable:dragleave":"handleDragLeave","draggable:drag":"handleDrag","sortable:appear":"handleSortableAppear","sortable:sort":"handleSortableSort","sortable:remove":"toggleAddButtons"},initialize:function(){Edicy.dragdrop.sortable(this.el,{accepts:".edy-content-element, .edy-content-thumb",items:".edy-content-element",within:".edy-content-elements",handle:".edy-partial-draghandle",helper:this.sortableHelper,placeholder:this.sortablePlaceholder,appear:this.getAppearedElement,droppables:".edy-ca-sortable, .edy-content-trash-droppable",exclude:".edy-bar-container",distance:10})},toggleAddButtons:function(){0==this.$(".edy-content-element").length?(this.$el.addClass("edy-ca-empty"),this.$(".edy-content-default").length>0&&this.$el.addClass("edy-ca-defaultcontent"),this.$(".edy-content-default").show()):(this.$(".edy-content-default").hide(),this.$el.removeClass("edy-ca-empty edy-ca-defaultcontent"))},addPartial:function(i,n){e.ajax({url:this.$el.data("partial-create-path"),type:"post",data:t.compactObject({partial:t.extend(this.$el.data("partial-create-attribs"),{content_type:i,content_options:n.contentOptions}),before:n.before,after:n.after}),dataType:"script",success:n.success})},handlePlaceholderClick:function(){Edicy.trigger("edicy:openpicker","content")},handleDragStart:function(t){Edicy.dom.matches(t.originalEvent.detail.draggable,".edy-content-element")&&(e(t.target).addClass("edy-ca-dragging"),this.el.dispatchEvent(new CustomEvent("edicy:content:dragstart",{bubbles:!0})))},handleDragEnd:function(t){Edicy.dom.matches(t.originalEvent.detail.draggable,".edy-content-element")&&(e(t.target).removeClass("edy-ca-dragging"),this.el.dispatchEvent(new CustomEvent("edicy:content:dragend",{bubbles:!0})))},handleDragEnter:function(){this.$el.addClass("edy-ca-drag-over")},handleDragLeave:function(){this.$el.removeClass("edy-ca-drag-over")},handleDrag:function(e){var t=e.originalEvent.detail.helper;t.style.maxWidth=window.innerWidth-parseInt(t.style.left,10)+"px"},sortablePlaceholder:function(){var e=document.createElement("span");return e.classList.add("edy-ca-drag-placeholder"),e},sortableHelper:function(t){return e("<div/>",{"class":"edy-content-element-draghelper"}).css({width:e(t).width(),height:e(t).height()}).get(0)},getAppearedElement:function(){return e("<div/>").html("").get(0)},handleSortableAppear:function(t){t.stopPropagation();var i=t.originalEvent.detail.appearedElement,n=t.originalEvent.detail.payload,o={before:e(i).next(".edy-content-element").data("partial-id"),after:e(i).prev(".edy-content-element").data("partial-id"),success:function(){e(i).remove()}};n.contentOptions&&(o.contentOptions=n.contentOptions),n.contentType&&this.addPartial(n.contentType,o)},handleSortableSort:function(t){t.stopPropagation(),e(t.originalEvent.detail.draggable).trigger("edicy:content:relocated"),this.toggleAddButtons()}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.PartialView=Edicy.Backbone.View.extend({events:{"click .edy-cb-move":!1,mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","edicy:partial:addrequested":"handlePartialAddRequested","edicy:content:relocated":"handleContentRelocated","edicy:content:deleterequested":"handleContentDeleteRequested","content:activate":"handleContentActivate","content:deactivate":"handleContentDeactivate","content:remove":"handleContentRemove","ajax:beforeSend .edy-cb-delete":"handleDeleteStarted"},initialize:function(e){this.options=t.defaults(e,{focus:!1})},render:function(){return this.$(".edy-textpartial-view").length>0&&(this.editor=new Edicy.TextPartialView({el:this.$(".edy-textpartial-view"),focus:this.options.focus})),this.$(".edy-gallery-view").length>0&&(this.editor=new Edicy.GalleryEditorView({el:this.$(".edy-gallery-view")})),this.$(".edy-fe-view").length>0&&(this.editor=new Edicy.FormEditorView({el:this.$(".edy-fe-view")})),this.$(".edy-cp-view").length>0&&(this.editor=new Edicy.ContentPartialView({el:this.$(".edy-cp-view"),focus:this.options.focus})),this},handleContentActivate:function(){this.$el.addClass("edy-content-element-activated"),this.$el.removeClass("edy-content-element-hover")},handleContentDeactivate:function(){this.$el.removeClass("edy-content-element-activated")},handleContentRelocated:function(){e.ajax({url:this.$el.data("relocate-path"),type:"put",data:t.compactObject({name:this.$el.closest(".edy-ca").data("name"),page_id:this.$el.closest(".edy-ca").data("page-id"),page_type:this.$el.closest(".edy-ca").data("page-type"),before:this.$el.next(".edy-content-element").data("partial-id"),after:this.$el.prev(".edy-content-element").data("partial-id")}),dataType:"json"})},handleContentDeleteRequested:function(t){var i=t.originalEvent.detail;i==this.el&&(t.stopPropagation(),this.$el.css({maxHeight:this.$el.height()+50}),setTimeout(function(){this.$el.addClass("edy-content-element-animatesheight")}.bind(this),0),setTimeout(function(){this.$el.css({maxHeight:0,opacity:0})}.bind(this),1),setTimeout(function(){e.ajax({url:this.$el.data("delete-path"),type:"delete",dataType:"script"})}.bind(this),500))},handlePartialAddRequested:function(i,n){this.$el.removeClass("edy-content-default").addClass("edy-content-element"),this.$el.closest(".edy-content-elements").trigger("partials:create");var o=e.ajax({method:"post",url:this.$el.attr("data-partial-create-path"),data:{partial:t.extend(this.$el.closest(".edy-ca").data("partial-create-attribs"),{content_type:"text",content_options:n.content_options})},dataType:"json",success:this.handlePartialAdded.bind(this)});Edicy.trigger("edicy:saving",o)},handlePartialAdded:function(e){this.$el.attr({id:e.partial.dom_id,"data-partial-id":e.partial.id,"data-relocate-path":e.partial.relocate_path,"data-delete-path":e.partial.delete_path}),this.$(".edy-partial-content-view").trigger("edicy:partial:created",e.content)},handleContentRemove:function(){this.editor&&this.editor.remove()},handleMouseEnter:function(t){Edicy.dragdrop.currentDrags.length>0||this.$el.hasClass("edy-content-element-activated")||(clearTimeout(this.timeout),e(".edy-content-element-hover").removeClass("edy-content-element-hover"),this.$(".edy-partial-close").css("margin-left",this.$el.width()-9),this.$el.addClass("edy-content-element-hover"),this.showDragHandlers(t.metaKey))},showDragHandlers:function(){var e=this.el.getBoundingClientRect(),t=10,i=3,n=6,o=0+i,a=o-t,r=e.height-n-i,s=r+t,l=0+i,d=l-t,c=e.width-n-i,h=c+t;Edicy.dom.matches(this.el.previousElementSibling,".edy-content-element")&&(a=0+i-t/2,o=n),Edicy.dom.matches(this.el.nextElementSibling,".edy-content-element")&&(r-=5,s=r+t),this.$(".edy-partial-draghandle-top").css({top:a,left:d,width:Math.abs(d-h),height:Math.abs(a-o)}),this.$(".edy-partial-draghandle-right").css({top:o,left:c,width:t,height:Math.abs(o-r)}),this.$(".edy-partial-draghandle-bottom").css({top:r,left:d,width:Math.abs(d-h),height:Math.abs(s-r)}),this.$(".edy-partial-draghandle-left").css({top:o,left:d,width:t,height:Math.abs(o-r)}),this.$(".edy-partial-draghandles").addClass("edy-partial-draghandles-visible")},hideDragHandlers:function(){this.$(".edy-partial-draghandles").removeClass("edy-partial-draghandles-visible")},handleMouseLeave:function(){this.timeout=setTimeout(function(){this.hideDragHandlers(),this.$el.removeClass("edy-content-element-hover").removeClass("edy-content-element-active")}.bind(this),500)},handleDeleteStarted:function(){this.$el.addClass("edy-deleting")}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.TagListItemView=Edicy.Backbone.View.extend({tagName:"div",className:"edy-tag-holder",events:{"click .edy-tag-remove":"removeTag"},initialize:function(){this.tagTemplate=t.template('{{name}} <div class="edy-tag-remove"></div>'),this.model.on("remove",this.handleRemove,this)},render:function(){return this.$el.html(this.tagTemplate({name:this.model.get("name")})),this},removeTag:function(){this.model.collection.remove(this.model)},handleRemove:function(){this.remove()}}),Edicy.TagListEditorView=Edicy.Backbone.View.extend({events:{click:"handleClick","click .edy-tag-suggestions a":"handleSuggestionClick","click .edy-taglist-openarrow":"handleOpenArrowClick","keydown .edy-tag-input":"handleInputKeydown"},initialize:function(){this.tags=new Edicy.Backbone.Collection,this.tags.url=this.$el.attr("data-tags-api-url"),this.tags.on({request:this.handleTagsRequest,sync:this.handleTagsSync},this),this.collection=new Edicy.Backbone.Collection(this.$el.data("tags")),this.collection.on({reset:this.render,add:this.handleAddTag,remove:this.handleRemoveTag},this),this.handleSideClick=this.handleSideClick.bind(this),e(document).on("click",this.handleSideClick)},render:function(){return this.$(".edy-tag-input").placeholder({customClass:"edy-placeholder"}),this.$suggestions=this.$(".edy-tag-suggestions"),this.$suggestionsInner=this.$(".edy-tag-suggestions-inner"),this.togglePlaceholder(),this.collection.each(this.handleAddTag,this),this.resizeInput(),this},handleAddTag:function(e){var t=new Edicy.TagListItemView({model:e});this.$(".edy-tag-input").before(t.render().$el),this.$suggestions.hide(),this.resizeInput(),this.trigger("change",{editor:this,target:this.el})},handleRemoveTag:function(){this.$(".edy-tag-input").focus(),this.togglePlaceholder(),this.resizeInput(),this.trigger("change",{editor:this,target:this.el})},cleanString:function(e){return e.replace(/[^a-zõäöü0-9\u00C0-\u01BF\u01C4-\u024F\u0370-\u052F\u1E00-\u1FFF\u20A0-\u20CF\u2600-\u26FF\u4E00-\u9FCC\u3400-\u4DB5\uF900-\uFAFF\- ]/gi,"")},togglePlaceholder:function(){this.collection.length>0||""!==this.$(".edy-tag-input").val()?this.$(".edy-tag-input").attr("placeholder",""):this.$(".edy-tag-input").attr("placeholder",this.$(".edy-tag-input").data("placeholder"))},handleClick:function(t){0==e(t.target).closest(".edy-tag-holder, .edy-tag-suggestions, .edy-taglist-openarrow").length&&this.$(".edy-tag-input").focus()},handleInputDelete:function(){""==this.$(".edy-tag-input").val()?this.collection.pop():setTimeout(this.showSuggestionList.bind(this),0)},handleInputKeydown:function(e){38==e.which?(e.preventDefault(),this.selectSuggestionUp()):40==e.which?(e.preventDefault(),this.selectSuggestionDown()):13==e.which||188==e.which?(e.preventDefault(),this.addTag()):27==e.which?(e.preventDefault(),this.$(".edy-tag-input").val(""),this.$suggestions.hide()):8==e.which?this.handleInputDelete():setTimeout(this.showSuggestionList.bind(this),0),setTimeout(this.togglePlaceholder.bind(this),0)},resizeInput:function(){var e=parseFloat(this.$el.css("padding-right"));this.$(".edy-tag-input").css("width","80px"),this.$(".edy-tag-input").css("width",this.$el.width()-this.$(".edy-tag-input").position().left-e+"px")},handleTagsRequest:function(){this.$(".edy-taglist-loader").show().dotLoader(),this.$(".edy-taglist-openarrow").hide()},handleTagsSync:function(e,t,i){this.$(".edy-taglist-loader").hide().dotLoader(!1),this.$(".edy-taglist-openarrow").show(),this.tags.synced=!0,this.showSuggestionList(i&&i.showIfEmpty,i&&i.showAtArrow)},handleOpenArrowClick:function(){this.$suggestions.is(":visible")?this.$suggestions.hide():this.showSuggestionList(!0,!0)},handleSideClick:function(t){0===e(t.target).closest(this.$el).length&&this.$suggestions.hide()},showSuggestionList:function(i,n){if(!(i||this.$(".edy-tag-input").val()&&""!==this.$(".edy-tag-input").val()))return this.$suggestions.hide(),void 0;if(this.tags.isEmpty()&&!this.tags.synced)return this.tags.fetch({showIfEmpty:i,showAtArrow:n}),void 0;this.$suggestionsInner.scrollTop(0);var o=n?"":this.$(".edy-tag-input").val().toLowerCase(),a=t.filter(this.tags.models,function(e){return 0==e.get("name").toLowerCase().indexOf(o)&&0==this.collection.where({name:e.get("name")}).length}.bind(this));this.$suggestionsInner.html(""),a.length>0?(t.each(a,function(t){var i=e('<a href="#">').addClass("edy-tag-suggestion").html(t.get("name")).data("tag-name",t.get("name"));this.$suggestionsInner.append(i)},this),this.showSuggestions(n)):this.$suggestions.hide()},positionSuggestionsList:function(t){var i=this.$suggestions.get(0).getBoundingClientRect(),n=e(window).height();this.suggestionsAbove=i.bottom>n-50,t||!this.$(".edy-tag-input").is(":focus")?this.$suggestions.css({right:"0px",left:"auto",top:this.suggestionsAbove?"auto":"2em",bottom:this.suggestionsAbove?this.$(".edy-tag-input").outerHeight()+5:"auto"}):this.$suggestions.css({top:this.suggestionsAbove?"auto":this.$(".edy-tag-input").position().top+this.$(".edy-tag-input").height()+"px",bottom:this.suggestionsAbove?this.$(".edy-tag-input").outerHeight()+5:"auto",right:"auto",left:this.$(".edy-tag-input").position().left+"px"})},showSuggestions:function(e){this.$suggestions.css("visibility","hidden").show(),this.positionSuggestionsList(e),this.$suggestions.css("visibility","visible")},selectSuggestionUp:function(){if(this.$suggestions.is(":visible")||""!=this.$(".edy-tag-input").val()||this.showSuggestionList(!0),this.$suggestionsInner.children().length>0){var e;e=this.$suggestions.find(".edy-tag-suggestion.active").length>0?this.$suggestions.find(".edy-tag-suggestion.active").eq(0).prev(".edy-tag-suggestion"):this.$suggestions.find(".edy-tag-suggestion").eq(0),e.length>0&&(this.$suggestions.find(".edy-tag-suggestion.active").removeClass("active"),e.addClass("active"),this.$(".edy-tag-input").val(e.data("tag-name")),this.adjustListScroll(e))}},selectSuggestionDown:function(){if(this.$suggestions.is(":visible")||""!=this.$(".edy-tag-input").val()||this.showSuggestionList(!0),this.$suggestionsInner.children().length>0){var e;e=this.$suggestions.find(".edy-tag-suggestion.active").length>0?this.$suggestions.find(".edy-tag-suggestion.active").eq(0).next(".edy-tag-suggestion"):this.$suggestions.find(".edy-tag-suggestion").eq(0),e.length>0&&(this.$suggestions.find(".edy-tag-suggestion.active").removeClass("active"),e.addClass("active"),this.$(".edy-tag-input").val(e.data("tag-name")),this.adjustListScroll(e))}},adjustListScroll:function(e){e.focus(),this.$(".edy-tag-input").focus()},addTag:function(){if(""!==this.$(".edy-tag-input").val()){var e=this.cleanString(this.$(".edy-tag-input").val());0==this.collection.where({name:e}).length&&this.collection.add({name:e}),this.$(".edy-tag-input").val("").focus()}this.togglePlaceholder()},handleSuggestionClick:function(t){t.preventDefault();var i=e(t.target).closest(".edy-tag-suggestion");this.$(".edy-tag-input").val(i.data("tag-name")),this.addTag()}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.ArticleEditorView=Edicy.Backbone.View.extend({initialize:function(e){this.options=e,this.initEditors(),this.model=Edicy.articles.add(new Edicy.Article(t.extend({id:e.model.id,page_id:e.model.page_id},this.getEditableValues())),{silent:!0}),Edicy.articles.currentArticle=this.model,Edicy.on("edicy:save",this.handleSave,this)},initEditors:function(){this.findEditable("title",function(e){this.titleEditor=new Edicy.PlaintextEditorView({el:e}),this.titleEditor.on("change",function(){this.model.set("autosaved_title",this.titleEditor.getValue())},this)}),this.findEditable("excerpt",function(e){this.excerptEditor=new Edicy.TextEditorView({el:e}),this.excerptEditor.on("change",function(){this.model.set("autosaved_excerpt",this.excerptEditor.getValue())},this)}),this.findEditable("body",function(e){this.bodyEditor=new Edicy.TextEditorView({el:e}),this.bodyEditor.on("change",function(){this.model.set("autosaved_body",this.bodyEditor.getValue())},this)}),this.findEditable("tags",function(e){this.tagsEditor=new Edicy.TagListEditorView({el:e}).render(),this.tagsEditor.on("change",function(){this.model.set("tag_names",this.tagsEditor.collection.pluck("name"))},this)})},findEditable:function(e,t){var i=this.$('.edy-editable[data-editable-type="article"][data-editable-field="'+e+'"][data-editable-cid="'+this.options.cid+'"]');i.length>0&&t.apply(this,i)},getEditableValues:function(){return{autosaved_title:this.titleEditor&&this.titleEditor.getValue(),autosaved_excerpt:this.excerptEditor&&this.excerptEditor.getValue(),autosaved_body:this.bodyEditor&&this.bodyEditor.getValue(),tag_names:this.tagsEditor&&this.tagsEditor.collection.pluck("name")}},setEditableValues:function(){this.model.set(this.getEditableValues())},handleSave:function(){if(this.setEditableValues(),this.model.hasPendingChanges()){var e=this.model.save(null,{patch:!0,success:this.handleSaveResponse});Edicy.trigger("edicy:saving",e)}},handleSaveResponse:function(e,t){t.page_url&&window.history.replaceState&&window.history.replaceState(null,null,t.page_url),t.edit_url&&Edicy.trigger("edicy:change:page_settings_url",t.edit_url)}})}(Edicy.jQuery,Edicy.Underscore),function(){Edicy.ArticleSettingsView=Edicy.Backbone.View.extend({mixins:[Edicy.ImagePickerMixin],events:{"ajax:before":"handleUpdateStarted",'ajax:before [data-method="delete"]':"handleDeleteStarted",'change input[name="article[path]"]':"handlePathChange"},render:function(){return this},handleUpdateStarted:function(){this.$(".edy-article-save-btn").dotLoader({replace:!0})},handlePathChange:function(){var e=this.$('input[name="article[path]"]');e.val(getSlug(e.val(),{custom:Edicy.slugReplacements}))},handleDeleteStarted:function(e){e.stopPropagation(),this.$(".edy-article-delete-btn").dotLoader({replace:!0})}})}(Edicy.jQuery),function(){this.JST||(this.JST={}),this.JST["admin/templates/image_drop"]=function(obj){var __p=[];with(obj||{})__p.push(""),src?__p.push('\n  <div class="edy-btn-cm-round edy-element-thumb-catcher-delete"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M6 6l8 8m-8 0l8-8" stroke="currentColor" stroke-width="2" fill="none"/>\n</svg>\n</div>\n  <img class="edy-element-thumb-catcher-image" src="',src,'"/>\n  <div class="edy-element-thumb-catcher-title" title="',src,'">',title,"</div>\n"):__p.push('\n  <div class="edy-element-thumb-empty">Drop image here</div>\n'),__p.push("\n");return __p.join("")}}.call(this),function(e,t){Edicy.ElementEditorView=Edicy.Backbone.View.extend({initialize:function(e){t.bindAll(this,"handleEditorChange"),this.options=e,this.initEditors(),this.model=Edicy.elements.add(new Edicy.Element(t.extend({id:e.model.id,page_id:e.model.page_id,element_definition_id:this.getElementDefinitionId()},this.getEditorValues())),{silent:!0}),Edicy.elements.currentElement=this.model,Edicy.on("edicy:save",this.handleSave,this)},initEditors:function(){t.each(this.$('.edy-editable[data-editable-type="element"][data-editable-cid="'+this.options.cid+'"]'),function(t){var i=e(t),n=i.data("element-field-type");"text"==n?i.data("element-editor",new Edicy.TextEditorView({el:i})):"string"==n?"title"===i.data("editable-field")?i.data("element-editor",new Edicy.PlaintextEditorView({el:i})):i.data("element-editor",new Edicy.ElementStringEditorView({el:i})):"number"==n?i.data("element-editor",i):"select"==n?i.data("element-editor",i):"boolean"==n?i.data("element-editor",i):"image"==n?i.data("element-editor",new Edicy.ThumbDropCatcher({el:i})):"date"==n?i.data("element-editor",new Edicy.DateEditorView({el:i.find('input[type="date"]')})):"datetime"==n?i.data("element-editor",new Edicy.DateEditorView({el:i.find('input[type="datetime"]')})):"relation"==n&&i.data("element-editor",new Edicy.RelationBuilderView({el:i})),i.data("element-editor").on("change",this.handleEditorChange)},this)},handleEditorChange:function(t){if(t.editor&&t.editor.el){var i,n=e(t.editor.$el),o=n.data("editable-field"),a=n.data("element-field-type"),r=t.editor;r.getValue&&(i=r.getValue()),i&&"title"==o?this.model.set("title",i):this.model.setValue(o,i)}else if(t.target){var i,n=e(t.target),o=n.data("editable-field"),a=n.data("element-field-type"),r=n.data("element-editor");r.getValue?i=r.getValue():"select"==a||"number"==a?i=r.val():"boolean"==a&&(i=r.is(":checked").toString()),i&&"title"==o?this.model.set("title",i):this.model.setValue(o,i)}},getElementDefinitionId:function(){return this.$('.edy-editable[data-editable-type="element"][data-editable-cid="'+this.options.cid+'"]').data("element-definition-id")},getEditorValues:function(){var i={values:{}};return t.each(this.$('.edy-editable[data-editable-type="element"][data-editable-cid="'+this.options.cid+'"]'),function(t){var n,o=e(t),a=o.data("editable-field"),r=o.data("element-field-type"),s=e(t).data("element-editor");s&&(s.getValue?n=s.getValue():"select"==r||"number"==r?n=s.val():"boolean"==r&&(n=s.is(":checked").toString()),n&&"title"==a?i.title=n:i.values[a]=n)},this),i},setEditableValues:function(){this.model.set(this.getEditorValues())},handleSave:function(){if(this.setEditableValues(),this.model.hasPendingChanges()){var e=this.model.save(null,{patch:!0,success:this.handleSaveResponse});Edicy.trigger("edicy:saving",e)}},handleSaveResponse:function(e,t){t.page_url&&window.history.replaceState(null,null,t.page_url),t.edit_url&&Edicy.trigger("edicy:change:page_settings_url",t.edit_url)}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.RelationBuilderView=Edicy.Backbone.View.extend({events:{"click .edy-relbuilder-add":"handleAddButtonClick","click .edy-relbuilder-remove":"handleRemoveButtonClick"},handleChange:function(){this.trigger("change",{editor:this,target:this.el})},handleAddButtonClick:function(t){if(t.preventDefault(),!this.linkeditor){var i=e(t.target).closest(".edy-relbuilder-add"),n=new Edicy.ElementSearchCollection;n.url=i.attr("href"),this.linkeditor=new Edicy.ItemPickerView({parent:i,relative:!1,collection:n}).render(),this.linkeditor.on("item:selected",function(t){var i=e("<li/>").append(this.$(".edy-relbuilder-item-tpl").html()).attr("data-item-id",t.id);i.find(".edy-relbuilder-item-title").html(t.title),this.$(".edy-relbuilder-itemlist").append(i),this.handleChange()},this)}this.linkeditor.toggle(),this.linkeditor.isVisible()&&this.linkeditor.focus()},handleRemoveButtonClick:function(t){t.preventDefault(),e(t.target).closest("li").remove(),this.handleChange()},getValue:function(){return t.map(this.$(".edy-relbuilder-itemlist li"),function(t){return e(t).data("item-id")})}})}(Edicy.jQuery,Edicy.Underscore),function(){Edicy.ElementSettingsView=Edicy.Backbone.View.extend({events:{"ajax:before":"handleUpdateStarted",'ajax:before [data-method="delete"]':"handleDeleteStarted"},handleUpdateStarted:function(){this.$(".edy-element-save-btn").dotLoader({replace:!0})},handleDeleteStarted:function(e){e.stopPropagation(),this.$(".edy-element-delete-btn").dotLoader({replace:!0})}})}(Edicy.jQuery),function(e,t){Edicy.ThumbDropCatcher=Edicy.Backbone.View.extend({events:{"click .edy-element-thumb-catcher-delete":"handleDeleteClick","draggable:drop":"handleDrop"},initialize:function(){t.bindAll(this,"handleDrop"),this.imageUrl=this.$el.text(),this.$el.data("target-width")&&(this.targetWidth=parseInt(this.$el.data("target-width"),10)),this.$el.data("include-all-sizes")&&(this.includeAllSizes=!0),this.$el.addClass("edy-element-thumb-catcher edy-accepts-assets"),this.setPreview()},handleChange:function(){this.trigger("change",{editor:this,target:this.el})},setPreview:function(){this.$el.html(JST["admin/templates/image_drop"]({src:this.imageUrl,title:decodeURIComponent(t.last(this.imageUrl.split("/")))}))},handleDeleteClick:function(){this.imageUrl="",this.setPreview(),this.handleChange()},handleDrop:function(e){var t=e.originalEvent.detail.payload;"photo"===t.type&&(this.imageUrl=this.targetWidth?this.getPhotoByWidth(t.sizes,this.targetWidth,this.includeAllSizes):t.url,this.setPreview(),this.handleChange())},getValue:function(){return this.imageUrl||""},getPhotoByWidth:function(e,t,i){for(var n,o,a=null,r=e.length;r--;)n=e[r].width-t,e[r].thumbnail&&"medium"===e[r].thumbnail&&!i||!(!a||0>o&&n>=0||(o>=0&&n>=0||0>o&&0>n)&&Math.abs(n)<Math.abs(o))||(a=e[r].url,o=n);return a}})}(Edicy.jQuery,Edicy.Underscore),function(e){Edicy.ElementStringEditorView=Edicy.PlaintextEditorView.extend({events:e.extend({},Edicy.PlaintextEditorView.prototype.events,{"draggable:drop":"handleDrop","draggable:dragenter":"handleDragEnter","draggable:dragleave":"handleDragLeave"}),initialize:function(){this.$el.addClass("edy-accepts-assets"),Edicy.PlaintextEditorView.prototype.initialize.call(this)},handleDrop:function(e){var t=e.originalEvent.detail.payload;t.url&&(this.$el.html(Edicy.StringUtil.url_encode_quotes(t.url)),this.hasPlaceholder=!1)},handleDragEnter:function(){this.$el.addClass("edy-texteditor-dragover")},handleDragLeave:function(){this.$el.removeClass("edy-texteditor-dragover")}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.SiteHeaderEditorView=Edicy.Backbone.View.extend({initialize:function(e){this.initEditors(),this.model=new Edicy.Language(t.compactObject({id:e.model.id,site_header:this.headerEditor&&this.headerEditor.getValue()})),this.model.url=e.model.url,Edicy.on("edicy:save",this.handleSave,this)},initEditors:function(){var e=this.$('.edy-editable[data-editable-type="language"][data-editable-field="site_header"][data-editable-id="'+this.model.id+'"]');e.length>0&&(this.headerEditor=new Edicy.TextEditorView({el:e}),this.headerEditor.on("change",this.setEditableValues,this))},setEditableValues:function(){this.model.set({site_header:this.headerEditor&&this.headerEditor.getValue()})},handleSave:function(){if(this.setEditableValues(),this.model.hasPendingChanges()){var e=this.model.save(null,{patch:!0});Edicy.trigger("edicy:saving",e)}}})}(Edicy.jQuery,Edicy.Underscore),function(e,t){Edicy.PageEditorView=Edicy.Backbone.View.extend({events:{"click .fci-editor-menuadd":"handleTranslatePageClick","ajax:before .edy-menu-menuadd":"handleMenuaddClick","ajax:complete .edy-menu-menuadd":"handleMenuaddLoaded","ajax:before .edy-menu-langadd":"handleLanguageAddClick","ajax:complete .edy-menu-langadd":"handleLanguageAddLoaded","click .edy-menu-hidden":"handleHiddenBtnClick","ajax:success .edy-btn-removecomment":"handleCommentDeleted"},initialize:function(){t.bindAll(this,"handleWindowUnload"),setInterval(function(){Edicy.trigger("edicy:save")},3e4),e(window).on("beforeunload",this.handleWindowUnload),this.$(".edy-ca").each(function(e,t){new Edicy.ContentAreaView({el:t}).render()}),this.$(".edy-partial-view").each(function(e,t){new Edicy.PartialView({el:t}).render()});var i=this.getEditables();t.each(i.article,function(e,t){new Edicy.ArticleEditorView({el:this.el,cid:t,model:e})},this),t.each(i.language,function(e){new Edicy.SiteHeaderEditorView({el:this.el,model:e})},this),t.each(i.element,function(e,t){new Edicy.ElementEditorView({el:this.el,cid:t,model:e})},this)},render:function(){return this},getEditables:function(){return t.chain(this.$(".edy-editable")).inject(function(i,n){var o=e(n),a=o.data("editable-type"),r=o.data("editable-cid");return t.has(i,a)&&!t.has(i[a],r)&&(i[a][r]=t.extend(i[a][r]||{},t.compactObject({id:o.data("editable-id"),url:o.data("editable-url"),page_id:o.data("page-id"),options:o.data("editable-options")}))),i},{article:{},language:{},element:{}}).value()},handleWindowUnload:function(){var e=["textpartials","galleries","forms","articles","content_partials","elements"],i=t.some(e,function(e){return Edicy[e].some(function(e){return e.hasPendingChanges()})});return i?I18n.t("content.unsaved_content"):void 0},handleTranslatePageClick:function(t){e(t.target).closest("a.fci-editor-menuadd").attr("data-remote",!0)},handleMenuaddClick:function(t){e(t.target).closest("a.edy-menu-menuadd").find(".edy-cbtn-content").dotLoader({replace:!0})},handleMenuaddLoaded:function(t){e(t.target).closest("a.edy-menu-menuadd").find(".edy-cbtn-content").dotLoader(!1)},handleLanguageAddClick:function(t){e(t.target).closest("a.edy-menu-langadd").find(".edy-cbtn-content").dotLoader({replace:!0})},handleLanguageAddLoaded:function(t){e(t.target).closest("a.edy-menu-langadd").find(".edy-cbtn-content").dotLoader(!1)},handleHiddenBtnClick:function(t){var i=e(t.target).closest("a");i.data("popover")||i.data("popover",new Edicy.PopoverView({body:i.find(".edy-menu-hidden-contents").html(),containerClass:"edy-menu-hidden-popover",parent:i,orientation:"bottom"}).render()),i.data("popover").toggle()
},handleCommentDeleted:function(t,i){e(t.target).closest(".edy-site-blog-comment").remove(),e(".edy-site-blog-comments-count").html(i.article.public_comments_count),Edicy.trigger("undo:objectdestroyed",{id:"comment."+i.article.id,kind:"comment",restore_url:i.article.restore_url})}})}(Edicy.jQuery,Edicy.Underscore),function(){this.JST||(this.JST={}),this.JST["edicy-gallery/photoswipe/photoswipe_template"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="pswp__bg"></div>\n<div class="pswp__scroll-wrap">\n  <div class="pswp__container">\n    <div class="pswp__item"></div>\n    <div class="pswp__item"></div>\n    <div class="pswp__item"></div>\n  </div>\n  <div class="pswp__ui pswp__ui--hidden">\n    <div class="pswp__top-bar">\n      <div class="pswp__counter"></div>\n      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n      <button class="pswp__button pswp__button--share" title="Share"></button>\n      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n      <div class="pswp__preloader">\n        <div class="pswp__preloader__icn">\n          <div class="pswp__preloader__cut">\n            <div class="pswp__preloader__donut"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n      <div class="pswp__share-tooltip"></div>\n    </div>\n    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>\n    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>\n    <div class="pswp__caption">\n      <div class="pswp__caption__center"></div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){var e,t,i=[],n=function(){if(!e){e=document.createElement("div"),e.innerHTML="",e.classList.add("edy-dragel"),e.classList.add("edy-asset-upload"),document.body.appendChild(e);var n=document.createElement("div");n.classList.add("edy-dragel-helper"),n.innerHTML="",t=new Edicy.dragdrop.Draggable(e,{droppables:".edy-accepts-assets",tolerance:"overlap",payload:function(){return{files:i,type:"upload"}},helper:function(){return n}})}},o=function(t){document.body.insertAdjacentHTML("beforeend",'<div class="edy-draghover-top"></div><div class="edy-draghover-right"></div><div class="edy-draghover-bottom"></div><div class="edy-draghover-left"></div>');var i=document.querySelector(".toolbar-asset-quota-notice");i&&100==i.getAttribute("data-quota")&&Array.prototype.slice.call(document.querySelectorAll("[class^=edy-draghover-]")).forEach(function(e){e.classList.add("edy-draghover-error")}),e||n(t.detail.originalEvent)},a=function(e){t&&t.handleDrag(e.detail.originalEvent)},r=function(e){Array.prototype.slice.call(document.querySelectorAll("[class^=edy-draghover-]")).forEach(Edicy.dom.remove),t&&t.handleDragEnd(e.detail.originalEvent)},s=function(e){Array.prototype.slice.call(document.querySelectorAll("[class^=edy-draghover-]")).forEach(Edicy.dom.remove),i=Edicy.assets.uploadFiles(e.detail.files),t&&t.handleDragEnd(e.detail.originalEvent),i=[]};Edicy.FileDragDropView=function(){document.addEventListener("dnd:dragenter",o),document.addEventListener("dnd:dragover",a),document.addEventListener("dnd:dragleave",r),document.addEventListener("dnd:drop",s)}}(),function(){try{new CustomEvent("test")}catch(e){!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}()}}(this),function(){window.edy&&"hasOption"in window.edy||(window.edy=function(){var e={};window.edy=window.edy||[];var t=function(t){var i=t.shift();1==t.length&&(t=t[0]),e[i]||(e[i]=[]),e[i].push(t)};return window.edy.forEach(t),{push:t,hasOption:function(t){return!!e[t]},getOption:function(t){return e[t]}}}()),window.EdicyGalleries=window.EdicyGalleries||{},window.EdicyGalleries={waitForLoad:function(e,t){for(var i=[],n=0,o=e.length;o>n;n++)e[n].complete||i.push(e[n]);i.length>0?setTimeout(function(){window.EdicyGalleries.waitForLoad(i,t)},100):setTimeout(t,100)},getGallery:function(e){return document.querySelector('.edys-gallery-area[data-gallery-id="'+e+'"]')},stretchImages:function(e){for(var t,i,n,o,a,r,s,l=e.length;l--;)e[l].parentNode&&(t=e[l].parentNode.getBoundingClientRect(),n=t.bottom-t.top,i=t.right-t.left,o=e[l].naturalWidth||e[l].width,a=e[l].naturalHeight||e[l].height,o/a>i/n?(e[l].style.width="auto",e[l].style.height="100%",e[l].style.marginTop="",s=o/a*n,e[l].style.marginLeft=(i-s)/2+"px"):(e[l].style.width="100%",e[l].style.height="auto",e[l].style.marginLeft="",r=a/o*i,e[l].style.marginTop=(n-r)/2+"px"))},findCoveringSize:function(e,t,i){"undefined"==typeof i&&(i=t);for(var n,o,a,r=e[0].width/e[0].height>t/i?"height":"width",s=0,l=e.length;l>s;s++)n?(a="width"===r?e[s].width-t:e[s].height-i,(0>o&&a>=0||a>=0&&o>a||0>a&&a>o)&&(o=a,n=e[s])):(n=e[s],o="width"===r?n.width-t:n.height-i);return n},findFittingSize:function(e,t,i){"undefined"==typeof i&&(i=t);for(var n,o,a,r=e[0].width/e[0].height>t/i?"height":"width",s=0,l=e.length;l>s;s++)n?(a="height"===r?e[s].width-t:e[s].height-i,(0>o&&a>=0||0>a&&a>o||a>=0&&o>a)&&(o=a,n=e[s])):(n=e[s],o="height"===r?n.width-t:n.height-i);return n},findSizeByHeight:function(e,t){for(var i,n,o,a=0,r=e.length;r>a;a++)i?(o=e[a].height-t,(0>n&&o>=0||o>=0&&n>o||0>o&&o>n)&&(n=o,i=e[a])):(i=e[a],n=i.height-t);return i},matches:function(e,t){if(!e)return!1;var i=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return i?i.call(e,t):!1},closest:function(e,t){return e&&("string"==typeof t&&this.matches(e,t)||e===t)?e:e?this.closest(e.parentNode,t):null},mergeObjs:function(){for(var e,t={},i=0,n=arguments.length;n>i;i++)for(e in arguments[i])arguments[i].hasOwnProperty(e)&&(t[e]=arguments[i][e]);return t},listen:function(e,t,i,n){var o=function(e){var t=e.target;do if(EdicyGalleries.matches(t,i))return e.delegateTarget=t,n.apply(this,arguments),void 0;while(t=t.parentNode)};return e.addEventListener(t,o),{stop:function(){e.removeEventListener(t,o)}}}}}(),function(){var e="photoswipe",t=function(){this.init()};t.prototype={init:function(){this.lightBoxes=[],this.listenPhotoEvents(),this.listenLightboxEvents()},listenPhotoEvents:function(){this.photoShowListener=EdicyGalleries.listen(document,"edicy:photo:show","[data-gallery-photo-id]",this.handlePhotoShow.bind(this)),this.photoHideListener=EdicyGalleries.listen(document,"edicy:photo:hide","[data-gallery-photo-id]",this.handlePhotoHide.bind(this)),this.photoChangeListener=EdicyGalleries.listen(document,"edicy:gallery:photo:change","[data-gallery-photo-id]",this.handlePhotoChange.bind(this))},listenLightboxEvents:function(){this.lightboxPhotoFocusListener=EdicyGalleries.listen(document,"edicy:lightbox:photo:focus","[data-lightbox-type]",this.handleLightboxPhotoFocus.bind(this)),this.lightboxPhotoBlurListener=EdicyGalleries.listen(document,"edicy:lightbox:photo:blur","[data-lightbox-type]",this.handleLightboxPhotoBlur.bind(this)),this.lightboxShowListener=EdicyGalleries.listen(document,"edicy:lightbox:show","[data-lightbox-type]",this.handleLightboxShow.bind(this)),this.lightboxHideListener=EdicyGalleries.listen(document,"edicy:lightbox:hide","[data-lightbox-type]",this.handleLightboxHide.bind(this))},destroy:function(){this.photoShowListener.stop(),this.photoHideListener.stop(),this.photoChangeListener.stop(),this.lightboxShowListener.stop(),this.lightboxHideListener.stop(),this.lightboxPhotoFocusListener.stop(),this.lightboxPhotoBlurListener.stop()},fetchLightbox:function(t){var i=edy.getOption("extendLightbox");if(i){t||(t=e);for(var n=i.length;n--;)if(i[n].type===t)return i[n];return this.fetchLightbox(e)}},triggerPhotoEvent:function(e,t,i){if(t&&i){var n=document.querySelector('[data-gallery-id="'+i+'"] [data-gallery-photo-id="'+t+'"]');n&&n.dispatchEvent(new CustomEvent(e,{bubbles:!0}))}},handlePhotoShow:function(e){this.fetchLightbox().show(e.delegateTarget,e.detail)},handlePhotoHide:function(e){this.fetchLightbox().hide(e.delegateTarget,e.detail)},handlePhotoChange:function(e){this.fetchLightbox().change(e.delegateTarget,e.detail)},handleLightboxPhotoFocus:function(e){e.detail&&this.triggerPhotoEvent("edicy:photo:lightbox:focus",e.detail.photo_id,e.detail.gallery_id)},handleLightboxPhotoBlur:function(e){e.detail&&this.triggerPhotoEvent("edicy:photo:lightbox:blur",e.detail.photo_id,e.detail.gallery_id)},handleLightboxShow:function(){},handleLightboxHide:function(){}},this.EdicyLightboxManager=new t}(this),function(){var e=function(e){this.gallerySelector=e,this.gallerySelector&&this.init()};e.prototype={init:function(){this.updateHandler=this.update.bind(this),window.addEventListener("resize",this.updateHandler),this.changeListener=EdicyGalleries.listen(document,"edicy:gallery:change",this.gallerySelector,this.handleChange.bind(this)),this.thumbClickListener=EdicyGalleries.listen(document,"click",this.gallerySelector+" [data-gallery-photo-id]",this.handleThumbClick.bind(this)),this.update()},handleChange:function(e){var t=e.delegateTarget;this.adjustThumbSizes(t)},update:function(){for(var e=document.querySelectorAll(this.gallerySelector),t=e.length;t--;)this.adjustThumbSizes(e[t]);this.polyfillObjFit()},polyfillObjFit:function(){"objectFit"in document.documentElement.style==!1&&window.EdicyGalleries.stretchImages(document.querySelectorAll(this.gallerySelector+" img"))},adjustThumbSizes:function(e){for(var t,i,n,o=e.getBoundingClientRect(),a=o.right-o.left,r=e.getAttribute("data-settings")?JSON.parse(e.getAttribute("data-settings")).columns||4:4,s=a/r,l=e.querySelectorAll("[data-sizes]"),d=l.length;d--;)t=JSON.parse(l[d].getAttribute("data-sizes")),i=EdicyGalleries.findCoveringSize(t,s),n=l[d].querySelector("img"),n.src!==i.url&&(n.src=i.url);"objectFit"in document.documentElement.style==!1&&setTimeout(function(){window.EdicyGalleries.stretchImages(e.querySelectorAll("img"))}.bind(this),0)},handleThumbClick:function(e){var t=e.delegateTarget,i=EdicyGalleries.closest(t,this.gallerySelector),n={gallery_id:parseInt(i.getAttribute("data-gallery-id"),10),gallerySettings:JSON.parse(i.getAttribute("data-settings")),photo_id:parseInt(t.getAttribute("data-gallery-photo-id"),10),photos:this.getPhotos(i)};e.preventDefault(),t.dispatchEvent(new CustomEvent("edicy:photo:show",{bubbles:!0,detail:n}))},getPhotos:function(e){return Array.prototype.slice.call(e.querySelectorAll("[data-gallery-photo-id]")).map(function(e){return{id:parseInt(e.getAttribute("data-gallery-photo-id"),10),sizes:JSON.parse(e.getAttribute("data-sizes")),title:e.getAttribute("data-title")}})},destroy:function(){window.removeEventListener("resize",this.updateHandler),this.thumbClickListener.stop(),this.thumbChangeListener.stop(),this.changeListener.stop()}},window.EdicyGalleries.Grid=new e(".edys-gallery-grid")}(),function(){var e=function(e,t,i){var n=document.createElement("a"),o=document.createElement("span"),a=i&&i.columns?i.columns:4,r=i&&i.spacing?i.spacing:0,s=100/a;return n.classList.add("edys-gallery-item-placeholder"),"upload"==e.type&&n.classList.add("edys-gallery-upload-placeholder"),o.classList.add("edys-gallery-grid-aspect"),e.thumbnail&&(o.style.backgroundImage='url("'+e.thumbnail+'")'),n.appendChild(o),n.style.width=s+"%",n.style.padding=r+"px",n},t=function(e,t){var i=window.getComputedStyle(t).width,n=document.createElement("div"),o=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,parseFloat(i)).url:e.url;return n.classList.add("edy-asset-dragproxy"),n.classList.add("edys-gallery-grid-dragproxy"),n.style.backgroundImage='url("'+o+'")',n.style.width=i,n.style.height=i,n},i=function(e,t){var i=document.createElement("a"),n=document.createElement("span"),o=document.createElement("img");return n.appendChild(o),i.appendChild(n),n.classList.add("edys-gallery-grid-aspect"),i.classList.add("edys-gallery-grid-item"),e.url&&i.setAttribute("href",e.url),t&&(t.columns&&(i.style.width=100/t.columns+"%"),t.spacing&&(i.style.padding=t.spacing+"px")),e.thumbnail&&o.setAttribute("src",e.thumbnail),o.classList.add("edys-gallery-grid-image"),i},n=function(e,t){var i=document.createElement("div");i.className="edys-gallery-grid-area edys-gallery-grid",i.setAttribute("data-gallery-id",e),i.setAttribute("data-settings",JSON.stringify(t));var n=document.createElement("div");return n.className="edys-gallery-grid-inner",n.setAttribute("data-gallery-photos",""),i.appendChild(n),t&&t.spacing&&(n.style.marginLeft=-1*t.spacing+"px",n.style.marginRight=-1*t.spacing+"px"),i},o=[{name:"Columns",key:"columns",unit:"",type:"number",defaultValue:4},{name:"Thumb spacing",key:"spacing",unit:"px",type:"number",defaultValue:0}];window.edy.push(["extendGallery",{galleryType:"grid",name:"Grid",placeholder:e,helper:t,item:i,wrapper:n,options:o}])}(),function(){var e=function(){var e="objectFit"in document.documentElement.style,t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;return t?!1:e}(),t=function(e){for(var t=document.documentElement,i=0;i<e.length;i++)if(e[i]in t.style)return e[i];return null},i=function(e){"requestAnimationFrame"in window?requestAnimationFrame(e):setTimeout(e,0)},n=t(["transform","MozTransform","webkitTransform","msTransform","OTransform"]),o=t(["transitionDuration","MozTransitionDuration","webkitTransitionDuration","msTransitionDuration","OTransitionDuration"]),a=function(e,t,i){var n=.06,o=0,a=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=e.scrollLeft,l=r.left-a.left+e.scrollLeft,d=i?(l-s)/i/n:l-s,c=function(){var t;o++,t=s+d*o,e.scrollLeft=t,(0===d||d>0&&t>=l||0>d&&l>=t)&&h&&clearInterval(h)};if(i){var h=setInterval(c,1/n);return h}return c(),null},r=function(e,t,i){var a=e.parentNode;a.getBoundingClientRect(),e.style[o]=(i||0)/1e3+"s",e.style[n]="translate3d("+-100*t+"%,0px,0px)"},s=function(e){var t=e.style[n];return left=t?parseFloat(t.match(/translate3d\(([-\d\.]+)/)[1]):0},l=function(e,t,i){return Math.min(Math.max(e,t),i)},d={moveTreshold:.1,clickTreshold:.03},c=function(e){this.gallerySelector=e,this.gallerySelector&&this.init()},h=function(){var e=document.createElement("div");return e.className="edys-gallery-slider-probe",e.innerHTML=new Array(500).join(" &nbsp;"),e};c.prototype={init:function(){var t=this;this.clickHandler=this.handleClick.bind(this),this.mouseDownHandler=this.handleMouseDown.bind(this),this.touchStartHandler=this.handleMouseDown.bind(this),this.updateHandler=this.handleUpdate.bind(this),this.resizeHandler=this.handleResize.bind(this),this.mouseMoveHandler=this.handleMouseMove.bind(this),this.mouseUpHandler=this.handleMouseUp.bind(this),this.nextHandler=this.next.bind(this),this.prevHandler=this.prev.bind(this),this.bindEvents();for(var i=document.querySelectorAll(this.gallerySelector),n=i.length;n--;)this.applyWidthProbe(i[n]),t.updateHelperImages(i[n]),t.loadImagesNearIdx(i[n],1),t.bindLooper(i[n]);e||window.EdicyGalleries.waitForLoad(document.querySelectorAll(this.gallerySelector+" img"),function(){this.polyfillObjFit()}.bind(this))},applyWidthProbe:function(e){var t=h();e.appendChild(t)},removeWidthProbe:function(e){for(var t=e.querySelectorAll(".edys-gallery-slider-probe"),i=t.length;i--;)t[i].parentNode.removeChild(t[i])},loadImagesNearIdx:function(t,i){var n=t.querySelectorAll(".edys-gallery-slider-item"),o=t.getBoundingClientRect(),a=o.right-o.left,r=o.bottom-o.top,s=i>0?i-1:n.length-1,l=i<n.length-1?i+1:0,d=function(t){var i=JSON.parse(t.getAttribute("data-sizes")),n=EdicyGalleries.findCoveringSize(i,a,r),o=new Image,s=function(){t.appendChild(o),t.className=t.className.replace("edys-gallery-slider-item-loading",""),e||window.EdicyGalleries.stretchImages([o])};t.className=t.className.replace("edys-gallery-slider-item-not-loaded","edys-gallery-slider-item-loading"),o.className="edys-gallery-slider-image",o.onabort=s,o.onerror=s,o.onload=s,o.src=n.url};n[i]&&n[i].className.indexOf("edys-gallery-slider-item-not-loaded")>-1&&d(n[i]),n[l]&&n[l].className.indexOf("edys-gallery-slider-item-not-loaded")>-1&&d(n[l]),n[s]&&n[s].className.indexOf("edys-gallery-slider-item-not-loaded")>-1&&d(n[s])},bindEvents:function(){document.body.addEventListener("click",this.clickHandler),document.body.addEventListener("mousedown",this.mouseDownHandler),document.body.addEventListener("touchstart",this.touchStartHandler),window.addEventListener("resize",this.resizeHandler),this.changeListener=EdicyGalleries.listen(document,"edicy:gallery:change",this.gallerySelector,this.handleChange.bind(this)),this.removeHandler=EdicyGalleries.listen(document,"edicy:gallery:remove",this.gallerySelector,this.handleRemove.bind(this)),this.dragEnterListener=EdicyGalleries.listen(document,"edicy:gallery:dragenter",this.gallerySelector,this.handleDragEnter.bind(this)),this.dragleaveListener=EdicyGalleries.listen(document,"edicy:gallery:dragleave",this.gallerySelector,this.handleDragLeave.bind(this)),this.imgDeleteHandler=EdicyGalleries.listen(document,"edicy:gallery:deleteimage",this.gallerySelector,this.handleImageDelete.bind(this)),this.mouseEnterListener=EdicyGalleries.listen(document,"mouseover",this.gallerySelector,this.handleMouseOver.bind(this)),this.beforeChangeListener=EdicyGalleries.listen(document,"edicy:gallery:beforechange",this.gallerySelector,this.handleBeforeChange.bind(this))},bindLooper:function(e){var t=this.getSettings(e);t.interval&&parseFloat(t.interval)>0&&!e.loopIntervalHandler&&[].slice.call(e.querySelectorAll(".edys-gallery-slider-item")).length>1&&(e.loopIntervalHandler=setInterval(function(){e&&e.parentNode&&e.className.indexOf("edys-gallery-slider")>-1&&[].slice.call(e.querySelectorAll(".edys-gallery-slider-item")).length>1?this.next(e,!0):this.unbindLooper(e)}.bind(this),1e3*parseFloat(t.interval)))},unbindLooper:function(e){e&&e.loopIntervalHandler&&(clearInterval(e.loopIntervalHandler),delete e.loopIntervalHandler)},handleRemove:function(e){var t=e.delegateTarget;t&&this.unbindLooper(t)},bindLooper:function(e){var t=this.getSettings(e);t.interval&&parseFloat(t.interval)>0&&(e.loopIntervalHandler||(e.loopIntervalHandler=setInterval(function(){this.next(e,!0)}.bind(this),1e3*parseFloat(t.interval))))},unbindLooper:function(e){e&&e.loopIntervalHandler&&(clearInterval(e.loopIntervalHandler),delete e.loopIntervalHandler)},destroy:function(){document.body.removeEventListener("click",this.clickHandler),document.body.removeEventListener("mousedown",this.mouseDownHandler),document.body.removeEventListener("touchstart",this.touchStartHandler),window.removeEventListener("resize",this.updateHandler);for(var e=document.querySelectorAll(this.gallerySelector),t=e.length;t--;)this.unbindLooper(e[t]);this.beforeChangeListener.stop(),this.changeListener.stop(),this.dragEnterListener.stop(),this.dragleaveListener.stop(),this.changeListener.stop(),this.removeHandler.stop(),this.mouseEnterListener.stop(),this.imgDeleteHandler.stop()},getSettings:function(e){return JSON.parse(e.getAttribute("data-settings")||"{}")},getSettings:function(e){return JSON.parse(e.getAttribute("data-settings")||"{}")},handleChange:function(e){var t=e.detail&&"undefined"!=typeof e.detail.position?e.detail.position-1:void 0,i=e.delegateTarget;this.unbindLooper(i),this.setDisplayPhotoSizes(i),this.update(i,t,300),e.detail&&e.detail.position||this.updateHelperImages(i),this.bindLooper(i)},handleBeforeChange:function(e){e.delegateTarget&&this.unbindLooper(e.delegateTarget)},handleResize:function(){var e=document.querySelectorAll(this.gallerySelector);if(e){for(var t=e.length;t--;)this.setDisplayPhotoSizes(e[t]),n||this.update(e[t]);this.polyfillObjFit()}},handleUpdate:function(){var e=document.querySelectorAll(this.gallerySelector);if(e){for(var t=e.length;t--;)this.setDisplayPhotoSizes(e[t]),this.update(e[t]);this.polyfillObjFit()}},handleClick:function(e){var t=EdicyGalleries.closest(e.target,this.gallerySelector);t&&(EdicyGalleries.closest(e.target,".edys-gallery-slider-next")?(this.unbindLooper(t),this.next(t)):EdicyGalleries.closest(e.target,".edys-gallery-slider-prev")?(this.unbindLooper(t),this.prev(t)):EdicyGalleries.closest(e.target,".edys-gallery-slider-scroll-crop")&&(this.unbindLooper(t),this.handleMouseClick(t,e)))},polyfillObjFit:function(){e||window.EdicyGalleries.stretchImages(document.querySelectorAll(this.gallerySelector+" img"))},removeHelperImages:function(e,t){var i=this.getIdx(e);e.followingHelperImage&&(e.followingHelperImage.parentNode&&e.followingHelperImage.parentNode.removeChild(e.followingHelperImage),delete e.followingHelperImage),e.leadingHelperImage&&(e.leadingHelperImage.parentNode&&e.leadingHelperImage.parentNode.removeChild(e.leadingHelperImage),delete e.leadingHelperImage),t!==!1&&this.update(e,i-1,0)},updateHelperImages:function(e){var t,i,n;e.leadingHelperImage||(t=this.getIdx(e));var o=e.querySelector(".edys-gallery-slider-inner");this.removeHelperImages(e,!1);var a=e.querySelector(".edys-gallery-slider-item"),r=Array.prototype.slice.call(e.querySelectorAll(".edys-gallery-slider-item")).pop();a&&(i=e.followingHelperImage=a.cloneNode(!0),i.className+=" edys-gallery-slider-helper-item",i.removeAttribute("data-gallery-photo-id"),o.appendChild(i)),r&&(n=e.leadingHelperImage=r.cloneNode(!0),n.className+=" edys-gallery-slider-helper-item",n.removeAttribute("data-gallery-photo-id"),o.insertBefore(n,o.firstChild)),"undefined"!=typeof t&&this.update(e,t+1,0)},handleImageDelete:function(e){var t=e.delegateTarget;this.updateHelperImages(t);var i=this.getMaxIdx(t),n=this.getIdx(t);i>n&&this.update(t,i,300)},getIdx:function(e){var t,i=e.getBoundingClientRect(),a=i.right-i.left;return n&&o?(t=s(e.querySelector(".edys-gallery-slider-inner")),Math.round(Math.abs(t)/100)):Math.round(e.querySelector(".edys-gallery-slider-scroll-crop").scrollLeft/a)},getMaxIdx:function(e){return e.querySelectorAll(".edys-gallery-slider-item").length-1},next:function(e){var t,i=e.querySelectorAll(".edys-gallery-slider-item");t=Math.min(this.getIdx(e)+1,i.length-1),this.update(e,t,300)},prev:function(e){var t=Math.max(this.getIdx(e)-1,0);this.update(e,t,300)},update:function(e,t,i){var n=this.getMaxIdx(e);"undefined"==typeof t&&(t=this.getIdx(e)),o?r(e.querySelector(".edys-gallery-slider-inner"),t,i):(this.animationInterval&&clearInterval(this.animationInterval),a(e.querySelector(".edys-gallery-slider-scroll-crop"),e.querySelectorAll(".edys-gallery-slider-item")[t],i)),this.loadImagesNearIdx(e,t),e.followingHelperImage&&t>=n&&setTimeout(function(){this.update(e,1,0)}.bind(this),i),e.leadingHelperImage&&0>=t&&setTimeout(function(){this.update(e,n-1,0)}.bind(this),i)},setArrowVisibility:function(e,t){"undefined"==typeof t&&(t=0);var i=e.querySelectorAll("[data-gallery-photo-id]:not(.edy-hidden)").length-1;e.querySelector(".edys-gallery-slider-next").style.display=t===i?"none":"block",e.querySelector(".edys-gallery-slider-prev").style.display=0===t?"none":"block"},getOptions:function(e){return EdicyGalleries.mergeObjs(d,JSON.parse(e.getAttribute("data-options")))},setDisplayPhotoSizes:function(t){var i,n,o=t.getBoundingClientRect(),a=o.right-o.left,r=o.bottom-o.top,s=t.querySelectorAll("[data-gallery-photo-id]");if(s)for(var l=0,d=s.length;d>l;l++)s[l].querySelector("img")&&(i=JSON.parse(s[l].getAttribute("data-sizes")),n=EdicyGalleries.findCoveringSize(i,a,r),s[l].querySelector("img").src!==n.url&&(s[l].querySelector("img").src=n.url));e||setTimeout(function(){window.EdicyGalleries.stretchImages(t.querySelectorAll("img"))}.bind(this),0)},handleMouseDown:function(e){if(!window.Edicy){this.unbindLooper(EdicyGalleries.closest(e.target,this.gallerySelector));var t=EdicyGalleries.closest(e.target,this.gallerySelector+" .edys-gallery-slider-scroll-crop");if(t){var i=t.querySelector(".edys-gallery-slider-inner");"mousedown"===e.type&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var a="touchstart"===e.type?e.targetTouches[0]:e;this.startX=a.pageX,this.startY=a.pageY,this.scrollX=n&&o?s(i):t.scrollLeft,"touchstart"===e.type?(t.addEventListener("touchmove",this.mouseMoveHandler),t.addEventListener("touchend",this.mouseUpHandler),t.addEventListener("touchcancel",this.mouseUpHandler)):(t.addEventListener("mousemove",this.mouseMoveHandler),t.addEventListener("mouseup",this.mouseUpHandler)),o&&(i.style[o]="0s")}}},handleMouseMove:function(e){var t,i=EdicyGalleries.closest(e.target,this.gallerySelector),a=EdicyGalleries.closest(e.target,this.gallerySelector+" .edys-gallery-slider-scroll-crop"),r=a.querySelector(".edys-gallery-slider-inner"),s="touchmove"===e.type?e.targetTouches[0]:e,l=i.getBoundingClientRect(),d=l.right-l.left,c=s.pageX-this.startX;if("touchmove"===e.type){var h=s.pageY-this.startY;if(!(Math.abs(h)<Math.abs(c)))return;e.preventDefault()}n&&o?(t=100*(c/d),r.style[n]="translate3d("+(this.scrollX+t)+"%,0px,0px)"):a.scrollLeft=this.scrollX+this.startX-s.pageX},handleMouseUp:function(e){var t,i=EdicyGalleries.closest(e.target,this.gallerySelector),a=i.querySelector(".edys-gallery-slider-scroll-crop"),r=i.querySelector(".edys-gallery-slider-inner"),d=i.querySelectorAll(".edys-gallery-slider-item"),c="touchend"===e.type||"touchleave"===e.type?e.changedTouches[0]:e,h=(this.startX-c.pageX,i.getBoundingClientRect()),u=h.right-h.left,m=this.getOptions(i),p=u*m.moveTreshold,g=u*m.clickTreshold,f=n&&o?-1*s(r):a.scrollLeft;a.removeEventListener("mousemove",this.mouseMoveHandler),a.removeEventListener("mouseup",this.mouseUpHandler),a.removeEventListener("touchmove",this.mouseMoveHandler),a.removeEventListener("touchend",this.mouseUpHandler),a.removeEventListener("touchcancel",this.mouseUpHandler),t=this.startX-c.pageX>p?n&&o?Math.ceil(f/100):Math.ceil(f/u):this.startX-c.pageX<-1*p?n&&o?Math.floor(f/100):Math.floor(f/u):n&&o?Math.round(f/100):Math.round(f/u),t=l(t,0,d.length-1),Math.abs(this.startX-c.pageX)>g&&(this.stopClick=!0,setTimeout(function(){this.stopClick=!1}.bind(this),0)),this.update(i,t,300),this.bindLooper(i)},handleMouseClick:function(e,t){t.preventDefault?t.preventDefault():t.returnValue=!1},handleMouseOver:function(e){var t=EdicyGalleries.closest(e.target,this.gallerySelector);t&&t.loopIntervalHandler&&(this.unbindLooper(t),t.leaveHandler||(t.leaveHandler=function(){this.bindLooper(t),t.removeEventListener("mouseleave",t.leaveHandler),delete t.leaveHandler}.bind(this),t.addEventListener("mouseleave",t.leaveHandler)))},handleDragEnter:function(e){var t=e.delegateTarget;this.removeHelperImages(t,!0),i(function(){var e=t.querySelector(".edys-gallery-slider-inner"),i=s(e);this.unbindLooper(t),this.rememberLeft=i,e&&(t.classList.add("zooming-out"),e.style[o]="",e.style[n]="translate3d("+.3*i+"%,0px,0px) scale(0.3)",setTimeout(function(){t.classList.remove("zooming-out")},600))}.bind(this))},handleDragLeave:function(e){var t=e.delegateTarget,i=t.querySelector(".edys-gallery-slider-inner"),a=s(i),r="undefined"!=typeof e.detail.position?e.detail.position-1:void 0;i&&(i.style[o]="",i.style[n]="translate3d("+a+"px,0px,0px)"),this.update(t,r,300),setTimeout(function(){this.setDisplayPhotoSizes(t),this.updateHelperImages(t,!1)}.bind(this),300),this.rememberLeft=void 0,this.bindLooper(t)},getPhotos:function(e){return Array.prototype.slice.call(e.querySelectorAll("[data-gallery-photo-id]")).map(function(e){return{id:parseInt(e.getAttribute("data-gallery-photo-id"),10),sizes:JSON.parse(e.getAttribute("data-sizes")),title:e.getAttribute("data-title")}})}},window.EdicyGalleries.slider=new c(".edys-gallery-slider")}(),function(){var e=function(e,t,i){var n=document.createElement("div"),o=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,i&&i.height?i.height:200).url:e.url;return o||(o=e.thumbnail),n.classList.add("edys-gallery-slider-placeholder"),"upload"==e.type&&n.classList.add("edys-gallery-upload-placeholder"),o&&(n.style.backgroundImage='url("'+o+'")'),n},t=function(e,t,i){var n=window.getComputedStyle(t),o=(e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,i&&i.height?i.height:200).url:e.url,document.createElement("div"));return o.classList.add("edy-asset-dragproxy"),o.classList.add("edys-gallery-slider-dragproxy"),o.style.width=.3*parseFloat(n.width)+"px",o.style.height=.3*parseFloat(n.height)+"px",o},i=function(e,t){var i=document.createElement("div"),n=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,t&&t.height?t.height:200).url:e.url;n||(n=e.thumbnail),i.classList.add("edys-gallery-slider-item");var o=document.createElement("img");return n&&(o.src=n),o.classList.add("edys-gallery-slider-image"),i.appendChild(o),i},n=function(e,t){var i=document.createElement("div");i.className="edys-gallery-area edys-gallery-slider",i.setAttribute("data-gallery-id",e),t&&(i.setAttribute("data-settings",JSON.stringify(t)),t.height&&("string"==typeof t.height&&t.height.indexOf("%")>-1?(i.style.paddingBottom=parseFloat(t.height)+"%",i.className+=" edys-gallery-slider-aspect"):i.style.height=t.height));var n=document.createElement("div");n.className="edys-gallery-slider-next",i.appendChild(n);var o=document.createElement("div");o.className="edys-gallery-slider-prev",i.appendChild(o);var a=document.createElement("div");a.className="edys-gallery-slider-scroll-crop";var r=document.createElement("div");r.className="edys-gallery-slider-inner",r.setAttribute("data-gallery-photos",""),a.appendChild(r),i.appendChild(a);var s=document.createElement("div");return s.className="edys-gallery-slider-probe",s.innerHTML=new Array(500).join(" &nbsp;"),i.appendChild(s),i},o=function(e,t,i,n){var o=n&&n.getBoundingClientRect(),a=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(o){if("vh"===i)return Math.round(1e3*(o.height/a))/10;if("%"===i)return Math.round(1e3*(o.height/o.width))/10}return e},a=[{name:"Height",key:"height",unit:["%","vh"],unitText:["of_width","of_window"],type:"number",defaultValue:"50%",unitConverter:o},{name:"Interval",key:"interval",unit:"s",type:"number",defaultValue:0}];window.edy.push(["extendGallery",{galleryType:"slider",name:"Slider",placeholder:e,helper:t,item:i,wrapper:n,options:a}])}(),function(){var e=function(){var e,t=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e];return null}(),t=function(e,t){for(var i,n,o=0,a=0,r=e.length;r>a;a++)i=parseInt(e[a].getAttribute("data-original-width"),10),n=parseInt(e[a].getAttribute("data-original-height"),10),o+=i/n;return t/o},i=function(e,t){for(var i,n,o,a=0,r=e.length;r>a;a++)n=parseInt(e[a].img.getAttribute("data-original-width"),10),o=parseInt(e[a].img.getAttribute("data-original-height"),10),i=Math.min(e[a].h,t),e[a].img.style.height=i+"px",e[a].img.style.width=Math.floor(n/o*i)+"px"},n={thumbsize:200},o=function(e){this.gallerySelector=e,this.gallerySelector&&this.init()};o.prototype={init:function(){this.updateHandler=this.handleUpdate.bind(this),window.addEventListener("resize",this.updateHandler),window.addEventListener("edicy:gallery:sort",this.updateHandler),window.addEventListener("edicy:gallery:dragleave",this.updateHandler),window.addEventListener("edicy:gallery:dragenter",this.updateHandler);for(var e=document.querySelectorAll(this.gallerySelector),t=e.length;t--;)this.adjustRows(e[t]),this.reRender(e[t]),this.makeVisible(e[t]);this.changeListener=EdicyGalleries.listen(document,"edicy:gallery:change",this.gallerySelector,this.handleChange.bind(this)),this.thumbClickListener=EdicyGalleries.listen(document,"click",this.gallerySelector+" [data-gallery-photo-id]",this.handleThumbClick.bind(this))},makeVisible:function(t){var i=function(){t.style.height="",t.removeEventListener(e,i)};e?(t.addEventListener(e,i),t.style.height=window.getComputedStyle(t.querySelector(".edys-gallery-wall-inner")).height):t.style.height="",t.className=t.className.replace("edys-gallery-wall-loading","")},getOptions:function(e){return e.getAttribute("data-settings")&&JSON.parse(e.getAttribute("data-settings")).thumbsize?JSON.parse(e.getAttribute("data-settings")):n},handleChange:function(e){var t=e.delegateTarget;setTimeout(function(){this.update(t)}.bind(this),0)},handleUpdate:function(){for(var e=document.querySelectorAll(this.gallerySelector),t=e.length;t--;)this.update(e[t])},destroy:function(){window.removeEventListener("resize",this.updateHandler),this.thumbClickListener.stop(),this.thumbChangeListener.stop(),this.changeListener.stop(),window.removeEventListener("edicy:gallery:sort",this.updateHandler),window.removeEventListener("edicy:gallery:dragleave",this.updateHandler),window.removeEventListener("edicy:gallery:dragenter",this.updateHandler)},reRender:function(e){for(var t=e.querySelectorAll("img"),i=0,n=t.length;n>i;i++)t[i].style.cssFloat="left";
    setTimeout(function(){for(var e=0,i=t.length;i>e;e++)t[e].style.cssFloat=""}.bind(this),0)},adjustRows:function(e){for(var n,o,a,r=this.getOptions(e),s=e.querySelectorAll(".edys-gallery-wall-item:not(.edy-hidden), .edys-gallery-sortable-placeholder"),l=window.getComputedStyle?window.getComputedStyle(e).marginRight:e.currentStyle.marginRight,d=Math.abs(parseFloat(l)),c=e.getBoundingClientRect(),h=c.right-c.left,u=[],m=[],p=0,g=s.length;g>p;p++)if(u.push(s[p]),n=t(u,h-2*u.length*d),n<=r.thumbsize||p===g-1&&u.length>0){for(o=0,a=u.length;a>o;o++)m.push({img:u[o],h:n});u=[]}i(m,r.thumbsize)},update:function(e){this.adjustRows(e),this.reRender(e)},handleThumbClick:function(e){var t=e.delegateTarget,i=EdicyGalleries.closest(t,this.gallerySelector),n={gallery_id:parseInt(i.getAttribute("data-gallery-id"),10),gallerySettings:JSON.parse(i.getAttribute("data-settings")),photo_id:parseInt(t.getAttribute("data-gallery-photo-id"),10),photos:this.getPhotos(i)};e.preventDefault(),t.dispatchEvent(new CustomEvent("edicy:photo:show",{bubbles:!0,detail:n}))},getPhotos:function(e){return Array.prototype.slice.call(e.querySelectorAll("[data-gallery-photo-id]")).map(function(e){return{id:parseInt(e.getAttribute("data-gallery-photo-id"),10),sizes:JSON.parse(e.getAttribute("data-sizes")),title:e.getAttribute("data-title")}})}},window.EdicyGalleries.wall=new o(".edys-gallery-wall")}(),function(){var e=function(e,t,i){var n=window.getComputedStyle(t),o=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,i&&i.thumbsize?i.thumbsize:200).url:e.url,a=document.createElement("div");return a.classList.add("edy-asset-dragproxy"),a.classList.add("edys-gallery-wall-dragproxy"),a.style.backgroundImage='url("'+o+'")',a.style.width=n.width,a.style.height=n.height,a},t=function(e,t){var i=document.createElement("div");return i.classList.add("edys-gallery-sortable-placeholder"),i.classList.add("edys-gallery-upload-placeholder"),i.setAttribute("data-original-width",100),i.setAttribute("data-original-height",100),i.style.backgroundImage='url("'+e.thumbnail+'")',t&&t.spacing&&(i.style.margin=t.spacing+"px"),i},i=function(e,t,i){var n=document.createElement("div"),o=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,i&&i.thumbsize?i.thumbsize:200).url:e.url;return n.classList.add("edys-gallery-sortable-placeholder"),n.setAttribute("data-original-width",e.width),n.setAttribute("data-original-height",e.height),e.sizes&&n.setAttribute("data-sizes",JSON.stringify(e.sizes)),e.title&&n.setAttribute("data-title",JSON.stringify(e.title)),n.style.width=t.style.width,n.style.height=t.style.height,n.style.backgroundImage='url("'+o+'")',i&&i.spacing&&(n.style.margin=i.spacing+"px"),n},n=function(e,t){var i=document.createElement("div"),n=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,t&&t.thumbsize?t.thumbsize:200).url:e.url;n||(n=e.thumbnail),i.classList.add("edys-gallery-wall-item"),i.setAttribute("data-original-width",e.width),i.setAttribute("data-original-height",e.height);var o=document.createElement("a");e.url&&o.setAttribute("href",e.url),i.appendChild(o),t&&t.spacing&&(i.style.margin=t.spacing+"px");var a=document.createElement("img");return a.classList.add("edys-gallery-wall-image"),n&&(a.src=n),o.appendChild(a),i},o=function(e,t){var i=document.createElement("div");i.className="edys-gallery-area edys-gallery-wall",i.setAttribute("data-gallery-id",e),t&&(i.setAttribute("data-settings",JSON.stringify(t)),t.spacing&&(i.style.marginLeft=-1*t.spacing+"px",i.style.marginRight=-1*t.spacing+"px"));var n=document.createElement("div");n.className="edys-gallery-wall-scroll-crop";var o=document.createElement("div");return o.className="edys-gallery-wall-inner",o.setAttribute("data-gallery-photos",""),n.appendChild(o),i.appendChild(n),i};window.edy.push(["extendGallery",{galleryType:"wall",name:"Wall",placeholder:i,uploadPlaceholder:t,helper:e,item:n,wrapper:o,options:[{name:"Thumbnail height",key:"thumbsize",unit:"px",type:"number",defaultValue:200},{name:"Thumbnail spacing",key:"spacing",unit:"px",type:"number",defaultValue:0}]}])}(),function(){var e=function(e){this.gallerySelector=e,this.gallerySelector&&this.init()};e.prototype={init:function(){this.thumbClickListener=EdicyGalleries.listen(document,"click",this.gallerySelector+" [data-gallery-photo-id]",this.handleThumbClick.bind(this)),this.changeListener=EdicyGalleries.listen(document,"edicy:gallery:change",this.gallerySelector,this.handleChange.bind(this)),this.polyfillObjFit()},handleThumbClick:function(e){var t=e.delegateTarget,i=EdicyGalleries.closest(t,this.gallerySelector),n={gallery_id:parseInt(i.getAttribute("data-gallery-id"),10),gallerySettings:JSON.parse(i.getAttribute("data-settings")),photo_id:parseInt(t.getAttribute("data-gallery-photo-id"),10),photos:this.getPhotos(i)};e.preventDefault(),t.dispatchEvent(new CustomEvent("edicy:photo:show",{bubbles:!0,detail:n}))},handleChange:function(e){var t=e.delegateTarget;"objectFit"in document.documentElement.style==!1&&setTimeout(function(){window.EdicyGalleries.stretchImages(t.querySelectorAll("img"))}.bind(this),0)},polyfillObjFit:function(){"objectFit"in document.documentElement.style==!1&&window.EdicyGalleries.stretchImages(document.querySelectorAll(this.gallerySelector+" img"))},getPhotos:function(e){return Array.prototype.slice.call(e.querySelectorAll("[data-gallery-photo-id]")).map(function(e){return{id:parseInt(e.getAttribute("data-gallery-photo-id"),10),sizes:JSON.parse(e.getAttribute("data-sizes")),title:e.getAttribute("data-title")}})},destroy:function(){this.thumbClickListener.stop(),this.changeListener.stop()}},window.EdicyGalleries.Squares=new e(".edys-gallery-squares")}(),function(){var e=function(e,t,i){var n=(window.getComputedStyle(t),i&&i.thumbsize?i.thumbsize:96),o=e.sizes?EdicyGalleries.findSizeByHeight(e.sizes,n).url:e.url,a=document.createElement("div");return a.classList.add("edy-asset-dragproxy"),a.classList.add("edys-gallery-squares-dragproxy"),a.style.backgroundImage='url("'+o+'")',a.style.width=n+"px",a.style.height=n+"px",a},t=function(e,t){var i=document.createElement("a"),n=t&&t.thumbsize?t.thumbsize:96;return i.classList.add("edys-gallery-item-placeholder"),i.classList.add("edys-gallery-upload-placeholder"),i.style.backgroundImage='url("'+e.thumbnail+'")',i.style.width=n+"px",i.style.height=n+"px",i},i=function(e,t,i){var n=document.createElement("a"),o=i&&i.thumbsize?i.thumbsize:96,a=e.sizes&&i&&i.thumbsize?EdicyGalleries.findCoveringSize(e.sizes,o).url:e.thumbnail;return n.classList.add("edys-gallery-item-placeholder"),n.style.backgroundImage='url("'+a+'")',n.style.width=o+"px",n.style.height=o+"px",n},n=function(e,t){var i=document.createElement("a"),n=document.createElement("img"),o=e.sizes&&t&&t.thumbsize?EdicyGalleries.findCoveringSize(e.sizes,t.thumbsize).url:e.thumbnail;return i.appendChild(n),i.classList.add("edys-gallery-item"),e.url&&(i.href=e.url),o&&n.setAttribute("src",o),n.classList.add("edys-gallery-image"),t&&t.thumbsize&&(i.style.width=t.thumbsize+"px",i.style.height=t.thumbsize+"px",n.style.width=t.thumbsize+"px",n.style.height=t.thumbsize+"px"),i},o=function(e){var t=document.createElement("div");t.className="photo_gallery_area edys-gallery-area edys-gallery-squares",t.setAttribute("data-gallery-id",e);var i=document.createElement("div");return i.className="edys-gallery",i.setAttribute("data-gallery-photos",""),t.appendChild(i),t},a=[{name:"Thumbnail size",key:"thumbsize",unit:"px",type:"number",defaultValue:96}];window.edy.push(["extendGallery",{galleryType:"squares",name:"Squares",helper:e,placeholder:i,uploadPlaceholder:t,item:n,wrapper:o,options:a}])}(),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipe=t()}(this,function(){"use strict";var e=function(e,t,i,n){var o={features:null,bind:function(e,t,i,n){var o=(n?"remove":"add")+"EventListener";t=t.split(" ");for(var a=0;a<t.length;a++)t[a]&&e[o](t[a],i,!1)},isArray:function(e){return e instanceof Array},createEl:function(e,t){var i=document.createElement(t||"div");return e&&(i.className=e),i},getScrollY:function(){var e=window.pageYOffset;return void 0!==e?e:document.documentElement.scrollTop},unbind:function(e,t,i){o.bind(e,t,i,!0)},removeClass:function(e,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(e,t){o.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},hasClass:function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},getChildByClass:function(e,t){for(var i=e.firstChild;i;){if(o.hasClass(i,t))return i;i=i.nextSibling}},arraySearch:function(e,t,i){for(var n=e.length;n--;)if(e[n][i]===t)return n;return-1},extend:function(e,t,i){for(var n in t)if(t.hasOwnProperty(n)){if(i&&e.hasOwnProperty(n))continue;e[n]=t[n]}},easing:{sine:{out:function(e){return Math.sin(e*(Math.PI/2))},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{out:function(e){return--e*e*e+1}}},detectFeatures:function(){if(o.features)return o.features;var e=o.createEl(),t=e.style,i="",n={};if(n.oldIE=document.all&&!document.addEventListener,n.touch="ontouchstart"in window,window.requestAnimationFrame&&(n.raf=window.requestAnimationFrame,n.caf=window.cancelAnimationFrame),n.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!n.pointerEvent){var a=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var r=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);r&&r.length>0&&(r=parseInt(r[1],10),r>=1&&8>r&&(n.isOldIOSPhone=!0))}var s=a.match(/Android\s([0-9\.]*)/),l=s?s[1]:0;l=parseFloat(l),l>=1&&(4.4>l&&(n.isOldAndroid=!0),n.androidVersion=l),n.isMobileOpera=/opera mini|opera mobi/i.test(a)}for(var d,c,h=["transform","perspective","animationName"],u=["","webkit","Moz","ms","O"],m=0;4>m;m++){i=u[m];for(var p=0;3>p;p++)d=h[p],c=i+(i?d.charAt(0).toUpperCase()+d.slice(1):d),!n[d]&&c in t&&(n[d]=c);i&&!n.raf&&(i=i.toLowerCase(),n.raf=window[i+"RequestAnimationFrame"],n.raf&&(n.caf=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"]))}if(!n.raf){var g=0;n.raf=function(e){var t=(new Date).getTime(),i=Math.max(0,16-(t-g)),n=window.setTimeout(function(){e(t+i)},i);return g=t+i,n},n.caf=function(e){clearTimeout(e)}}return n.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,o.features=n,n}};o.detectFeatures(),o.features.oldIE&&(o.bind=function(e,t,i,n){t=t.split(" ");for(var o,a=(n?"detach":"attach")+"Event",r=function(){i.handleEvent.call(i)},s=0;s<t.length;s++)if(o=t[s])if("object"==typeof i&&i.handleEvent){if(n){if(!i["oldIE"+o])return!1}else i["oldIE"+o]=r;e[a]("on"+o,i["oldIE"+o])}else e[a]("on"+o,i)});var a=this,r=25,s=3,l={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.6,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.5},maxSpreadZoom:2,modal:!0,scaleMode:"fit",alwaysFadeIn:!1};o.extend(l,n);var d,c,h,u,m,p,g,f,y,b,v,w,C,E,x,S,k,T,N,_,A,L,R,O,I,P,M,D,B,z,$,H,j,q,F,V,U,W,G,K,Y,X,J,Z,Q,et,tt,it,nt,ot,at,rt,st,lt,dt,ct,ht=function(){return{x:0,y:0}},ut=ht(),mt=ht(),pt=ht(),gt={},ft=0,yt={},bt=ht(),vt=0,wt=!0,Ct=[],Et={},xt=function(e,t){o.extend(a,t.publicMethods),Ct.push(e)},St=function(e){var t=Zi();return e>t-1?e-t:0>e?t+e:e},kt={},Tt=function(e,t){return kt[e]||(kt[e]=[]),kt[e].push(t)},Nt=function(e){var t=kt[e];if(t){var i=Array.prototype.slice.call(arguments);i.shift();for(var n=0;n<t.length;n++)t[n].apply(a,i)}},_t=function(){return(new Date).getTime()},At=function(e){lt=e,a.bg.style.opacity=e*l.bgOpacity},Lt=function(e,t,i,n){e[L]=w+t+"px, "+i+"px"+C+" scale("+n+")"},Rt=function(){nt&&Lt(nt,pt.x,pt.y,b)},Ot=function(e){e.container&&Lt(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel)},It=function(e,t){t[L]=w+e+"px, 0px"+C},Pt=function(e,t){if(!l.loop&&t){var i=u+(bt.x*ft-e)/bt.x,n=Math.round(e-yi.x);(0>i&&n>0||i>=Zi()-1&&0>n)&&(e=yi.x+n*l.mainScrollEndFriction)}yi.x=e,It(e,m)},Mt=function(e,t){var i=bi[e]-yt[e];return mt[e]+ut[e]+i-i*(t/v)},Dt=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},Bt=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},zt=null,$t=function(){zt&&(o.unbind(document,"mousemove",$t),o.addClass(e,"pswp--has_mouse"),l.mouseUsed=!0,Nt("mouseUsed")),zt=setTimeout(function(){zt=null},100)},Ht=function(){o.bind(document,"keydown",a),$.transform&&o.bind(a.scrollWrap,"click",a),l.mouseUsed||o.bind(document,"mousemove",$t),o.bind(window,"resize scroll",a),Nt("bindEvents")},jt=function(){o.unbind(window,"resize",a),o.unbind(window,"scroll",y.scroll),o.unbind(document,"keydown",a),o.unbind(document,"mousemove",$t),$.transform&&o.unbind(a.scrollWrap,"click",a),W&&o.unbind(window,g,a),Nt("unbindEvents")},qt=function(e,t){var i=sn(a.currItem,gt,e);return t&&(it=i),i},Ft=function(e){return e||(e=a.currItem),e.initialZoomLevel},Vt=function(e){return e||(e=a.currItem),e.w>0?l.maxSpreadZoom:1},Ut=function(e,t,i,n){return n===a.currItem.initialZoomLevel?(i[e]=a.currItem.initialPosition[e],!0):(i[e]=Mt(e,n),i[e]>t.min[e]?(i[e]=t.min[e],!0):i[e]<t.max[e]?(i[e]=t.max[e],!0):!1)},Wt=function(){if(L){var t=$.perspective&&!O;return w="translate"+(t?"3d(":"("),C=$.perspective?", 0px)":")",void 0}L="left",o.addClass(e,"pswp--ie"),It=function(e,t){t.left=e+"px"},Ot=function(e){var t=e.fitRatio>1?1:e.fitRatio,i=e.container.style,n=t*e.w,o=t*e.h;i.width=n+"px",i.height=o+"px",i.left=e.initialPosition.x+"px",i.top=e.initialPosition.y+"px"},Rt=function(){if(nt){var e=nt,t=a.currItem,i=t.fitRatio>1?1:t.fitRatio,n=i*t.w,o=i*t.h;e.width=n+"px",e.height=o+"px",e.left=pt.x+"px",e.top=pt.y+"px"}}},Gt=function(e){var t="";l.escKey&&27===e.keyCode?t="close":l.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),t&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,a[t]()))},Kt=function(e){e&&(Y||K||ot||V)&&(e.preventDefault(),e.stopPropagation())},Yt=function(){a.setScrollOffset(0,o.getScrollY())},Xt={},Jt=0,Zt=function(e){Xt[e]&&(Xt[e].raf&&P(Xt[e].raf),Jt--,delete Xt[e])},Qt=function(e){Xt[e]&&Zt(e),Xt[e]||(Jt++,Xt[e]={})},ei=function(){for(var e in Xt)Xt.hasOwnProperty(e)&&Zt(e)},ti=function(e,t,i,n,o,a,r){var s,l=_t();Qt(e);var d=function(){if(Xt[e]){if(s=_t()-l,s>=n)return Zt(e),a(i),r&&r(),void 0;a((i-t)*o(s/n)+t),Xt[e].raf=I(d)}};d()},ii={shout:Nt,listen:Tt,viewportSize:gt,options:l,isMainScrollAnimating:function(){return ot},getZoomLevel:function(){return b},getCurrentIndex:function(){return u},isDragging:function(){return W},isZooming:function(){return Q},setScrollOffset:function(e,t){yt.x=e,z=yt.y=t,Nt("updateScrollOffset",yt)},applyZoomPan:function(e,t,i){pt.x=t,pt.y=i,b=e,Rt()},init:function(){if(!d&&!c){var i;a.framework=o,a.template=e,a.bg=o.getChildByClass(e,"pswp__bg"),M=e.className,d=!0,$=o.detectFeatures(),I=$.raf,P=$.caf,L=$.transform,B=$.oldIE,a.scrollWrap=o.getChildByClass(e,"pswp__scroll-wrap"),a.container=o.getChildByClass(a.scrollWrap,"pswp__container"),m=a.container.style,a.itemHolders=S=[{el:a.container.children[0],wrap:0,index:-1},{el:a.container.children[1],wrap:0,index:-1},{el:a.container.children[2],wrap:0,index:-1}],S[0].el.style.display=S[2].el.style.display="none",Wt(),y={resize:a.updateSize,scroll:Yt,keydown:Gt,click:Kt};var n=$.isOldIOSPhone||$.isOldAndroid||$.isMobileOpera;for($.animationName&&$.transform&&!n||(l.showAnimationDuration=l.hideAnimationDuration=0),i=0;i<Ct.length;i++)a["init"+Ct[i]]();if(t){var r=a.ui=new t(a,o);r.init()}Nt("firstUpdate"),u=u||l.index||0,(isNaN(u)||0>u||u>=Zi())&&(u=0),a.currItem=Ji(u),($.isOldIOSPhone||$.isOldAndroid)&&(wt=!1),e.setAttribute("aria-hidden","false"),l.modal&&(wt?e.style.position="fixed":(e.style.position="absolute",e.style.top=o.getScrollY()+"px")),void 0===z&&(Nt("initialLayout"),z=D=o.getScrollY());var h="pswp--open ";for(l.mainClass&&(h+=l.mainClass+" "),l.showHideOpacity&&(h+="pswp--animate_opacity "),h+=O?"pswp--touch":"pswp--notouch",h+=$.animationName?" pswp--css_animation":"",h+=$.svg?" pswp--svg":"",o.addClass(e,h),a.updateSize(),p=-1,vt=null,i=0;s>i;i++)It((i+p)*bt.x,S[i].el.style);B||o.bind(a.scrollWrap,f,a),Tt("initialZoomInEnd",function(){a.setContent(S[0],u-1),a.setContent(S[2],u+1),S[0].el.style.display=S[2].el.style.display="block",l.focus&&e.focus(),Ht()}),a.setContent(S[1],u),a.updateCurrItem(),Nt("afterInit"),wt||(E=setInterval(function(){Jt||W||Q||b!==a.currItem.initialZoomLevel||a.updateSize()},1e3)),o.addClass(e,"pswp--visible")}},close:function(){d&&(d=!1,c=!0,Nt("close"),jt(),en(a.currItem,null,!0,a.destroy))},destroy:function(){Nt("destroy"),Gi&&clearTimeout(Gi),e.setAttribute("aria-hidden","true"),e.className=M,E&&clearInterval(E),o.unbind(a.scrollWrap,f,a),o.unbind(window,"scroll",a),xi(),ei(),kt=null},panTo:function(e,t,i){i||(e>it.min.x?e=it.min.x:e<it.max.x&&(e=it.max.x),t>it.min.y?t=it.min.y:t<it.max.y&&(t=it.max.y)),pt.x=e,pt.y=t,Rt()},handleEvent:function(e){e=e||window.event,y[e.type]&&y[e.type](e)},goTo:function(e){e=St(e);var t=e-u;vt=t,u=e,a.currItem=Ji(u),ft-=t,Pt(bt.x*ft),ei(),ot=!1,a.updateCurrItem()},next:function(){a.goTo(u+1)},prev:function(){a.goTo(u-1)},updateCurrZoomItem:function(e){if(e&&Nt("beforeChange",0),S[1].el.children.length){var t=S[1].el.children[0];nt=o.hasClass(t,"pswp__zoom-wrap")?t.style:null}else nt=null;it=a.currItem.bounds,v=b=a.currItem.initialZoomLevel,pt.x=it.center.x,pt.y=it.center.y,e&&Nt("afterChange")},invalidateCurrItems:function(){x=!0;for(var e=0;s>e;e++)S[e].item&&(S[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==vt){var t,i=Math.abs(vt);if(!(e&&2>i)){a.currItem=Ji(u),Nt("beforeChange",vt),i>=s&&(p+=vt+(vt>0?-s:s),i=s);for(var n=0;i>n;n++)vt>0?(t=S.shift(),S[s-1]=t,p++,It((p+2)*bt.x,t.el.style),a.setContent(t,u-i+n+1+1)):(t=S.pop(),S.unshift(t),p--,It(p*bt.x,t.el.style),a.setContent(t,u+i-n-1-1));if(nt&&1===Math.abs(vt)){var o=Ji(k);o.initialZoomLevel!==b&&(sn(o,gt),Ot(o))}vt=0,a.updateCurrZoomItem(),k=u,Nt("afterChange")}}},updateSize:function(t){if(!wt&&l.modal){var i=o.getScrollY();if(z!==i&&(e.style.top=i+"px",z=i),!t&&Et.x===window.innerWidth&&Et.y===window.innerHeight)return;Et.x=window.innerWidth,Et.y=window.innerHeight,e.style.height=Et.y+"px"}if(gt.x=a.scrollWrap.clientWidth,gt.y=a.scrollWrap.clientHeight,Yt(),bt.x=gt.x+Math.round(gt.x*l.spacing),bt.y=gt.y,Pt(bt.x*ft),Nt("beforeResize"),void 0!==p){for(var n,r,d,c=0;s>c;c++)n=S[c],It((c+p)*bt.x,n.el.style),d=u+c-1,l.loop&&Zi()>2&&(d=St(d)),r=Ji(d),r&&(x||r.needsUpdate||!r.bounds)?(a.cleanSlide(r),a.setContent(n,d),1===c&&(a.currItem=r,a.updateCurrZoomItem(!0)),r.needsUpdate=!1):-1===n.index&&d>=0&&a.setContent(n,d),r&&r.container&&(sn(r,gt),Ot(r));x=!1}v=b=a.currItem.initialZoomLevel,it=a.currItem.bounds,it&&(pt.x=it.center.x,pt.y=it.center.y,Rt()),Nt("resize")},zoomTo:function(e,t,i,n,a){t&&(v=b,bi.x=Math.abs(t.x)-pt.x,bi.y=Math.abs(t.y)-pt.y,Dt(mt,pt));var r=qt(e,!1),s={};Ut("x",r,s,e),Ut("y",r,s,e);var l=b,d={x:pt.x,y:pt.y};Bt(s);var c=function(t){1===t?(b=e,pt.x=s.x,pt.y=s.y):(b=(e-l)*t+l,pt.x=(s.x-d.x)*t+d.x,pt.y=(s.y-d.y)*t+d.y),a&&a(t),Rt()};i?ti("customZoomTo",0,1,i,n||o.easing.sine.inOut,c):c(1)}},ni=30,oi=10,ai={},ri={},si={},li={},di={},ci=[],hi={},ui=[],mi={},pi=0,gi=ht(),fi=0,yi=ht(),bi=ht(),vi=ht(),wi=function(e,t){return e.x===t.x&&e.y===t.y},Ci=function(e,t){return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r},Ei=function(e,t){return mi.x=Math.abs(e.x-t.x),mi.y=Math.abs(e.y-t.y),Math.sqrt(mi.x*mi.x+mi.y*mi.y)},xi=function(){X&&(P(X),X=null)},Si=function(){W&&(X=I(Si),Hi())},ki=function(){return!("fit"===l.scaleMode&&b===a.currItem.initialZoomLevel)},Ti=function(e,t){return e?e.className&&e.className.indexOf("pswp__scroll-wrap")>-1?!1:t(e)?e:Ti(e.parentNode,t):!1},Ni={},_i=function(e,t){return Ni.prevent=!Ti(e.target,l.isClickableElement),Nt("preventDragEvent",e,t,Ni),Ni.prevent},Ai=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},Li=function(e,t,i){i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y)},Ri=function(e,t,i){if(e-j>50){var n=ui.length>2?ui.shift():{};n.x=t,n.y=i,ui.push(n),j=e}},Oi=function(){var e=pt.y-a.currItem.initialPosition.y;return 1-Math.abs(e/(gt.y/2))},Ii={},Pi={},Mi=[],Di=function(e){for(;Mi.length>0;)Mi.pop();return R?(ct=0,ci.forEach(function(e){0===ct?Mi[0]=e:1===ct&&(Mi[1]=e),ct++})):e.type.indexOf("touch")>-1?e.touches&&e.touches.length>0&&(Mi[0]=Ai(e.touches[0],Ii),e.touches.length>1&&(Mi[1]=Ai(e.touches[1],Pi))):(Ii.x=e.pageX,Ii.y=e.pageY,Ii.id="",Mi[0]=Ii),Mi},Bi=function(e,t){var i,n,o,r,s=0,d=pt[e]+t[e],c=t[e]>0,h=yi.x+t.x,u=yi.x-hi.x;return i=d>it.min[e]||d<it.max[e]?l.panEndFriction:1,d=pt[e]+t[e]*i,!l.allowPanToNext&&b!==a.currItem.initialZoomLevel||(nt?"h"!==at||"x"!==e||K||(c?(d>it.min[e]&&(i=l.panEndFriction,s=it.min[e]-d,n=it.min[e]-mt[e]),(0>=n||0>u)&&Zi()>1?(r=h,0>u&&h>hi.x&&(r=hi.x)):it.min.x!==it.max.x&&(o=d)):(d<it.max[e]&&(i=l.panEndFriction,s=d-it.max[e],n=mt[e]-it.max[e]),(0>=n||u>0)&&Zi()>1?(r=h,u>0&&h<hi.x&&(r=hi.x)):it.min.x!==it.max.x&&(o=d))):r=h,"x"!==e)?(ot||J||b>a.currItem.fitRatio&&(pt[e]+=t[e]*i),void 0):(void 0!==r&&(Pt(r,!0),J=r===hi.x?!1:!0),it.min.x!==it.max.x&&(void 0!==o?pt.x=o:J||(pt.x+=t.x*i)),void 0!==r)},zi=function(e){if(!("mousedown"===e.type&&e.button>0)){if(Xi)return e.preventDefault(),void 0;if(!U||"mousedown"!==e.type){if(_i(e,!0)&&e.preventDefault(),Nt("pointerDown"),R){var t=o.arraySearch(ci,e.pointerId,"id");0>t&&(t=ci.length),ci[t]={x:e.pageX,y:e.pageY,id:e.pointerId}}var i=Di(e),n=i.length;Z=null,ei(),W&&1!==n||(W=rt=!0,o.bind(window,g,a),F=dt=st=V=J=Y=G=K=!1,at=null,Nt("firstTouchStart",i),Dt(mt,pt),ut.x=ut.y=0,Dt(li,i[0]),Dt(di,li),hi.x=bt.x*ft,ui=[{x:li.x,y:li.y}],j=H=_t(),qt(b,!0),xi(),Si()),!Q&&n>1&&!ot&&!J&&(v=b,K=!1,Q=G=!0,ut.y=ut.x=0,Dt(mt,pt),Dt(ai,i[0]),Dt(ri,i[1]),Li(ai,ri,vi),bi.x=Math.abs(vi.x)-pt.x,bi.y=Math.abs(vi.y)-pt.y,et=tt=Ei(ai,ri))}}},$i=function(e){if(e.preventDefault(),R){var t=o.arraySearch(ci,e.pointerId,"id");if(t>-1){var i=ci[t];i.x=e.pageX,i.y=e.pageY}}if(W){var n=Di(e);if(at||Y||Q)Z=n;else{var a=Math.abs(n[0].x-li.x)-Math.abs(n[0].y-li.y);Math.abs(a)>=oi&&(at=a>0?"h":"v",Z=n)}}},Hi=function(){if(Z){var e=Z.length;if(0!==e)if(Dt(ai,Z[0]),si.x=ai.x-li.x,si.y=ai.y-li.y,Q&&e>1){if(li.x=ai.x,li.y=ai.y,!si.x&&!si.y&&wi(Z[1],ri))return;Dt(ri,Z[1]),K||(K=!0,Nt("zoomGestureStarted"));var t=Ei(ai,ri),i=Ui(t);i>a.currItem.initialZoomLevel+a.currItem.initialZoomLevel/15&&(dt=!0);var n=1,o=Ft(),r=Vt();if(o>i)if(l.pinchToClose&&!dt&&v<=a.currItem.initialZoomLevel){var s=o-i,d=1-s/(o/1.2);At(d),Nt("onPinchClose",d),st=!0}else n=(o-i)/o,n>1&&(n=1),i=o-n*(o/3);else i>r&&(n=(i-r)/(6*o),n>1&&(n=1),i=r+n*o);0>n&&(n=0),et=t,Li(ai,ri,gi),ut.x+=gi.x-vi.x,ut.y+=gi.y-vi.y,Dt(vi,gi),pt.x=Mt("x",i),pt.y=Mt("y",i),F=i>b,b=i,Rt()}else{if(!at)return;if(rt&&(rt=!1,Math.abs(si.x)>=oi&&(si.x-=Z[0].x-di.x),Math.abs(si.y)>=oi&&(si.y-=Z[0].y-di.y)),li.x=ai.x,li.y=ai.y,0===si.x&&0===si.y)return;if("v"===at&&l.closeOnVerticalDrag&&!ki()){ut.y+=si.y,pt.y+=si.y;var c=Oi();return V=!0,Nt("onVerticalDrag",c),At(c),Rt(),void 0}Ri(_t(),ai.x,ai.y),Y=!0,it=a.currItem.bounds;var h=Bi("x",si);h||(Bi("y",si),Bt(pt),Rt())}}},ji=function(e){if($.isOldAndroid){if(U&&"mouseup"===e.type)return;e.type.indexOf("touch")>-1&&(clearTimeout(U),U=setTimeout(function(){U=0},600))}Nt("pointerUp"),_i(e,!1)&&e.preventDefault();var t;if(R){var i=o.arraySearch(ci,e.pointerId,"id");if(i>-1)if(t=ci.splice(i,1)[0],navigator.pointerEnabled)t.type=e.pointerType||"mouse";else{var n={4:"mouse",2:"touch",3:"pen"};t.type=n[e.pointerType],t.type||(t.type=e.pointerType||"mouse")}}var r,s=Di(e),d=s.length;if("mouseup"===e.type&&(d=0),2===d)return Z=null,!0;1===d&&Dt(di,s[0]),0!==d||at||ot||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),Nt("touchRelease",e,t));var c=-1;if(0===d&&(W=!1,o.unbind(window,g,a),xi(),Q?c=0:-1!==fi&&(c=_t()-fi)),fi=1===d?_t():-1,r=-1!==c&&150>c?"zoom":"swipe",Q&&2>d&&(Q=!1,1===d&&(r="zoomPointerUp"),Nt("zoomGestureEnded")),Z=null,Y||K||ot||V)if(ei(),q||(q=qi()),q.calculateSwipeSpeed("x"),V){var h=Oi();if(h<l.verticalDragRange)a.close();else{var u=pt.y,m=lt;ti("verticalDrag",0,1,300,o.easing.cubic.out,function(e){pt.y=(a.currItem.initialPosition.y-u)*e+u,At((1-m)*e+m),Rt()}),Nt("onVerticalDrag",1)}}else{if((J||ot)&&0===d){var p=Vi(r,q);if(p)return;r="zoomPointerUp"}if(!ot)return"swipe"!==r?(Wi(),void 0):(!J&&b>a.currItem.fitRatio&&Fi(q),void 0)}},qi=function(){var e,t,i={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(n){ui.length>1?(e=_t()-j+50,t=ui[ui.length-2][n]):(e=_t()-H,t=di[n]),i.lastFlickOffset[n]=li[n]-t,i.lastFlickDist[n]=Math.abs(i.lastFlickOffset[n]),i.lastFlickSpeed[n]=i.lastFlickDist[n]>20?i.lastFlickOffset[n]/e:0,Math.abs(i.lastFlickSpeed[n])<.1&&(i.lastFlickSpeed[n]=0),i.slowDownRatio[n]=.95,i.slowDownRatioReverse[n]=1-i.slowDownRatio[n],i.speedDecelerationRatio[n]=1},calculateOverBoundsAnimOffset:function(e,t){i.backAnimStarted[e]||(pt[e]>it.min[e]?i.backAnimDestination[e]=it.min[e]:pt[e]<it.max[e]&&(i.backAnimDestination[e]=it.max[e]),void 0!==i.backAnimDestination[e]&&(i.slowDownRatio[e]=.7,i.slowDownRatioReverse[e]=1-i.slowDownRatio[e],i.speedDecelerationRatioAbs[e]<.05&&(i.lastFlickSpeed[e]=0,i.backAnimStarted[e]=!0,ti("bounceZoomPan"+e,pt[e],i.backAnimDestination[e],t||300,o.easing.sine.out,function(t){pt[e]=t,Rt()}))))},calculateAnimOffset:function(e){i.backAnimStarted[e]||(i.speedDecelerationRatio[e]=i.speedDecelerationRatio[e]*(i.slowDownRatio[e]+i.slowDownRatioReverse[e]-i.slowDownRatioReverse[e]*i.timeDiff/10),i.speedDecelerationRatioAbs[e]=Math.abs(i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]),i.distanceOffset[e]=i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]*i.timeDiff,pt[e]+=i.distanceOffset[e])},panAnimLoop:function(){return Xt.zoomPan&&(Xt.zoomPan.raf=I(i.panAnimLoop),i.now=_t(),i.timeDiff=i.now-i.lastNow,i.lastNow=i.now,i.calculateAnimOffset("x"),i.calculateAnimOffset("y"),Rt(),i.calculateOverBoundsAnimOffset("x"),i.calculateOverBoundsAnimOffset("y"),i.speedDecelerationRatioAbs.x<.05&&i.speedDecelerationRatioAbs.y<.05)?(pt.x=Math.round(pt.x),pt.y=Math.round(pt.y),Rt(),Zt("zoomPan"),void 0):void 0}};return i},Fi=function(e){return e.calculateSwipeSpeed("y"),it=a.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05?(e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0):(Qt("zoomPan"),e.lastNow=_t(),e.panAnimLoop(),void 0)},Vi=function(e,t){var i;ot||(pi=u);var n;if("swipe"===e){var r=li.x-di.x,s=t.lastFlickDist.x<10;r>ni&&(s||t.lastFlickOffset.x>20)?n=-1:-ni>r&&(s||t.lastFlickOffset.x<-20)&&(n=1)}var d;n&&(u+=n,0>u?(u=l.loop?Zi()-1:0,d=!0):u>=Zi()&&(u=l.loop?0:Zi()-1,d=!0),(!d||l.loop)&&(vt+=n,ft-=n,i=!0));var c,h=bt.x*ft,m=Math.abs(h-yi.x);return i||h>yi.x==t.lastFlickSpeed.x>0?(c=Math.abs(t.lastFlickSpeed.x)>0?m/Math.abs(t.lastFlickSpeed.x):333,c=Math.min(c,400),c=Math.max(c,250)):c=333,pi===u&&(i=!1),ot=!0,Nt("mainScrollAnimStart"),ti("mainScroll",yi.x,h,c,o.easing.cubic.out,Pt,function(){ei(),ot=!1,pi=-1,(i||pi!==u)&&a.updateCurrItem(),Nt("mainScrollAnimComplete")}),i&&a.updateCurrItem(!0),i},Ui=function(e){return 1/tt*e*v},Wi=function(){var e=b,t=Ft(),i=Vt();t>b?e=t:b>i&&(e=i);var n,r=1,s=lt;return st&&!F&&!dt&&t>b?(a.close(),!0):(st&&(n=function(e){At((r-s)*e+s)}),a.zoomTo(e,0,300,o.easing.cubic.out,n),!0)};xt("Gestures",{publicMethods:{initGestures:function(){var e=function(e,t,i,n,o){T=e+t,N=e+i,_=e+n,A=o?e+o:""};R=$.pointerEvent,R&&$.touch&&($.touch=!1),R?navigator.pointerEnabled?e("pointer","down","move","up","cancel"):e("MSPointer","Down","Move","Up","Cancel"):$.touch?(e("touch","start","move","end","cancel"),O=!0):e("mouse","down","move","up"),g=N+" "+_+" "+A,f=T,R&&!O&&(O=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),a.likelyTouchDevice=O,y[T]=zi,y[N]=$i,y[_]=ji,A&&(y[A]=y[_]),$.touch&&(f+=" mousedown",g+=" mousemove mouseup",y.mousedown=y[T],y.mousemove=y[N],y.mouseup=y[_]),O||(l.allowPanToNext=!1)}}});var Gi,Ki,Yi,Xi,Ji,Zi,Qi,en=function(t,i,n,r){Gi&&clearTimeout(Gi),Xi=!0,Yi=!0;var s;t.initialLayout?(s=t.initialLayout,t.initialLayout=null):s=l.getThumbBoundsFn&&l.getThumbBoundsFn(u);var d=n?l.hideAnimationDuration:l.showAnimationDuration,c=function(){Zt("initialZoom"),n?(a.template.removeAttribute("style"),a.bg.removeAttribute("style")):(At(1),i&&(i.style.display="block"),o.addClass(e,"pswp--animated-in"),Nt("initialZoom"+(n?"OutEnd":"InEnd"))),r&&r(),Xi=!1};if(!d||!s||void 0===s.x){var m=function(){Nt("initialZoom"+(n?"Out":"In")),b=t.initialZoomLevel,Dt(pt,t.initialPosition),Rt(),e.style.opacity=n?0:1,At(1),c()};return m(),void 0}var p=function(){var i=h,r=!a.currItem.src||a.currItem.loadError||l.showHideOpacity;t.miniImg&&(t.miniImg.style.webkitBackfaceVisibility="hidden"),n||(b=s.w/t.w,pt.x=s.x,pt.y=s.y-D,a[r?"template":"bg"].style.opacity=.001,Rt()),Qt("initialZoom"),n&&!i&&o.removeClass(e,"pswp--animated-in"),r&&(n?o[(i?"remove":"add")+"Class"](e,"pswp--animate_opacity"):setTimeout(function(){o.addClass(e,"pswp--animate_opacity")},30)),Gi=setTimeout(function(){if(Nt("initialZoom"+(n?"Out":"In")),n){var a=s.w/t.w,l={x:pt.x,y:pt.y},h=b,u=lt,m=function(t){1===t?(b=a,pt.x=s.x,pt.y=s.y-z):(b=(a-h)*t+h,pt.x=(s.x-l.x)*t+l.x,pt.y=(s.y-z-l.y)*t+l.y),Rt(),r?e.style.opacity=1-t:At(u-t*u)};i?ti("initialZoom",0,1,d,o.easing.cubic.out,m,c):(m(1),Gi=setTimeout(c,d+20))}else b=t.initialZoomLevel,Dt(pt,t.initialPosition),Rt(),At(1),r?e.style.opacity=1:At(1),Gi=setTimeout(c,d+20)},n?25:90)};p()},tn={},nn=[],on={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Ki.length}},an=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},rn=function(e,t,i){var n=e.bounds;n.center.x=Math.round((tn.x-t)/2),n.center.y=Math.round((tn.y-i)/2)+e.vGap.top,n.max.x=t>tn.x?Math.round(tn.x-t):n.center.x,n.max.y=i>tn.y?Math.round(tn.y-i)+e.vGap.top:n.center.y,n.min.x=t>tn.x?0:n.center.x,n.min.y=i>tn.y?e.vGap.top:n.center.y},sn=function(e,t,i){if(e.src&&!e.loadError){var n=!i;if(n&&(e.vGap||(e.vGap={top:0,bottom:0}),Nt("parseVerticalMargin",e)),tn.x=t.x,tn.y=t.y-e.vGap.top-e.vGap.bottom,n){var o=tn.x/e.w,a=tn.y/e.h;e.fitRatio=a>o?o:a;var r=l.scaleMode;"orig"===r?i=1:"fit"===r&&(i=e.fitRatio),i>1&&(i=1),e.initialZoomLevel=i,e.bounds||(e.bounds=an())}if(!i)return;return rn(e,e.w*i,e.h*i),n&&i===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds}return e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds=an(),e.initialPosition=e.bounds.center,e.bounds},ln=function(e,t,i,n,o,r){if(!t.loadError){var s,d=a.isDragging()&&!a.isZooming(),c=e===u||a.isMainScrollAnimating()||d;!o&&(O||l.alwaysFadeIn)&&c&&(s=!0),n&&(s&&(n.style.opacity=0),t.imageAppended=!0,hn(n,t.w,t.h),i.appendChild(n),s&&setTimeout(function(){n.style.opacity=1,r&&setTimeout(function(){t&&t.loaded&&t.placeholder&&(t.placeholder.style.display="none",t.placeholder=null)},500)},50))}},dn=function(e){e.loading=!0,e.loaded=!1;var t=e.img=o.createEl("pswp__img","img"),i=function(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,t.onload=t.onerror=null,t=null};return t.onload=i,t.onerror=function(){e.loadError=!0,i()},t.src=e.src,t},cn=function(e,t){return e.src&&e.loadError&&e.container?(t&&(e.container.innerHTML=""),e.container.innerHTML=l.errorMsg.replace("%url%",e.src),!0):void 0},hn=function(e,t,i){e.style.width=t+"px",e.style.height=i+"px"},un=function(){if(nn.length){for(var e,t=0;t<nn.length;t++)e=nn[t],e.holder.index===e.index&&ln(e.index,e.item,e.baseDiv,e.img);nn=[]}};xt("Controller",{publicMethods:{lazyLoadItem:function(e){e=St(e);var t=Ji(e);!t||t.loaded||t.loading||(Nt("gettingData",e,t),t.src&&dn(t))},initController:function(){o.extend(l,on,!0),a.items=Ki=i,Ji=a.getItemAt,Zi=l.getNumItemsFn,Qi=l.loop,Zi()<3&&(l.loop=!1),Tt("beforeChange",function(e){var t,i=l.preload,n=null===e?!0:e>0,o=Math.min(i[0],Zi()),r=Math.min(i[1],Zi());for(t=1;(n?r:o)>=t;t++)a.lazyLoadItem(u+t);for(t=1;(n?o:r)>=t;t++)a.lazyLoadItem(u-t)}),Tt("initialLayout",function(){a.currItem.initialLayout=l.getThumbBoundsFn&&l.getThumbBoundsFn(u)
}),Tt("mainScrollAnimComplete",un),Tt("initialZoomInEnd",un),Tt("destroy",function(){for(var e,t=0;t<Ki.length;t++)e=Ki[t],e.container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);nn=null})},getItemAt:function(e){return e>=0?void 0!==Ki[e]?Ki[e]:!1:!1},allowProgressiveImg:function(){return l.forceProgressiveLoading||!O||l.mouseUsed||screen.width>1200},setContent:function(e,t){l.loop&&(t=St(t));var i=a.getItemAt(e.index);i&&(i.container=null);var n,r=a.getItemAt(t);if(!r)return e.el.innerHTML="",void 0;Nt("gettingData",t,r),e.index=t,e.item=r;var s=r.container=o.createEl("pswp__zoom-wrap");if(!r.src&&r.html&&(r.html.tagName?s.appendChild(r.html):s.innerHTML=r.html),cn(r),!r.src||r.loadError||r.loaded)r.src&&!r.loadError&&(n=o.createEl("pswp__img","img"),n.style.webkitBackfaceVisibility="hidden",n.style.opacity=1,n.src=r.src,hn(n,r.w,r.h),ln(t,r,s,n,!0));else{if(r.loadComplete=function(i){if(d){if(i.img&&(i.img.style.webkitBackfaceVisibility="hidden"),e&&e.index===t){if(cn(i,!0))return i.loadComplete=i.img=null,sn(i,gt),Ot(i),e.index===u&&a.updateCurrZoomItem(),void 0;i.imageAppended?!Xi&&i.placeholder&&(i.placeholder.style.display="none",i.placeholder=null):$.transform&&(ot||Xi)?nn.push({item:i,baseDiv:s,img:i.img,index:t,holder:e}):ln(t,i,s,i.img,ot||Xi)}i.loadComplete=null,i.img=null,Nt("imageLoadComplete",t,i)}},o.features.transform){var c="pswp__img pswp__img--placeholder";c+=r.msrc?"":" pswp__img--placeholder--blank";var h=o.createEl(c,r.msrc?"img":"");r.msrc&&(h.src=r.msrc),hn(h,r.w,r.h),s.appendChild(h),r.placeholder=h}r.loading||dn(r),a.allowProgressiveImg()&&(!Yi&&$.transform?nn.push({item:r,baseDiv:s,img:r.img,index:t,holder:e}):ln(t,r,s,r.img,!0,!0))}sn(r,gt),Yi||t!==u?Ot(r):(nt=s.style,en(r,n||r.img)),e.el.innerHTML="",e.el.appendChild(s)},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});var mn,pn={},gn=function(e,t,i){var n=document.createEvent("CustomEvent"),o={origEvent:e,target:e.target,releasePoint:t,pointerType:i||"touch"};n.initCustomEvent("pswpTap",!0,!0,o),e.target.dispatchEvent(n)};xt("Tap",{publicMethods:{initTap:function(){Tt("firstTouchStart",a.onTapStart),Tt("touchRelease",a.onTapRelease),Tt("destroy",function(){pn={},mn=null})},onTapStart:function(e){e.length>1&&(clearTimeout(mn),mn=null)},onTapRelease:function(e,t){if(t&&!Y&&!G&&!Jt){var i=t;if(mn&&(clearTimeout(mn),mn=null,Ci(i,pn)))return Nt("doubleTap",i),void 0;if("mouse"===t.type)return gn(e,t,"mouse"),void 0;var n=e.target.tagName.toUpperCase();if("BUTTON"===n||o.hasClass(e.target,"pswp__single-tap"))return gn(e,t),void 0;Dt(pn,i),mn=setTimeout(function(){gn(e,t),mn=null},300)}}}});var fn;xt("DesktopZoom",{publicMethods:{initDesktopZoom:function(){B||(O?Tt("mouseUsed",function(){a.setupDesktopZoom()}):a.setupDesktopZoom(!0))},setupDesktopZoom:function(t){fn={};var i="wheel mousewheel DOMMouseScroll";Tt("bindEvents",function(){o.bind(e,i,a.handleMouseWheel)}),Tt("unbindEvents",function(){fn&&o.unbind(e,i,a.handleMouseWheel)}),a.mouseZoomedIn=!1;var n,r=function(){a.mouseZoomedIn&&(o.removeClass(e,"pswp--zoomed-in"),a.mouseZoomedIn=!1),1>b?o.addClass(e,"pswp--zoom-allowed"):o.removeClass(e,"pswp--zoom-allowed"),s()},s=function(){n&&(o.removeClass(e,"pswp--dragging"),n=!1)};Tt("resize",r),Tt("afterChange",r),Tt("pointerDown",function(){a.mouseZoomedIn&&(n=!0,o.addClass(e,"pswp--dragging"))}),Tt("pointerUp",s),t||r()},handleMouseWheel:function(e){if(b<=a.currItem.fitRatio)return l.modal&&(l.closeOnScroll?L&&Math.abs(e.deltaY)>2&&(h=!0,a.close()):e.preventDefault()),!0;if(e.stopPropagation(),fn.x=0,"deltaX"in e)1===e.deltaMode?(fn.x=18*e.deltaX,fn.y=18*e.deltaY):(fn.x=e.deltaX,fn.y=e.deltaY);else if("wheelDelta"in e)e.wheelDeltaX&&(fn.x=-.16*e.wheelDeltaX),fn.y=e.wheelDeltaY?-.16*e.wheelDeltaY:-.16*e.wheelDelta;else{if(!("detail"in e))return;fn.y=e.detail}qt(b,!0);var t=pt.x-fn.x,i=pt.y-fn.y;(l.modal||t<=it.min.x&&t>=it.max.x&&i<=it.min.y&&i>=it.max.y)&&e.preventDefault(),a.panTo(t,i)},toggleDesktopZoom:function(t){t=t||{x:gt.x/2+yt.x,y:gt.y/2+yt.y};var i=l.getDoubleTapZoom(!0,a.currItem),n=b===i;a.mouseZoomedIn=!n,a.zoomTo(n?a.currItem.initialZoomLevel:i,t,333),o[(n?"remove":"add")+"Class"](e,"pswp--zoomed-in")}}});var yn,bn,vn,wn,Cn,En,xn,Sn,kn,Tn,Nn,_n,An={history:!0,galleryUID:1},Ln=function(){return Nn.hash.substring(1)},Rn=function(){yn&&clearTimeout(yn),vn&&clearTimeout(vn)},On=function(){var e=Ln(),t={};if(e.length<5)return t;var i,n=e.split("&");for(i=0;i<n.length;i++)if(n[i]){var o=n[i].split("=");o.length<2||(t[o[0]]=o[1])}if(l.galleryPIDs){var a=t.pid;for(t.pid=0,i=0;i<Ki.length;i++)if(Ki[i].pid===a){t.pid=i;break}}else t.pid=parseInt(t.pid,10)-1;return t.pid<0&&(t.pid=0),t},In=function(){if(vn&&clearTimeout(vn),Jt||W)return vn=setTimeout(In,500),void 0;wn?clearTimeout(bn):wn=!0;var e=u+1,t=Ji(u);t.hasOwnProperty("pid")&&(e=t.pid);var i=xn+"&gid="+l.galleryUID+"&pid="+e;Sn||-1===Nn.hash.indexOf(i)&&(Tn=!0);var n=Nn.href.split("#")[0]+"#"+i;_n?"#"+i!==window.location.hash&&history[Sn?"replaceState":"pushState"]("",document.title,n):Sn?Nn.replace(n):Nn.hash=i,Sn=!0,bn=setTimeout(function(){wn=!1},60)};xt("History",{publicMethods:{initHistory:function(){if(o.extend(l,An,!0),l.history){Nn=window.location,Tn=!1,kn=!1,Sn=!1,xn=Ln(),_n="pushState"in history,xn.indexOf("gid=")>-1&&(xn=xn.split("&gid=")[0],xn=xn.split("?gid=")[0]),Tt("afterChange",a.updateURL),Tt("unbindEvents",function(){o.unbind(window,"hashchange",a.onHashChange)});var e=function(){En=!0,kn||(Tn?history.back():xn?Nn.hash=xn:_n?history.pushState("",document.title,Nn.pathname+Nn.search):Nn.hash=""),Rn()};Tt("unbindEvents",function(){h&&e()}),Tt("destroy",function(){En||e()}),Tt("firstUpdate",function(){u=On().pid});var t=xn.indexOf("pid=");t>-1&&(xn=xn.substring(0,t),"&"===xn.slice(-1)&&(xn=xn.slice(0,-1))),setTimeout(function(){d&&o.bind(window,"hashchange",a.onHashChange)},40)}},onHashChange:function(){return Ln()===xn?(kn=!0,a.close(),void 0):(wn||(Cn=!0,a.goTo(On().pid),Cn=!1),void 0)},updateURL:function(){Rn(),Cn||(Sn?yn=setTimeout(In,800):In())}}}),o.extend(a,ii)};return e}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipeUI_Default=t()}(this,function(){"use strict";var e=function(e,t){var i,n,o,a,r,s,l,d,c,h,u,m,p,g,f,y,b,v,w,C=this,E=!1,x=!0,S=!0,k={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(e,t){return e.title?(t.children[0].innerHTML=e.title,!0):(t.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return e.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return e.currItem.title||""},indexIndicatorSep:" / "},T=function(e){if(y)return!0;e=e||window.event,f.timeToIdle&&f.mouseUsed&&!c&&D();for(var i,n,o=e.target||e.srcElement,a=o.className,r=0;r<V.length;r++)i=V[r],i.onTap&&a.indexOf("pswp__"+i.name)>-1&&(i.onTap(),n=!0);if(n){e.stopPropagation&&e.stopPropagation(),y=!0;var s=t.features.isOldAndroid?600:30;b=setTimeout(function(){y=!1},s)}},N=function(){return!e.likelyTouchDevice||f.mouseUsed||screen.width>1200},_=function(e,i,n){t[(n?"add":"remove")+"Class"](e,"pswp__"+i)},A=function(){var e=1===f.getNumItemsFn();e!==g&&(_(n,"ui--one-slide",e),g=e)},L=function(){_(l,"share-modal--hidden",S)},R=function(){return S=!S,S?(t.removeClass(l,"pswp__share-modal--fade-in"),setTimeout(function(){S&&L()},300)):(L(),setTimeout(function(){S||t.addClass(l,"pswp__share-modal--fade-in")},30)),S||I(),!1},O=function(t){t=t||window.event;var i=t.target||t.srcElement;return e.shout("shareLinkClick",t,i),i.href?i.hasAttribute("download")?!0:(window.open(i.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),S||R(),!1):!1},I=function(){for(var e,t,i,n,o,a="",r=0;r<f.shareButtons.length;r++)e=f.shareButtons[r],i=f.getImageURLForShare(e),n=f.getPageURLForShare(e),o=f.getTextForShare(e),t=e.url.replace("{{url}}",encodeURIComponent(n)).replace("{{image_url}}",encodeURIComponent(i)).replace("{{raw_image_url}}",i).replace("{{text}}",encodeURIComponent(o)),a+='<a href="'+t+'" target="_blank" class="pswp__share--'+e.id+'"'+(e.download?"download":"")+">"+e.label+"</a>",f.parseShareButtonOut&&(a=f.parseShareButtonOut(e,a));l.children[0].innerHTML=a,l.children[0].onclick=O},P=function(e){for(var i=0;i<f.closeElClasses.length;i++)if(t.hasClass(e,"pswp__"+f.closeElClasses[i]))return!0},M=0,D=function(){clearTimeout(w),M=0,c&&C.setIdle(!1)},B=function(e){e=e?e:window.event;var t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||(clearTimeout(w),w=setTimeout(function(){C.setIdle(!0)},f.timeToIdleOutside))},z=function(){f.fullscreenEl&&(i||(i=C.getFullscreenAPI()),i?(t.bind(document,i.eventK,C.updateFullscreen),C.updateFullscreen(),t.addClass(e.template,"pswp--supports-fs")):t.removeClass(e.template,"pswp--supports-fs"))},$=function(){f.preloaderEl&&(H(!0),h("beforeChange",function(){clearTimeout(p),p=setTimeout(function(){e.currItem&&e.currItem.loading?(!e.allowProgressiveImg()||e.currItem.img&&!e.currItem.img.naturalWidth)&&H(!1):H(!0)},f.loadingIndicatorDelay)}),h("imageLoadComplete",function(t,i){e.currItem===i&&H(!0)}))},H=function(e){m!==e&&(_(u,"preloader--active",!e),m=e)},j=function(e){var i=e.vGap;if(N()){var r=f.barsSize;if(f.captionEl&&"auto"===r.bottom)if(a||(a=t.createEl("pswp__caption pswp__caption--fake"),a.appendChild(t.createEl("pswp__caption__center")),n.insertBefore(a,o),t.addClass(n,"pswp__ui--fit")),f.addCaptionHTMLFn(e,a,!0)){var s=a.clientHeight;i.bottom=parseInt(s,10)||44}else i.bottom=r.top;else i.bottom="auto"===r.bottom?0:r.bottom;i.top=r.top}else i.top=i.bottom=0},q=function(){f.timeToIdle&&h("mouseUsed",function(){t.bind(document,"mousemove",D),t.bind(document,"mouseout",B),v=setInterval(function(){M++,2===M&&C.setIdle(!0)},f.timeToIdle/2)})},F=function(){h("onVerticalDrag",function(e){x&&.95>e?C.hideControls():!x&&e>=.95&&C.showControls()});var e;h("onPinchClose",function(t){x&&.9>t?(C.hideControls(),e=!0):e&&!x&&t>.9&&C.showControls()}),h("zoomGestureEnded",function(){e=!1,e&&!x&&C.showControls()})},V=[{name:"caption",option:"captionEl",onInit:function(e){o=e}},{name:"share-modal",option:"shareEl",onInit:function(e){l=e},onTap:function(){R()}},{name:"button--share",option:"shareEl",onInit:function(e){s=e},onTap:function(){R()}},{name:"button--zoom",option:"zoomEl",onTap:e.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(e){r=e}},{name:"button--close",option:"closeEl",onTap:e.close},{name:"button--arrow--left",option:"arrowEl",onTap:e.prev},{name:"button--arrow--right",option:"arrowEl",onTap:e.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){i.isFullscreen()?i.exit():i.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(e){u=e}}],U=function(){var e,i,o,a=function(n){if(n)for(var a=n.length,r=0;a>r;r++){e=n[r],i=e.className;for(var s=0;s<V.length;s++)o=V[s],i.indexOf("pswp__"+o.name)>-1&&(f[o.option]?(t.removeClass(e,"pswp__element--disabled"),o.onInit&&o.onInit(e)):t.addClass(e,"pswp__element--disabled"))}};a(n.children);var r=t.getChildByClass(n,"pswp__top-bar");r&&a(r.children)};C.init=function(){t.extend(e.options,k,!0),f=e.options,n=t.getChildByClass(e.scrollWrap,"pswp__ui"),h=e.listen,F(),h("beforeChange",C.update),h("doubleTap",function(t){var i=e.currItem.initialZoomLevel;e.getZoomLevel()!==i?e.zoomTo(i,t,333):e.zoomTo(f.getDoubleTapZoom(!1,e.currItem),t,333)}),h("preventDragEvent",function(e,t,i){var n=e.target||e.srcElement;n&&n.className&&e.type.indexOf("mouse")>-1&&(n.className.indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(n.tagName))&&(i.prevent=!1)}),h("bindEvents",function(){t.bind(n,"pswpTap click",T),t.bind(e.scrollWrap,"pswpTap",C.onGlobalTap),e.likelyTouchDevice||t.bind(e.scrollWrap,"mouseover",C.onMouseOver)}),h("unbindEvents",function(){S||R(),v&&clearInterval(v),t.unbind(document,"mouseout",B),t.unbind(document,"mousemove",D),t.unbind(n,"pswpTap click",T),t.unbind(e.scrollWrap,"pswpTap",C.onGlobalTap),t.unbind(e.scrollWrap,"mouseover",C.onMouseOver),i&&(t.unbind(document,i.eventK,C.updateFullscreen),i.isFullscreen()&&(f.hideAnimationDuration=0,i.exit()),i=null)}),h("destroy",function(){f.captionEl&&(a&&n.removeChild(a),t.removeClass(o,"pswp__caption--empty")),l&&(l.children[0].onclick=null),t.removeClass(n,"pswp__ui--over-close"),t.addClass(n,"pswp__ui--hidden"),C.setIdle(!1)}),f.showAnimationDuration||t.removeClass(n,"pswp__ui--hidden"),h("initialZoomIn",function(){f.showAnimationDuration&&t.removeClass(n,"pswp__ui--hidden")}),h("initialZoomOut",function(){t.addClass(n,"pswp__ui--hidden")}),h("parseVerticalMargin",j),U(),f.shareEl&&s&&l&&(S=!0),A(),q(),z(),$()},C.setIdle=function(e){c=e,_(n,"ui--idle",e)},C.update=function(){x&&e.currItem?(C.updateIndexIndicator(),f.captionEl&&(f.addCaptionHTMLFn(e.currItem,o),_(o,"caption--empty",!e.currItem.title)),E=!0):E=!1,S||R(),A()},C.updateFullscreen=function(n){n&&setTimeout(function(){e.setScrollOffset(0,t.getScrollY())},50),t[(i.isFullscreen()?"add":"remove")+"Class"](e.template,"pswp--fs")},C.updateIndexIndicator=function(){f.counterEl&&(r.innerHTML=e.getCurrentIndex()+1+f.indexIndicatorSep+f.getNumItemsFn())},C.onGlobalTap=function(i){i=i||window.event;var n=i.target||i.srcElement;if(!y)if(i.detail&&"mouse"===i.detail.pointerType){if(P(n))return e.close(),void 0;t.hasClass(n,"pswp__img")&&(1===e.getZoomLevel()&&e.getZoomLevel()<=e.currItem.fitRatio?f.clickToCloseNonZoomable&&e.close():e.toggleDesktopZoom(i.detail.releasePoint))}else if(f.tapToToggleControls&&(x?C.hideControls():C.showControls()),f.tapToClose&&(t.hasClass(n,"pswp__img")||P(n)))return e.close(),void 0},C.onMouseOver=function(e){e=e||window.event;var t=e.target||e.srcElement;_(n,"ui--over-close",P(t))},C.hideControls=function(){t.addClass(n,"pswp__ui--hidden"),x=!1},C.showControls=function(){x=!0,E||C.update(),t.removeClass(n,"pswp__ui--hidden")},C.supportsFullscreen=function(){var e=document;return!!(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen)},C.getFullscreenAPI=function(){var t,i=document.documentElement,n="fullscreenchange";return i.requestFullscreen?t={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:n}:i.mozRequestFullScreen?t={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+n}:i.webkitRequestFullscreen?t={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+n}:i.msRequestFullscreen&&(t={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),t&&(t.enter=function(){return d=f.closeOnScroll,f.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?e.template[this.enterK]():(e.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT),void 0)},t.exit=function(){return f.closeOnScroll=d,document[this.exitK]()},t.isFullscreen=function(){return document[this.elementK]}),t}};return e}),function(){var e,t,i=this,n="photoswipe",o=function(){var e=document.createElement("div");return e.className="pswp",e.setAttribute("tabindex",-1),e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true"),e.setAttribute("data-lightbox-type",n),e.innerHTML=JST["edicy-gallery/photoswipe/photoswipe_template"](),e},a=function(e,t){for(var i=0,n=t.length;n>i;i++)if(t[i].id&&t[i].id===e)return i;return 0},r=function(i,n){var r=a(n.photo_id,n.photos),s=o(),l=n.photos.map(function(e){var t=EdicyGalleries.findFittingSize(e.sizes,window.innerWidth,window.innerHeight);return{id:e.id,title:e.title,src:t.url,w:t.width,h:t.height}});document.body.appendChild(s),e=new PhotoSwipe(s,PhotoSwipeUI_Default,l,{index:r,counterEl:!1,history:!1,shareEl:!1,closeOnScroll:!1}),e.listen("beforeChange",function(){t||s.dispatchEvent(new CustomEvent("edicy:lightbox:photo:blur",{bubbles:!0,detail:{gallery_id:n.gallery_id,photo_id:t}}))}),e.listen("afterChange",function(){s.dispatchEvent(new CustomEvent("edicy:lightbox:photo:focus",{bubbles:!0,detail:{gallery_id:n.gallery_id,photo_id:n.photos[e.getCurrentIndex()].id}})),t=n.photos[e.getCurrentIndex()].id}),e.listen("close",function(){t&&s.dispatchEvent(new CustomEvent("edicy:lightbox:photo:blur",{bubbles:!0,detail:{gallery_id:n.gallery_id,photo_id:t}})),s.dispatchEvent(new CustomEvent("edicy:lightbox:hide",{bubbles:!0,detail:{gallery_id:n.gallery_id,photo_id:t}})),t=null}),e.listen("destroy",function(){s.parentNode&&s.parentNode.removeChild(s),t=null}),e.init(),s.dispatchEvent(new CustomEvent("edicy:lightbox:show",{bubbles:!0,detail:{gallery_id:n.gallery_id}}))},s=function(t,i){e&&(e.items.forEach(function(e){e.id==i.photo_id&&(e.title=i.photo.title)}),e.ui.update())};i.edy.push(["extendLightbox",{type:"photoswipe",name:"Photoswipe",show:r,change:s}])}(this),function(e){if(!e.fn.droppable){var t=function(e,t){for(var i,n,o=null,a=e.length;a--;)i=e[a].width-t,e[a].thumbnail&&"medium"===e[a].thumbnail||!(!o||0>n&&i>=0||(n>=0&&i>=0||0>n&&0>i)&&Math.abs(i)<Math.abs(n))||(o=e[a].url,n=i);return o},i=function(e){var i={get:function(i){var n;return"src"===i?n=e.url:"large_thumbnail_src"===i?(e.sizes&&(n=t(e.sizes,600)),n=e.url):"width"===i?n=e.width:"height"===i&&(n=e.height),n},isImage:function(){return e&&"photo"===e.type}};return{helper:{data:function(e){return"model"===e?i:void 0}}}};e.fn.droppable=function(){return this.each(function(){e(this).addClass("edy-accepts-assets"),e(this).on({"draggable:dragenter":function(t){e(this).triggerHandler("dropover",[i(t.originalEvent.detail.payload)])},"draggable:dragleave":function(t){e(this).triggerHandler("dropout",[i(t.originalEvent.detail.payload)])},"draggable:drop":function(t){e(this).triggerHandler("drop",[i(t.originalEvent.detail.payload)])}})})}}}(Edicy.jQuery),Edicy.jQuery(function(e){Edicy.elements=new Edicy.Backbone.Collection,Edicy.elements.url="/admin/content/elements",Edicy.forms=new Edicy.Backbone.Collection,Edicy.forms.url="/admin/content/forms",Edicy.galleries=new Edicy.Backbone.Collection([],{model:Edicy.Gallery}),Edicy.galleries.url="/admin/content/media_sets",Edicy.textpartials=new Edicy.Backbone.Collection,Edicy.textpartials.url="/admin/content/text_partials",Edicy.articles=new Edicy.Backbone.Collection,Edicy.articles.url="/admin/content/articles",Edicy.content_partials=new Edicy.Backbone.Collection,Edicy.content_partials.url="/admin/content/content_partials",Edicy.SearchCollection.url="/admin/search/textlink",Edicy.assets=new Edicy.AssetsUploader,Edicy.assets.url="/admin/assets",Edicy.userLocation=function(t){e.getJSON("/admin/user_location",t)},document.body.classList.add("edy-editmode"),new Edicy.PageEditorView({el:document.body}).render(),new Edicy.AdminToolbarView({el:e("#edy-hldr")}).render(),new Edicy.FileDragDropView({el:document.body}),e(document).ajaxComplete(function(e,t){401==t.status&&t.getResponseHeader("X-Logout-Redirect")&&(window.location.href=t.getResponseHeader("X-Logout-Redirect"))})});